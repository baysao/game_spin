/*
@license
Webix <%= pkg.productName %> v.<%= pkg.version %>
This software is covered by Webix Trial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).docManager={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function i(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var n=function(){return(n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function r(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),r=0;for(e=0;e<i;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,r++)n[r]=o[a];return n}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var o,a=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){!function(t){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function i(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var n=function(){return(n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},r=function(){},o=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)},t.prototype.getParam=function(t,e){var i=this._data[t];if(void 0!==i||!e)return i;var n=this.getParentView();return n?n.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(i){return(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,i){var n=t.attachEvent(e,i);return this._events.push({obj:t,id:n}),n},t.prototype.contains=function(t){for(var e in this._subs){var i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var i=e.view._getDefaultSub();if(i)return i}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function a(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),i=[],n=0;n<e.length;n++){var r=e[n],o={},a=r.indexOf(":");if(-1===a&&(a=r.indexOf("?")),-1!==a)for(var s=0,c=r.substr(a+1).split(/[\:\?\&]/g);s<c.length;s++){var l=c[s].split("=");o[l[0]]=decodeURIComponent(l[1])}i[n]={page:a>-1?r.substr(0,a):r,params:o,isNew:!0}}return i}function s(t){for(var e=[],i=0,n=t;i<n.length;i++){var r=n[i];e.push("/"+r.page);var o=c(r.params);o&&e.push("?"+o)}return e.join("")}function c(t){var e=[];for(var i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}var l=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:a(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var i=new t(this.route,this.index+this._next);return i.setParams(i.route.url,e,i.index),i},t.prototype.setParams=function(t,e,i){if(e){var n=t[i].params;for(var r in e)n[r]=e[r]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=s(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var i=this.route.url;if(null===t)return i;var n=this.route.url,r=!0;if(i=n.slice(0,this.index+(e?this._next:0)),t){i=i.concat(a(t));for(var o=0;o<i.length;o++)n[o]&&(i[o].view=n[o].view),r&&n[o]&&i[o].page===n[o].page?i[o].isNew=!1:i[o].isNew&&(r=!1)}return i},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=s(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,i){var n=this,o=this._join(t.url,i);return this.setParams(o,t.params,this.index+(i?this._next:0)),new Promise((function(t,i){var a=s(o),c={url:o,redirect:a,confirm:Promise.resolve()},l=e?e.app:null;!l||l.callEvent("app:guard",[c.redirect,e,c])?c.confirm.catch((function(t){return i(t)})).then((function(){if(null!==c.redirect){if(c.redirect!==a)return l.show(c.redirect),void i(new r);n.route.path=a,n.route.url=o,t()}else i(new r)})):i(new r)}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=s(e.url)),new t(e,0)},t.prototype.update=function(t,e,i){var n=this.route.url[this.index+(i||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?n.page=e:n.params[t]=e,this.route.path=s(this.route.url)},t}(),p=function(t){function e(e,i){var n=t.call(this,e.webix)||this;return n.app=e,n._children=[],n}return i(e,t),e.prototype.ui=function(t,e){var i=(e=e||{}).container||t.container,n=this.app.createView(t);return this._children.push(n),n.render(i,this._segment,this),"object"!=typeof t||t instanceof o?n:n.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var i in t)this.setParam(i,t[i]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var n=this.getParentView();return n?n.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var r=this.getSubViewInfo(e.target);if(r){if(r.parent!==this)return r.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,r.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,i){var n=this;return t.show(e,i,!0).then((function(){return n._init_url_data(),n._urlChange()})).then((function(){t.route.linkRouter&&(n.app.getRouter().set(t.route.path,{silent:!0}),n.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){return this.getUrl(),this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,i){var n=this;"string"==typeof e&&(e=new l(e,0)),this._segment=e,this._parent=i,this._init_url_data();var r="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==r?(this._container=r,this._render(e)):this._urlChange().then((function(){return n.getRoot()}))},e.prototype._render=function(t){var e=this,i=this.config();return i.then?i.then((function(i){return e._render_final(i,t)})):this._render_final(i,t)},e.prototype._render_final=function(t,e){var i,n=this,r=null,o=null,a=!1;if(this._container.tagName?o=this._container:(r=this._container).popup?(o=document.body,a=!0):o=this.webix.$$(r.id),!this.app||!o)return Promise.reject(null);var s=this._segment.current(),c={ui:{}};this.app.copyConfig(t,c.ui,this._subs),this.app.callEvent("app:render",[this,e,c]),c.ui.$scope=this,!r&&s.isNew&&s.view&&s.view.destructor();try{if(r&&!a){var l=o,p=l.getParentView();p&&"multiview"===p.name&&!c.ui.id&&(c.ui.id=l.config.id)}this._root=this.app.webix.ui(c.ui,o);var u=this._root;a&&u.setPosition&&!u.isVisible()&&u.show(),r&&(r.view&&r.view!==this&&r.view!==this.app&&r.view.destructor(),r.id=this._root.config.id,this.getParentView()||!this.app.app?r.view=this:r.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((function(){return n._urlChange().then((function(){return n._initUrl=null,n.ready(n._root,e.suburl())}))}))}catch(t){i=Promise.reject(t)}return i.catch((function(t){return n._initError(n,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var i in this._subs){var n=this._subs[i],r=this._renderFrameLock(i,n,null);r&&e.push(r)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,i){if(!e.lock){var n=this._renderFrame(t,e,i);n&&(e.lock=n.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,i){var n=this;if("default"===t){if(this._segment.next()){var r=i?i.params:null;return e.params&&(r=this.webix.extend(r||{},e.params)),this._createSubView(e,this._segment.shift(r))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((function(){return n._createSubView(e,e.route)}));if(e.branch)return}var o=e.view;if(!o&&e.url){if("string"==typeof e.url)return e.route=new l(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||o instanceof e.url||(o=new(this.app._override(e.url))(this.app,"")),o||(o=e.url)}if(o)return o.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var i=this;return this.app.createFromURL(e.current()).then((function(n){return n.render(t,e,i)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(o),u=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._ui=i.ui,n}return i(e,t),e.prototype.config=function(){return this._ui},e}(p),h=function(){function t(t,e,i){this.path="",this.app=i}return t.prototype.set=function(t,e){this.path=t;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),f=!0,d=function(t){function e(e){var i=this,n=(e||{}).webix||window.webix;return e=n.extend({name:"App",version:"1.0",start:"/home"},e,!0),(i=t.call(this,n,e)||this).config=e,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return i(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,i){if((t instanceof o||"function"==typeof t&&t.prototype instanceof o)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);var n=t instanceof Array;for(var r in e=e||(n?[]:{}),t){var a=t[r];if("function"==typeof a&&a.prototype instanceof o&&(a={$subview:a}),!a||"object"!=typeof a||a instanceof this.webix.DataCollection||a instanceof RegExp||a instanceof Map)e[r]=a;else if(a instanceof Date)e[r]=new Date(a);else{var s=this.copyConfig(a,a instanceof Array?[]:{},i);null!==s&&(n?e.push(s):e[r]=s)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var i=e.getAttribute("trigger");if(i)return this._forView(e,(function(t){return t.app.trigger(i)})),t.cancelBubble=!0,t.preventDefault();var n=e.getAttribute("route");if(n)return this._forView(e,(function(t){return t.show(n)})),t.cancelBubble=!0,t.preventDefault()}var r=e.parentNode;r&&this.clickHandler(t,r)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,i=this.config.views,n=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(n="function"==typeof i?i(t):i[t])&&(t=n,n=null),n||("_hidden"===t?n={hidden:!0}:"_blank"===t?n={}:(t=t.replace(/\./g,"/"),n=this.require("jet-views",t)))}catch(e){n=this._loadError(t,e)}return n.then||(n=Promise.resolve(n)),n=n.then((function(t){return t.__esModule?t.default:t})).catch((function(i){return e._loadError(t,i)}))},e.prototype._forView=function(t,e){var i=this.webix.$$(t);i&&e(i.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(i){return e.createView(i,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e.prototype.createView=function(t,i,n){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:i,params:n,router:h});if(t.prototype instanceof o)return new t(this,{name:i,params:n});t=t(this)}return t instanceof o?t:new u(this,{name:i,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){var n=e[i].message;0===n.indexOf("Module build failed")?(n=n.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+n+"</pre>"):(n+="<br><br>Check console for more details",this.webix.message({type:"error",text:n,expire:-1}))}},e.prototype.render=function(t,e,i){var n=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var r=null;this.$router?r="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString():(f&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return n.clickHandler(t)})),f=!1),"string"==typeof e&&(e=new l(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0);var o=i?i.params:this.config.params||null,a=this.getSubView(),s=this._subSegment,c=s.show({url:r,params:o},a).then((function(){return n.createFromURL(s.current())})).then((function(e){return e.render(t,s)})).then((function(t){return n.$router.set(s.route.path,{silent:!0}),n.callEvent("app:route",[n.getUrl()]),t}));return this.ready=this.ready.then((function(){return c})),c},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new p(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;if(this._segment=t,this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof r))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(i,"webixappstart"),e.webix.html.addCss(i,"webixapp")}),10)}if(t){if(this.app){var n=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new l(this.config.start,0),t.current().view=n}}else{var o=this.$router.get();o||(o=this.config.start,this.$router.set(o,{silent:!0})),t=new l(o,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,i){var n=!0!==t.$subview?t.$subview:null,r=t.name||(n?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[r]={id:e.id,url:n,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(o),v=function(){function t(t,e){var i=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return t.prototype.set=function(t,e){var i=this;if(this.config.routes){var n=t.split("?",2);for(var r in this.config.routes)if(this.config.routes[r]===n[0]){t=r+(n.length>1?"?"+n[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),g=!1;function m(t){if(!g&&t){g=!0;var e=window;e.Promise||(e.Promise=t.promise);var i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){var i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});var n=t.ui.baselayout.prototype.addView,r=t.ui.baselayout.prototype.removeView,o={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var i=this.$scope,r={};t=i.app.copyConfig(t,{},r),n.apply(this,[t,e]);var o=function(t){i._renderFrame(t,r[t],null).then((function(){i._subs[t]=r[t]}))};for(var a in r)o(a);return t.id}return n.apply(this,arguments)},removeView:function(){if(r.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var i in e){var n=e[i];t.$$(n.id)||(n.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,o,!0),t.extend(t.ui.baselayout.prototype,o,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}}var w=function(t){function e(e){var i;return e.router=e.router||v,m((i=t.call(this,e)||this).webix),i}return i(e,t),e.prototype.require=function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()},e}(d),y=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}i(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(v),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var i=this;this.path=t,e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function b(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function _(t,e,i){for(var n in t)b(t,n)&&e.call(i||t,t[n],n,t)}function x(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var S=String.prototype.replace,$=String.prototype.split,k=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},T={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:k,chinese:function(){return 0},croatian:k,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:k,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},C={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function F(t){var e,i=(e={},_(C,(function(t,i){_(t,(function(t){e[t]=i}))})),e);return i[t]||i[$.call(t,/-/,1)[0]]||i.en}function I(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var P=/\$/g,E=/%\{(.*?)\}/g;function D(t,e,i,n){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var r=t,o=n||E,a="number"==typeof e?{smart_count:e}:e;if(null!=a.smart_count&&r){var s=$.call(r,"||||");r=(s[function(t,e){return T[F(t)](e)}(i||"en",a.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return r=S.call(r,o,(function(t,e){return b(a,e)&&null!=a[e]?S.call(a[e],P,"$$"):t}))}function A(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?D:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||x,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(I(e)+"(.*?)"+I(i),"g")}(e.interpolation)}A.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},A.prototype.extend=function(t,e){_(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.extend(t,n):this.phrases[n]=t}),this)},A.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:_(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.unset(t,n):delete this.phrases[n]}),this)},A.prototype.clear=function(){this.phrases={}},A.prototype.replace=function(t){this.clear(),this.extend(t)},A.prototype.t=function(t,e){var i,n,r=null==e?{}:e;return"string"==typeof this.phrases[t]?i=this.phrases[t]:"string"==typeof r._?i=r._:this.onMissingKey?n=(0,this.onMissingKey)(t,r,this.currentLocale,this.tokenRegex):(this.warn('Missing translation for key: "'+t+'"'),n=t),"string"==typeof i&&(n=D(i,r,this.currentLocale,this.tokenRegex)),n},A.prototype.has=function(t){return b(this.phrases,t)},A.transformPhrase=function(t,e,i){return D(t,e,i)};var R=A,j=window.webix;j&&m(j);var V=function(t,e,i){var n=(i=i||{}).storage,r=n?n.get("lang")||"en":i.lang||"en";function o(e,o,a){o.__esModule&&(o=o.default);var c={phrases:o};i.polyglot&&t.webix.extend(c,i.polyglot);var l=s.polyglot=new R(c);if(l.locale(e),s._=t.webix.bind(l.t,l),r=e,n&&n.put("lang",r),i.webix){var p=i.webix[e];p&&t.webix.i18n.setLocale(p)}return a?Promise.resolve():t.refresh()}function a(e,n){if(!1!==i.path){var r=(i.path?i.path+"/":"")+e;o(e,t.require("jet-locales",r),n)}}var s={getLang:function(){return r},setLang:a,setLangData:o,_:null,polyglot:null};t.setService("locale",s),a(r,!0)},L=window;L.Promise||(L.Promise=L.webix.promise);var M=1;function O(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function U(t,e){e=e||{};var i={},n={},r=function(t,e){var r=M++;return i[r]={mask:t,handler:e},e("*"===t?n:n[t],void 0,t),r},o=[],a=!1,s=function(t,e,n,r){if(a)o.push([t,e,n,r]);else for(var s=Object.keys(i),c=0;c<s.length;c++){var l=i[s[c]];l&&("*"!==l.mask&&l.mask!==t||l.handler(n,e,t,r))}};for(var c in t)if(t.hasOwnProperty(c)){var l=t[c];e.nested&&"object"==typeof l&&l?n[c]=U(l,e):B(n,l,c,s)}return Object.defineProperty(n,"$changes",{value:{attachEvent:r,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$observe",{value:r,enumerable:!1,configurable:!1}),Object.defineProperty(n,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)n[t]=e[t]}}for(a=!0,t(n),a=!1;o.length;){var i=o.shift();s.apply(this,i)}},enumerable:!1,configurable:!1}),n}function B(t,e,i,n){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var r=e;e=t,n(i,r,t,null)}},enumerable:!0,configurable:!1})}var H=!1;function z(t,e,i){var n=e.$width,r=e.$height;t.config._fillApp?t.define({width:n,height:r}):t.define({left:(n-t.$width)/2,top:(r-t.$height)/2}),i||t.resize()}function W(t,e){var i=e.getRoot();t.attachEvent("onHide",(function(){i.$destructed||(webix.html.removeCss(i.$view,"webix_win_inside"),i.enable())}));var n=e.attachEvent("view:resize",(function(){z(t,i)}));t.attachEvent("onDestruct",(function(){e.detachEvent(n)}))}function G(t){return{attachEvent:function(e,i){return webix.UIManager.addHotKey(e,i,t),{key:e,handler:i}},detachEvent:function(e){var i=e.key,n=e.handler;return webix.UIManager.removeHotKey(i,n,t)}}}var N="<span class='webix_icon wxi-folder'></span>",q="<span class='webix_icon wxi-dots webix_fmanager_menu_icon'></span>",K=function(t){function e(e,i){var n=t.call(this,e)||this;return n.compact=!!i.compact,n.tree=!!i.tree,n}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("state"),n=[{id:"download",value:e("Download"),icon:"wxi-download",show:32,hotkey:"Ctrl+D"},{$template:"Separator",show:32},{id:"toggle-preview",value:e("Preview"),icon:"wxi-eye",show:17},{id:"locate",value:e("Open item location"),icon:"wxi-folder",hotkey:"Ctrl+Alt+O",show:65},{id:"open",value:e("Open"),icon:"wxi-folder-open",hotkey:"Ctrl+O",show:8},{$template:"Separator",show:8},{id:"copy",value:e("Copy"),hotkey:"Ctrl+C",icon:"fmi-content-copy",show:35},{id:"cut",value:e("Cut"),hotkey:"Ctrl+X",icon:"fmi-content-cut",show:35},{id:"paste",value:e("Paste"),hotkey:"Ctrl+V",icon:"fmi-content-paste",show:161},{$template:"Separator",show:35},{id:"rename",value:e("Rename"),icon:"fmi-rename-box",hotkey:"Ctrl+R",show:1},{id:"delete",value:e("Delete"),icon:"wxi-close",hotkey:"Del / &#8592;",show:3}];return this.app.config.editor&&n.splice(5,0,{id:"edit",value:e("Edit"),icon:"wxi-pencil",hotkey:"Ctrl+E",show:6}),{view:"menu",css:"webix_fmanager_menu",layout:"y",autoheight:!0,data:n,template:function(t){return(t.icon?'<span class="webix_list_icon webix_icon '+t.icon+'"></span>':"")+t.value+(t.hotkey?'<span class="webix_fmanager_context-menu-hotkey">'+t.hotkey+"</span>":"")},on:{onMenuItemClick:function(e){"toggle-preview"===e?i.preview=!i.preview:t.app.callEvent("app:action",[e,t.Files]),t.app.callEvent("app:filemenu:click")}}}},e.prototype.FilterOptions=function(t){var e=this;this.Files=t;var i=t[0],n=t.length>1,r=["image","audio","video","code","pdf"],o=-1!=r.indexOf(i.type)||-1!=r.indexOf(i.$ext),a=this.app.getState().search,s="empty"===i.type;this.getRoot().define("width",a&&!n?270:200),this.getRoot().filter((function(t){return!(!(128&t.show)&&s||n&&!(2&t.show)||"folder"===i.type&&!(1&t.show)||4&t.show&&"code"!==i.type||8&t.show&&!o||16&t.show&&!e.compact||32&t.show&&e.tree||64&t.show&&!a)}))},e}(p),J=function(t){function e(e,i){var n=t.call(this,e)||this;return n._config=i,n}return i(e,t),e.prototype.config=function(){var t=this;return{view:"context",body:{$subview:new(this.app.dynamic(K))(this.app,n({},this._config)),name:"options"},on:{onBeforeShow:function(e){var i=t._Locate(e);if(!i)return!1;t.getSubView("options").FilterOptions(i)}}}},e.prototype.init=function(){var t=this;this.on(this.app,"app:filemenu:click",(function(){return t.getRoot().hide()}))},e.prototype.AttachTo=function(t,e){this._Locate=e,this.getRoot().attachTo(t)},e.prototype.Show=function(t){this.getRoot().show(t,{x:-t.offsetX,y:t.target.offsetHeight-t.offsetY})},e.prototype.Hide=function(){this.getRoot().hide()},e}(p),Y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.init=function(){var t=this;this.State=this.getParam("state"),this.Local=this.app.getService("local"),this._Track=!0,this.WTable.attachEvent("onAfterSelect",(function(){return t.ShiftFocus()})),this.WTable.attachEvent("onSelectChange",(function(){if(t._Track){var e=[].concat(t.WTable.getSelectedId(!0).map((function(e){return t.WTable.getItem(e)}))).filter((function(t){return".."!==t.value}));(e.length||t.State.selectedItem.length)&&(e.length||(e.$noSelect=!0),t.State.selectedItem=e)}})),this.on(this.State.$changes,"path",(function(e,i){t.State.search?i&&t.State.$batch({search:"",searchStats:null}):"files"===t.State.source&&(i?t.Local.folders().then((function(n){t.State.selectedItem=t.GetPrevLocation(n,e,i),t.LoadData(e)})):t.LoadData(e))})),this.on(this.WTable.data,"onStoreUpdated",(function(e,i,n){!n&&t.WTable.count()&&t.State.selectedItem.length&&t.SelectActive()})),this.AddHotkeys();var e=this.getParam("compact",!0);this.Menu=this.ui(new(this.app.dynamic(J))(this.app,{compact:e,state:this.State})),this.Menu.AttachTo(this.WTable.$view,(function(e){var i=t.WTable.locate(e);if(!i)return[{type:"empty"}];var n=t.WTable.getItem(i);if(".."==n.value)return!1;t.WTable.isSelected(i)||t.WTable.select(i);var r=t.WTable.getSelectedId(!0);return 1===r.length?[n]:r=r.map((function(e){return t.WTable.getItem(e)})).filter((function(t){return".."!=t.value}))})),this.on(this.WTable,"onAfterScroll",(function(){return t.Menu.Hide()})),this.on(this.WTable,"onBeforeDrag",(function(){return t.Menu.Hide()}))},e.prototype.ShiftFocus=function(){this.getParam("trackActive",!0)&&(this.State.isActive=!0)},e.prototype.Activate=function(t){if(t.length)if(1===t.length){var e=t[0];if("folder"===e.type)this.ShowSubFolder(".."===e.value?e.value:e.id);else{var i="code"===e.type&&this.app.config.editor?"edit":"open";this.app.callEvent("app:action",[i,t])}}else i=this.app.config.editor?"edit":"open",this.app.callEvent("app:action",[i,t])},e.prototype.ShowSubFolder=function(t){var e;if(".."==t){var i=this.State.path.split("/");e="/"+i.slice(1,i.length-1).join("/")}else e=t;this.State.path=e},e.prototype.GetPrevLocation=function(t,e,i){if("/"===i||!t.exists(i))return[];var n;for("/"===e&&(e="../files");i;)if(n=i,(i=t.getParentId(i))===e){var r=t.getItem(n);return[{id:r.id,value:r.value,type:"folder",date:new Date(r.date)}]}return[]},e.prototype.GetTargetFolder=function(t){var e=t?this.WTable.getItem(t):null;return e&&"folder"===e.type&&".."!==e.value?e.id:this.State.path},e.prototype.SelectActive=function(){var t=this.WTable;if(!1!==this.State.isActive&&!t.getSelectedId()){for(var e=this.State.selectedItem,i=0;i<e.length;i++)t.exists(e[i].id)&&t.select(e[i].id,!0);if(!e.$noSelect&&!t.getSelectedId()){var n=t.getFirstId();n&&(t.select(n),e.$noSelect=!1)}webix.delay((function(){return webix.UIManager.setFocus(t)}))}},e.prototype.GetSelection=function(){var t=this;return this.WTable.getSelectedId(!0).map((function(e){return t.WTable.getItem(e)}))},e.prototype.LoadData=function(t,e){var i=this;this._Track=!1;var n=this.WTable;e?(n.clearAll(),this.app.getService("backend").search(t,e).then((function(t){if(i.app){for(var e=0;e<t.length;++e)i.Local.prepareData(t[e]);n.parse(t),i.GetSearchStats(t)}}))):n.data.url!==t&&(n.clearAll(),this.Local.files(t).then((function(t){i.app&&(i.RenderData(t),i.SelectActive())}))),this._Track=!0},e.prototype.MoveFiles=function(t,e){return this.app.getService("operations").move(t,this.GetTargetFolder(e)),!1},e.prototype.Icon=function(t){return'<img class="webix_fmanager_file-type-icon" src="'+this.app.getService("backend").icon(t)+'" />'},e.prototype.DragMarker=function(t){var e=this.WTable,i=e.find((function(t){return".."===t.value}),!0);if(i){var n=t.source.indexOf(i.id);-1!==n&&t.source.splice(n,1)}var r=t.source.length;if(!r)return!1;1===r&&e.select(t.source[0]);var o=e.getItem(t.source[0]),a="<div class='webix_fmanager_grid_drag_zone_list'>";if(a+='<div class="webix_fmanager_inner_drag_zone_list">'+("folder"===o.type?N:this.Icon(o))+o.value+"</div>",a+="</div>",r>1){a="<div class='webix_drag_main'>"+a+"</div>";var s="<div class='webix_drag_multiple'></div>";r>2&&(s="<div class='webix_drag_multiple_last'></div>"+s),a=s+(a+="<div class='webix_badge'>"+r+"</div>")}t.html=a},e.prototype.AddHotkeys=function(){var t=this,e=webix.env.isMac?"COMMAND":"CTRL",i=[{key:"DELETE",oper:"delete"},{key:"BACKSPACE",oper:"delete"},{key:e+"+C",oper:"copy"},{key:e+"+X",oper:"cut"},{key:e+"+V",oper:"paste"},{key:e+"+R",oper:"rename"},{key:e+"+O",oper:"open"},{key:e+"+D",oper:"download"},{key:e+"+Alt+O",oper:"locate"}];this.app.config.editor&&i.push({key:e+"+E",oper:"edit"});for(var n=function(e){r.on(G(r.getRoot()),i[e].key,(function(n,r){var o=[i[e].oper];t.app.callEvent("app:action",o),webix.html.preventEvent(r)}))},r=this,o=0;o<i.length;++o)n(o);this.on(G(this.getRoot()),e+"+A",(function(e,i){t.WTable.selectAll(),webix.html.preventEvent(i)}))},e.prototype.GetSearchStats=function(t){var e=t.length,i=t.filter((function(t){return"folder"===t.type}));this.State.searchStats={folders:i?i.length:0,files:e-i.length}},e.prototype.EmptyClick=function(){!1!==this.State.isActive?this.WTable.unselectAll():this.ShiftFocus()},e}(p),X=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.getParam("compact",!0),i="mini"===webix.skin.$name||"compact"===webix.skin.$name;return{view:"dataview",localId:"cards",drag:!e,select:!0,multiselect:!0,css:"webix_noselect webix_fmanager_cards",template:function(e){return t.CardTemplate(e)},type:n(n({},i?{height:149,width:181,padding:16}:{height:197,width:236,padding:20}),{type:"tiles"}),on:{onItemDblClick:function(){return t.Activate(t.GetSelection())},onEnter:function(){return t.Activate(t.GetSelection())},onBeforeDrag:function(e){return t.DragMarker(e)},onBeforeDrop:function(e){return t.MoveFiles(e.source,e.target)}},onClick:{webix_fmanager_menu_icon:function(e){t.Menu.Show(e)},webix_dataview:function(e,i){i||t.EmptyClick()}},onContext:{webix_dataview:function(e,i){i||t.EmptyClick()}}}},e.prototype.init=function(){this.WTable=this.$$("cards"),t.prototype.init.call(this)},e.prototype.RenderData=function(t){var e=this;this.WTable.sync(t,(function(){return e.WTable.filter((function(t){return".."!==t.value}))}))},e.prototype.CardTemplate=function(t){var e,i,n=this.app.getService("locale")._;if("folder"===t.type)e="<div class=\"webix_fmanager_card_preview\"><span class='webix_icon wxi-folder webix_fmanager_folder_icon'></span></div>",i='<div class="webix_fmanager_card_panel">\n\t\t<span class="webix_fmanager_card_label">'+n("Folder")+'</span>\n\t\t<span class="webix_fmanager_card_name folder">'+this.SearchTemplate(t.value)+"</span>"+q+"\n\t\t</div>";else{var r=webix.skin.$active.listItemHeight<29?[163,92]:[214,124],o=this.app.getService("backend").previewURL(t,r[0],r[1]);e='<div class="webix_fmanager_card_preview file"><img height="'+r[1]+'" width="'+r[0]+'" src="'+o+'" onerror=\'this.style.display="none"\'/></div>',i='<div class="webix_fmanager_card_panel file">\n\t\t<span class="webix_fmanager_card_name">'+this.Icon(t)+'<span class="file_name_text">'+this.SearchTemplate(t.value)+"</span></span>"+q+"\n\t\t</div>"}return e+i},e.prototype.SearchTemplate=function(t){if(this.State.search){var e=new RegExp("("+this.State.search+")","gi");return t.replace(e,"<span class='webix_fmanager_search_mark'>$1</span>")}return t},e}(Y);function Z(t){var e=t.value.lastIndexOf(".");e>-1?t.setSelectionRange(0,e):t.select()}function Q(t,e,i){if(!((i=i||{i:0,cancel:!1}).i>=t.length))return e(t[i.i],i.i).then((function(){if(i.i+=1,!i.cancel)return Q(t,e,i)}))}function tt(t){return t>=1e9?(t/1e9).toFixed(1)+" Gb":t>=1e6?(t/1e6).toFixed(1)+" Mb":t>=1e3?(t/1e3).toFixed(1)+" kb":t+" b"}function et(t){return t.length?t[t.length-1]:{type:"empty",value:"Nothing is selected"}}function it(t){for(t=t.replace(/[/\\:*?"<>|]/g,"").trim();"."===t[0];)t=t.substr(1).trim();return t}function nt(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}webix.protoUI({name:"codemirror-editor",defaults:{mode:"javascript",lineNumbers:!0,matchBrackets:!0,theme:"default"},$init:function(t){this.$view.innerHTML="<textarea style='width:100%;height:100%;'></textarea>",this._textarea=this.$view.firstChild,this._waitEditor=webix.promise.defer(),this.$ready.push(this._render_cm_editor)},complex_types:{php:{mode:["xml","javascript","css","htmlmixed","clike"]},htmlembedded:{mode:["xml","javascript","css","htmlmixed"],addon:["mode/multiplex"]},htmlmixed:{mode:["xml","javascript","css"]},dockerfile:{addon:["mode/simple"]}},_render_cm_editor:function(){if(!1!==this.config.cdn){var t=this.config.cdn||"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/",e=[t+"/codemirror.css",t+"/codemirror.js"],i=this.config.mode?this.config.mode:"javascript",n=this.complex_types[i];n&&(n.mode&&n.mode.forEach((function(i){var n="/mode/"+i+"/"+i+".js";e.push(t+n)})),n.addon&&n.addon.forEach((function(i){var n="/addon/"+i+".js";e.push(t+n)}))),e.push(t+"/mode/"+i+"/"+i+".js"),this.config.theme&&"default"!==this.config.theme&&e.push(t+"/theme/"+this.config.theme+".css"),this.config.matchBrackets&&e.push(t+"/addon/edit/matchbrackets.js"),webix.require(e).then(webix.bind(this._render_when_ready,this)).catch((function(t){console.log(t)}))}else this._render_when_ready},_render_when_ready:function(){this._editor=CodeMirror.fromTextArea(this._textarea,{mode:this.config.mode,lineNumbers:this.config.lineNumbers,matchBrackets:this.config.matchBrackets,theme:this.config.theme}),this._waitEditor.resolve(this._editor),this.setValue(this.config.value),this._focus_await&&this.focus()},_set_inner_size:function(){this._editor&&this.$width&&(this._updateScrollSize(),this._editor.scrollTo(0,0))},_updateScrollSize:function(){var t=this._editor.getWrapperElement(),e=(this.$height||0)+"px";t.style.height=e,t.style.width=(this.$width||0)+"px";var i=this._editor.getScrollerElement();i.style.height!=e&&(i.style.height=e,this._editor.refresh())},$setSize:function(t,e){webix.ui.view.prototype.$setSize.call(this,t,e)&&this._set_inner_size()},setValue:function(t){t||0===t||(t=""),this.config.value=t,this._editor&&(this._editor.setValue(t),this.config.preserveUndoHistory||this._editor.clearHistory(),this._updateScrollSize())},getValue:function(){return this._editor?this._editor.getValue():this.config.value},focus:function(){this._focus_await=!0,this._editor&&this._editor.focus()},getEditor:function(t){return t?this._waitEditor:this._editor},undo:function(){this._editor.undo()},redo:function(){this._editor.redo()},undoLength:function(){return this._editor.historySize().undo}},webix.ui.view);var rt={css:["css","less"],go:["go"],htmlmixed:["html","xml","svg"],javascript:["js","mjs","json","ts","coffee"],markdown:["md"],php:["php","phtml","php3","php4","php5","php7","php-s","pht","phar"],python:["py","pyc","pyd","pyo","pyw","pyz"],sql:["sql","sqlite3","sqlite","db"],yaml:["yaml","yml"],shell:["sh"]},ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this._=this.app.getService("locale")._,this.Files=this.getParam("files");var e={view:"tabbar",localId:"tabbar",css:"webix_fmanager_editor_tabs",borderless:!0,tabMinWidth:170,moreTemplate:"<span class='webix_icon webix_tabbar_more fmi-format-list-bulleted'></span>",tooltip:function(t){return t.id},options:[],on:{onChange:function(e){return t.OpenDoc(e)},onBeforeTabClick:function(e,i){return t.TabAction(e,i)}},tabbarPopup:{css:"webix_gantt_editor_popup"}},i=webix.skin.$active,n={view:"toolbar",css:"webix_fmanager_editor_bar",padding:{left:4,right:4,top:0,bottom:0},height:i.toolbarHeight+!(i.toolbarHeight%2),cols:webix.env.mobile?this.GetMobileControls():[e]};return webix.env.mobile?n.cols.push(this.GetCloseAll(!0)):n.cols.push({width:12},this.GetCloseAll()),{type:"wide",rows:[n,{view:"codemirror-editor",localId:"editor",theme:"contrast"==webix.skin.$name||"dark"===webix.skin.$name?"monokai":"default"}]}},e.prototype.GetMobileControls=function(){var t=this;return[{view:"button",localId:"saveBtn",type:"icon",label:this._("Save"),icon:"wxi-check",css:"webix_primary webix_fmanager_editor_save",width:90,click:function(){return t.Save()}},{view:"label",label:" ",localId:"name",css:"webix_fmanager_editor_name"}]},e.prototype.GetCloseAll=function(t){var e=this;return{view:"icon",icon:t?"wxi-close":"fmi-exit-to-app",click:function(){return e.ConfirmAll()},tooltip:this._("Close the editor")+" (Esc)"}},e.prototype.init=function(){var t=this,e=this.$$("editor");if(webix.extend(e,webix.ProgressBar),e.showProgress({type:"top"}),webix.env.mobile){var i=this.Files[0];this.$$("name").setValue(this.GetFileLabel(i))}this._oldValue={},this._changed={},this._buffers={},e.getEditor(!0).then((function(i){Q(t.Files,(function(e){return t.app.getService("operations").read(e.id).then((function(i){return t.AddDoc(e,i)}))})).then((function(){if(!webix.env.mobile){for(var e=t.$$("tabbar"),i=0;i<t.Files.length;++i)t.AddTab(e,t.Files[i]);e.setValue(e.config.options[0].id)}t.OpenDoc(t.Files[0].id)})).finally((function(){e.hideProgress()})),t.HandleChanges(i)}));var n=webix.env.isMac?"COMMAND":"CTRL";this.on(G(),n+" + S",(function(e,i){t.Save(),webix.html.preventEvent(i)})),this.on(G(),n+" + Shift + S",(function(){return t.SaveAll()})),this.on(G(),"ESC",(function(){return t.ConfirmAll()}))},e.prototype.HandleChanges=function(t){var e=this;t.on("changes",(function(){e.TextChanged(e.GetActiveFile())}))},e.prototype.AddDoc=function(t,e){this._oldValue[t.id]=e,this._buffers[t.id]=CodeMirror.Doc(e,this.GetFileType(t))},e.prototype.GetFileLabel=function(t,e){return'<div class="filename">'+this.ClipName(e?t.value:t.id)+'</div><span class="extension">.'+t.$ext+"</span>"},e.prototype.ClipName=function(t){if(!t)return"";var e=t.split(".");return e.slice(0,e.length-1).join(".")},e.prototype.AddTab=function(t,e){var i='<span class="webix_fmanager_tab_action webix_icon wxi-close" webix_tooltip="'+this._("Close this file")+'"></span>',n='<div class="tab_content">'+this.GetFileLabel(e,!0)+i+"</div>",r=webix.html.getTextSize(e.value,"webix_item_tab").width+90;t.addOption({id:e.id,value:n,css:"webix_fmanager_editor_tab",width:r>250?250:r})},e.prototype.OpenDoc=function(t){var e=this;this.$$("editor").getEditor(!0).then((function(i){i.swapDoc(e._buffers[t]),i.focus()}))},e.prototype.Back=function(){this.show("/top",{params:{state:this.getParam("state")}})},e.prototype.ConfirmAll=function(){var t=this;this.CheckChanges()?webix.confirm({container:this.app.getRoot().$view,text:this._("Are you sure you want to exit without saving?")}).then((function(){return t.Back()})):this.Back()},e.prototype.TabAction=function(t,e){if(e){var i=e.target.className,n=-1!==i.indexOf("webix_icon")&&t==this.$$("tabbar").getValue();return n&&(-1!==i.indexOf("close")?this.CloseTab(t):-1!==i.indexOf("circle")&&this.ConfirmOne(t)),!n}return!0},e.prototype.ConfirmOne=function(t){var e=this;webix.confirm({container:this.app.getRoot().$view,text:this._("Save before closing?")}).then((function(){e.Save(t).then((function(){return e.CloseTab(t)}))})).catch((function(){e.CloseTab(t)}))},e.prototype.CheckChanges=function(){for(var t in this._changed)if(this._changed[t])return!0;return!1},e.prototype.SaveAll=function(){var t=this,e=this.Files.filter((function(e){return t._changed[e.id]}));e.length&&Q(e,(function(e){return t.WriteFileContent(e.id)})).then((function(){t.ChangeTextState(!1)}))},e.prototype.Save=function(t){var e=this;return t||(t=this.GetActiveFile()),this._changed[t]?this.WriteFileContent(t).then((function(){e.ChangeTextState(!1,t)})):webix.promise.resolve()},e.prototype.WriteFileContent=function(t){var e=this,i=this._buffers[t].getValue();return this.app.getService("operations").write(t,i).then((function(){e._oldValue[t]=i}))},e.prototype.GetActiveFile=function(){return webix.env.mobile?this.Files[0].id:this.$$("tabbar").getValue()},e.prototype.GetFileType=function(t){if("Dockerfile"===t.value)return"dockerfile";if(t.$ext)for(var e in rt)if(-1!==rt[e].indexOf(t.$ext))return e;return"htmlmixed"},e.prototype.TextChanged=function(t){var e=this._buffers[t]==this._oldValue[t];this.ChangeTextState(!e,t)},e.prototype.ChangeTextState=function(t,e){e&&t===!!this._changed[e]||(e?this._changed[e]=t:this._changed={},webix.env.mobile?this.ChangeButtonState(t):this.ChangeTabsState(t,e))},e.prototype.ChangeButtonState=function(t){var e=this.$$("saveBtn");e.config.icon=t?"webix_fmanager_icon fmi-circle":"wxi-check",e.refresh()},e.prototype.ChangeTabsState=function(t,e){var i=this.$$("tabbar");if(e){var n=i.getOption(e);this.ChangeTabState(n,t)}else for(var r=i.config.options,o=0;o<r.length;++o)this.ChangeTabState(r[o],t);i.refresh()},e.prototype.ChangeTabState=function(t,e){t.value=t.value.replace(e?"wxi-close":"webix_fmanager_icon fmi-circle",e?"webix_fmanager_icon fmi-circle":"wxi-close")},e.prototype.CloseTab=function(t){var e=this.$$("tabbar");if(e.removeOption(t),!e.getValue())return this.Back();delete this._buffers[t],delete this._changed[t],delete this._oldValue[t]},e}(p);function at(t,e){var i=new webix.promise.defer;return webix.ui(e.getService("jet-win").updateConfig({view:"window",css:"webix_fmanager_prompt",head:{view:"toolbar",padding:{left:12,right:4},borderless:!0,elements:[{view:"label",label:t.text},{view:"icon",icon:"wxi-close",hotkey:"esc",click:function(){i.reject("prompt cancelled"),this.getTopParentView().close()}}]},body:{view:"form",padding:{top:0,left:12,right:12,bottom:12},rows:[{margin:10,cols:[{view:"text",name:"name",value:t.value,maxWidth:230,validate:it,css:"webix_fmanager_prompt_input"},{view:"button",value:t.button,css:"webix_primary",width:100,hotkey:"enter",click:function(){var t=this.getTopParentView(),e=t.getBody();if(e.validate()){var n=e.getValues().name;i.resolve(n),t.close()}else webix.UIManager.setFocus(e)}}]}]},on:{onShow:function(){var e=this.getBody().elements.name.getInputNode();e.focus(),t.selectMask?t.selectMask(e):e.select()}}})).show(),i}var st=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"popup",width:198,body:{view:"menu",autoheight:!0,layout:"y",css:"webix_fmanager_add_new_menu",data:[{id:"makefile",value:e("Add new file"),icon:"webix_fmanager_icon fmi-file-plus-outline"},{id:"makedir",value:e("Add new folder"),icon:"webix_fmanager_icon fmi-folder-plus-outline"},{$template:"Separator"},{id:"upload",value:e("Upload file"),icon:"webix_fmanager_icon fmi-file-upload-outline"},{id:"uploaddir",value:e("Upload folder"),icon:"webix_fmanager_icon fmi-folder-upload-outline"}],on:{onMenuItemClick:function(e){return t.StartAction(e)}}}}},e.prototype.Show=function(t){this.getRoot().show(t,{x:20})},e.prototype.StartAction=function(t){var e=this;if("makefile"===t||"makedir"===t){var i=this.app.getService("locale")._;at({text:i("Enter a new name"),button:i("Add"),selectMask:Z,value:"New "+("makefile"===t?"file.txt":"folder")},this.app).then((function(i){e.app.callEvent("app:action",[t,it(i)])}))}else this.app.callEvent("app:action",[t]);this.getRoot().hide()},e}(p),ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"proxy",body:{rows:[{view:"button",value:e("Add New"),inputWidth:210,css:"webix_primary",align:"center",click:function(){this.$scope.Menu.Show(this.$view)}},{view:"tree",localId:"tree",css:"webix_fmanager_tree",select:!0,drag:"target",type:{template:function(t,i){return""+i.icon(t)+i.folder(t)+" <span>"+(1===t.$level?e(t.value):t.value)+"</span>"},folder:function(t){return"<div class='webix_icon wxi-"+(t.icon||"folder")+"'></div>"}},borderless:!0,on:{onBeforeDrop:function(e){return t.MoveFiles(e.source,e.target)},onBeforeContextMenu:function(e){if(".."===e.substr(0,2))return!1;t.Tree.select(e)}}},{localId:"fs:stats",borderless:!0,height:68,css:"webix_fmanager_fsstats",template:function(t){return'<svg width="100%" height="20px">\n<rect y="1" rx="4" width="100%" height="8" style="fill:#DFE2E6;" />\n<rect y="1" rx="4" width="'+(Math.floor(t.used/t.total*100)||0)+'%" height="8" style="fill:'+webix.skin.$active.timelineColor+';" /></svg><div class="webix_fmanager_fsstats_label">'+tt(t.used||0)+" "+e("of")+" "+tt(t.total||0)+" "+e("used")+"</div>"}}],padding:{top:8,bottom:4}}}},e.prototype.init=function(){var t=this;this.State=this.getParam("state"),this.Tree=this.$$("tree"),this.app.getService("local").folders().then((function(e){t.Tree.sync(e),t.Subscribe(),t.GetFsStats()})),this.Menu=this.ui(st),this.ContextMenu=this.ui(new(this.app.dynamic(J))(this.app,{compact:!1,tree:!0})),this.ContextMenu.AttachTo(this.Tree,(function(e){var i=t.Tree.locate(e);return i?[t.Tree.getItem(i)]:null})),this.on(this.app,"reload:fs:stats",(function(){return t.GetFsStats(!0)}))},e.prototype.Subscribe=function(){var t=this;this.Tree.attachEvent("onAfterSelect",(function(){var e=t.Tree.getSelectedId();".."==e.substr(0,2)?t.State.$batch({source:e.slice(3),path:"/"}):t.State.$batch({source:t.GetRootId(e).slice(3),path:e}),t.TreeState=t.Tree.getState()})),this.Tree.attachEvent("onAfterOpen",(function(){t.TreeState=t.Tree.getState()})),this.on(this.State.$changes,"path",(function(e){if(t.State.path=e,t.Tree.exists(e)){t.Tree.select(e);var i=t.Tree.getParentId(e);i&&t.Tree.open(i),t.Tree.showItem(e)}else t.Tree.select("../"+t.State.source)})),this.app.getService("local").folders().then((function(e){t.on(e.data,"onStoreUpdated",(function(e){!e&&t.Tree.count()&&t.Tree.setState(t.TreeState)}))}))},e.prototype.GetFsStats=function(t){var e=this;this.app.getService("backend").getInfo(t).then((function(t){e.$$("fs:stats").setValues(t.stats)}))},e.prototype.MoveFiles=function(t,e){return"../files"===e&&(e="/"),this.app.getService("operations").move(t,e),!1},e.prototype.GetRootId=function(t){for(var e;t;)e=t,t=this.Tree.getParentId(t);return e},e}(p),lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact",!0),n={view:"datatable",localId:"table",css:"webix_noselect webix_header_border webix_fmanager_filelist",select:"row",multiselect:!0,drag:!0,resizeColumn:{headerOnly:!0},sort:"multi",type:{backIcon:function(){return"<span class='webix_icon wxi-angle-double-left webix_fmanager_back_icon'></span>"},backLabel:function(){return e("back to parent folder")}},on:{onItemDblClick:function(){return t.Activate(t.GetSelection())},onEnter:function(){return t.Activate(t.GetSelection())},onBeforeDrag:function(e){return t.DragMarker(e)},onBeforeDrop:function(e){return t.MoveFiles(e.source,e.target)},"data->onStoreLoad":function(){t.WTable.markSorting()}},onClick:{webix_ss_center_scroll:function(){return t.EmptyClick()},webix_column:function(){return!1}},onContext:{webix_ss_center_scroll:function(e,i){i||t.EmptyClick()}},columns:[{id:"value",header:"",template:function(e){return t.NameTemplate(e)},sort:pt("value"),fillspace:!0},{id:"size",header:e("Size"),template:function(t){return"folder"!==t.type?tt(t.size):""},sort:pt("size")},{id:"date",header:e("Date"),sort:pt("date"),format:function(t){return t instanceof Date&&!isNaN(t)?webix.i18n.longDateFormatStr(t):""},width:150}]};return i&&n.columns.splice(1,2),n},e.prototype.init=function(){var e=this;this.WTable=this.$$("table"),t.prototype.init.call(this),this.on(this.State.$changes,"isActive",(function(t){t?(e.SelectActive(),webix.delay((function(){return webix.UIManager.setFocus(e.WTable)}))):(e.Menu.Hide(),e._Track=!1,e.WTable.unselect(),e._Track=!0)})),this.on(G(this.getRoot()),"TAB",(function(){e.getParam("trackActive",!0)&&(e.State.isActive=!1)}))},e.prototype.RenderData=function(t){this.WTable.sync(t)},e.prototype.NameTemplate=function(t){return"folder"===t.type?N+t.value:this.Icon(t)+'<span class="file-name">'+t.value+"</span>"},e}(Y);function pt(t){return function(e,i){return".."===e.value||".."===i.value||"folder"===e.type&&"folder"!==i.type||"folder"===i.type&&"folder"!==e.type?0:"value"===t?e.value.localeCompare(i.value,void 0,{ignorePunctuation:!0,numeric:!0}):e[t]<i[t]?-1:e[t]>i[t]?1:0}}var ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return this.app.getService("jet-win").updateConfig({view:"window",borderless:!0,head:!1,fullscreen:!0,body:{$subview:!0,branch:!0,name:"preview"}})},e.prototype.IsVisible=function(){return this.getRoot().isVisible()},e.prototype.Show=function(t){this.show("preview",{target:"preview",params:{state:t.state,compact:!0}}),this.getRoot().show()},e.prototype.Hide=function(){this.show("_blank",{target:"preview"}),this.getRoot().hide()},e}(p),ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return{view:"sidemenu",css:"webix_files_sidemenu",width:300,animate:!1,state:function(e){var i=webix.skin.$active.toolbarHeight+14;e.left=t.Parent.left,e.top=t.Parent.top+i,e.height=t.Parent.height-i},body:ct}},e.prototype.init=function(){var t=this;this.on(this.app,"view:resize",(function(){t.getRoot().isVisible()&&t.Show(!0)}))},e.prototype.Show=function(t){!t&&this.getRoot().isVisible()||(this.Parent=this.app.getRoot().$view.getBoundingClientRect(),this.getRoot().show())},e}(p),ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{type:"wide",cols:[{$subview:!0,branch:!0,name:"left"},{view:"resizer"},{$subview:!0,branch:!0,name:"right"}]}},e.prototype.init=function(){this.State=this.getParam("state");var t=U({selectedItem:[].concat(this.State.selectedItem),path:this.State.path,source:this.GetSource("left"),mode:"list",isActive:!0});t.selectedItem.$noSelect=this.State.selectedItem.$noSelect;var e=U({selectedItem:[],path:this.State.path,source:this.GetSource("right"),mode:"list",isActive:!1});this._TrackChanges(t,e),this._TrackChanges(e,t),this.show("panel/list",{target:"left",params:{trackActive:!0,state:t}}),this.show("panel/list",{target:"right",params:{trackActive:!0,state:e}})},e.prototype._TrackChanges=function(t,e){var i=this;this.on(t.$changes,"path",(function(e){t.isActive&&(i.State.path=e)})),this.on(t.$changes,"source",(function(t){return i.State.source=t})),this.on(t.$changes,"selectedItem",(function(e){t.isActive&&(i.State.selectedItem=e)})),this.on(t.$changes,"isActive",(function(n){n&&i.State.$batch({path:t.path,source:t.source}),e.isActive=!n})),this.on(this.app,"pathChanged",(function(e,i){t.isActive||t.path!==e&&0!==t.path.indexOf(e+"/")||(t.path=t.path.replace(e,i))}))},e.prototype.GetSource=function(){return this.State.source},e}(p),dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.State=this.getParam("state");var e=this.app.getService("locale")._;return{rows:[{view:"toolbar",cols:[{view:"icon",icon:"wxi-angle-left",click:function(){t.State.$batch({search:"",searchStats:null})}},{localId:"header",type:"header",borderless:!0,css:"webix_fmanager_path",template:function(i){var n=e("Search results in"),r=t.app.getService("backend").getRootName(),o="";return i&&i.path&&"/"!==i.path&&(o=webix.template.escape(i.path)),n+" "+r+o}},{}]},{$subview:!0,params:{state:this.State}}]}},e.prototype.init=function(){this.$$("header").setValues({path:this.State.path})},e.prototype.ready=function(){var t=this;this.on(this.State.$changes,"search",(function(e){(e=e.trim())&&(t.State.selectedItem=[],t.getSubView().LoadData(t.State.path,e))}))},e}(p),vt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return{rows:[{view:"toolbar",paddingX:4,cols:[{view:"icon",icon:"wxi-sync",css:"webix_fmanager_spec_icon",tooltip:"Refresh",click:function(){t.app.getService("local").refresh(t.State.path)}},{view:"template",localId:"path",borderless:!0,css:"webix_fmanager_path",template:function(e){return t.RenderPath(e)},onClick:{webix_fmanager_path_chunk:function(e){return t.ChangePath(e)}}}]},{$subview:!0,params:{state:this.getParam("state")}}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state"),this.on(this.State.$changes,"path",(function(e){return t.ProcessPath(e)}));var e=this.app.getService("upload").getUploader();e.addDropZone(this.getRoot().$view),this.on(e,"onBeforeFileDrop",(function(i,n){t.getRoot().$view.contains(n.target)&&(e.config.tempUrlData={id:t.State.path})}))},e.prototype.ProcessPath=function(t){var e=this;this.app.getService("local").folders().then((function(i){var n=["/"];if("/"!==t)for(var r=t.split("/"),o=1,a="";o<r.length;++o)a+="/"+r[o],n.push(i.getItem(a).value);e.$$("path").setValues({path:n})}))},e.prototype.RenderPath=function(t){if(t.path&&t.path.length){var e=this.app.getService("backend").getRootName(),i="";return t.path.forEach((function(n,r){i+='<span class="webix_fmanager_path_chunk" data-path="'+r+'">'+(r?n:e)+"</span>",r<t.path.length-1&&(i+="<span class='webix_icon wxi-angle-right'></span>")})),i}return""},e.prototype.ChangePath=function(t){var e=1*t.target.getAttribute("data-path"),i=this.State.path.split("/");i.splice(e+1,i.length-1);var n=i.join("/")||"/";this.State.path=n},e}(p),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=webix.Date.dateToStr("%M %j, %Y&nbsp;&nbsp;&nbsp;&nbsp;%H:%i:%s"),n={css:"webix_fmanager_preview_info",localId:"info",borderless:!0,autoheight:!0,template:function(e){if(!e.id)return"";var n=t.app.getService("locale")._;return"<div><div class='key_col'>"+("folder"===e.type?["Type","Date"]:["Type","Size","Date"]).map((function(t){return"<div class='key_value_cell''>"+n(t)+"</div>"})).join("")+'</div><div class="value_col">'+("folder"===e.type?[nt(n(e.type)),i(e.date)]:[nt(n(e.type)),tt(e.size),i(e.date)]).map((function(t){return"<div class='key_value_cell'>"+t+"</div>"})).join("")+"</div></div>"}},r={css:"webix_fmanager_preview_info extra",localId:"extra:info",hidden:!0,autoheight:!0,template:function(t){for(var e=Object.keys(t),i="<div class='key_col'>",n=0;n<e.length;++n)i+="<div class='key_value_cell key'>"+e[n]+"</div>";i+="</div>";var r="<div class='value_col'>";for(var o in t){var a=t[o].trim();r+="<div class='key_value_cell'>"+(a&&"0"!=a?a:"<span class='webix_fmanager_id3tags-unknown'>Unknown</span>")+"</div>"}return'<div><div class="webix_fmanager_info_header">\n<span class="webix_fmanager_icon fmi-information-outline"></span>\n<span class="webix_fmanager_info_title">Extra info</span>\n</div>'+i+(r+="</div>")+"</div>"}},o={localId:"search:counter",css:"webix_fmanager_preview_info",height:104,borderless:!0,template:function(t){return"<div><div class='key_col search'>"+["Folders","Files"].map((function(t){return"<div class='key_value_cell''>"+e(t)+"</div>"})).join("")+'</div><div class="value_col search">'+[t.folders,t.files].map((function(t){return"<div class='key_value_cell'>"+t+"</div>"})).join("")+"</div></div>"}};return{localId:"info:tabs",view:"tabview",css:"webix_fmanager_info_tab",cells:[{header:e("Information"),body:{padding:14,margin:14,rows:[n,r,{}]}},{header:e("Search results"),body:{padding:14,margin:14,rows:[o,{}]}}]}},e.prototype.init=function(){var t=this;this.Tabview=this.$$("info:tabs"),this.State=this.getParam("state"),this.on(this.State.$changes,"selectedItem",(function(e){t.ShowInfo(et(e))})),this.on(this.State.$changes,"searchStats",(function(e){e?t.$$("search:counter").setValues(e):t.State.selectedItem.length||t.Tabview.hide()}))},e.prototype.ShowInfo=function(t){var e=this,i=this.Tabview.getTabbar(),n=i.config.options[0].id,r=i.config.options[1].id;if("empty"!==t.type){this.SetInfo(this.$$("info"),t),this.SwitchTabs(i,r,n);var o=this.$$("extra:info"),a=this.app.getService("backend").getMeta(t);a?a.then((function(t){return e.SetExtraInfo(o,t)})).catch((function(){return o.hide()})):o.hide()}else this.State.search?this.SwitchTabs(i,n,r):this.Tabview.hide()},e.prototype.SetExtraInfo=function(t,e){!function t(e){for(var i in e){if("object"==typeof e[i])return t(e[i]);if(e[i]&&"0"!==e[i])return!1}return!0}(e)?this.SetInfo(t,e):t.hide()},e.prototype.SetInfo=function(t,e){t.setValues(e),t.show()},e.prototype.SwitchTabs=function(t,e,i){t.hideOption(e),t.setValue(i),t.showOption(i),this.Tabview.show()},e}(p),mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact"),n=this.getParam("state");return{margin:.1,rows:[{view:"toolbar",localId:"toolbar",padding:{right:6},elements:[{view:"label",localId:"filename:label",css:"webix_fmanager_preview_name"},{view:"icon",icon:"wxi-download",css:"webix_fmanager_spec_icon",localId:"download",tooltip:e("Download file"),click:function(){t.app.callEvent("app:action",["download",[t.FileInfo]])}},{view:"icon",icon:"wxi-close",hidden:!i,click:function(){n.preview=!n.preview}}]},{view:"scrollview",borderless:!0,body:{type:"wide",margin:10,rows:[{view:"proxy",minHeight:413,borderless:!0,body:{$subview:!0,name:"preview"}},gt]}}]}},e.prototype.init=function(){var t=this;this.on(this.getParam("state").$changes,"selectedItem",(function(e){var i=et(e);t.ShowInfo(i),t.FileInfo=i;var n=t.$$("download");"folder"===i.type?n.hide():n.show()}))},e.prototype.ShowInfo=function(t){var e="preview.template";!this.app.config.player||"audio"!==t.type&&"video"!==t.type||(e="preview.media"),"empty"!==t.type?(this.$$("filename:label").setValue(t.value),this.$$("toolbar").show()):this.$$("toolbar").hide(),this.show(e,{target:"preview",params:{info:t}})},e}(p);webix.protoUI({name:"plyr-player",defaults:{config:{},source:{}},$init:function(){this.$view.innerHTML='<div class="webix_player_parent"><audio></audio></div>',this._container=this.$view.firstChild.firstChild,this.$view.style.overflow="visible",this._waitView=webix.promise.defer(),this.$ready.push(this.render)},getPlayer:function(t){return t?this._waitView:this._player},render:function(){if(!1===this.config.cdn||window.Plyr)this._initPlyr();else{var t=this.config.cdn?this.config.cdn:"https://cdn.plyr.io/3.5.10";webix.require([t+"/plyr.js",t+"/plyr.css"]).then(webix.bind(this._initPlyr,this)).catch((function(t){console.log(t)}))}},_initPlyr:function(){if(this.$view){var t=webix.extend({},this.config.config);this._player=new Plyr(this._container,t),this._player.elements.container.setAttribute("tabindex","-1"),this.attachEvent("onDestroy",(function(){this._player&&this._player.destroy()})),this._waitView.resolve(this._player),this._player.on("canplay",webix.bind((function(){this._player.media&&(this._player.media.setAttribute("tabindex","-1"),this._normalizeRatio())}),this)),this._player.on("ready",webix.bind((function(){this.$view&&(this.$view.querySelector(".plyr--full-ui").style["min-width"]="0px",this._normalizeRatio())}),this))}},$setSize:function(t,e){this.$view.firstChild.style.width=t+"px",this.$view.firstChild.style.height=e-2+"px",this._player&&this._normalizeRatio(t,e)},source_setter:function(t){this._waitView.then((function(e){t&&(e.source=t)}))},getPlyr:function(t){return t?this._waitView:this._player},_gcdRatio:function(t,e){for(t=Math.abs(t),e=Math.abs(e);e;){var i=e;e=t%e,t=i}return t},_normalizeRatio:function(t,e){if(this.$view){t=t||this.$view.clientWidth,e=e||this.$view.clientHeight;var i=this._gcdRatio(t,e),n=(t/i).toString()+":"+(e/i).toString();this._player.ratio=n}}},webix.ui.view,webix.EventSystem);var wt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{rows:[{localId:"albumArt",hidden:!0,css:"webix_fmanager_preview",template:'<img class="webix_fmanager_preview_icon" src="'+this.app.getService("backend").icon({type:"audio"},"big")+'" />'},{view:"plyr-player",css:"webix_fmanager_player",localId:"player",config:{controls:["play-large","play","progress","current-time","mute","volume"]}}]}},e.prototype.init=function(){var t=this,e=this.$$("albumArt").$view;webix.event(e,"dblclick",(function(){var e=t.getParam("info");t.app.callEvent("app:action",["open",[e]])}))},e.prototype.urlChange=function(){var t=this.getParam("info");this.ShowPreview(t)},e.prototype.ShowPreview=function(t){if(t){var e=this.app.getService("backend").directLink(t.id);this.SetMedia(e,t.type,t.$ext);var i=this.$$("albumArt"),n=this.$$("player");"audio"===t.type?(n.config.height=52,i.show()):(n.config.height=0,i.hide())}},e.prototype.SetMedia=function(t,e,i){this.$$("player").define({source:{type:e,sources:[{src:t,type:e+"/"+i}]}})},e}(p),yt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{view:"template",localId:"preview",css:"webix_fmanager_preview"}},e.prototype.init=function(){var t=this,e=this.getRoot().$view;webix.event(e,"dblclick",(function(){var e=t.getParam("info");"code"===e.type&&t.app.config.editor?t.app.callEvent("app:action",["edit",[e]]):"folder"!==e.type&&"empty"!==e.type&&t.app.callEvent("app:action",["open",[e]])}))},e.prototype.urlChange=function(){var t=this.getParam("info");this.ShowPreview(t)},e.prototype.ShowPreview=function(t){var e=this.$$("preview");if("folder"===t.type)e.setHTML('<img class="webix_fmanager_preview_icon" src="'+this.app.getService("backend").icon({type:"folder"},"big")+'" />');else if("empty"===t.type)e.setHTML('<img class="webix_fmanager_preview_icon" src="'+this.app.getService("backend").icon({type:"none"},"big")+'" />');else{var i=this.app.getService("backend").previewURL(t,464,407);e.setHTML("<img style='width:100%; height:100%;' src='"+i+"' onerror='this.style.display=\"none\"'>")}},e}(p),bt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return this.Config=this.getParam("config"),this.app.getService("jet-win").updateConfig({view:"window",css:"webix_fmanager_progress",head:{template:this.Config.head,css:"webix_fmanager_progress_head",height:54},body:{padding:{top:0,bottom:20,left:20,right:20},margin:10,rows:[{template:function(t){return'<div class="webix_fmanager_progress_bar">\n<div class="webix_fmanager_progress_counter">'+t.done+" of "+t.total+' items</div>\n<div class="webix_fmanager_progress_name">'+t.file+"</div></div>"},localId:"counter",borderless:!0,height:59},{view:"button",value:"Stop",css:"webix_fmanager_progress_cancel",click:function(){t.State.cancel=!0,t.getRoot().disable()}}]}})},e.prototype.ready=function(){var t=this;this.WaitClose=webix.promise.defer(),this.Counter=this.$$("counter"),this.Counter.setValues({done:0,total:this.Config.files.length,file:this.Config.files[0]}),webix.extend(this.Counter,webix.ProgressBar),this.State=U({i:0,cancel:!1}),Q(this.Config.files,this.Config.code,this.State).finally((function(){return t.Close()})),this.on(this.State.$changes,"i",(function(e){return e&&t.Step(e)}))},e.prototype.Close=function(){this.Counter.showProgress({type:"bottom",position:1,delay:100}),this.show("_blank",{target:"popup"}),this.WaitClose.resolve()},e.prototype.Step=function(t){var e=this.Counter.getValues().done;this.Counter.setValues({done:t,file:this.Config.files[t-1]},!0),e=(e+1)/this.Config.files.length,this.Counter.showProgress({type:"bottom",position:Math.min(1,e),delay:100})},e}(p),_t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.getParam("compact"),i=webix.skin.$active,n=this.app.getService("locale")._,r=this.getParam("state");return{view:"toolbar",height:i.toolbarHeight+12,margin:20,paddingY:9,paddingX:12,cols:[{view:"icon",icon:"webix_fmanager_icon fmi-file-tree",click:function(){return t.app.callEvent("app:action",["toggle-folders"])},hidden:!e},{view:"label",label:n("Files"),autowidth:!0,hidden:e},{view:"search",width:e?0:300,localId:"search",placeholder:n("Search files and folders")},{hidden:e},{view:"toggle",css:"webix_fmanager_preview_toggle",type:"icon",icon:"wxi-eye",tooltip:n("Preview"),width:i.toolbarHeight<37?48:60,localId:"previewMode",on:{onChange:function(t,e,i){"user"===i&&(r.preview=!r.preview)}},hidden:e},{view:"segmented",width:124,optionWidth:40,localId:"modes",tooltip:function(t){switch(t.id){case"grid":return n("Table");case"cards":return n("Cards");case"double":return n("Total");default:return nt(t.id+"")}},options:[{value:"<span class='webix_fmanager_icon fmi-view-list webix_fmanager_mode_icon'></span>",id:"grid"},{value:"<span class='webix_fmanager_icon fmi-view-grid webix_fmanager_mode_icon'></span>",id:"cards"},{value:"<span class='webix_fmanager_icon fmi-view-array webix_fmanager_mode_icon'></span>",id:"double"}]}]}},e.prototype.init=function(){var t=this,e=this.getParam("state"),i=this.$$("modes");i.attachEvent("onChange",(function(t){t&&e.$batch({mode:t,search:""})})),this.on(e.$changes,"mode",(function(t){i.getOption(t)?i.setValue(t):i.setValue()}));var n=this.$$("search");n.attachEvent("onTimedKeyPress",(function(){e.search=n.getValue().trim()})),this.on(e.$changes,"search",(function(t){t=t.trim(),n.setValue(t)})),this.on(e.$changes,"preview",(function(e){t.$$("previewMode").setValue(1*e)})),this.on(G(),(webix.env.isMac?"COMMAND":"CTRL")+" + F",(function(t,e){n.focus(),webix.html.preventEvent(e)}))},e}(p),xt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){H||(H=!0,webix.protoUI({name:"r-layout",sizeTrigger:function(t,e,i){this._compactValue=i,this._compactHandler=e,this._app=t;var n=t.config;this._forceCompact=n.params.forceCompact,this._compactWidth=n.compactWidth,this._forceCompact||this._checkTrigger(this.$view.width,i)},_checkTrigger:function(t,e){return!this._compactWidth||!(t<=this._compactWidth&&!e||t>this._compactWidth&&e)||(this._compactWidth=null,this._compactHandler(!e),!1)},$setSize:function(t,e){(this._forceCompact||this._checkTrigger(t,this._compactValue))&&webix.ui.layout.prototype.$setSize.call(this,t,e),this._app&&this._app.callEvent("view:resize",[])}},webix.ui.layout));var t=this.getParam("forceCompact");webix.isUndefined(t)||this.setParam("compact",t),this.Compact=this.getParam("compact");var e={view:"proxy",batch:"tree",width:240,minWidth:240,maxWidth:400,hidden:!0,borderless:!0,body:ct},i={type:"wide",localId:"folders",cols:[{$subview:!0,name:"center",branch:!0},{view:"proxy",borderless:!0,width:470,hidden:!0,localId:"r-side",body:{$subview:"",branch:!0,name:"r-side"}}]};return this.Compact||i.cols.unshift(e,{view:"resizer",batch:"tree"}),{view:"r-layout",type:"wide",css:"webix_files_main_layout",rows:[_t,i,{$subview:!0,popup:!0,name:"popup"}]}},e.prototype.init=function(){var t=this;this.getRoot().sizeTrigger(this.app,(function(e){return t.SetCompactMode(e)}),!!this.Compact);var e=this.getParam("state");this.State=e,this.Compact&&(this.SideTree=this.ui(ht),this.PreviewPopup=this.ui(ut)),this.on(this.app,"app:action",(function(e){switch(e){case"toggle-folders":t.ToggleFolders()}})),this.on(e.$changes,"mode",(function(e,i){return t.ShowMode(e,i)})),this.on(e.$changes,"search",(function(e){return t.ShowSearch(e)})),this.on(e.$changes,"preview",(function(e){return t.TogglePreview(e)})),this.app.getService("progress").handle(this.getRoot(),this.ShowProgress.bind(this))},e.prototype.ShowMode=function(t,e){var i=this.$$("folders"),n={target:"center",params:{state:this.getParam("state"),compact:this.Compact}};switch(t){case"grid":case"cards":i.showBatch("tree"),this.show("panel/"+("grid"==t?"list":t),n);break;case"double":i.showBatch(""),this.show("panel-double",n);break;case"search":this.PrevMode=this.PrevMode||e,i.showBatch(""),this.show("panel-search/cards",n)}},e.prototype.ShowProgress=function(t){var e=this;return this.show("./progress",{target:"popup",params:t}).then((function(){return e.getSubView("popup")}))},e.prototype.TogglePreview=function(t){if(this.Compact)t?this.PreviewPopup.Show({state:this.State}):this.PreviewPopup.Hide();else{var e=this.$$("r-side");t?(this.show("preview",{target:"r-side",params:{state:this.State}}),e.show()):(this.show("_blank",{target:"r-side"}),e.hide())}},e.prototype.ToggleFolders=function(){this.SideTree.Show()},e.prototype.ShowSearch=function(t){t?this.State.mode="search":("search"===this.State.mode&&(this.State.mode=this.PrevMode||"grid"),this.PrevMode="")},e.prototype.SetCompactMode=function(t){this.setParam("compact",t),this.refresh()},e}(p),St={JetView:p};St.cards=X,St.editor=ot,St.folders=ct,St.list=lt,St["menus/addnewmenu"]=st,St["menus/contextmenu"]=J,St["menus/menubody"]=K,St["mobile/previewpopup"]=ut,St["mobile/sidetree"]=ht,St["panel-double"]=ft,St["panel-search"]=dt,St.panel=vt,St.preview=mt,St["preview/info"]=gt,St["preview/media"]=wt,St["preview/template"]=yt,St.progress=bt,St["sections/dataview"]=Y,St.top=xt,St.topbar=_t;var $t=function(){function t(t,e){this.app=t,this._url=e,this._features={preview:{},meta:{}}}return t.prototype.url=function(t){return this._url+t},t.prototype.search=function(t,e){return t=t||"/",this._files(this.url("files"),{id:t,search:e})},t.prototype.files=function(t){return t=t||"/",this._files(this.url("files"),{id:t})},t.prototype._files=function(t,e){var i=webix.ajax(t,e).then((function(t){return t.json()}));return this.getInfo().then((function(){return i}))},t.prototype.folders=function(t){return t=t||"/",webix.ajax(this.url("folders"),{id:t}).then((function(t){return t.json()}))},t.prototype.icon=function(t,e){var i=webix.skin.$name;return this.url("icons/"+i+"/"+(e||"small")+"/"+t.type+"/"+t.$ext+".svg")},t.prototype.upload=function(){return this.url("upload")},t.prototype.readText=function(t){return webix.ajax(this.url("text"),{id:t}).then((function(t){return t.text()}))},t.prototype.writeText=function(t,e){return webix.ajax().post(this.url("text"),{id:t,content:e}).then((function(t){return t.json()}))},t.prototype.directLink=function(t,e){return this.url("direct?id="+encodeURIComponent(t)+(e?"&download=true":""))},t.prototype.previewURL=function(t,e,i){return this._features.preview[t.type]?this.url("preview?width="+e+"&height="+i+"&id="+encodeURIComponent(t.id)):this.icon(t,"big")},t.prototype.remove=function(t){return webix.ajax().post(this.url("delete"),{id:t}).then((function(t){return t.json()}))},t.prototype.makedir=function(t,e){return webix.ajax().post(this.url("makedir"),{id:t,name:e}).then((function(t){return t.json()}))},t.prototype.makefile=function(t,e){return webix.ajax().post(this.url("makefile"),{id:t,name:e}).then((function(t){return t.json()}))},t.prototype.copy=function(t,e){return webix.ajax().post(this.url("copy"),{id:t,to:e}).then((function(t){return t.json()}))},t.prototype.move=function(t,e){return webix.ajax().post(this.url("move"),{id:t,to:e}).then((function(t){return t.json()}))},t.prototype.rename=function(t,e){return webix.ajax().post(this.url("rename"),{id:t,name:e}).then((function(t){return t.json()}))},t.prototype.getRootName=function(){return(0,this.app.getService("locale")._)("My Files")},t.prototype.getMeta=function(t){return!!this._features.meta[t.type]&&webix.ajax(this.url("meta"),{id:t.id}).then((function(t){return t.json()}))},t.prototype.getInfo=function(t){var e=this;return this._info&&!t?this._info:this._info=webix.ajax(this.url("info")).then((function(t){return t=t.json(),e._features=t.features,t}))},t}(),kt=function(){function t(t){this._store=new Map,this._limit=t,this._i=1}return t.prototype.each=function(t){this._store.forEach((function(e){return t(e.obj)}))},t.prototype.set=function(t,e){this._store.size>=this._limit&&this.prune(),this._store.set(t,{obj:e,key:t,t:this._i++})},t.prototype.get=function(t){var e=this._store.get(t);return e?(e.t=this._i++,e.obj):null},t.prototype.prune=function(){var t=[];this._store.forEach((function(e){return t.push(e)})),t=t.sort((function(t,e){return t.t>e.t?-1:1}));for(var e=Math.floor(this._limit/2);e<t.length;e++)this._store.delete(t[e].key)},t.prototype.delete=function(t){this._store.has(t)&&this._store.delete(t)},t.prototype.clear=function(){this._store.clear()},t}(),Tt=function(){function t(t,e){this.app=t,this.fscache=new kt(e),this.hierarchy=new webix.TreeCollection,this.folders_ready=null}return t.prototype.defaultDir=function(t){var e=[];return"/"!==t&&e.push({type:"folder",value:"..",$row:function(t,e){return e.backIcon()+"<span class='webix_fmanager_back'>"+e.backLabel()+"</span>"}}),e},t.prototype.files=function(t,e){var i=this.fscache.get(t);return e?i:i?Promise.resolve(i):(i=new webix.DataCollection({scheme:{$change:this.prepareData,$serialize:this.serializeData}}),this.fscache.set(t,i),this.reload(i,t))},t.prototype.serializeData=function(t){if(".."==t.value)return!1;var e={};for(var i in t)0!==i.indexOf("$")&&(e[i]=t[i]);return e},t.prototype.prepareData=function(t){"number"==typeof t.date&&(t.date=new Date(1e3*t.date)),"folder"===t.type?t.$css=t.type:t.$ext=function(t){if(!t)return"";var e=t.split(".");return e.length<2?"":e[e.length-1]}(t.value)},t.prototype.reload=function(t,e){var i=this;return this.app.getService("backend").files(e).then((function(n){return t.clearAll(),t.parse(i.defaultDir(e).concat(n)),t}))},t.prototype.refresh=function(t){var e=this.fscache.get(t);if(e)return this.reload(e,t)},t.prototype.addFile=function(t,e,i){var n=this,r=this.fscache.get(t);r&&(r.exists(e.id)||r.add(e,this.getFsPosition(r,e))),"folder"===e.type&&("/"===t&&(t="../files"),this.hierarchy.add(e,null,t),i&&this.app.getService("backend").folders(e.id).then((function(t){return t.length&&n.hierarchy.parse({parent:e.id,data:t})})))},t.prototype.getFsPosition=function(t,e){if("folder"!==e.type)return-1;var i=t.data;return i.order.findIndex((function(t){return"folder"!==i.getItem(t).type}))},t.prototype.deleteFile=function(t){var e=this.fscache,i=this.hierarchy;e.each((function(e){e&&e.exists(t)&&e.remove(t)})),e.delete(t),i.exists(t)&&i.remove(t)},t.prototype.updateFile=function(t,e,i){var n=this.hierarchy;this.fscache.each((function(n){n&&n.exists(t)&&(n.updateItem(t,e),i&&t!=i&&n.data.changeId(t,i))})),n.exists(t)&&(n.updateItem(t,e),i&&t!=i&&n.data.changeId(t,i))},t.prototype.defaultTree=function(){return[{value:"My Files",id:"../files",open:!0}]},t.prototype.folders=function(t){var e=this,i=this.hierarchy;return!t&&this.folders_ready||(this.folders_ready=this.app.getService("backend").folders().then((function(t){return i.clearAll(),i.parse(e.defaultTree()),i.parse({parent:"../files",data:t}),i}))),this.folders_ready},t}(),Ct=function(){function t(t,e){this.initUploader(t),this.initEvents(t,e)}return t.prototype.initEvents=function(t,e){var i=this;t.attachEvent("app:action",(function(t,n){"upload"!=t&&"uploaddir"!=t||(n||(n=e.path||"/"),i.openDialog(t,n))}))},t.prototype.initUploader=function(t){this.uploader=this.createUploader(t),this.dirUploader=this.createUploader(t,!0)},t.prototype.createUploader=function(t,e){var i=webix.ui({view:"uploader",directory:e,apiOnly:!0,upload:t.getService("backend").upload(),on:{onAfterFileAdd:function(t){t.urlData=this.config.tempUrlData},onUploadComplete:function(){if(t.getService("progress").end(),t.callEvent("reload:fs:stats",[]),e){var i=this.config.tempUrlData.id,n=t.getService("local");n.refresh(i),n.folders(!0)}}}});return e||i.attachEvent("onFileUpload",(function(e,i){t.getService("local").addFile(e.urlData.id,i)})),i.$updateProgress=function(e,i){var n=i/100;n&&t.getService("progress").start(n)},i},t.prototype.openDialog=function(t,e){var i="upload"==t?this.uploader:this.dirUploader;i.config.tempUrlData={id:e},i.fileDialog()},t.prototype.getUploader=function(){return this.dirUploader},t}(),Ft=function(){function t(){this.view=null,this.popup=null}return t.prototype.handle=function(t,e){this.view=t,webix.extend(t,webix.ProgressBar),this.popup=e},t.prototype.start=function(t){var e=this.view;e&&!e.$destructed&&e.showProgress({type:"top",delay:3e3,hide:!0,position:t})},t.prototype.end=function(){var t=this.view;t&&!t.$destructed&&t.hideProgress()},t.prototype.files=function(t,e,i){var n=this;if(e.length)return 1==e.length?(this.start(),i(e[0],0).finally((function(){return n.end()}))):this.popup?this.popup({config:{head:t,files:e,code:i}}).then((function(t){return t.WaitClose})):void 0},t}(),It=function(){function t(t,e){this.app=t,this.state=e,this.initEvents()}return t.prototype.backend=function(){return this.app.getService("backend")},t.prototype.local=function(){return this.app.getService("local")},t.prototype.initEvents=function(){var t=this;this.app.attachEvent("app:action",(function(e,i){switch(e){case"open":t.open(i);break;case"download":t.download(i);break;case"edit":t.edit(i);break;case"delete":t.remove(i);break;case"makefile":t.makeFile(i);break;case"makedir":t.makeFolder(i);break;case"rename":t.rename(i);break;case"copy":case"cut":t.addToClipboard(e);break;case"paste":t.paste(i);break;case"locate":t.goUp(i)}}))},t.prototype.write=function(t,e){var i=this;return this.backend().writeText(t,e).then((function(e){return i.local().updateFile(t,{size:e.size,date:e.date})}))},t.prototype.read=function(t){return this.backend().readText(t)},t.prototype.makeFile=function(t){var e=this,i=this.state.path||"/";this.backend().makefile(i,t).then((function(t){t.invalid||e.local().addFile(i,t)}))},t.prototype.makeFolder=function(t){var e=this,i=this.state.path||"/";this.backend().makedir(i,t).then((function(t){t.invalid||e.local().addFile(i,t)}))},t.prototype.edit=function(t){var e=this.state;t||(t=e.selectedItem),(t=t.filter((function(t){return"code"===t.type}))).length&&this.app.show("/editor",{params:{files:t,state:e}})},t.prototype.open=function(t){t||(t=this.state.selectedItem);for(var e=0;e<t.length;++e)"folder"!=t[e].type&&window.open(this.backend().directLink(t[e].id),"_blank")},t.prototype.download=function(t){t||(t=this.state.selectedItem),window.open(this.backend().directLink(t[0].id,!0),"_self")},t.prototype.remove=function(t){var e=this,i=this.state,n=this.extractIds(t||i.selectedItem);if(!n.length)return webix.promise.reject();var r=this.app.getService("locale")._;return webix.confirm({title:r("Delete files"),text:this.removeConfirmMessage(t||i.selectedItem),container:this.app.getRoot().$view,css:"webix_fmanager_confirm"}).then((function(){return e.app.getService("progress").files(r("Deleting..."),n,(function(t){return e.backend().remove(t).then((function(n){n.invalid||(e.local().deleteFile(t),i.path===t&&(i.path="/"),e.app.callEvent("pathChanged",[t,"/"]),e.app.callEvent("reload:fs:stats",[]))}))}))})).then((function(){i.search&&(i.search=i.search+" ")}))},t.prototype.removeConfirmMessage=function(t){for(var e=this.app.getService("locale")._,i='<div class="question">'+e("Are you sure you want to delete")+" "+(t.length>1?e("these items:"):e("this item:"))+"</div>",n=0,r="&#9679;&nbsp;",o=t.length<6?t.length:5;n<o;++n)i+='<div class="item">'+r+t[n].value+"</div>";return n<t.length&&(i+="<div>"+r+e("and")+" "+(t.length-n)+" "+e("more file(s)")+"</div>"),i},t.prototype.rename=function(t){var e=this,i=this.state,n=t?t[0]:i.selectedItem[0];if(n){var r=this.app.getService("locale")._,o=n.id;at({text:r("Enter a new name"),button:r("Rename"),value:n.value,selectMask:"folder"!==n.type?Z:null},this.app).then((function(t){(t=it(t))&&t!==n.value&&e.backend().rename(o,t).then((function(t){e.local().updateFile(o,{value:t.id.split("/").pop()},t.id),"folder"===n.type&&e.reloadBranch(t.id).then((function(){i.path===o&&(i.path=t.id),e.app.callEvent("pathChanged",[o,t.id])})),i.search&&(i.search=i.search+" ")}))}))}},t.prototype.reloadBranch=function(t){var e=this.local().hierarchy;return this.app.getService("backend").folders(t).then((function(i){var n=[];e.data.eachChild(t,(function(t){return n.push(t.id)})),e.parse({parent:t,data:i}),e.remove(n)}))},t.prototype.copy=function(t,e){var i=this;if(!t.length)return webix.promise.reject();var n=this.local(),r=this.app.getService("locale")._;return this.app.getService("progress").files(r("Copying..."),t,(function(t){return i.backend().copy(t,e).then((function(t){t.invalid||n.addFile(e,t,!0)}))}))},t.prototype.move=function(t,e){var i=this;if(!t.length||!e)return webix.promise.reject();var n=this.local(),r=n.files(e,!0);if(r&&(t=t.filter((function(t){return!r.exists(t)}))),!(t=t.filter((function(t){return t!=e}))).length)return webix.promise.reject();var o=this.app.getService("locale")._;return this.app.getService("progress").files(o("Moving..."),t,(function(t){return i.backend().move(t,e).then((function(r){r.invalid||(n.deleteFile(t),n.addFile(e,r,!0),i.state.path===t&&(i.state.path=r.id),i.app.callEvent("pathChanged",[t,r.id]))}))}))},t.prototype.extractIds=function(t){if(!t.length||"string"==typeof t[0])return t;for(var e=[],i=0;i<t.length;++i)".."!==t[i].value&&e.push(t[i].id);return e},t.prototype.addToClipboard=function(t){var e=this.state.selectedItem;e.length&&(this.state.clipboard={files:e,mode:t})},t.prototype.clearClipboard=function(){this.state.clipboard=null},t.prototype.paste=function(t){var e=this.state;if(e.clipboard){var i=e.path;t&&"folder"==t[0].type&&(i=t[0].id),"copy"===e.clipboard.mode?this.copy(this.extractIds(e.clipboard.files),i):"cut"===e.clipboard.mode&&this.move(this.extractIds(e.clipboard.files),i),this.clearClipboard()}},t.prototype.goUp=function(t){var e=this.state;if(e.search){var i=t?t[0]:e.selectedItem[0];if(!i)return;var n=i.id.split("/"),r="/"+n.slice(1,n.length-1).join("/");e.$batch({search:"",searchStats:null,path:r})}},t}(),Pt=function(t){function e(e){var i,r,o,a=this,s=U({mode:e.mode||"grid",selectedItem:[],search:"",searchStats:null,path:e.path||"/",source:e.source||"files",clipboard:null,preview:!1}),c={router:y,version:"10.0.1",debug:!0,start:"/top",params:{state:s,forceCompact:e.compact},editor:!0,player:!0,compactWidth:640};return(a=t.call(this,n(n({},c),e))||this).setService("backend",new(a.dynamic($t))(a,a.config.url)),a.setService("local",new(a.dynamic(Tt))(a,10)),a.setService("progress",new(a.dynamic(Ft))(a)),a.setService("upload",new(a.dynamic(Ct))(a,s)),a.setService("operations",new(a.dynamic(It))(a,s)),o={updateConfig:function(t){var e=i.getRoot(),n=e.$view;r?r&&!n.id&&(n.id=r):(n.id?r=n.id:n.id=r="webix_"+webix.uid(),webix.html.addStyle(".webix_win_inside *:not(.webix_modal_box):not(.webix_modal_cover){ z-index: 0; }"),webix.html.addStyle("#"+r+"{ position: relative; }"),webix.html.addStyle("#"+r+" .webix_window{ z-index:2 !important; }"),webix.html.addStyle("#"+r+" .webix_disabled{ z-index:1 !important; }")),t.container=r,t.fullscreen&&(t._fillApp=!0,delete t.fullscreen),t.on||(t.on={});var o=!0,a=t.on.onShow;return t.on.onShow=function(){var t=this;a&&a.apply(this,arguments),o&&(this.$setSize=function(i,n){z(t,e,!0),webix.ui.window.prototype.$setSize.apply(t,[i,n])},W(this,i),o=null),webix.callEvent("onClick",[]),webix.html.addCss(n,"webix_win_inside"),e.disable(),z(this,e)},t}},(i=a).setService("jet-win",o),a.use(V,a.config.locale||{lang:"en",webix:{en:"en-US",zh:"zh-CN"}}),a}return i(e,t),e.prototype.dynamic=function(t){return this.config.override&&this.config.override.get(t)||t},e.prototype.require=function(t,e){return"jet-views"===t?St[e]:"jet-locales"===t?Dt[e]:null},e.prototype.getState=function(){return this.config.params.state},e}(w);webix.protoUI({name:"filemanager",app:Pt,getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},$init:function(){this.$view.className+=" webix_files";var t=this.$app.getState();for(var e in t)O(t,this.config,e)}},webix.ui.jetapp);var Et={Backend:$t,LocalData:Tt,Upload:Ct,Progress:Ft,Operations:It},Dt={en:{Save:"Save","Save all":"Save all",Rename:"Rename",Open:"Open",Edit:"Edit",Delete:"Delete",Folder:"Folder","Add New":"Add New","My Files":"My Files",Size:"Size",Date:"Date","back to parent folder":"back to parent folder",Download:"Download",Type:"Type",Information:"Information",Files:"Files",Table:"Table",Cards:"Cards",Total:"Total","Are you sure ?":"Are you sure ?",Details:"Details","Enter a new name":"Enter a new name",Add:"Add","Select something":"Select something","Download file":"Download file",Preview:"Preview",Refresh:"Refresh","Are you sure you want to exit without saving?":"Are you sure you want to exit without saving?","Save before closing?":"Save before closing?",Copy:"Copy",Cut:"Cut",Paste:"Paste","Deleting...":"Deleting...","Copying...":"Copying...","Moving...":"Moving...",Folders:"Folders","Search results":"Search results","Search results in":"Search results in","Search files and folders":"Search files and folders","Add new file":"Add new file","Add new folder":"Add new folder","Upload file":"Upload file","Upload folder":"Upload folder",folder:"folder",file:"file",archive:"archive",audio:"audio",image:"image",video:"video",code:"code",document:"document",of:"of",used:"used","Open item location":"Open item location","Are you sure you want to delete":"Are you sure you want to delete","these items:":"these items:","this item:":"this item:","Delete files":"Delete files",and:"and","more file(s)":"more file(s)","Close the editor":"Close the editor","Close this file":"Close this file"}};t.App=Pt,t.locales=Dt,t.services=Et,t.views=St,Object.defineProperty(t,"__esModule",{value:!0})}(e)}));(o=a)&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")&&o.default;var s=a.views,c=a.services,l=a.locales,p=a.App,u=1;function h(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function f(t,e){e=e||{};var i={},n={},r=function(t,e){var r=u++;return i[r]={mask:t,handler:e},e("*"===t?n:n[t],void 0,t),r},o=[],a=!1,s=function(t,e,n,r){if(a)o.push([t,e,n,r]);else for(var s=Object.keys(i),c=0;c<s.length;c++){var l=i[s[c]];l&&("*"!==l.mask&&l.mask!==t||l.handler(n,e,t,r))}};for(var c in t)if(t.hasOwnProperty(c)){var l=t[c];e.nested&&"object"==typeof l&&l?n[c]=f(l,e):d(n,l,c,s)}return Object.defineProperty(n,"$changes",{value:{attachEvent:r,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$observe",{value:r,enumerable:!1,configurable:!1}),Object.defineProperty(n,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)n[t]=e[t]}}for(a=!0,t(n),a=!1;o.length;){var i=o.shift();s.apply(this,i)}},enumerable:!1,configurable:!1}),n}function d(t,e,i,n){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var r=e;e=t,n(i,r,t,null)}},enumerable:!0,configurable:!1})}function v(t,e,i){var n=e.$width,r=e.$height;t.config._fillApp?t.define({width:n,height:r}):t.define({left:(n-t.$width)/2,top:(r-t.$height)/2}),i||t.resize()}function g(t,e){var i=e.getRoot();t.attachEvent("onHide",(function(){i.$destructed||(webix.html.removeCss(i.$view,"webix_win_inside"),i.enable())}));var n=e.attachEvent("view:resize",(function(){v(t,i)}));t.attachEvent("onDestruct",(function(){e.detachEvent(n)}))}var m="<span class='webix_icon wxi-dots webix_fmanager_menu_icon'></span>";function w(t){return{attachEvent:function(e,i){return webix.UIManager.addHotKey(e,i,t),{key:e,handler:i}},detachEvent:function(e){var i=e.key,n=e.handler;return webix.UIManager.removeHotKey(i,n,t)}}}var y={MoveFiles:function(t,e){if("files"===this.State.source){var i=this.app.getService("operations");i.move(i.extractIds(t),this.GetTargetFolder(e))}else"trash"===this.State.source&&this.app.callEvent("app:action",["delete",t]);return!1},AddHotkeys:function(){for(var t=this,e=webix.env.isMac?"COMMAND":"CTRL",i=[{key:"DELETE",oper:"delete",trash:"remove"},{key:"BACKSPACE",oper:"delete",trash:"remove"},{key:e+"+C",oper:"copy"},{key:e+"+X",oper:"cut",trash:"trashed"},{key:e+"+V",oper:"paste",trash:"paste"},{key:e+"+R",oper:"rename"},{key:e+"+O",oper:"open"},{key:e+"+E",oper:"edit"},{key:e+"+D",oper:"download"}],n=function(e){r.on(w(r.getRoot()),i[e].key,(function(n,r){var o="trash"!==t.State.source?i[e].oper:i[e].trash;o&&t.app.callEvent("app:action",[o]),webix.html.preventEvent(r)}))},r=this,o=0;o<i.length;++o)n(o)},SourceHandlers:function(){var t=this;this.on(this.State.$changes,"source",(function(e,i){(i||!i&&"files"!==e)&&("files"!==t.State.source?(t.State.selectedItem=[],t.LoadData(t.State.path,"",e)):t.LoadData(t.State.path))}))},HandleDrag:function(t){var e=this,i=this.State.source;return("files"===i||"trash"===i)&&(t.items=t.source.map((function(t){return e.WTable.getItem(t)})),t.stateSource=i,this.__proto__.DragMarker.call(this,t))},HandleDrop:function(t){return"trash"!==t.stateSource?this.MoveFiles(t.items,t.target):"trash"!==this.State.source&&void this.app.callEvent("app:action",["restore",t.source,this.GetTargetFolder(t.target)])},LoadData:function(t,e,i){var n=this;if(i){this._Track=!1;var r=this.WTable;r.data.url!==t&&(r.clearAll(),this.app.getService("local").files(t,!1,i).then((function(t){n.RenderData(t),n.SelectActive()}))),this._Track=!0}else this.__proto__.LoadData.call(this,t,e)},Activate:function(t){if(t.length)if(1===t.length){var e=t[0];if("trash"!==this.State.source||"/"===e.id){if(!t.length)return;"folder"===e.type?this.ShowSubFolder(".."===e.value?e.value:e.id):"code"===e.type||"xls"===e.$ext||"xlsx"===e.$ext?this.app.callEvent("app:action",["edit",t]):this.app.callEvent("app:action",["open",t])}}else"trash"!==this.State.source&&this.app.callEvent("app:action",["edit",t])},ShowSubFolder:function(t){this.State.source="files",this.__proto__.ShowSubFolder.call(this,t)},DragMark:function(){var t=this;webix.extend(this.WTable,{$dragMark:function(e){t.WTable._marked&&t.WTable._marked!=e.target&&t.WTable.removeCss(t.WTable._marked,"webix_drag_over"),e.target&&"trash"!==t.State.source?(t.WTable.addCss(e.target,"webix_drag_over"),t.WTable._marked=e.target):"trash"==t.State.source&&e.stateSource&&"trash"!==e.stateSource&&webix.html.addCss(t.WTable.$view,"webix_drag_over")},$dragOut:function(e,i,n){"trash"==t.State.source&&i!==n&&webix.html.removeCss(t.WTable.$view,"webix_drag_over")}},!0)}};function b(t){Object.assign(t,y)}var _=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this;return b(this),this.app.getService("localusers").users().then((function(i){e.Users=i;var n=t.prototype.config.call(e);return n.on.onBeforeDrag=function(t){return e.HandleDrag(t)},n.on.onBeforeDrop=function(t){return e.HandleDrop(t)},n}))},e.prototype.init=function(){t.prototype.init.call(this),this.SourceHandlers(),this.DragMark(),webix.TooltipControl.addTooltip(this.WTable.$view)},e.prototype.RenderData=function(t){var e=this;this.WTable.sync(t,(function(){return e.WTable.filter((function(t){return t.value&&".."!==t.value}))}))},e.prototype.CardTemplate=function(t){var e="";if(t.users&&t.users.length){e="<div class='webix_fmanager_card_shared'>";for(var i=[],n=t.users.length>4?1:0,r=0;r<t.users.length&&(r<3||3===r&&r-t.users.length==-1);++r){var o=this.Users.getItem(t.users[r]);i.push('<img class="shared_user_name user_'+(n+r)+'" webix_tooltip="'+o.name+"<br>("+o.email+')" src="'+this.app.getService("users").avatarUrl(o.id,o.avatar)+'" />')}n&&i.unshift('<span class="shared_user_name user_plus">+'+(t.users.length-3)+"</span>"),e+=i.reverse().join(""),e+="</div>"}var a,s,c=this.app.getService("locale")._,l=t.star&&"trash"!==this.State.source?"<div class='webix_fmanager_star'><span class='webix_docmanager_icon dmi-star'></span></div>":"";if("folder"===t.type)a='<div class="webix_fmanager_card_preview">'+l+"<span class='webix_icon wxi-folder webix_fmanager_folder_icon'></span></div>",s='<div class="webix_fmanager_card_panel">\n\t\t<span class="webix_fmanager_card_label">'+c("Folder")+'</span>\n\t\t<span class="webix_fmanager_card_name folder">'+this.SearchTemplate(t.value)+"</span>"+m+"\n\t\t</div>";else{var p=webix.skin.$active.listItemHeight<29?[163,92]:[214,124],u=this.app.getService("backend").previewURL(t,p[0],p[1]);a='<div class="webix_fmanager_card_preview file">'+l+('<img height="'+p[1]+'" width="'+p[0]+'" src="'+u+'" onerror=\'this.style.display="none"\'/>')+e+"</div>",s='<div class="webix_fmanager_card_panel file">\n\t\t<span class="webix_fmanager_card_name">'+this.Icon(t)+'<span class="file_name_text">'+this.SearchTemplate(t.value)+"</span></span>"+m+"\n\t\t</div>"}return'<div class="webix_fmanager_card_outer"><div class="webix_fmanager_card" webix_l_id="'+t.id+'">'+(a+s)+"</div></div>"},e.prototype.SearchTemplate=function(t){var e=this.State.search;if(e=e.replace(/(#\w+\b)/g,"").trim()){var i=new RegExp("("+e.replace(/ +/g,")|(")+")","gi");return t.replace(i,"<span class='webix_fmanager_search_mark'>$&</span>")}return t},e}(s.cards),x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return{view:"icon",css:"webix_fmanager_history_back",icon:"dmi-arrow-left",tooltip:(0,this.app.getService("locale")._)("Back to editor"),click:function(){t.app.callEvent("history:close",[])}}},e}(s.JetView),S=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=t.prototype.config.call(this);this.Compact=this.getParam("compact");var i=e.rows[0];i.visibleBatch="editor",i.cols[0].batch="editor",(webix.env.mobile||this.Files.length>1)&&(i.cols[i.cols.length-1].batch="editor"),webix.env.mobile||i.cols.splice(i.cols.length-1,0,{view:"label",label:" ",localId:"name",batch:"history",css:"webix_fmanager_editor_name"});var n=i.cols.findIndex((function(t){return"name"===t.localId}));n>-1&&i.cols.splice(n+1,0,{batch:"history"}),this.Compact&&i.cols.unshift({view:"proxy",batch:"history",css:"webix_fmanager_back_proxy",borderless:!0,body:x}),i.cols.splice(i.cols.length-1,0,this.GetVersionsButton(),this.GetRestoreButton());var r={type:"wide",cols:[e.rows[1],{view:"proxy",borderless:!0,hidden:!0,localId:"r-side",body:{$subview:!0,name:"r-side"}}]};return e.rows[1]=r,e},e.prototype.GetRestoreButton=function(){var t=this,e={view:"button",localId:"restoreBtn",hidden:!0,css:"webix_primary",align:"center",click:function(){return t.RestoreVersion()}};return this.Compact?(e.value=this._("Restore"),e.autowidth=!0):(e.value=this._("Restore this version"),e.width=296,e.inputWidth=200),e},e.prototype.GetVersionsButton=function(){var t=this;return{localId:"versionsBtn",view:"button",type:"icon",icon:"wxi-clock",label:this.Compact?"History":"",css:"webix_transparent webix_fmanager_versions",autowidth:!0,tooltip:this._("Show version history"),batch:"editor",hidden:!0,click:function(){return t.ShowHistory()}}},e.prototype.init=function(){t.prototype.init.call(this),this.HandleVersioning()},e.prototype.HandleVersioning=function(){var t=this;this.Editor=this.$$("editor"),this.State=f({version:0,current:!0,date:null,diff:!0}),this.on(this.State.$changes,"current",(function(e){e?t.$$("restoreBtn").hide():t.$$("restoreBtn").show()})),this.on(this.State.$changes,"date",(function(e){e&&t.SetMainLabel(e)})),this.on(this.app,"history:close",(function(){t.HideHistory()}))},e.prototype.SetMainLabel=function(t,e){var i=this.$$("name"),n=i.getValue().split(", ");if(t){var r='<span class="date">'+this.DateFormat(t).date+"</span>";n[1]=r,i.setValue(n[0]+", "+n[1])}else i.setValue(e||n[0])},e.prototype.DateFormat=function(t){var e="",i="on",n=webix.Date.datePart(new Date),r=webix.Date.datePart(t,!0);return webix.Date.equal(n,r)?(e="%H:%i:%s",i="at"):e=r.getYear()===n.getYear()?"%F %j":"%F %j, %Y",{preposition:i,date:webix.Date.dateToStr(e)(t)}},e.prototype.SetVersionsButton=function(t){var e=this.$$("versionsBtn");if(!this.State.version&&(e.isVisible()||e.show(),!this.Compact)){var i=this.DateFormat(t.date);e.config.label=this._("Last edited "+i.preposition)+" "+i.date,e.resize(),e.refresh()}},e.prototype.ShowHistory=function(){var t=this,e=this.GetActiveFile();this.Save(e).then((function(){var i=t.GetFileData(e);t.show("editor.history",{target:"r-side",params:{file:i,state:t.State,compact:t.getParam("compact")}}),t.$$("r-side").show(),t.SetBatch("history")}))},e.prototype.GetFileData=function(t){return this.Files.find((function(e){return e.id===t}))},e.prototype.HideHistory=function(){this.show("_blank",{target:"r-side"}),this.$$("r-side").hide(),this.SetBatch("editor")},e.prototype.SetBatch=function(t){this.getRoot().queryView("toolbar").showBatch(t),"history"===t?this.Editor.hide():(this.Editor.show(),this.$$("restoreBtn").hide(),webix.env.mobile&&this.SetMainLabel())},e.prototype.RestoreVersion=function(){var t=this,e=this.GetActiveFile();webix.confirm({text:this._("Are you sure ?"),container:this.app.getRoot().$view}).then((function(){t.app.getService("versions").restore(e,1*t.State.version).then((function(i){var n=t.Files.findIndex((function(t){return t.id===e}));t.Files[n].date=new Date(1e3*i.date),t.app.getService("operations").read(i.id).then((function(e){t.HideHistory(),t.AddDoc(i,e),t.OpenDoc(i.id)}))}))}))},e.prototype.ChangeTextState=function(e,i){t.prototype.ChangeTextState.call(this,e,i),e||(i||(i=this.GetActiveFile()),this.SetVersionsButton(this.GetFileData(i)))},e.prototype.OpenDoc=function(t){var e=this;this.$$("editor").getEditor(!0).then((function(i){i.swapDoc(e._buffers[t]),i.focus();var n=e.GetFileData(t);e.SetVersionsButton(n),e.SetMainLabel(null,e.GetFileLabel(n))}))},e}(s.editor),$=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=t.prototype.config.call(this);if(!webix.env.mobile){var i=e.rows[0].cols;i.splice.apply(i,r([0,2],this.GetMobileControls())),i.splice(i.length-1,1,this.GetCloseAll(!0))}return e.rows[1].cols[0]={view:"excelviewer",editable:!0,editaction:"dblclick",css:"webix_data_border",areaselect:!0,header:!1,localId:"editor"},this.Compact&&(e.rows[1].rows=e.rows[1].cols,delete e.rows[1].cols),e},e.prototype.init=function(){var t=this;this.HandleVersioning(),this._changed={},this.File=this.Files[0],this.$$("name").setValue('<div class="filename">'+this.ClipName(this.File.id)+'</div><span class="extension">.'+this.File.$ext+"</span>"),webix.extend(this.Editor,webix.ProgressBar),this.Editor.showProgress({type:"top"}),this.LoadFile(this.File.id,!0),this.on(this.Editor,"onAfterEditStop",(function(e){e.value!=e.old&&t.ChangeTextState(!0,t.File.id)})),this.on(w(this.Editor),"any",(function(){var e=t.Editor.getSelectedId();e&&t.Editor.edit(e)})),this.on(this.State.$changes,"version",(function(e){t.Diffs=null,t.ParseVersion(e,t.State.diff)})),this.on(this.State.$changes,"diff",(function(e){t.Diffs?t.ResetDiffStyle(t.State.version,e):t.ParseVersion(t.State.version,e)})),this.on(w(),(webix.env.isMac?"COMMAND":"CTRL")+" + S",(function(e,i){t.Save(),webix.html.preventEvent(i)})),this.on(w(),"ESC",(function(){return t.ConfirmAll()}))},e.prototype.LoadFile=function(t,e){var i=this,n=this.app.getService(e?"backend":"versions").directLink(t);this.Editor.load("binary->"+n,"excel").then((function(){i.Editor.hideProgress(),e&&i.SetVersionsButton(i.File)}))},e.prototype.ResetDiffStyle=function(t,e){if(t){var i=this.getSubView("r-side").GetPrevVersion(t);i&&this.StyleDiffCells(e),this.ResetTotalDiff(!i&&e)}},e.prototype.ParseVersion=function(t,e){var i=this;if(t){this.Editor.showProgress({type:"top"}),this.Editor.clearAll();var n=this.getSubView("r-side").GetPrevVersion(t);this.ResetTotalDiff(!n&&e),e&&n?webix.promise.all([this.ParseExcel(n),this.ParseExcel(t)]).then((function(t){var e=t[0],n=t[1];i.Diffs=i.CollectDiffs(e.data,n.data),i.Editor.parse(n),i.StyleDiffCells(!0)})):this.LoadFile(t)}},e.prototype.ResetTotalDiff=function(t){var e=t?"addCss":"removeCss";webix.html[e](this.Editor.$view,"webix_fmanager_diff_all")},e.prototype.ParseExcel=function(t){var e=this,i=this.app.getService("versions").directLink(t);return webix.ajax().response("arraybuffer").get(i).then((function(t){return webix.DataDriver.excel.toObject({data:t,options:{ext:e.File.$ext}})}))},e.prototype.CollectDiffs=function(t,e){for(var i=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)e[n][r]!=t[n][r]&&i.push([n,r]);return i},e.prototype.StyleDiffCells=function(t){var e=this;this.Editor.showProgress({type:"top"});var i=t?"addCellCss":"removeCellCss";this.Diffs.forEach((function(t){var n=e.Editor.columnId(t[1]);e.Editor[i](e.Editor.getIdByIndex(t[0]),n,"webix_docmanager_diff_excel",!0)})),this.Editor.render(),this.Editor.hideProgress()},e.prototype.Save=function(t){var e=this;return this.Editor.editStop(),t||(t=this.File.id),this._changed[t]?webix.toExcel(this.Editor,{download:!1,styles:!0,spans:!0,heights:!0,header:!1}).then((function(i){return e.app.getService("operations").writeBinary(t,e.File.value,i).then((function(){e.ChangeTextState(!1,t)}))})):webix.promise.resolve()},e.prototype.HideHistory=function(){this.refresh()},e.prototype.SetBatch=function(t){this.getRoot().queryView("toolbar").showBatch(t),"history"===t&&this.Editor.define("editable",!1)},e.prototype.GetActiveFile=function(){return this.File.id},e.prototype.ChangeTextState=function(t){var e=this.File.id;t!==!!this._changed[e]&&(this._changed[e]=t,this.ChangeButtonState(t),t||this.SetVersionsButton(this.File))},e.prototype.RestoreVersion=function(){var t=this,e=this.File.id;webix.confirm({text:this._("Are you sure ?"),container:this.app.getRoot().$view}).then((function(){t.app.getService("versions").restore(e,1*t.State.version).then((function(){return t.HideHistory()}))}))},e}(S),k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.File=this.getParam("file"),this.State=this.getParam("state");var e=this.getParam("compact"),i=this.app.getService("locale")._;return this.app.getService("localusers").users().then((function(n){var r={view:"toolbar",elements:[{view:"label",label:i("Version history"),align:"center",css:"webix_fmanager_history_bar"}]};e||r.elements.unshift(x);var o={view:"checkbox",localId:"diffCheck",labelWidth:12,labelRight:i("Show changes"),value:t.State.diff,on:{onChange:function(e){return t.State.diff=!!e}}},a={type:"form",margin:0,padding:0,rows:[r,{view:"list",localId:"list",width:e?0:300,select:!0,borderless:!0,scheme:{$init:t.PrepareDates},type:{height:"auto"},template:function(e){return t.ListTemplate(e,n)},on:{onAfterSelect:function(e){return t.SetVersion(e)}}},o,{height:12}]},s={localId:"diff",scroll:"auto",hidden:"code"!==t.File.type,view:"template",css:"webix_docmanager_editor_diff"};return e?{type:"wide",rows:[s,a]}:{type:"wide",cols:[s,a]}}))},e.prototype.init=function(){var t=this;this.List=this.$$("list"),this.Diff=this.$$("diffCheck"),this.dateFormat=webix.Date.dateToStr("%F %j, %Y %H:%i:%s"),this.on(this.State.$changes,"version",(function(e){return t.GetVersion(e,t.State.diff)})),this.on(this.State.$changes,"diff",(function(e){return t.GetVersion(t.List.getSelectedId(),e)})),this.on(this.app,"history:close",(function(){return t.$$("diff").setHTML("")})),this.LoadData()},e.prototype.LoadData=function(){var t=this;this.app.getService("versions").versions(this.File.id).then((function(e){t.List.parse(e),t.List.select(t.List.getFirstId())}))},e.prototype.PrepareDates=function(t){"string"==typeof t.date&&(t.date=new Date(t.date)),"string"==typeof t.origin&&(t.origin=new Date(t.origin))},e.prototype.ListTemplate=function(t,e){var i=this.app.getService("locale")._,n='<div class="webix_fmanager_version_date">'+this.dateFormat(t.date)+"</div>";t.origin&&(n+='<div class="webix_fmanager_restore_date">'+i("Restored from")+" "+this.dateFormat(t.origin)+"</div>");var r=e.getItem(t.user);return'<div class="webix_fmanager_version">'+n+('<div class="webix_fmanager_version_author">'+('<img class="webix_fmanager_version_face" webix_tooltip="'+r.name+"<br>("+r.email+')" src="'+this.app.getService("users").avatarUrl(r.id,r.avatar)+'" />')+'<span class="webix_fmanager_version_name">'+r.name+"</span></div>")+"</div>"},e.prototype.SetVersion=function(t){var e=this.List.getItem(t);this.State.$batch({version:t,current:webix.Date.equal(this.File.date,e.date),date:e.date})},e.prototype.GetVersion=function(t,e){var i=this;t&&"code"===this.File.type&&this.app.getService("versions").readText(t,e).then((function(n){t==i.List.getLastId()&&e&&(n='<span class="webix_docmanager_diff_insert">'+n+"</span>"),i.$$("diff").setHTML(n)}))},e.prototype.GetPrevVersion=function(t){return this.List.getNextId(t)},e}(s.JetView),T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this,i=t.prototype.config.call(this),n=i.body.rows[1];return n.type.folder=function(t){return"<div class='"+("dmi"===(t.icon?t.icon.slice(0,3):"")?"webix_docmanager_icon":"webix_icon")+" "+(t.icon||"wxi-folder")+"'></div>"},n.on.onBeforeDrop=function(t){return e.HandleDrop(t)},i},e.prototype.init=function(){t.prototype.init.call(this),this.DragMark()},e.prototype.DragMark=function(){var t=this;webix.extend(this.Tree,{$dragMark:function(e){if(t.Tree._marked&&t.Tree._marked!=e.target&&t.Tree.removeCss(t.Tree._marked,"webix_drag_over"),e.target){var i="../trash"===e.target&&"trash"!==e.stateSource;0===e.target.indexOf("..")&&"../files"!==e.target&&!i||(t.Tree.addCss(e.target,"webix_drag_over"),t.Tree._marked=e.target)}}},!0)},e.prototype.HandleDrop=function(t){if(!t.target)return!1;"../files"===t.target&&(t.target="/");var e="trash"===t.stateSource;return 0===t.target.indexOf("..")?"../trash"!==t.target||e||this.app.callEvent("app:action",["delete",t.items]):e?this.app.callEvent("app:action",["restore",t.source,t.target]):this.app.getService("operations").move(t.source,t.target),!1},e.prototype.Subscribe=function(){var e=this;t.prototype.Subscribe.call(this),this.on(this.State.$changes,"source",(function(t){"files"===t&&"/"!==e.State.path||e.Tree.select("../"+t);var i=e.getRoot().queryView("button");"files"!==t?(i.disable(),"trash"===t&&(e.State.preview=!1)):i.enable()}))},e}(s.folders),C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this;b(this);var i=t.prototype.config.call(this),n=this.app.getService("locale")._;return i.type.backToFiles=function(){return n("back to ")+e.app.getService("backend").getRootName()},i.on.onBeforeDrag=function(t){return e.HandleDrag(t)},i.on.onBeforeDrop=function(t){return e.HandleDrop(t)},i},e.prototype.NameTemplate=function(t){return(t.star&&"trash"!==this.State.source?"<div class='webix_fmanager_star'><span class='webix_docmanager_icon dmi-star'></span></div>":"")+("folder"===t.type?"<span class='webix_icon wxi-folder'></span>"+t.value:this.Icon(t)+'<span class="file-name">'+t.value+"</span>")},e.prototype.init=function(){t.prototype.init.call(this),this.SourceHandlers(),this.DragMark()},e}(s.list),F=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this,i=t.prototype.config.call(this);return i.on.onBeforeShow=function(t){var i=e._Locate(t),n=e.app.getState().source;if(!i||"empty"===i[0].type&&"files"!==n)return!1;e.getSubView("options").FilterOptions(i)},i},e}(s["menus/contextmenu"]),I=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.state=i.state,n}return i(e,t),e.prototype.config=function(){var e,i=this.app.getService("locale")._,n=t.prototype.config.call(this),o=[{id:"favorite",show:289,value:i("Add to favorites"),icon:"dmi-star-outline"},{id:"unfavorite",show:289,value:i("Remove from favorites"),icon:"dmi-star"},{id:"share",value:i("Share"),show:32,icon:"dmi-share"},{$template:"Separator",show:32}];return(e=n.data).splice.apply(e,r([11,0],o)),n.data=n.data.concat([{id:"restore",value:i("Restore"),show:127,icon:"dmi-delete-restore"},{id:"remove",value:i("Delete from trash"),show:127,icon:"dmi-delete-empty",hotkey:"Del / &#8592;"}]),n.template=function(t){return(t.icon?'<span class="webix_list_icon webix_icon '+t.icon+'"></span>':"")+t.value+(t.hotkey?'<span class="webix_fmanager_context-menu-hotkey">'+t.hotkey+"</span>":"")},n},e.prototype.FilterOptions=function(t){var e=this,i=this.state?this.state.source:null,n=this.getRoot();if(this.Files=t,"trash"!==i){var r=t[0],o=t.length>1,a=["image","audio","video","code","pdf"].find((function(t){return t===r.type||t===r.$ext})),s="code"===r.type||"xls"===r.$ext||"xlsx"===r.$ext,c=this.app.getState().search,l="empty"===r.type;this.getRoot().define("width",c&&!o?270:200),this.getRoot().filter((function(t){return!(!(128&t.show)&&l||o&&!(2&t.show)||"folder"===r.type&&!(1&t.show)||4&t.show&&!s||8&t.show&&!a||16&t.show&&!e.compact||32&t.show&&e.tree||64&t.show&&!c||(256&t.show&&r.star?"favorite"===t.id:"unfavorite"===t.id))})),this.FilterCopyPaste(i,n)}else n.define("width",250),n.filter((function(t){return"remove"===t.id||"restore"===t.id}))},e.prototype.FilterCopyPaste=function(t,e){"files"!==t&&e.filter((function(t){return 35^t.show&&161^t.show}),null,!0)},e}(s["menus/menubody"]),P=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact"),n=e(this.getParam("label")),r={view:"window",borderless:!0,css:"webix_fmanager_popup",head:{view:"toolbar",padding:{left:12,right:4},borderless:!0,cols:[{template:function(){return n},height:36,borderless:!0,css:"webix_fmanager_shared_title"},{view:"icon",icon:"wxi-close",css:"webix_fmanager_shared_close",hotkey:"esc",click:function(){return t.getRoot().hide()}}]},body:{$subview:!0},on:{onHide:function(){t.show("_blank",{target:"popup"})}}};if(i)r.fullscreen=!0;else{var o="mini"==webix.skin.$name||"compact"==webix.skin.$name;r.width=o?400:540}return this.app.getService("jet-win").updateConfig(r),r},e}(s.JetView);var E=[{bg:"#2EADC2",c:"#FFFFFF"},{bg:"#3B3ABB",c:"#FFFFFF"},{bg:"#813EBB",c:"#FFFFFF"},{bg:"#B442A8",c:"#FFFFFF"},{bg:"#B43D64",c:"#FFFFFF"},{bg:"#D25640",c:"#FFFFFF"},{bg:"#DBA10D",c:"#FFFFFF"},{bg:"#7BBD48",c:"#FFFFFF"},{bg:"#5EBD90",c:"#FFFFFF"}],D=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact",!0),n={localId:"users",view:"text",placeholder:e("Invite someone..."),suggest:{template:"#email#",body:{css:"webix_fmanager_user_list",data:[],template:function(e){return t.InputListTemplate(e)}}}},r={localId:"counter",borderless:!0,template:function(t){return t?t.users?e("Available to")+" "+t.users+" "+e("user(s)"):e("No users"):"&nbsp;"},autoheight:!0},o={view:"list",borderless:!0,localId:"list",css:"webix_fmanager_shared_list",template:function(e){return t.ListTemplate(e)},type:{height:webix.skin.$active.rowHeight},autoheight:!i,yCount:i?0:4,onClick:{webix_fmanager_remove_user:function(e,i){return t.RemoveUser(1*i)}}},a={borderless:!0,padding:12,margin:4,rows:[n,{view:"button",label:e("Invite"),inputWidth:140,css:"webix_primary",click:function(){return t.Done()}},r,o]};return i&&a.rows.push({gravity:1e-5}),a},e.prototype.init=function(){var t=this;this.List=this.$$("list"),this.Input=this.$$("users"),this.File=this.getParam("info",!0)[0],this.app.getService("localusers").users().then((function(e){t.Data=e;var i=webix.$$(t.Input.config.suggest).getList();i.clearAll(),i.sync(e);var n=t.File.users;n&&n.length&&t.List.parse(n.map((function(t){return e.getItem(t)}))),t.UpdateCounter(n)})),this.Input.focus(),webix.TooltipControl.addTooltip(this.List.$view)},e.prototype.RemoveUser=function(t){var e=this,i=this.app.getService("locale")._;webix.confirm({text:i("Are you sure ?"),container:this.app.getRoot().$view}).then((function(){return e.app.getService("operations").removeUser(e.File,t).then((function(){e.List.remove(t),e.UpdateCounter(e.File.users)}))}))},e.prototype.ClearInput=function(){this.Input.setValue("")},e.prototype.Done=function(){var t=this,e=this.Input.getValue();if(e){var i=this.Data.find((function(t){return t.email===e}),!0);if(i&&!this.List.find((function(t){return t.id===i.id}),!0))return this.app.getService("operations").share(this.File,i.id).then((function(){t.List.add(i),t.List.showItem(i.id),t.ClearInput(),t.UpdateCounter(t.File.users)}));this.ClearInput()}},e.prototype.ListTemplate=function(t){return(t.avatar?'<img class="avatar_img" webix_tooltip="'+t.email+'" src="'+this.app.getService("users").avatarUrl(t.id,t.avatar)+'">':function(t){var e="",i=E[Math.floor(Math.random()*E.length)];"string"!=typeof t&&(t=""),t=t.split(" ");for(var n=0;n<t.length&&e.length<2;n++)t[n]&&(e+=t[n].charAt(0));return'<div class="default_avatar" style="background:'+i.bg+"; color:"+i.c+';">'+(e||"no")+"</div>"}(t.name))+'<span webix_tooltip="'+t.email+'">'+t.name+"</span><span class='webix_fmanager_remove_user webix_icon wxi-trash'></span>"},e.prototype.InputListTemplate=function(t){return t.name+'&nbsp;<span class="webix_fmanager_user_email">'+t.email+"</span>"},e.prototype.UpdateCounter=function(t){this.$$("counter").setValues({users:t?t.length:0}),t&&t.length?webix.html.removeCss(this.List.$view,"no-border"):webix.html.addCss(this.List.$view,"no-border")},e}(s.JetView);function A(){return R[Math.floor(4*Math.random())][Math.floor(4*Math.random())]}var R=[["#00a037","#13a1aa","#df282f","#fd772c"],["#6d4bce","#b26bd3","#c87095","#90564d"],["#eb2f89","#ea77c0","#777676","#a9a8a8"],["#9bb402","#e7a90b","#0bbed7","#038cd9"]],j=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact",!0),n={margin:4,cols:[{view:"search",localId:"search",placeholder:e("Type to search a tag"),on:{onTimedKeyPress:function(){return t.FilterTags()},onChange:function(e){return!e&&t.FilterTags()}}},{view:"button",value:e("Add"),css:"webix_primary",width:90,click:function(){t.AddTag()}}]},r=webix.skin.$active.propertyItemHeight+1;return{borderless:!0,padding:12,margin:0,type:"clean",rows:[n,{localId:"tags",view:"datatable",editable:!0,header:!1,yCount:i?0:4,columns:[{id:"name",editor:"text",fillspace:!0,template:function(e){return t.SearchTemplate(e.name)}},{id:"color",editor:"color",width:50,template:function(e){return t.TaglistTemplate(e)},suggest:{css:"webix_fmanager_palette",type:"colorboard",padding:3,body:{view:"colorboard",palette:R,width:4*r,height:4*r}}},{width:50,template:"<span class='webix_fmanager_remove_tag webix_icon wxi-trash'></span>"}],on:{onBeforeEditStop:function(e,i){return t.ProcessTagEditing(e,i)},"data->onSyncApply":function(){t.FilterTags()}},onClick:{webix_fmanager_remove_tag:function(e,i){t.RemoveTag(i.row)}}}]}},e.prototype.init=function(){var t=this;this.List=this.$$("tags"),this.Search=this.$$("search"),this.SetTaglistOverlay(),this.app.getService("localtags").tags().then((function(e){t.List.parse(e),t.Search.focus()}))},e.prototype.ProcessTagEditing=function(t,e){if(t.value!==t.old){var i=this.$$("tags").getItem(e.row);return i[e.column]=t.value,this.UpdateTag(e.row,{name:i.name,color:i.color}),!1}},e.prototype.FilterTags=function(){var t=this;this._Input=this.Search.getValue().trim().toLowerCase(),this.List.filter((function(e){return-1!==e.name.toLowerCase().indexOf(t._Input)}))},e.prototype.AddTag=function(){var t=this,e={name:"New",color:A()};this.app.getService("operations").addTag(e).then((function(e){t.Search.setValue(""),t.List.editCell(e,"name",!1,!0)}))},e.prototype.UpdateTag=function(t,e){var i=this;this.app.getService("operations").updateTag(t,e).then((function(){i.List.blockEvent(),i.List.editStop(),i.List.unblockEvent()}))},e.prototype.RemoveTag=function(t){this.app.getService("operations").removeTag(t)},e.prototype.SetTaglistOverlay=function(){var t=this;webix.extend(this.List,webix.OverlayBox),this.on(this.List.data,"onAfterFilter",(function(){return t.ToggleOverlay()})),this.on(this.List.data,"onStoreUpdated",(function(){return t.ToggleOverlay()}))},e.prototype.ToggleOverlay=function(){var t=this.app.getService("locale")._;this.List.count()?this.List.hideOverlay():this.List.showOverlay(t("Click Add to create a new tag"))},e.prototype.TaglistTemplate=function(t){return'<span class="webix_fmanager_tag_color" style="background-color: '+t.color+';">&nbsp;</span>'},e.prototype.SearchTemplate=function(t){if(this._Input){var e=new RegExp("("+this._Input+")","gi");return t.replace(e,"<span class='webix_fmanager_search_mark'>$1</span>")}return t},e}(s.JetView),V=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.GetSource=function(t){return"left"===t?this.State.source:"files"},e}(s["panel-double"]),L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this,i=t.prototype.config.call(this);return i.rows[0].cols[0].click=function(){var t="files"!==e.State.source?e.State.source:"";e.app.getService("local").refresh(e.State.path,t)},i},e.prototype.init=function(){var e=this;t.prototype.init.call(this);var i=this.app.getService("upload").getUploader();this.on(i,"onBeforeFileDrop",(function(t,i){if(e.getRoot().$view.contains(i.target)&&"files"!==e.State.source)return!1})),this.on(this.State.$changes,"source",(function(t){return e.ProcessSource(t)}))},e.prototype.ProcessPath=function(e){"files"===this.State.source&&t.prototype.ProcessPath.call(this,e)},e.prototype.ProcessSource=function(t){var e=this,i=this.app.getService("locale")._;this.app.getService("local").folders().then((function(n){if("files"!==t||"/"===e.State.path){var r=i(n.getItem("../"+t).value);e.$$("path").setValues({source:r})}}))},e.prototype.RenderPath=function(e){return e.path?t.prototype.RenderPath.call(this,e):e.source?this.RenderSource(e):""},e.prototype.RenderSource=function(t){return'<span class="webix_fmanager_path_chunk" data-path="0">'+t.source+"</span>"},e}(s.panel),M=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("users");return this.app.getService("localusers").users().then((function(i){return{localId:"comments",view:"comments",css:"webix_fmanager_comments",mentions:!0,users:i,currentUser:1,scheme:{$init:t.PrepareComments},listItem:{templateAvatar:function(t){var n=i.getItem(t.user_id);return'<div class="webix_comments_avatar"><img class="webix_comments_avatar_image" src="'+e.avatarUrl(n.id,n.avatar)+'" /></div>'}}}}))},e.prototype.init=function(){var t=this;this.Comments=this.$$("comments"),this.on(this.Comments,"onBeforeAdd",(function(e,i){return t.AddComment(i)})),this.on(this.Comments.queryView("list").data,"onDataUpdate",(function(e,i,n){return t.UpdateComment(e,i,n)})),this.on(this.Comments,"onBeforeDelete",(function(e){return t.RemoveComment(e)})),webix.extend(this.Comments.queryView("list"),webix.OverlayBox)},e.prototype.urlChange=function(){var t=this.getParam("file");this.LoadComments(t)},e.prototype.LoadComments=function(t){var e=this;this.File=t,this.app.getService("users").comments(t.id).then((function(t){e.Comments.clearAll(),e.Comments.parse(t),e.ChangeListState()}))},e.prototype.ChangeListState=function(){if(this.Comments.count())this.Comments.queryView("list").hideOverlay();else{var t=this.app.getService("locale")._;this.Comments.queryView("list").showOverlay('<div class="webix_fmanager_overlay">'+t("No comments yet")+"</div>")}},e.prototype.PrepareComments=function(t){t&&"string"==typeof t.date&&(t.date=new Date(t.date))},e.prototype.AddComment=function(t){var e=this;return this.app.getService("users").addComment(this.File.id,t.text).then((function(i){t.id=1*i.id,e.Silently("add",[t]),e.ChangeListState()})),!1},e.prototype.UpdateComment=function(t,e,i){var n=this;this.app.getService("users").updateComment(t,e.text).catch((function(){n.Comments.getItem(t).text=i.text,n.Comments.refresh(t)}))},e.prototype.RemoveComment=function(t){var e=this;return this.app.getService("users").deleteComment(t).then((function(t){e.Silently("remove",[t.id]),e.ChangeListState()})),!1},e.prototype.Silently=function(t,e){var i=this.Comments;i.blockEvent(),i[t].apply(i,e),i.unblockEvent()},e}(s.JetView),O=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this.app.getService("locale")._,i=t.prototype.config.call(this);return{rows:[webix.copy(i.rows[0]),{localId:"tabview",view:"tabview",css:"webix_fmanager_preview_tabs",cells:[{header:e("Preview"),body:i.rows[1]},{header:e("Comments"),body:{$subview:!0,name:"comments"}}]}]}},e.prototype.ShowInfo=function(e){t.prototype.ShowInfo.call(this,e);var i=this.$$("tabview").getTabbar();"empty"===e.type?(i.setValue(i.config.options[0].id),i.hide()):(i.show(),this.show("preview.comments",{target:"comments",params:{file:e}}))},e}(s.preview),U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this,i=this.app.getService("locale")._,n={css:"webix_fmanager_tags_line",rows:[{view:"label",css:"webix_fmanager_info_title",label:i("Tags")},{cols:[{view:"multicombo",localId:"tags:combo",css:"preview_tags",placeholder:i("Add a tag"),newValues:!0,options:{template:"#name#",body:{data:[],template:function(t){return e.TaglistTemplate(t)}}},on:{onItemClick:function(t,i){return e.SearchTag(i.target)}}},{rows:[{cols:[{view:"icon",icon:"wxi-plus",css:"webix_fmanager_tags_plus",tooltip:i("Add a tag"),click:function(){return e.OpenTagList()}},{view:"icon",icon:"dmi-cog",css:"webix_fmanager_tag_settings",tooltip:i("Open tag settings"),click:function(){e.app.callEvent("app:action",["tags"])}}]}]}]}]},r=t.prototype.config.call(this),o=r.cells[0].body;return o.css="webix_fmanager_info",o.rows.splice(0,0,n),r},e.prototype.init=function(){var e=this;t.prototype.init.call(this),this.Tags=this.$$("tags:combo"),this.HandleTagUpdate(),this.HandleColoring(),this.HandleTagCreation(),this.on(this.app,"current:tags:updated",(function(){return e.ReloadTags()}))},e.prototype.OpenTagList=function(){this.Tags.getInputNode().click(),this.Tags.getList().show(this.Tags.$view)},e.prototype.ShowInfo=function(e){var i=this;if(t.prototype.ShowInfo.call(this,e),"empty"!==e.type){this.File=e;var n=this.app.getService("localtags").tags(),r=this.app.getService("tags").getTags(e.id);webix.promise.all([n,r]).then((function(t){i.Tags.getList().parse(t[0]),i.SetTagsSilent(t[1])}))}},e.prototype.HandleTagUpdate=function(){var t=this;this.on(this.Tags,"onChange",(function(e,i){t.File&&t.app.getService("tags").setTags(t.File.id,e.join()).catch((function(){t.SetTagsSilent(t.Tags,i)}))}))},e.prototype.SetTagsSilent=function(t){this.Tags.blockEvent(),this.Tags.setValue(t),this.Tags.unblockEvent()},e.prototype.HandleColoring=function(){var t="mini"===webix.skin.$name||"compact"===webix.skin.$name;this.Tags.$renderTag=function(e,i,n,r){var o=this.getList().getItem(r),a='<span class="webix_multicombo_text">'+e+'</span><span class="webix_multicombo_delete" role="button" aria-label="'+webix.i18n.aria.removeItem+'"></span>';return'<li class="webix_multicombo_value" style="line-height: '+(n+(t?2:0))+"px; max-width:"+i+"px; background-color: "+o.color+';" optvalue="'+webix.template.escape(r)+'">'+a+"</li>"}},e.prototype.ReloadTags=function(){var t=this;this.app.getService("tags").getTags(this.File.id).then((function(e){t.SetTagsSilent(e)}))},e.prototype.SearchTag=function(t){var e;if("webix_multicombo_value"===t.className?e=t:"webix_multicombo_value"===t.parentNode.className&&(e=t.parentNode),e){this.Tags.getPopup().hide();var i=e.getAttribute("optvalue");this.getParam("state").search="#"+this.Tags.getList().getItem(i).value}},e.prototype.SwitchTabs=function(e,i,n){this.State.search&&!this.State.selectedItem.length?e.show():e.hide(),t.prototype.SwitchTabs.call(this,e,i,n)},e.prototype.HandleTagCreation=function(){var t=this,e=this.Tags.getList();this.on(e,"onBeforeAdd",(function(e,i){return t.AddTag({name:i.value,tags:t.Tags.getValue()}),!1})),this.SetTaglistOverlay(e)},e.prototype.AddTag=function(t){var e=this,i={name:t.name,color:A()};this.app.getService("operations").addTag(i,t.tags).then((function(){e.ReloadTags()}))},e.prototype.SetTaglistOverlay=function(t){var e=this;webix.extend(t,webix.OverlayBox),this.on(t.data,"onAfterFilter",(function(){return e.ToggleOverlay(t)})),this.on(t.getTopParentView(),"onShow",(function(){return e.ToggleOverlay(t)}))},e.prototype.ToggleOverlay=function(t){var e=this.app.getService("locale")._;t.count()?(t.define({autoheight:!0,yCount:5}),t.hideOverlay()):(t.define({yCount:1,autoheight:!1}),t.showOverlay(e("Press Enter to create a new tag"))),t.resize()},e.prototype.TaglistTemplate=function(t){var e=webix.skin.$active.listItemHeight,i='<span class="webix_fmanager_tag_marker" style="background-color:'+t.color+"; height:"+(e-12)+"px; width:"+(e-12)+"px; margin-top:"+e/10+'px;">&nbsp;</span>';return t.name+i},e}(s["preview/info"]),B=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.init=function(){var e=this;t.prototype.init.call(this),this.on(this.app,"app:action",(function(t,i){"share"===t?e.show("./menus.popup/menus.sharepopup",{target:"popup",params:{info:i,compact:e.Compact,label:"Share File"}}):"tags"===t&&e.show("./menus.popup/menus.tagspopup",{target:"popup",params:{compact:e.Compact,label:"Manage Tags"}})}))},e}(s.top),H=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this,i=t.prototype.config.call(this),n=webix.skin.$active,r=this.app.getService("locale")._;return i.cols.find((function(t){return"previewMode"===t.localId})).icon="dmi-gesture-double-tap",i.cols.splice(5,0,{localId:"emptyTrash",css:"webix_fmanager_empty_trash",view:"button",type:"icon",icon:"dmi-delete-empty",tooltip:r("Empty trash"),width:n.toolbarHeight<37?48:60,hidden:!0,click:function(){return e.app.callEvent("app:action",["remove","all"])}}),i},e.prototype.init=function(){var e=this;t.prototype.init.call(this);var i=this.getParam("state");this.on(i.$changes,"source",(function(t,i){"trash"===t?(e.$$("emptyTrash").show(),e.$$("previewMode").hide()):"trash"===i&&(e.$$("emptyTrash").hide(),e.getParam("compact")||e.$$("previewMode").show())}))},e}(s.topbar),z={};z.cards=_,z["editor/back"]=x,z["editor/excel"]=$,z["editor/history"]=k,z.editor=S,z.folders=T,z.list=C,z["menus/contextmenu"]=F,z["menus/menubody"]=I,z["menus/popup"]=P,z["menus/sharepopup"]=D,z["menus/tagspopup"]=j,z["panel-double"]=V,z.panel=L,z["preview/comments"]=M,z.preview=O,z["preview/info"]=U,z["sections/dataview"]=y,z.top=B,z.topbar=H;var W=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.files=function(e,i){return i?this._files(this.url("files"),{id:e,source:i}):t.prototype.files.call(this,e)},e.prototype.removePermanent=function(t){return webix.ajax().del(this.url("delete?id="+encodeURIComponent(t))).then((function(t){return t.json()}))},e.prototype.restore=function(t,e){return webix.ajax().put(this.url("delete"),{id:t,target:e}).then((function(t){return t.json()}))},e.prototype.favour=function(t){return webix.ajax().post(this.url("favorite"),{id:t}).then((function(t){return t.json()}))},e.prototype.unfavour=function(t){return webix.ajax().del(this.url("favorite?id="+encodeURIComponent(t))).then((function(t){return t.json()}))},e.prototype.writeBinary=function(t,e,i){var n=new FormData;return n.append("upload",i,e),webix.ajax().post(this.url("direct?id="+encodeURIComponent(t)),n).then((function(t){return t.json()}))},e}(c.Backend),G=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.files=function(e,i,n){if(n){var r=this.fscache.get(n);return i?r:r?Promise.resolve(r):(r=new webix.DataCollection({scheme:{$change:this.prepareData,$serialize:this.serializeData}}),this.fscache.set(n,r),this.reload(r,e,n))}return t.prototype.files.call(this,e,i)},e.prototype.refresh=function(t,e){var i=this.fscache.get(e||t);if(i)return this.reload(i,t,e)},e.prototype.reload=function(e,i,n){var r=this;return n?this.app.getService("backend").files(i,n).then((function(t){return e.clearAll(),e.parse(r.backToFiles().concat(t)),e})):t.prototype.reload.call(this,e,i)},e.prototype.backToFiles=function(){return[{type:"folder",id:"/",value:"..",$row:function(t,e){return e.backIcon()+"<span class='webix_fmanager_back'>"+e.backToFiles()+"</span>"}}]},e.prototype.defaultTree=function(){return[{value:"My Files",id:"../files",open:!0},{value:"Favorite",$css:{"margin-top":"20px"},id:"../favorite",icon:"dmi-star"},{value:"Recent",id:"../recent",icon:"dmi-history"},{value:"Shared",id:"../shared",icon:"dmi-share-all"},{value:"Trash",$css:{"margin-top":"20px"},id:"../trash",icon:"wxi-trash"}]},e.prototype.addFile=function(e,i){this.hierarchy.exists(e)||(e="/"),t.prototype.addFile.call(this,e,i)},e}(c.LocalData),N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.initEvents=function(){var e=this;t.prototype.initEvents.call(this),this.app.attachEvent("app:action",(function(t,i,n){switch(t){case"trashed":e.addToClipboard(t);break;case"restore":e.restore(i,n);break;case"remove":e.removePermanent(i);break;case"favorite":case"unfavorite":e.favour(i)}}))},e.prototype.remove=function(e){var i=this;(e||this.state.selectedItem.length)&&t.prototype.remove.call(this,e).then((function(){i.local().refresh("/","trash")}))},e.prototype.restore=function(t,e){var i=this,n=this.state,r=this.app.getService("locale")._;if(t||(t=n.selectedItem),!t.length)return webix.promise.reject();t=this.extractIds(t),this.app.getService("progress").files(r("Restoring..."),t,(function(t){return i.backend().restore(t,e).then((function(e){var n=i.local();n.deleteFile(t),n.addFile(i.dir(e.id),e)}))}))},e.prototype.removePermanent=function(t){var e=this,i=this.state,n=this.app.getService("locale")._;return"all"===t?t=this.local().files("/",!0,"trash").serialize():t||(t=i.selectedItem),t.length?(t=this.extractIds(t),webix.confirm({text:n("Are you sure ?"),container:this.app.getRoot().$view}).then((function(){e.app.getService("progress").files(n("Deleting..."),t,(function(t){return e.backend().removePermanent(t).then((function(i){i.invalid||e.local().deleteFile(t)}))}))}))):webix.promise.reject()},e.prototype.addToClipboard=function(e){"files"!==this.state.source&&"trash"!==this.state.source||t.prototype.addToClipboard.call(this,e)},e.prototype.paste=function(e){var i=this.state;i.clipboard&&("files"===i.source?"trashed"===i.clipboard.mode?this.restore(i.clipboard.files,i.path):t.prototype.paste.call(this,e):"trash"===i.source&&"cut"===i.clipboard.mode&&this.remove(i.clipboard.files))},e.prototype.favour=function(t){var e=this,i=t[0],n=!i.star,r=this.backend();(n?r.favour:r.unfavour).call(r,i.id).then((function(t){t.invalid||(e.local().updateFile(t.id,{star:n}),e.local().refresh("/","favorite"))}))},e.prototype.dir=function(t){return t.slice(0,t.lastIndexOf("/"))||"/"},e.prototype.edit=function(t){var e=this.state;if(t||(t=e.selectedItem),(t=t.filter((function(t){return"code"===t.type||"xls"===t.$ext||"xlsx"===t.$ext}))).length){var i="code"===t[0].type;t=i?t.filter((function(t){return"code"===t.type})):[(t=t.filter((function(t){return"xls"===t.$ext||"xlsx"===t.$ext})))[t.length-1]],this.app.show(i?"/editor":"/editor.excel",{params:{files:t,state:e,compact:this.app.getSubView().Compact}})}},e.prototype.writeBinary=function(t,e,i){var n=this;return this.backend().writeBinary(t,e,i).then((function(e){return n.local().updateFile(t,{size:e.size,date:e.date})}))},e.prototype.users=function(){return this.app.getService("users")},e.prototype.share=function(t,e){var i=this;return this.users().share(t.id,e).then((function(n){return i.local().updateFile(n.id,{users:(t.users||[]).concat(e)})}))},e.prototype.removeUser=function(t,e){var i=this;return this.users().removeUser(t.id,e).then((function(n){return i.local().updateFile(n.id,{users:t.users.filter((function(t){return t!==e}))})}))},e.prototype.tags=function(){return this.app.getService("tags")},e.prototype.localtags=function(){return this.app.getService("localtags")},e.prototype.addTag=function(t,e){var i=this;return this.tags().addTag(t).then((function(t){if(void 0!==e){var n=i.state.selectedItem,r=n[n.length-1];e=e?e+","+t.id:t.id,i.tags().setTags(r.id,e).then((function(){i.app.callEvent("current:tags:updated")}))}return i.localtags().addTag(t)}))},e.prototype.updateTag=function(t,e){var i=this;return this.tags().updateTag(t,e).then((function(e){i.app.callEvent("current:tags:updated"),i.localtags().updateTag(t,e)}))},e.prototype.removeTag=function(t){var e=this,i=this.app.getService("locale")._;webix.confirm({text:i("Are you sure ?"),container:this.app.getRoot().$view}).then((function(){e.tags().removeTag(t).then((function(t){e.app.callEvent("current:tags:updated"),e.localtags().removeTag(t.id)}))}))},e}(c.Operations),q=function(){function t(t,e){this._url=e}return t.prototype.url=function(t){return this._url+t},t.prototype.users=function(){return webix.ajax().get(this.url("users/all")).then((function(t){return t.json()}))},t.prototype.avatarUrl=function(t,e){return this.url(""+e.slice(1))},t.prototype.share=function(t,e){return webix.ajax().post(this.url("share"),{id:t,user:e}).then((function(t){return t.json()}))},t.prototype.removeUser=function(t,e){return webix.ajax().del(this.url("share?id="+encodeURIComponent(t)+"&user="+e)).then((function(t){return t.json()}))},t.prototype.comments=function(t){return webix.ajax().get(this.url("comments?id="+encodeURIComponent(t))).then((function(t){return t.json()}))},t.prototype.addComment=function(t,e){return webix.ajax().post(this.url("comments?id="+encodeURIComponent(t)),{value:e}).then((function(t){return t.json()}))},t.prototype.updateComment=function(t,e){return webix.ajax().put(this.url("comments/"+t),{value:e}).then((function(t){return t.json()}))},t.prototype.deleteComment=function(t){return webix.ajax().del(this.url("comments/"+t)).then((function(t){return t.json()}))},t}(),K=function(){function t(t){this.app=t,this.userlist=new webix.DataCollection({scheme:{$change:function(t){t.value=t.name}}}),this.users_ready=null}return t.prototype.users=function(t){var e=this.userlist;return!t&&this.users_ready||(this.users_ready=this.app.getService("users").users().then((function(t){return e.clearAll(),e.parse(t),e}))),this.users_ready},t}(),J=function(){function t(t,e){this._url=e}return t.prototype.url=function(t){return this._url+t},t.prototype.tags=function(){return webix.ajax().get(this.url("tags/all")).then((function(t){return t.json()}))},t.prototype.getTags=function(t){return webix.ajax().get(this.url("tags?id="+encodeURIComponent(t))).then((function(t){return t.json()}))},t.prototype.setTags=function(t,e){return webix.ajax().put(this.url("tags"),{id:t,value:e}).then((function(t){return t.json()}))},t.prototype.addTag=function(t){return webix.ajax().post(this.url("tags"),t).then((function(t){return t.json()}))},t.prototype.updateTag=function(t,e){return webix.ajax().put(this.url("tags/"+t),e).then((function(t){return t.json()}))},t.prototype.removeTag=function(t){return webix.ajax().del(this.url("tags/"+t)).then((function(t){return t.json()}))},t}(),Y=function(){function t(t){this.app=t,this.taglist=new webix.DataCollection({}),this.tags_ready=null}return t.prototype.tags=function(t){var e=this.taglist;return!t&&this.tags_ready||(this.tags_ready=this.app.getService("tags").tags().then((function(t){return e.clearAll(),e.parse(t),e}))),this.tags_ready},t.prototype.addTag=function(t){return this.taglist.add(t)},t.prototype.updateTag=function(t,e){this.taglist.exists(t)&&this.taglist.updateItem(t,e)},t.prototype.removeTag=function(t){this.taglist.exists(t)&&this.taglist.remove(t)},t}(),X=function(){function t(t,e){this._url=e}return t.prototype.url=function(t){return this._url+t},t.prototype.versions=function(t){return webix.ajax().get(this.url("versions"),{id:t}).then((function(t){return t.json()}))},t.prototype.readText=function(t,e){var i={mode:"text"};return e&&(i.diff=!0),webix.ajax().get(this.url("versions/"+t),i).then((function(t){return t.text()}))},t.prototype.restore=function(t,e){return webix.ajax().post(this.url("versions"),{id:t,version:e}).then((function(t){return t.json()}))},t.prototype.directLink=function(t){return this.url("versions/"+t+"?mode=binary")},t}(),Z=function(t){function e(e){var i,r,o,a=this,l=new Map([[s.top,z.top],[s.cards,z.cards],[s.editor,z.editor],[s.folders,z.folders],[s.list,z.list],[s["menus/menubody"],z["menus/menubody"]],[s["menus/contextmenu"],z["menus/contextmenu"]],[s.panel,z.panel],[s["panel-double"],z["panel-double"]],[s["preview/info"],z["preview/info"]],[s.preview,z.preview],[s.topbar,z.topbar],[c.Backend,Q.Backend],[c.LocalData,Q.LocalData],[c.Operations,Q.Operations]]);return e.override&&e.override.forEach((function(t,e){return l.set(e,t)})),(a=t.call(this,n(n(n({},{version:"10.0.1"}),e),{override:l}))||this).setService("users",new(a.dynamic(q))(a,a.config.url)),a.setService("localusers",new(a.dynamic(K))(a)),a.setService("tags",new(a.dynamic(J))(a,a.config.url)),a.setService("localtags",new(a.dynamic(Y))(a)),a.setService("versions",new(a.dynamic(X))(a,a.config.url)),o={updateConfig:function(t){var e=i.getRoot(),n=e.$view;r?r&&!n.id&&(n.id=r):(n.id?r=n.id:n.id=r="webix_"+webix.uid(),webix.html.addStyle(".webix_win_inside *:not(.webix_modal_box):not(.webix_modal_cover){ z-index: 0; }"),webix.html.addStyle("#"+r+"{ position: relative; }"),webix.html.addStyle("#"+r+" .webix_window{ z-index:2 !important; }"),webix.html.addStyle("#"+r+" .webix_disabled{ z-index:1 !important; }")),t.container=r,t.fullscreen&&(t._fillApp=!0,delete t.fullscreen),t.on||(t.on={});var o=!0,a=t.on.onShow;return t.on.onShow=function(){var t=this;a&&a.apply(this,arguments),o&&(this.$setSize=function(i,n){v(t,e,!0),webix.ui.window.prototype.$setSize.apply(t,[i,n])},g(this,i),o=null),webix.callEvent("onClick",[]),webix.html.addCss(n,"webix_win_inside"),e.disable(),v(this,e)},t}},(i=a).setService("jet-win",o),a}return i(e,t),e.prototype.require=function(t,e){return"jet-views"===t?z[e]:"jet-locales"===t?tt[e]:null},e.prototype.dynamic=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e}(p);webix.protoUI({name:"docmanager",app:Z,getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},$init:function(){var t=this.$app.getState();for(var e in t)h(t,this.config,e)}},webix.ui.jetapp),webix.extend(z,s);var Q={LocalData:G,Backend:W,Operations:N,Users:q,LocalUsers:K,Tags:J,LocalTags:Y,Versions:X,Progress:c.Progress,Upload:c.Upload},tt={en:webix.extend({Favorite:"Favorite",Recent:"Recent",Shared:"Shared",Trash:"Trash","Add to favorites":"Add to favorites","Remove from favorites":"Remove from favorites",Share:"Share",Tags:"Tags",Comments:"Comments","Can view":"Can view","Can edit":"Can edit","Share File":"Share File","Invite someone...":"Invite someone...",Invite:"Invite",Restore:"Restore","Delete from trash":"Delete from trash","Restoring...":"Restoring...","Empty trash":"Empty trash","back to ":"back to ","Select a user":"Select a user","Add a tag":"Add a tag","No comments yet":"No comments yet","No users":"No users","Available to":"Available to","user(s)":"user(s)","Manage Tags":"Manage Tags","Press Enter to create a new tag":"Press Enter to create a new tag","Click Add to create a new tag":"Click Add to create a new tag","Open tag settings":"Open tag settings","Type to search a tag":"Type to search a tag","Show version history":"Show version history","Last edited at":"Last edited at","Last edited on":"Last edited on","Back to editor":"Back to editor","Version history":"Version history","Show changes":"Show changes","Restored from":"Restored from","Restore this version":"Restore this version"},l.en)};t.App=Z,t.locales=tt,t.services=Q,t.views=z,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=docmanager.min.js.map
