/*
@license
Webix <%= pkg.productName %> v.<%= pkg.version %>
This software is covered by Webix Trial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).chat={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function i(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var n=function(){return(n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var a in e=arguments[i])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},a=function(){},o=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)},t.prototype.getParam=function(t,e){var i=this._data[t];if(void 0!==i||!e)return i;var n=this.getParentView();return n?n.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(i){return(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,i){var n=t.attachEvent(e,i);return this._events.push({obj:t,id:n}),n},t.prototype.contains=function(t){for(var e in this._subs){var i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var i=e.view._getDefaultSub();if(i)return i}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function r(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),i=[],n=0;n<e.length;n++){var a=e[n],o={},r=a.indexOf(":");if(-1===r&&(r=a.indexOf("?")),-1!==r)for(var s=0,c=a.substr(r+1).split(/[\:\?\&]/g);s<c.length;s++){var l=c[s].split("=");o[l[0]]=decodeURIComponent(l[1])}i[n]={page:r>-1?a.substr(0,r):a,params:o,isNew:!0}}return i}function s(t){for(var e=[],i=0,n=t;i<n.length;i++){var a=n[i];e.push("/"+a.page);var o=c(a.params);o&&e.push("?"+o)}return e.join("")}function c(t){var e=[];for(var i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}var l=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:r(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var i=new t(this.route,this.index+this._next);return i.setParams(i.route.url,e,i.index),i},t.prototype.setParams=function(t,e,i){if(e){var n=t[i].params;for(var a in e)n[a]=e[a]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=s(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var i=this.route.url;if(null===t)return i;var n=this.route.url,a=!0;if(i=n.slice(0,this.index+(e?this._next:0)),t){i=i.concat(r(t));for(var o=0;o<i.length;o++)n[o]&&(i[o].view=n[o].view),a&&n[o]&&i[o].page===n[o].page?i[o].isNew=!1:i[o].isNew&&(a=!1)}return i},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=s(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,i){var n=this,o=this._join(t.url,i);return this.setParams(o,t.params,this.index+(i?this._next:0)),new Promise((function(t,i){var r=s(o),c={url:o,redirect:r,confirm:Promise.resolve()},l=e?e.app:null;if(l&&!l.callEvent("app:guard",[c.redirect,e,c]))return void i(new a);c.confirm.catch((function(t){return i(t)})).then((function(){if(null!==c.redirect){if(c.redirect!==r)return l.show(c.redirect),void i(new a);n.route.path=r,n.route.url=o,t()}else i(new a)}))}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=s(e.url)),new t(e,0)},t.prototype.update=function(t,e,i){var n=this.route.url[this.index+(i||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?n.page=e:n.params[t]=e,this.route.path=s(this.route.url)},t}(),h=function(t){function e(e,i){var n=t.call(this,e.webix)||this;return n.app=e,n._children=[],n}return i(e,t),e.prototype.ui=function(t,e){var i=(e=e||{}).container||t.container,n=this.app.createView(t);return this._children.push(n),n.render(i,this._segment,this),"object"!=typeof t||t instanceof o?n:n.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var i in t)this.setParam(i,t[i]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var n=this.getParentView();return n?n.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var a=this.getSubViewInfo(e.target);if(a){if(a.parent!==this)return a.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,a.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,i){var n=this;return t.show(e,i,!0).then((function(){return n._init_url_data(),n._urlChange()})).then((function(){t.route.linkRouter&&(n.app.getRouter().set(t.route.path,{silent:!0}),n.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,i){var n=this;"string"==typeof e&&(e=new l(e,0)),this._segment=e,this._parent=i,this._init_url_data();var a="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==a?(this._container=a,this._render(e)):this._urlChange().then((function(){return n.getRoot()}))},e.prototype._render=function(t){var e=this,i=this.config();return i.then?i.then((function(i){return e._render_final(i,t)})):this._render_final(i,t)},e.prototype._render_final=function(t,e){var i,n=this,a=null,o=null,r=!1;if(this._container.tagName?o=this._container:(a=this._container).popup?(o=document.body,r=!0):o=this.webix.$$(a.id),!this.app||!o)return Promise.reject(null);var s=this._segment.current(),c={ui:{}};this.app.copyConfig(t,c.ui,this._subs),this.app.callEvent("app:render",[this,e,c]),c.ui.$scope=this,!a&&s.isNew&&s.view&&s.view.destructor();try{if(a&&!r){var l=o,h=l.getParentView();h&&"multiview"===h.name&&!c.ui.id&&(c.ui.id=l.config.id)}this._root=this.app.webix.ui(c.ui,o);var u=this._root;r&&u.setPosition&&!u.isVisible()&&u.show(),a&&(a.view&&a.view!==this&&a.view!==this.app&&a.view.destructor(),a.id=this._root.config.id,this.getParentView()||!this.app.app?a.view=this:a.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((function(){return n._urlChange().then((function(){return n._initUrl=null,n.ready(n._root,e.suburl())}))}))}catch(t){i=Promise.reject(t)}return i.catch((function(t){return n._initError(n,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var i in this._subs){var n=this._subs[i],a=this._renderFrameLock(i,n,null);a&&e.push(a)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,i){if(!e.lock){var n=this._renderFrame(t,e,i);n&&(e.lock=n.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,i){var n=this;if("default"===t){if(this._segment.next()){var a=i?i.params:null;return e.params&&(a=this.webix.extend(a||{},e.params)),this._createSubView(e,this._segment.shift(a))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((function(){return n._createSubView(e,e.route)}));if(e.branch)return}var o=e.view;if(!o&&e.url){if("string"==typeof e.url)return e.route=new l(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||o instanceof e.url||(o=new(this.app._override(e.url))(this.app,"")),o||(o=e.url)}if(o)return o.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var i=this;return this.app.createFromURL(e.current()).then((function(n){return n.render(t,e,i)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(o),u=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._ui=i.ui,n}return i(e,t),e.prototype.config=function(){return this._ui},e}(h),p=function(){function t(t,e,i){this.path="",this.app=i}return t.prototype.set=function(t,e){this.path=t;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),d=!0,f=function(t){function e(e){var i=this,n=(e||{}).webix||window.webix;return e=n.extend({name:"App",version:"1.0",start:"/home"},e,!0),(i=t.call(this,n,e)||this).config=e,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return i(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,i){if((t instanceof o||"function"==typeof t&&t.prototype instanceof o)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);var n=t instanceof Array;for(var a in e=e||(n?[]:{}),t){var r=t[a];if("function"==typeof r&&r.prototype instanceof o&&(r={$subview:r}),!r||"object"!=typeof r||r instanceof this.webix.DataCollection||r instanceof RegExp||r instanceof Map)e[a]=r;else if(r instanceof Date)e[a]=new Date(r);else{var s=this.copyConfig(r,r instanceof Array?[]:{},i);null!==s&&(n?e.push(s):e[a]=s)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var i=e.getAttribute("trigger");if(i)return this._forView(e,(function(t){return t.app.trigger(i)})),t.cancelBubble=!0,t.preventDefault();var n=e.getAttribute("route");if(n)return this._forView(e,(function(t){return t.show(n)})),t.cancelBubble=!0,t.preventDefault()}var a=e.parentNode;a&&this.clickHandler(t,a)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,i=this.config.views,n=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(n="function"==typeof i?i(t):i[t])&&(t=n,n=null),n||("_hidden"===t?n={hidden:!0}:"_blank"===t?n={}:(t=t.replace(/\./g,"/"),n=this.require("jet-views",t)))}catch(e){n=this._loadError(t,e)}return n.then||(n=Promise.resolve(n)),n=n.then((function(t){return t.__esModule?t.default:t})).catch((function(i){return e._loadError(t,i)}))},e.prototype._forView=function(t,e){var i=this.webix.$$(t);i&&e(i.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(i){return e.createView(i,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e.prototype.createView=function(t,i,n){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:i,params:n,router:p});if(t.prototype instanceof o)return new t(this,{name:i,params:n});t=t(this)}return t instanceof o?t:new u(this,{name:i,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){var n=e[i].message;0===n.indexOf("Module build failed")?(n=n.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+n+"</pre>"):(n+="<br><br>Check console for more details",this.webix.message({type:"error",text:n,expire:-1}))}},e.prototype.render=function(t,e,i){var n=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var a=null;!this.$router?(d&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return n.clickHandler(t)})),d=!1),"string"==typeof e&&(e=new l(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0):a="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString();var o=i?i.params:this.config.params||null,r=this.getSubView(),s=this._subSegment,c=s.show({url:a,params:o},r).then((function(){return n.createFromURL(s.current())})).then((function(e){return e.render(t,s)})).then((function(t){return n.$router.set(s.route.path,{silent:!0}),n.callEvent("app:route",[n.getUrl()]),t}));return this.ready=this.ready.then((function(){return c})),c},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new h(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;this._segment=t;if(this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof a))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(i,"webixappstart"),e.webix.html.addCss(i,"webixapp")}),10)}if(t){if(this.app){var n=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new l(this.config.start,0),t.current().view=n}}else{var o=this.$router.get();o||(o=this.config.start,this.$router.set(o,{silent:!0})),t=new l(o,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,i){var n=!0!==t.$subview?t.$subview:null,a=t.name||(n?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[a]={id:e.id,url:n,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(o),_=function(){function t(t,e){var i=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return t.prototype.set=function(t,e){var i=this;if(this.config.routes){var n=t.split("?",2);for(var a in this.config.routes)if(this.config.routes[a]===n[0]){t=a+(n.length>1?"?"+n[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),m=!1;function v(t){if(!m&&t){m=!0;var e=window;e.Promise||(e.Promise=t.promise);var i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){var i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});var n=t.ui.baselayout.prototype.addView,a=t.ui.baselayout.prototype.removeView,o={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var i=this.$scope,a={};t=i.app.copyConfig(t,{},a),n.apply(this,[t,e]);var o=function(t){i._renderFrame(t,a[t],null).then((function(){i._subs[t]=a[t]}))};for(var r in a)o(r);return t.id}return n.apply(this,arguments)},removeView:function(){if(a.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var i in e){var n=e[i];t.$$(n.id)||(n.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,o,!0),t.extend(t.ui.baselayout.prototype,o,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}}var g=function(t){function e(e){var i;return e.router=e.router||_,v((i=t.call(this,e)||this).webix),i}return i(e,t),e.prototype.require=function(t,e){return require(t+"/"+e)},e}(f),b=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}i(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(_),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var i=this;this.path=t,e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function w(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function F(t,e,i){for(var n in t)w(t,n)&&e.call(i||t,t[n],n,t)}function y(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var x=String.prototype.replace,S=String.prototype.split,C=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},k={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:C,chinese:function(){return 0},croatian:C,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:C,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},E={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function $(t){var e,i=(e={},F(E,(function(t,i){F(t,(function(t){e[t]=i}))})),e);return i[t]||i[S.call(t,/-/,1)[0]]||i.en}function I(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var A=/\$/g,j=/%\{(.*?)\}/g;function P(t,e,i,n){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var a=t,o=n||j,r="number"==typeof e?{smart_count:e}:e;if(null!=r.smart_count&&a){var s=S.call(a,"||||");a=(s[function(t,e){return k[$(t)](e)}(i||"en",r.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return a=x.call(a,o,(function(t,e){return w(r,e)&&null!=r[e]?x.call(r[e],A,"$$"):t}))}function D(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?P:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||y,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(I(e)+"(.*?)"+I(i),"g")}(e.interpolation)}D.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},D.prototype.extend=function(t,e){F(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.extend(t,n):this.phrases[n]=t}),this)},D.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:F(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.unset(t,n):delete this.phrases[n]}),this)},D.prototype.clear=function(){this.phrases={}},D.prototype.replace=function(t){this.clear(),this.extend(t)},D.prototype.t=function(t,e){var i,n,a=null==e?{}:e;if("string"==typeof this.phrases[t])i=this.phrases[t];else if("string"==typeof a._)i=a._;else if(this.onMissingKey){n=(0,this.onMissingKey)(t,a,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+t+'"'),n=t;return"string"==typeof i&&(n=P(i,a,this.currentLocale,this.tokenRegex)),n},D.prototype.has=function(t){return w(this.phrases,t)},D.transformPhrase=function(t,e,i){return P(t,e,i)};var B=D;var M=window.webix;M&&v(M);var T=function(t,e,i){var n=(i=i||{}).storage,a=n?n.get("lang")||"en":i.lang||"en";function o(e,o,r){o.__esModule&&(o=o.default);var c={phrases:o};i.polyglot&&t.webix.extend(c,i.polyglot);var l=s.polyglot=new B(c);if(l.locale(e),s._=t.webix.bind(l.t,l),a=e,n&&n.put("lang",a),i.webix){var h=i.webix[e];h&&t.webix.i18n.setLocale(h)}return r?Promise.resolve():t.refresh()}function r(e,n){if(!1!==i.path){var a=(i.path?i.path+"/":"")+e;o(e,t.require("jet-locales",a),n)}}var s={getLang:function(){return a},setLang:r,setLangData:o,_:null,polyglot:null};t.setService("locale",s),r(a,!0)},L=window;L.Promise||(L.Promise=L.webix.promise);var R=!1;function U(t,e,i){var n=e.$width,a=e.$height;t.config._fillApp?t.define({width:n,height:a}):t.define({left:(n-t.$width)/2,top:(a-t.$height)/2}),i||t.resize()}function V(t,e){var i=e.getRoot();t.attachEvent("onHide",(function(){i.$destructed||(webix.html.removeCss(i.$view,"webix_win_inside"),i.enable())}));var n=e.attachEvent("view:resize",(function(){U(t,i)}));t.attachEvent("onDestruct",(function(){e.detachEvent(n)}))}var H=1;function O(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function N(t,e){e=e||{};var i={},n={},a=function(t,e){var a=H++;return i[a]={mask:t,handler:e},e("*"===t?n:n[t],void 0,t),a},o=[],r=!1,s=function(t,e,n,a){if(r)o.push([t,e,n,a]);else for(var s=Object.keys(i),c=0;c<s.length;c++){var l=i[s[c]];l&&("*"!==l.mask&&l.mask!==t||l.handler(n,e,t,a))}};return Object.defineProperty(n,"$changes",{value:{attachEvent:a,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$observe",{value:a,enumerable:!1,configurable:!1}),Object.defineProperty(n,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)n[t]=e[t]}}for(r=!0,t(n),r=!1;o.length;){var i=o.shift();s.apply(this,i)}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$extend",{value:function(t,i){for(var a in i=i||e,t)if(t.hasOwnProperty(a)){var o=t[a];i.nested&&"object"==typeof o&&o?n[a]=N(o,i):z(n,o,a,s)}},enumerable:!1,configurable:!1}),n.$extend(t,e),n}function z(t,e,i,n){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var a=e;e=t,n(i,a,t,null)}},enumerable:!0,configurable:!1})}function q(t){console.error(t)}function G(t,e,i,n,a){e=e||{iceServers:[{urls:"stun:turn.webix.com:5349"},{urls:"turn:turn.webix.com:5349",username:"demo",credential:"redro43a"}]};var o,r,s=new RTCPeerConnection(e),c=((r=new Promise((function(t){o=t}))).resolve=o,r),l=function(t){i(t||{action:"streams",conn:s})};s.onicecandidate=function(e){e.candidate&&t("new-ice-candidate",e.candidate)},s.ontrack=function(){l()},s.onnegotiationneeded=function(){s.createOffer().then((function(t){return s.setLocalDescription(t)})).then((function(){return t("offer",s.localDescription)})).catch(q)},s.oniceconnectionstatechange=function(){switch(s.iceConnectionState){case"closed":case"failed":h(!0)}},s.onicegatheringstatechange=function(){switch(s.signalingState){case"closed":h(!0)}};var h=function(t){s&&(s.ontrack=null,s.onremovetrack=null,s.onremovestream=null,s.onicecandidate=null,s.oniceconnectionstatechange=null,s.onsignalingstatechange=null,s.onicegatheringstatechange=null,s.onnegotiationneeded=null,s.close(),s=null),l({action:"end",final:t})},u={audio:{echoCancellation:!0,noiseSuppression:!0},video:{facingMode:"user"}};return{start:function(e,i,n){n&&t("reset","")},end:h,restart:function(){s.restartIce()},status:function(){return s&&s.remoteDescription?1:0},enable:function(t,e){var i=webix.promise.defer(),n=s.getSenders().map((function(t){return t.track||{}})).reduce((function(t,e){return t.concat(e)}),[]);return n=n.filter((function(e){return e.kind===t})),e&&!n.length?l({action:"upgrade",kind:t,promise:i}):(n.forEach((function(t){return t.enabled=e})),i.resolve()),i},onOffer:function(e){var i=new RTCSessionDescription(e);0===s.getSenders().length?s.setRemoteDescription(i).then((function(){return s.createAnswer()})).then((function(t){return s.setLocalDescription(t)})).then((function(){c.resolve(),t("answer",s.localDescription)})).catch(q):s.setRemoteDescription(i).then((function(){return s.createAnswer()})).then((function(t){return s.setLocalDescription(t)})).then((function(){t("answer",s.localDescription)})).catch(q)},onAnswer:function(t){var e=new RTCSessionDescription(t);return s.setRemoteDescription(e).then((function(){c.resolve()})).catch(q)},upgrade:function(t,e){var i;return navigator.mediaDevices.getUserMedia((i={},i[t]=u[t],i)).then((function(t){t.getTracks().forEach((function(e){return s.addTrack(e,t)})),l(),e.resolve()})).catch((function(i){e.reject(),function(t,e){if(s)switch(t.name){case"NotFoundError":webix.alert({container:a,text:n("Could not find your")+" "+n("audio"==e?"microphone":"camera")});break;case"SecurityError":case"PermissionDeniedError":h(!0);break;default:webix.alert({container:a,text:n("Error opening your")+" "+n("audio"==e?"microphone":"camera")})}}(i,t)}))},onCandidate:function(t){c.then((function(){var e=new RTCIceCandidate(t);return s.addIceCandidate(e)})).catch(q)}}}function W(t,e,i){var n=i.track;if(n){var a=n.kind,o=t[e][a],r=new MediaStream;r.addTrack(n),o.srcObject=r}}var J=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){this.time=0,this.Helpers=this.app.getService("helpers"),this.Back=this.app.getService("backend"),this.callStatuses=this.Back.callStatuses,this.State=this.getParam("state",!0),this.LocalState=N({audio:!0,video:!1,remoteVideo:!1,remoteAudio:!1}),this.Initiator=this.State.callUsers[0]===this.app.config.user,this.State.callStatus===this.callStatuses.active&&(this.AfterRefresh=!0);var t=this.app.getService("local")._users;return{type:"clean",width:this.getParam("compact",!0)?0:380,rows:[{css:"webix_chat_call",localId:"fullscreen",rows:[{animate:!1,borderless:!0,cells:[this.GetAudioConfig(t),this.GetVideoConfig()]},{borderless:!0,css:"webix_chat_video webix_chat_audio",minHeight:96,gravity:1e-4,template:'\n\t\t\t\t\t\t\t\t<div style="position: relative; width: 100%; height: 100%;">\n\t\t\t\t\t\t\t\t\t<div class="webix_chat_video_remote">\n\t\t\t\t\t\t\t\t\t\t<audio autoplay></audio>\n\t\t\t\t\t\t\t\t\t\t<video autoplay playsinline></video>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="webix_chat_video_local">\n\t\t\t\t\t\t\t\t\t\t<audio autoplay></audio>\n\t\t\t\t\t\t\t\t\t\t<video autoplay playsinline></video>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t'+this.Helpers.avatar(t.getItem(this.app.config.user),"webix_chat_video_local_avatar")+"\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t",localId:"connection"},this.GetActionsConfig()]}]}},e.prototype.init=function(){var t=this,e=this.$$("connection").$view;this.localVideo=e.querySelector(".webix_chat_video_local"),this.localAvatar=e.querySelector(".webix_chat_video_local_avatar"),this.remoteVideo=e.querySelector(".webix_chat_video_remote"),this.on(this.Back.pubsub(),"signal",(function(e){var i=e.msg,n=e.type;t.AfterRefresh||(i&&(i=JSON.parse(i)),t.Phone&&t.Phone.events(n,i))})),this.on(this.app,"updateCallTime",(function(e){return t.UpdateCallTime(e)})),this.on(this.State.$changes,"callStatus",(function(e){return t.HandleCallStatusChange(e)})),this.on(this.LocalState.$changes,"remoteVideo",(function(){return t.ShowVideo()}))},e.prototype.GetAudioConfig=function(t){var e=this,i=this.app.getService("locale")._;return{localId:"audio",type:"clean",rows:[{css:"webix_chat_audio_time",localId:"audio-timer",batch:"active",height:56,template:function(){return i("Active call")+" ("+e.Helpers.normalizeTime(e.time)+")"}},{gravity:1e-4,css:"webix_chat_audio"},{height:270,css:"webix_chat_audio",template:function(){var i=t.getItem(e.State.callUsers[e.Initiator?1:0]);return e.Helpers.avatar(i,"webix_chat_call_avatar webix_chat_avatar")+"<p class='webix_chat_call_name'>"+i.name+"</p>"}},{batch:"outgoing",css:"webix_chat_audio",height:30,template:i("Ringing")},{batch:"income",css:"webix_chat_audio",height:30,template:i("Is calling you")},{batch:"income",height:42,css:"webix_chat_audio",cols:[{},{view:"button",height:0,width:86,value:i("Accept"),css:"webix_chat_accept",click:function(){return e.AcceptCall()}},{view:"button",width:86,value:i("Reject"),css:"webix_danger",click:function(){return e.RejectCall()}},{}]},{batch:"refresh",height:42,css:"webix_chat_audio",cols:[{},{view:"button",height:0,width:86,value:i("Join call"),css:"webix_chat_accept",click:function(){e.AfterRefresh=!1,e.Start(!0)}},{view:"button",width:86,value:i("End call"),css:"webix_danger",click:function(){return e.EndCall()}},{}]},{gravity:1e-4,css:"webix_chat_audio"}]}},e.prototype.GetVideoConfig=function(){var t=this;return{localId:"video",type:"clean",rows:[{css:"webix_chat_video_time",height:56,type:"clean",cols:[{localId:"video-timer",template:function(){return t.Helpers.normalizeTime(t.time)}},{view:"icon",localId:"fullscreen-icon",icon:"chi-fullscreen",click:function(){t.SetFullscreen(!t.fullscreen)}},{width:6}]}]}},e.prototype.GetActionsConfig=function(){var t=this;return{height:80,css:"webix_chat_call_actions",localId:"call-actions",rows:[{},{height:44,cols:[{},{view:"toggle",type:"icon",offIcon:"chi-video-off",onIcon:"chi-video",localId:"video-toggle",css:"webix_primary",width:44,click:function(){return t.EnableVideo(!0)}},{width:32},{view:"toggle",type:"icon",offIcon:"chi-audio-off",onIcon:"chi-audio",localId:"audio-toggle",css:"webix_primary",width:44,value:!0,click:function(){return t.EnableAudio(!0)}},{width:32},{view:"button",type:"icon",icon:"chi-hangup",css:"webix_danger",width:44,click:function(){return t.EndCall()}},{}]},{}]}},e.prototype.ControlVisibility=function(t,e,i){var n=this.$$(t);n.show(),e&&n.showBatch(e),this.$$("call-actions")[i?"show":"hide"]()},e.prototype.SetFullscreen=function(t){webix.fullscreen.exit();var e=this.$$("fullscreen-icon");e.config.icon="chi-fullscreen"+(t?"-off":""),e.refresh(),this.fullscreen=t?webix.fullscreen.set(this.$$("fullscreen"),{head:!1,css:"webix_chat_video_fullscreen"}):null},e.prototype.Start=function(t){this.AfterRefresh?this.ControlVisibility("audio","refresh",!1):(this.ControlVisibility("audio","active",!0),this.InitPhone(this.Initiator,t),this.LocalState.audio&&this.EnableAudio(),this.LocalState.video&&this.EnableVideo())},e.prototype.InitPhone=function(t,e){var i=this,a=this.$$("connection").$view.querySelectorAll("audio"),o=this.$$("connection").$view.querySelectorAll("video");this.Phone=function(t,e,i,a,o,r,s){o=webix.extend(o||{},{audio:!0,video:!1});var c,l={audio:!0,video:!1},h=function(t){var e=t.action,n=t.conn,a=t.final,r=t.kind,s=t.promise;"upgrade"===e?(o[r]=!0,c.upgrade(r,s)):"end"===e?(i.remote.audio.srcObject&&i.remote.audio.srcObject.getTracks().forEach((function(t){return t.stop()})),i.local.audio.srcObject&&i.local.audio.srcObject.getTracks().forEach((function(t){return t.stop()})),i.remote.video.srcObject&&i.remote.video.srcObject.getTracks().forEach((function(t){return t.stop()})),i.local.video.srcObject&&i.local.video.srcObject.getTracks().forEach((function(t){return t.stop()})),i.local.audio.removeAttribute("src"),i.local.audio.removeAttribute("srcObject"),i.remote.audio.removeAttribute("src"),i.remote.audio.removeAttribute("srcObject"),i.local.video.removeAttribute("src"),i.local.video.removeAttribute("srcObject"),i.remote.video.removeAttribute("src"),i.remote.video.removeAttribute("srcObject"),a&&i.end()):"streams"===e&&(n.getSenders().forEach((function(t){return W(i,"local",t)})),n.getReceivers().forEach((function(t){return W(i,"remote",t)})))},u=function(){return t("active",n({},l)),G(t,e,h,r,s)};switch(c=u(),a){case 1:c.start(o,l);break;case 2:t("await-offer","");break;case 3:c.start(o,l,!0)}return{events:function(e,a){switch(e){case"reset":c.end(),c=u();break;case"offer":c.onOffer(a);break;case"answer":c.onAnswer(a);break;case"new-ice-candidate":c.onCandidate(a);break;case"await-offer":t("active",n({},l)),c.restart();break;case"active":for(var o in a){var r=i.active.remote?i.active.remote[o]:null;r&&r(a[o])}}},enable:function(e,i){var a=c.enable(e,i);return a.then((function(){l[e]=i})).catch((function(){l[e]=o[e]=!1})).finally((function(){t("active",n({},l))})),a},end:function(){c&&c.end()}}}(this.SendSignal.bind(this),this.app.config.rtcConfig||null,{local:{audio:a[1],video:o[1]},remote:{audio:a[0],video:o[0]},active:{remote:{video:function(t){return i.LocalState.remoteVideo=t},audio:function(t){return i.LocalState.remoteAudio=t}}},end:function(){return i.EndCall()}},t?e?3:1:e?2:4,{video:this.LocalState.video,audio:this.LocalState.audio},this.app.getService("locale")._,this.app.getRoot().$view)},e.prototype.EndCall=function(){this.SetFullscreen(!1),this.getParam("state",!0).callStatus=this.callStatuses.drop,this.Phone?(this.Phone.end(),this.Phone=null,this.Back.updateCall(this.State.callId,this.callStatuses.end)):this.Back.updateCall(this.State.callId,this.callStatuses.ignore)},e.prototype.AcceptCall=function(){this.Back.updateCall(this.State.callId,this.callStatuses.accept)},e.prototype.RejectCall=function(){this.getParam("state",!0).callStatus=this.callStatuses.drop,this.Back.updateCall(this.State.callId,this.callStatuses.reject)},e.prototype.SendSignal=function(t,e){if(this.app)return"string"!=typeof e&&(e=JSON.stringify(e)),this.Back.signalCall(t,e)},e.prototype.EnableAudio=function(t){var e=this,i=t?this.LocalState.audio=!this.LocalState.audio:this.LocalState.audio;this.Phone&&this.Phone.enable("audio",i).catch((function(){e.LocalState.audio=!1,e.$$("audio-toggle").setValue(!1)}))},e.prototype.EnableVideo=function(t){var e=this,i=t?this.LocalState.video=!this.LocalState.video:this.LocalState.video;this.Phone&&this.Phone.enable("video",i).catch((function(){e.LocalState.video=!1,e.$$("video-toggle").setValue(!1)})).finally((function(){e.ShowVideo()}))},e.prototype.CheckVideoVisibility=function(){var t=this.LocalState.remoteVideo,e=this.LocalState.video,i=["none","none","none"];t?i=e?["none","block","block"]:["block","none","block"]:e&&(i=["none","block","none"]),[this.localAvatar,this.localVideo,this.remoteVideo].forEach((function(t,e){t.style.display=i[e]}))},e.prototype.UpdateCallTime=function(t){this.time=t,this.fullscreen?this.fullscreen.queryView({localId:"video-timer"}).refresh():this.$$("audio-timer").isVisible()?this.$$("audio-timer").refresh():this.$$("video-timer").isVisible()&&this.$$("video-timer").refresh()},e.prototype.HandleCallStatusChange=function(t){t==this.callStatuses.init?this.ControlVisibility("audio",this.Initiator?"outgoing":"income",this.Initiator):t==this.callStatuses.active?this.Start():t!=this.callStatuses.reject&&t!=this.callStatuses.end&&t!=this.callStatuses.ignore&&t!=this.callStatuses.lost||this.Phone&&(this.SetFullscreen(!1),this.Phone.end(),this.Phone=null)},e.prototype.ShowVideo=function(){if(this.State.callStatus==this.callStatuses.active&&!this.AfterRefresh){var t=this.LocalState.remoteVideo;!this.LocalState.video&&!t||!t?(this.SetFullscreen(!1),this.ControlVisibility("audio","active",!0)):this.fullscreen||this.ControlVisibility("video","",!0),this.CheckVideoVisibility()}},e}(h),K=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.app.getService("helpers");return{padding:20,margin:20,elementsConfig:{labelWidth:130,labelAlign:"right"},view:"form",localId:"form",css:"webix_chat_newchat_form",elements:[{align:"center",body:{view:"forminput",name:"avatar",body:{localId:"avatar",css:"webix_chat_form_avatar",width:130,height:130,borderless:!0,template:function(t){return i.formAvatar(t,e("Change avatar"))},onClick:{webix_chat_avatar:function(){t.app.getService("upload").fileDialog()}}}}},{align:"center",body:{name:"name",localId:"name",inputAlign:"center",view:"text",width:300,placeholder:e("Chat name"),on:{onChange:function(e){t.NameChangedHandler(e)},onTimedKeyPress:function(){t.NameChangedHandler(t.$$("name").getValue())}}}},{}]}},e.prototype.init=function(){var t=this,e=this.getParam("state",!0),i=e.name,n=e.avatar,a=e.chat;this.$$("form").setValues({name:i,avatar:{avatar:n}});var o=this.app.getService("upload").getUploader(a);this.on(o,"onAfterFileAdd",(function(e){t.UpdateAvatar(e)})),this.on(o,"onUploadComplete",(function(e){t.UpdateAvatar(e)}))},e.prototype.ready=function(){var t=this;webix.delay((function(){t.$$("name").focus()}))},e.prototype.UpdateAvatar=function(t){var e=this;if("client"===t.status&&t.file){var i=new FileReader;i.onload=function(){e.SetLocalAvatar(i.result)},i.readAsDataURL(t.file)}else if("server"===t.status){var n=t.value;this.$$("form").setValues({avatar:n},!0),this.AvatarChangedHandler(n),this.SetLocalAvatar(n)}},e.prototype.SetLocalAvatar=function(t){this.$$("avatar").setValues({avatar:t})},e.prototype.SetInitValues=function(){var t=this.getParam("state",!0).values.form,e=t.name,i=t.avatar;(e||i)&&this.$$("form").setValues({name:e,avatar:{avatar:i}})},e.prototype.NameChangedHandler=function(){},e.prototype.AvatarChangedHandler=function(){},e}(h);webix.ui.datafilter.umMasterCheckox=webix.extend({refresh:function(t,e,i){e.onclick=function(){i.checked=!i.checked,e.querySelector(".webix_icon").className="webix_icon wxi-checkbox-"+(i.checked?"marked":"blank"),t.data.each((function(t){return t[i.columnId]=i.checked})),t.refresh(),t.callEvent("onCustomSave",[])}},render:function(t,e){return e.checked?"<span class='webix_icon wxi-checkbox-marked'></span>":"<span class='webix_icon wxi-checkbox-blank'></span>"}},webix.ui.datafilter.masterCheckbox);var Y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e={batch:"selected",view:"template",localId:"selected",scroll:"x",template:"",borderless:!0},i="material"==webix.skin.$name||"mini"==webix.skin.$name;return e.height=80+(i?8:10)+webix.env.scrollSize,{visibleBatch:"default",rows:[e,{view:"datatable",localId:"table",css:"webix_chat_people_table",rowHeight:60,headerRowHeight:Math.max(webix.skin.$active.barHeight-2,44),columns:this.GetColumns(),scheme:{$sort:{by:"name",dir:"asc"}},checkboxRefresh:!0,on:{onItemClick:function(e){return t.Toggle(1*e.row)},onCustomSave:function(){return t.UpdatePeopleList()}}}]}},e.prototype.init=function(){var t=this,e=this.app.getService("local").users(),i=this.$$("table");this.Users=[].concat(this.getParam("state",!0).users),this.UsersStore=new webix.DataCollection({data:[]}),this.UsersStore.data.attachEvent("onSyncApply",(function(){i.clearAll(),i.parse(t.UsersStore.data.serialize().map((function(t){return{id:t.id,name:t.name,avatar:t.avatar,status:t.status}})).filter((function(e){return e.id!==t.app.config.user}))),i.sort((function(e,i){return t.SortUsers(e,i)})),t.LoadPeopleList()})),this.UsersStore.sync(e)},e.prototype.destroy=function(){this.UsersStore.destructor(),this.UsersStore=null},e.prototype.GetColumns=function(){var t=this,e=this.app.getService("locale")._,i=this.app.getService("helpers");return[{id:"selected",header:{content:"textFilter",placeholder:e("Search"),colspan:2,prepare:function(t){return t.toLowerCase()},compare:this.GetCompare()},width:45,cssFormat:function(e,i){return i.selected?"webix_chat_row_"+(t.Users.indexOf(i.id)>=0?"group_user":"select"):""},template:function(t){return t.selected?i.checkedIcon:i.notCheckedIcon}},{id:"name",header:"",template:function(t){return i.listAvatar(t,"webix_chat_people_avatar")+t.name},fillspace:2,cssFormat:function(e,i){return i.selected?"webix_chat_row_"+(t.Users.indexOf(i.id)>=0?"group_user":"select"):""}}]},e.prototype.GetCompare=function(){return function(t,e,i){return i.name.toLowerCase().indexOf(e)>-1}},e.prototype.GetPeopleList=function(t){var e=this;return t.sort((function(t,i){return e.SortUsers(t,i)})),this.app.getService("helpers").peopleList(t,!1,this.Users)},e.prototype.SortUsers=function(t,e){var i=this.Users.indexOf(t.id),n=this.Users.indexOf(e.id);return i>=0&&n<0?1:n>=0&&i<0?-1:t.name>e.name?1:t.name<e.name?-1:0},e.prototype.Toggle=function(t){var e=this.$$("table"),i=e.getItem(t);e.updateItem(t,{selected:!i.selected}),this.UpdatePeopleList()},e.prototype.UpdatePeopleList=function(){var t=this.GetSelected();this.SetBatch(t.length?"selected":"default");var e=this.GetPeopleList(t);this.$$("selected").setHTML(e),this.getParam("state",!0).users=this.GetSelectedIds()},e.prototype.LoadPeopleList=function(){var t=this,e=this.getParam("state",!0).users.filter((function(e){return e!==t.app.config.user}));if(e&&e.length){var i=[];e.forEach((function(e){var n=t.$$("table").getItem(e);i.push(n),n.selected=!0})),this.SetBatch("selected");var n=this.GetPeopleList(i);this.$$("selected").setHTML(n)}},e.prototype.GetSelected=function(){var t=[];return this.$$("table").data.each((function(e){e.selected&&t.push(e)})),t},e.prototype.GetSelectedIds=function(){var t=[];return this.$$("table").data.each((function(e){e.selected&&t.push(e.id)})),t},e.prototype.SetBatch=function(t){t?this.getRoot().showBatch(t):this.getRoot().showBatch("default")},e}(h),Z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{view:"toolbar",height:Math.max(webix.skin.$active.toolbarHeight,46),borderless:!0,cols:[]}},e.prototype.init=function(){var t=this,e=this.getParam("state",!0);this.on(e.$changes,"toolbar",(function(){var i=e.toolbar.cols.map((function(i){return t.ButtonFactory(i,e)}));t.webix.ui(i,t.getRoot())}))},e.prototype.ButtonFactory=function(t,e){var i=this,n=this.app.getService("locale")._;switch(t){case"close":return{view:"icon",icon:"wxi-close",hotkey:"esc",width:Math.max(webix.skin.$active.inputHeight,38),click:function(){e.cursor=0}};case"back":return{view:"icon",icon:"chi-back",width:Math.max(webix.skin.$active.inputHeight,38),hotkey:"esc",click:function(){e.cursor=e.cursor-1}};case"start":return{view:"icon",icon:"chi-back",width:Math.max(webix.skin.$active.inputHeight,38),hotkey:"esc",click:function(){i.app.callEvent("wizardStart",[])}};case"label":return{view:"label",css:"webix_chat_wizard_title",labelAlign:"center",label:"function"==typeof e.toolbar.label?e.toolbar.label():e.toolbar.label};case"edit":return{view:"icon",icon:"wxi-pencil",width:Math.max(webix.skin.$active.inputHeight,38),batch:"m1",click:function(){e.cursor=e.cursor+1}};case"save":return{batch:"m2",view:"button",label:n("Save"),hotkey:"enter",width:130,css:"webix_primary",click:function(){i.app.callEvent("wizardSave",[])}}}},e}(h),Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return this.app.getService("jet-win").updateConfig({view:"window",fullscreen:this.getParam("compact",!0),width:450,height:600,borderless:!0,head:Z,body:{$subview:!0}})},e.prototype.init=function(){var t=this,e=this.getParam("id")||0,i=e?this.app.getService("local").chats().getItem(e):{id:0,name:"",users:[],avatar:""},n=this.getParam("msgId")||0,a=N({cursor:1,toolbar:{label:"",cols:[]},chat:i.id,name:i.name,avatar:i.avatar,users:[].concat(i.users),group:!i.direct_id,messageId:n});this.setParam("state",a);var o=this.stages();this.on(a.$changes,"cursor",(function(e){webix.delay((function(){o[e]?(t.show(o[e][0]),a.toolbar=o[e][1]):t.Close()}))})),this.on(this.app,"wizardSave",(function(){t.Save&&(t.Save(),t.Close())}))},e.prototype.Close=function(){this.show("_hidden",{target:"top"})},e}(h),X=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.init=function(){var e=this;return this.on(this.app,"wizardSave",(function(){return e.Save()})),t.prototype.init.call(this)},e.prototype.Save=function(){var t=this.getParam("state",!0),e=this.app.getService("operations"),i=this.$$("form").getValues();e.updateChat(t.chat,i.name,i.avatar.avatar),t.$batch({name:i.name,avatar:i.avatar.avatar,cursor:1})},e}(K),tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.stages=function(){var t=this,e=this.app.getService("locale")._;return[null,["./chat.info.info",{label:function(){return t.getParam("state").name},cols:["close","label","edit"]}],["./chat.info.form",{label:'<span class="webix_chat_wizard_title2">'+e("Edit chat")+"</span>",cols:["back","label","save"]}],["./chat.info.people",{label:'<span class="webix_chat_wizard_title2">'+e("Add members")+"</span>",cols:["start","label","save"]}]]},e.prototype.init=function(){var e=this;t.prototype.init.call(this),this.on(this.app,"leaveChatClick",(function(){e.LeaveChat()}))},e.prototype.LeaveChat=function(){var t=this,e=this.app.getService("locale")._;webix.confirm({container:this.app.getRoot().$view,title:e("Leave chat"),ok:e("Leave"),cancel:e("Cancel"),text:e("Are you sure to leave this chat?")}).then((function(){t.app.getService("operations").leaveChat(t.getParam("state").chat),t.Close()}))},e}(Q),et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("state",!0),n=this.app.getService("helpers");this.ShowAll=!1,this.MemberListMaxCount=3,this.CanAddUsers=i.group;var a={localId:"avatar",css:"webix_chat_form_avatar",width:130,height:130,borderless:!0,template:function(t){return n.formAvatar(t,e("Avatar"))},data:{avatar:i.avatar}},o={view:"list",localId:"members",css:"webix_chat_list",borderless:!0,autoheight:!0,type:{height:60,template:function(e){return t.ListTemplate(e)},text:function(t){return t.replace(/<[^>]*>/g,"")}},onClick:{webix_chat_list_item_delete:function(e,i){return t.DeleteMemberClickHandler(i)}}},r={view:"button",type:"icon",width:150,height:Math.max(webix.skin.$active.inputHeight,38),icon:"wxi-plus",label:e("Add members"),click:function(){return i.cursor=3}},s={view:"button",css:"webix_chat_delete_button",label:e("Leave chat"),width:130,click:function(){return t.LeaveChat()}},c=[{type:"form",cols:[{},a,{}]},{type:"form",rows:[{cols:[{view:"label",label:e("Members")+" ("+i.users.length+")"},r]},o,{localId:"showAllButton",hidden:!0,autoheight:!0,borderless:!0,view:"template",template:'<span class="webix_chat_show_all_btn">'+e("Show all members")+"</span>",css:"webix_chat_show_all_tmpl",onClick:{webix_chat_show_all_btn:function(){return t.ShowAllMembers(i.users)}},inputWidth:150}]},{}];return i.group&&c.push({type:"form",padding:{top:0},cols:[s,{}]}),{view:"form",type:"clean",scroll:!0,borderless:!0,elements:c}},e.prototype.init=function(){var t=this,e=this.getParam("state",!0);this.$$("members")&&this.InitMembersList(e.users),this.on(e.$changes,"users",(function(e){return t.Filter(e)}))},e.prototype.InitMembersList=function(t){var e=this,i=this.app.getService("local"),n=this.$$("members");n.data.attachEvent("onSyncApply",(function(){n.data.sort((function(t,i){return e.Sort(t,i)}),"asc"),e.Filter(t)})),n.sync(i.users())},e.prototype.ListTemplate=function(t){var e=this.app.getService("locale")._,i=t.id==this.app.config.user?" (<span class='webix_chat_list_you_text'>"+e("You")+"</span>)":"";return this.app.getService("helpers").listAvatar(t)+t.name+i+this.DeleteButtonTemplate(t)},e.prototype.DeleteButtonTemplate=function(t){var e="";return t.id!=this.app.config.user&&this.CanAddUsers&&(e="<button type='button' class='webix_icon_button webix_chat_list_item_delete'><span class='webix_icon wxi-close'></span></button>"),e},e.prototype.Sort=function(t,e){return e.id==this.app.config.user?1:t.id==this.app.config.user?-1:t.name>e.name?1:-1},e.prototype.ShowAllMembers=function(t){this.ShowAll=!0,this.Filter(t),this.$$("showAllButton").hide()},e.prototype.Filter=function(t){var e=this;this.MemberListCount=0,this.$$("members").data.filter((function(i){var n=i.direct_id==i.id,a=t&&t.indexOf(i.id)>-1,o=n||a;return o&&!e.ShowAll&&e.MemberListCount++,o&&e.MemberListCount<=e.MemberListMaxCount})),this.MemberListCount>this.MemberListMaxCount&&this.$$("showAllButton").show()},e.prototype.DeleteMemberClickHandler=function(t){var e=this,i=this.app.getService("locale")._,n=this.app.getService("operations");webix.confirm({container:this.app.getRoot().$view,title:i("Delete member"),ok:i("Delete"),cancel:i("Cancel"),text:i("Are you sure to delete this member?")}).then((function(){var i=e.getParam("state",!0);i.users=i.users.filter((function(e){return e!=t})),n.setUsers(i.chat,i.users)}))},e.prototype.LeaveChat=function(){var t=this,e=this.app.getService("locale")._;webix.confirm({container:this.app.getRoot().$view,title:e("Leave chat"),ok:e("Leave"),cancel:e("Cancel"),text:e("Are you sure to leave this chat?")}).then((function(){var e=t.app.getService("operations"),i=t.getParam("state",!0);e.leaveChat(i.chat),i.cursor=0}))},e}(h),it=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.init=function(){var e=this,i=this.getParam("state",!0);return this._users=[].concat(i.users),this.on(this.app,"wizardStart",(function(){return e.Back()})),this.on(this.app,"wizardSave",(function(){return e.Save()})),t.prototype.init.call(this)},e.prototype.Save=function(){var t=this.getParam("state",!0);this.app.getService("operations").setUsers(t.chat,t.users),t.cursor=1},e.prototype.Back=function(){this.getParam("state",!0).$batch({cursor:1,users:this._users})},e}(Y),nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.stages=function(){return[null,["./chat.common.people",{label:'<span class="webix_chat_wizard_title2">'+(0,this.app.getService("locale")._)("Add members")+"</span>",cols:["close","label","save"]}]]},e.prototype.Save=function(){var t=this.app,e=this.getParam("state");e.users.length&&t.getService("operations").setUsers(e.chat,e.users)},e}(Q),at=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this,i=this.app.getService("locale")._,n=t.prototype.config.call(this,!0),a={view:"button",localId:"next",type:"icon",hotkey:"enter",icon:"chi-next",css:"webix_primary",label:'<span class="webix_chat_next_text">'+i("People")+"</span>",width:160,disabled:!0,height:Math.max(webix.skin.$active.inputHeight,38),align:"center",click:function(){e.ShowNextPage()}};return n.elements.push({align:"right",body:a}),n},e.prototype.ShowNextPage=function(){var t=this.getParam("state",!0),e=this.$$("form").getValues();t.name=e.name,t.avatar=e.avatar.avatar,t.cursor=t.cursor+1},e.prototype.NameChangedHandler=function(t){var e=this.$$("next");t?e.enable():e.disable()},e}(K),ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.stages=function(){var t=this.app.getService("locale")._;return[null,["./chat.new.form",{label:'<span class="webix_chat_wizard_title1">'+t("New chat")+"</span>",cols:["close","label"]}],["./chat.common.people",{label:'<span class="webix_chat_wizard_title2">'+t("Add members")+"</span>",cols:["back","label","save"]}]]},e.prototype.Save=function(){var t=this.app,e=this.getParam("state"),i=e.name,n=e.avatar,a=e.users;a&&a.length&&t.getService("operations").addGroupChat(i,n,a).then((function(e){return t.callEvent("showChat",["chat",e])}))},e}(Q),rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return{view:"list",localId:"list",select:!0,borderless:!0,css:"webix_chat_list",type:{height:60,template:function(e,i){return t.ListTemplate(e,i)},text:function(t){return t.replace(/<[^>]*>/g,"")}}}},e.prototype.InitSelf=function(t,e){var i=this,n=this.$$("list");n.data.attachEvent("onSyncApply",(function(){i.ApplySearchValue(),i.SyncHandler()})),n.sync(t,e||null),n.attachEvent("onAfterSelect",(function(t){i.ShowChat(t)})),this.on(this.app.getState().$changes,"search",(function(t){i.Find(t)}))},e.prototype.SyncHandler=function(){},e.prototype.ShowChat=function(){},e.prototype.ListTemplate=function(t){return t.name},e.prototype.EscapeRegExp=function(t){return t.replace(/[[\]{}()*+?.\\^$|]/g,"\\$&")},e.prototype.ApplySearchValue=function(){var t=this.app.getState().search;t&&this.Find(t)},e.prototype.Find=function(t){var e=this,i=this.$$("list");this.EscapedSearchText=this.EscapeRegExp(t||""),t?(t=t.toLowerCase(),i.filter((function(i){return e.SearchCompare(t,i)}))):i.filter()},e.prototype.SearchCompare=function(t,e){return e.name.toLowerCase().indexOf(t)>-1},e.prototype.Select=function(t){var e=this.$$("list");t!=e.getSelectedId()&&e.getItem(t)&&e.select(t)},e}(h),st=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this,i="limited"===this.app.config.mode,n=this.app.getService("locale")._;return{type:"clean",rows:[t.prototype.config.call(this),{padding:9,rows:[{view:"button",type:"icon",icon:"wxi-plus",css:"webix_chat_add_button",height:Math.max(webix.skin.$active.inputHeight,38),label:n("New chat"),click:function(){return e.app.callEvent("newChat",[])},hidden:i}]}]}},e.prototype.init=function(){var t=this,e=this.app.getParam("state",!0),i=this.app.getService("local").chats();this.InitSelf(i),i.waitData.then((function(){t.on(e.$changes,"chatId",(function(e){e?t.Select(e):t.$$("list").unselectAll()}))})),this.app.config.emojis&&(this.Emojis=this.app.getService("emojis"))},e.prototype.ShowChat=function(t){this.app.callEvent("showChat",["chat",1*t])},e.prototype.ListTemplate=function(t,e){var i=this.app.getService("locale")._,n=this.app.getService("helpers"),a="";if(a+=n.listAvatar(t),a+="<div class='webix_chat_listitem_block'>",a+="<div class='webix_chat_listitem_name'>"+n.addTextMark(t.name,this.EscapedSearchText)+"</div>",t.date&&(a+="<span class='webix_chat_listitem_date'>"+n.dateChatFormat(t.date)+"</span>"),t.unread_count){var o="webix_chat_listitem_number";t.unread_count>9&&(o+=" webix_chat_listitem_number_wide"),a+="<span class='"+o+"'>"+t.unread_count+"</span>"}if(t.message_type){switch(a+="<div class='webix_chat_listitem_message'>",t.message_type){case 900:a+=i("Ended call")+" ("+t.message+")";break;case 901:a+=i("Rejected call");break;case 902:a+=i("Missed call")}a+="</div>"}else if(t.message){var r=e.text(t.message);this.Emojis&&(r=this.Emojis.replaceEmoji(r)),a+="<div class='webix_chat_listitem_message'>",a+=r,a+="</div>"}return a+"</div>"},e}(rt);webix.protoUI({name:"chat-search",$cssName:"search",on_click:{webix_input_icon:function(t){t.target.className.indexOf(this.config.closeIcon)>-1?(this.getInputNode().focus(),this.setValue(""),this.callEvent("onCloseIconClick",[t]),this.hideCloseIcon()):(this.getInputNode().focus(),this.callEvent("onSearchIconClick",[t]))}},setIcon:function(t){var e=this.$view.getElementsByClassName("webix_input_icon");e.length&&(e[0].className="webix_input_icon "+t)},showCloseIcon:function(){this.setIcon(this.config.closeIcon)},hideCloseIcon:function(){this.setIcon(this.config.icon)},defaults:{closeIcon:"wxi-close"}},webix.ui.search);var ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{css:"webix_chat_sidebar",width:320,type:"clean",rows:[{view:"tabbar",borderless:!0,css:"webix_chat_tabbar",height:52,bottomOffset:0,options:[{value:e("Chats"),id:"chats"},{value:e("Users"),id:"users"}],on:{onChange:function(e){return t.ShowPanel(e)}}},{padding:9,rows:[{view:"chat-search",localId:"search",height:Math.max(webix.skin.$active.inputHeight,38),placeholder:e("Search")}]},{$subview:!0,name:"left"}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.ShowPanel("chats"),this.$$("search").attachEvent("onTimedKeyPress",(function(){t.State.search=t.$$("search").getValue()})),this.$$("search").attachEvent("onChange",(function(){t.State.search=t.$$("search").getValue()})),this.on(this.State.$changes,"search",(function(e){e?t.$$("search").showCloseIcon():(t.$$("search").setValue(""),t.$$("search").hideCloseIcon())}))},e.prototype.ShowPanel=function(t){this.State.search="",this.show("./"+t,{target:"left"})},e}(h),lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return{view:"sidemenu",css:"webix_chat_sidemenu",animate:!1,width:320,position:"left",state:function(e){e.left=t.Parent.left,e.top=t.Parent.top,e.height=t.Parent.height},body:ct}},e.prototype.init=function(){var t=this;this.on(this.app,"top:navigation",(function(){t.getRoot().hide()})),this.on(this.app,"view:resize",(function(){t.getRoot().isVisible()&&t.Show(!0)}))},e.prototype.Show=function(t){!t&&this.getRoot().isVisible()||(this.Parent=this.app.getRoot().$view.getBoundingClientRect(),this.getRoot().show())},e}(h),ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._;return this.Emojis=this.app.getService("emojis"),{view:"popup",body:{rows:[{css:"webix_chat_layout_esearch",padding:{top:5,bottom:5,left:10,right:10},visibleBatch:"categories",localId:"toolbar",rows:[{batch:"categories",cols:[{view:"icon",localId:"searchBtn",icon:"wxi-search"},{view:"list",borderless:!0,localId:"categories",css:"webix_chat_emoji_categories_list",template:function(e){return t.CategoryMenuTemplate(e)},select:!0,layout:"x",on:{onItemClick:function(e,i){t.ShowCategory(e),webix.html.preventEvent(i)}},data:this.Emojis.categories()}]},{batch:"search",margin:webix.skin.$active.layoutMargin.form,cols:[{view:"icon",localId:"backBtn",icon:"chi-back"},{view:"text",localId:"search",placeholder:e("Search")}]}]},{view:"scrollview",height:200,scroll:!0,localId:"views",body:{visibleBatch:"categories",type:"clean",padding:{left:10,right:10},rows:this.GetLists()}},{localId:"preview",view:"template",hidden:webix.env.mobile,template:" ",height:40}]}}},e.prototype.init=function(){var t=this;this.Preview=this.$$("preview");var e=this.$$("search");e.attachEvent("onTimedKeyPress",(function(){t.Find(e.getValue())})),this.ScrollHandler(),this._searchClickEvent=webix.event(this.$$("searchBtn").$view,"click",(function(e){t.ShowSearchHeader(),webix.html.preventEvent(e)})),this._backClickEvent=webix.event(this.$$("backBtn").$view,"click",(function(e){t.HideSearchHeader(),webix.html.preventEvent(e)}))},e.prototype.ScrollHandler=function(){var t=this,e=this.$$("views").getBody().getChildViews(),i=0,n=[];e.forEach((function(t){t.config.hidden||(i+=t.$height-5,n.push(i))})),this._scrollEvent=webix.event(this.$$("views").$view,"scroll",(function(){for(var e,i=t.$$("views").$view.scrollTop,a=0;a<n.length&&void 0===e;a++)(a==n.length-1||i<n[a]&&(!a||i>=n[a-1]))&&(e=a);t.$$("categories").select(t.Emojis.categories()[e].id)}))},e.prototype.GetLists=function(){var t=this,e=[],i={};return this.Emojis.emojis().data.each((function(t){i[t.category]||(i[t.category]=[]),i[t.category].push(t)})),this.Emojis.categories().forEach((function(n){e.push(t.ListConfig("category_"+n.id,"basic"==n.id?t.Emojis.basicEmojis():i[n.id],t._(n.name),"categories"))})),e.push(this.ListConfig("searchResults",[],this._("Search results"),"search")),e},e.prototype.ListConfig=function(t,e,i,n){var a=this,o={type:"clean",batch:n,rows:[{template:i,css:"webix_emoji_category_label",autoheight:!0},{view:"dataview",localId:t,autoheight:!0,xCount:6,type:{css:"webix_chat_emojis_item",width:40,height:40},on:{onItemClick:function(t){this.$scope.app.callEvent("pasteEmoji",[t,this.getItem(t)])},onMouseMove:function(t){var e=this.getItem(t);this.$scope.ShowPreview(e)}},mouseEventDelay:100,template:function(t){return a.ItemTemplate(t)},data:e}]};return webix.env.mobile||(o.rows[1].on.onMouseMove=function(t){var e=this.getItem(t);this.$scope.ShowPreview(e)}),o},e.prototype.Show=function(t){this.HideSearchHeader(),this.getRoot().show(t);var e=this.Emojis.categories()[0].id;this.$$("categories").select(e),this.ShowCategory(e)},e.prototype.Hide=function(){this.getRoot().hide()},e.prototype.ItemTemplate=function(t){return"<div class='webix_chat_emoji webix_chat_emoji_"+t.unified+"'></div>"},e.prototype.ShowPreview=function(t){this.Preview.setHTML(this.PreviewTemplate(t))},e.prototype.PreviewTemplate=function(t){var e=this.$$("search"),i=e.isVisible()?e.getValue():"",n=this.Emojis.findName(t,i);return n?(n=this.Emojis.shortNameToTitle(n),"<div class='webix_chat_emoji_preview'><div class='webix_chat_emoji webix_chat_emoji_"+t.unified+"'></div><div class='webix_chat_emoji_name'>"+n+"</div></div>"):""},e.prototype.Find=function(t){if(t){this.$$("views").getBody().showBatch("search"),t=t.toLowerCase();var e=this.Emojis.emojis().data.find((function(e){for(var i=!1,n=0;n<e.names.length&&!i;n++)i=e.names[n].includes(t);return i}));this.$$("searchResults").clearAll(),this.$$("searchResults").parse(e)}else this.$$("views").getBody().showBatch("categories")},e.prototype.ShowSearchHeader=function(){this.$$("toolbar").showBatch("search"),this.$$("search").setValue(""),this.$$("search").focus()},e.prototype.HideSearchHeader=function(){this.Find(),this.$$("views").getBody().showBatch("categories"),this.$$("toolbar").showBatch("categories")},e.prototype.CategoryMenuTemplate=function(t){return"<span class='webix_icon "+t.icon+"'></span>"},e.prototype.ShowCategory=function(t){var e=this.Emojis.categories().findIndex((function(e){return e.id==t})),i=this.$$("views").getBody().getChildViews()[e].config.id;this.$$("views").showView(i)},e.prototype.destroy=function(){this._scrollEvent&&webix.eventRemove(this._scrollEvent),webix.eventRemove(this._backClickEvent),webix.eventRemove(this._searchClickEvent)},e}(h),ut=function(t){function e(e,i){var n=t.call(this,e)||this;return n.Master=i,n}return i(e,t),e.prototype.config=function(){var t=this;return this.Emojis=this.app.getService("emojis"),{view:"mentionsuggest",symbol:this.Emojis.symbol,maxHeight:200,css:"webix_chat_emojisuggest",template:function(e){return t.SuggestTemplate(e)},filter:function(e){if(t.FilterText){var i=t.getRoot().getItemText(e.id);return i&&i.toLowerCase().indexOf(t.FilterText.toLowerCase())>-1}return!1},body:{template:function(e){return t.ItemTemplate(e)},data:this.Emojis.emojis()}}},e.prototype.init=function(){var t=this;this.Text=this.Master.queryView({name:"text"}),this.Text.setValueHere=function(t,e,i){return-1!=t.indexOf(" ")&&t.indexOf(" ")!=t.length-1&&(t='"'+t+'"'),webix.ui.text.prototype.setValueHere.apply(this,[t,e,i])},this.Popup=this.getRoot(),this.on(this.Popup.getList().data,"onBeforeFilter",(function(){return t.BeforeFilterHandler()})),this._keyEvent=webix.event(this.Text.$view,"keydown",(function(e){t.KeyCode=e.keyCode}),{capture:!0}),this.on(this.Popup,"onValueSuggest",(function(e,i){webix.delay((function(){t.Master.focus();var e=t.Text.getInputNode(),n=i.length-t.FilterText.length;e.setSelectionRange(t._lastCursorPosition+n,t._lastCursorPosition+n)}))})),this.on(this.Popup,"onShow",(function(){return t.ShowHandler()}))},e.prototype.ShowHandler=function(){var t=this.Popup.getList();t.select(t.getFirstId())},e.prototype.LinkInput=function(){var t=this;this.on(this.Text,"onAfterRender",(function(){t.Popup.linkInput(t.Text)}))},e.prototype.BeforeFilterHandler=function(){this._lastCursorPosition=webix.html.getSelectionRange(this.Text.getInputNode()).start;var t=this.KeyCode;if((37==t||39==t)&&!this.Popup.isVisible())return!1;this.FilterText=null;var e=this.Text.getValue(),i=this.Emojis.symbol;return-1!==(e=e.substring(0,this._lastCursorPosition)).indexOf(i)&&((e=e.toLowerCase().substring(e.lastIndexOf(i)+i.length)).length&&e.match("^[A-Za-z0-9-+]+$")&&!e.indexOf(this.LastFilterFail)>-1?(this.Emojis.emojis().data.find((function(t){return t.names.some((function(t){return-1!=t.toLowerCase().indexOf(e)}))}),!0)?this.FilterText=e:(this.FilterText=null,this.LastFilterFail=e),this.FilterText):(this.Popup.isVisible()&&this.Popup.hide(),!1))},e.prototype.SuggestTemplate=function(t){var e=this.Emojis.findName(t,this.FilterText);return e?e+": ":null},e.prototype.ItemTemplate=function(t){var e=this.Emojis.findName(t,this.FilterText);return e?(e=this.Emojis.shortNameToTitle(e),"<div class='webix_chat_emoji_preview'><div class='webix_chat_emoji webix_chat_emoji_"+t.unified+"'></div><div class='webix_chat_emoji_name'>"+e+"</div></div>"):""},e.prototype.destroy=function(){webix.eventRemove(this._keyEvent)},e}(h),pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.config,i=this.app.getService("locale")._;this.Compact=this.getParam("compact",!0);var n=e.mode;this.Limited="single"===n||"limited"===n;var a=Math.max(webix.skin.$active.inputHeight,38);return{view:"toolbar",localId:"toolbar",visibleBatch:"active",css:"webix_chat_toolbar",padding:{right:4,top:3,bottom:3},elements:[{view:"icon",icon:"webix_icon chi-menu",click:function(){return t.app.callEvent("showSidebar",[])},hidden:!this.Compact||"single"===n},{view:"template",height:46,localId:"chatTitle",css:"webix_chat_toolbar_tmpl",name:"chatTitle",borderless:!0,template:function(e){return t.TitleTemplate(e)},onClick:{webix_chat_title:function(){t.ChatInfoHandler()}}},{view:"icon",batch:"active",icon:"chi-video",tooltip:i("Start call"),localId:"call",width:a,click:function(){t.StartCallHandler()}},{view:"icon",batch:"active",icon:"chi-account-plus",tooltip:i("Add members"),width:a,click:function(){t.NewMembersHandler()}},{view:"icon",batch:"active",icon:"wxi-dots",width:a,click:function(e,i){t.ToggleMenu(i)}}]}},e.prototype.init=function(){var t=this,e=this.getParam("state",!0);this.State=e,this.app.getService("local").chats().data.attachEvent("onStoreUpdated",(function(i){i&&i!=e.chatId||t.Refresh()})),this.on(e.$changes,"*",(function(){t.Refresh()})),this.InitMenu()},e.prototype.Refresh=function(){var t=this.State;if(!this.getRoot())return!1;var e,i=this.app.getService("local");t.chatId?e=i.chats().getItem(t.chatId):e=i.users().getItem(t.userId);e=e||{},this.$$("chatTitle").setValues(e),e.direct_id&&this.app.config.calls?this.$$("call").show():this.$$("call").hide();var n=this.$$("toolbar");t.chatId&&!this.Limited?n.showBatch("active"):n.showBatch("inactive")},e.prototype.TitleTemplate=function(t){var e=this.app.getService("locale")._,i=this.app.getService("helpers"),n="";if(t.name)if(n+=i.listAvatar(t,"webix_chat_toolbar_avatar"),t.users){var a=t.users.length+" "+e("members");n+="<div class='webix_chat_title'>",t.direct_id?n+='<span class="webix_chat_messages_chat_name">'+t.name+"</span>":n+='<div class="webix_chat_messages_groupchat_name">'+t.name+'</div><div class="webix_chat_messages_groupchat_members">'+a+"</div>",n+="</div>"}else n+='<span class="webix_chat_messages_user_name">'+t.name+"</span>";return n},e.prototype.ToggleMenu=function(t){this.ToolbarMenu.isVisible()?this.ToolbarMenu.hide():this.ToolbarMenu.show(t.target,{pos:"left",y:30,x:10})},e.prototype.InitMenu=function(){var t=this;return this.ToolbarMenu=this.ui({view:"contextmenu",autowidth:!0,point:!1,data:this.GetMenuData(),on:{onItemClick:function(e){t.ToolbarMenu.callEvent("onBeforeMenuAction",[e])&&"info"==e&&t.ChatInfoHandler()}}}),this.ToolbarMenu},e.prototype.GetMenuData=function(){return[{id:"info",value:(0,this.app.getService("locale")._)("Chat info")}]},e.prototype.ChatInfoHandler=function(){this.State.chatId&&!this.Limited&&this.app.callEvent("chatInfo",[this.State.chatId])},e.prototype.NewMembersHandler=function(){this.app.callEvent("newMembers",[this.State.chatId])},e.prototype.StartCallHandler=function(){this.app.callEvent("startCall",[this.State.userId||this.State.chatId,this.State.chatId||0])},e}(h);webix.protoUI({name:"chat-comments",$cssName:"comments",$init:function(t){t.ChatFormConfig&&t.ChatFormConfig(t),t.ChatListConfig&&t.ChatListConfig(t)}},webix.ui.comments),webix.protoUI({name:"chat-comments-layout",$cssName:"layout",hide:function(){}},webix.ui.layout),webix.protoUI({name:"chat-comments-text",$cssName:"texthighlight",define:function(t,e){var i=t.height;if(i){var n=this.config;i<70&&i>n.inactiveHeight&&(t.height=n.inactiveHeight)}return webix.ui.texthighlight.prototype.define.call(this,t,e)}},webix.ui.texthighlight);var dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.Helpers=this.app.getService("helpers"),this.State=this.getParam("state",!0),this.Upload=this.app.getService("upload"),this.UploadDelay=500,this.WithReactions=this.app.config.reactions,this._=this.app.getService("locale")._;var e={view:"chat-comments",sendAction:"enter",localId:"comments",css:this.WithReactions?"webix_chat_comments_rct":"",currentUser:this.app.config.user,users:new webix.DataCollection({data:[],scheme:{$init:function(t){t.value=t.name,t.image=t.avatar}}}),listItem:{templateText:function(e){return t.MessageTemplateText(e)},templateLinks:function(e){return t.MessageTemplateLink(e)},templateMenu:function(e){return t.MessageTemplateMenu(e)},templateUser:function(e){return t.MessageTemplateUser(e)},templateAvatar:function(e){return t.MessageTemplateAvatar(e)},templateDate:function(e){return t.MessageTemplateDate(e)}}};return(this.app.config.files||this.app.config.emojis)&&(e.ChatFormConfig=function(e){return t.FormConfig(e)}),this.WithReactions&&(e.ChatListConfig=function(e){return t.ListConfig(e)}),{rows:[pt,e]}},e.prototype.init=function(){var t=this,e=this.Comments=this.$$("comments"),i=this.List=e.queryView("list");this.Local=this.app.getService("local"),this.Back=this.app.getService("backend"),this.Users=this.Local.users();var n=this.Back.pubsub();this.Ops=this.app.getService("operations");var a=e.getUsers();this.on(a.data,"onSyncApply",(function(){a.data.each((function(t){t.value=t.name}))})),a.sync(this.Local.users()),e.attachEvent("onAfterAdd",(function(i){var n=e.getItem(i);if(!n.chat_id){var a=t.State.userId,o=n.text.replace(/</g,"&lt;");o!==n.text&&e.updateItem(i,{text:o}),t.State.chatId?(t.AddMessage(t.State.chatId,n.text,i),t.ScrollToBottom()):a&&(e.disable(),t.Ops.addChat(a).then((function(e){return t.AddMessage(e,n.text,i)})).then((function(){return t.app.callEvent("showChat",["user",a])})))}})),e.attachEvent("onBeforeDelete",(function(i){return t.IsUsersMessage(e.getItem(i))&&t.Ops.removeMessage(i),!0})),e.attachEvent("onDataUpdate",(function(e,i,n){t.IsUsersMessage(i)&&i.text!=n.text&&t.Ops.updateMessage(e,i.text)})),this.on(this.app,"showChat",(function(){var i=t.Local.chats();i.waitData.then((function(){t.getRoot()&&t.FilterUsers(e.getUsers(),i,t.State.chatId,t.State.userId)}))})),this.on(n,"messages",(function(n){var a=n.op,o=n.origin,r=n.msg;if(r.chat_id==t.State.chatId)switch(a){case"add":r.date=new Date(r.date),e.exists(o)?(i.data.changeId(o,r.id),e.updateItem(r.id,r)):e.exists(r.id)||(e.add(r),t.ScrollToBottom());break;case"remove":e.exists(r.id)&&e.remove(r.id);break;case"update":r.date=new Date(r.date),e.exists(r.id)&&e.updateItem(r.id,r)}})),this.on(this.State.$changes,"chatId",(function(){t.LoadChat(t.State.chatId,t.State.userId)})),this.app.config.files&&this.InitUploader(),this.on(this.Comments.getMenu(),"onBeforeShow",(function(){return t.ShowMenuHandler(t.Comments.getMenu())})),this.AddImageHandler(),this.app.config.emojis&&this.InitEmojis()},e.prototype.IsUsersMessage=function(t){return t.user_id==this.app.config.user&&(!t.type||t.type<900)},e.prototype.IsUsersReaction=function(t,e){return t!=this.app.config.user&&this.Comments.getItem(t).reactions[e].includes(this.app.config.user)},e.prototype.AddMessage=function(t,e,i){var n=this;return this.Ops.addMessage(t,i,e).then((function(t){n.Comments.exists(i)&&n.Comments.queryView("list").data.changeId(i,t.id)}))},e.prototype.ScrollToBottom=function(){var t=this.$$("comments").queryView("list");t.showItem(t.getLastId())},e.prototype.LoadChat=function(t,e){var i=this,n=this.$$("comments");n.clearAll(),this.Uploader=this.Upload.getUploader(t,"file"),t||e?(n.enable(),t&&this.Local.messages(t).then((function(e){i.getRoot()&&(n.parse(e),i.Ops.resetCounter(t),i.ScrollToBottom())})),this.Focus()):n.disable()},e.prototype.FilterUsers=function(t,e,i,n){var a=this,o=i?e.getItem(i):null;t.data.filter((function(t){return i?o&&o.users.indexOf(t.id)>=0&&t.id!=a.app.config.user:t.id==n}))},e.prototype.Focus=function(){var t=this;webix.delay((function(){t.getRoot()&&t.Comments.focus()}))},e.prototype.MessageTemplateText=function(t){var e=t.text;this.app.config.emojis&&(e=this.Emojis.replaceEmoji(e));var i=t.type;if(800===i){var n=e.split("\n");e=4===n.length?this.Preview(n[0],n[3],n[1],n[2]):this.FileLinkTemplate(n[0],n[1],n[2])}else if(i>=900){var a=this.State.userId==t.user_id,o="chi-arrow-"+(a?"bottom-left":"top-right"),r=void 0;switch(i){case 900:r=a?this._("Incoming call"):this._("Outgoing call");break;case 901:r=this._("Rejected call");break;case 902:r=this._("Missed call")}e="<span class = 'webix_chat_call_type "+o+" webix_chat_call_type_"+this.Back.callMessages[i]+"'></span><div class = 'webix_chat_call_message'>"+r+"<p>"+e+"</p></div>"}return this.WithReactions&&i<900&&(e=this.ReactionsTemplate(t,e)),"<div class = 'webix_comments_message'>"+e+"</div>"},e.prototype.FileLinkTemplate=function(t,e,i){return'<a target="_blank" href="'+t+"\" class=\"webix_chat_file_block\"><span class='webix_icon chi-file-outline webix_chat_file_icon'></span><div class='webix_chat_file_section'>"+this.FileNameTemplate(e)+'<div class="webix_chat_file_size">'+this.FormatBytes(i)+"</div></div></a>"},e.prototype.MessageTemplateLink=function(t){return t.type?t.text:t.text.replace(/(https?:\/\/[^\s]+)/g,this.Preview)},e.prototype.Preview=function(t,e,i,n){var a="";if((t=webix.template.escape(t)).match(/.(jpg|jpeg|png|gif)$/)){if(this&&i)return this.FileLinkTemplate(t,i,n)+"<br/><a target='_blank' class='webix_chat_preview_lnk' href='"+t+"'><img class='webix_comments_image' src='"+e+"' /></a>";a+="<img class='webix_comments_image webix_comments_image_link' src='"+e+"'/><div class='webix_chat_file_name_link'>"+t+"</div>"}else a+=t;return"<a target='_blank' class='' href='"+t+"'>"+a+"</a>"},e.prototype.AddImageHandler=function(){var t=this;webix.event(this.Comments.$view,"error",(function(e){return t.ImageErrorHandler(e)}),{capture:!0})},e.prototype.ImageErrorHandler=function(t){var e=t.target;-1!=e.className.indexOf("webix_comments_image")&&(e.className+=" webix_chat_onerror")},e.prototype.FileNameTemplate=function(t){return t.length>40?t.substring(0,20)+"..."+t.substring(t.length-20,t.length):t},e.prototype.MessageTemplateAvatar=function(t){var e="<div class='webix_chat_list_avatar'>",i=this.Comments.getUsers(),n=i&&i.exists(t.user_id)?i.getItem(t.user_id):{};return n.status&&(e+=this.Helpers.status(n)),e+=this.Helpers.avatar(n),e+="</div>"},e.prototype.MessageTemplateUser=function(t){var e=this.Comments.getUsers();return"<span class = 'webix_comments_name'>"+((e&&e.exists(t.user_id)?e.getItem(t.user_id):{}).name||"")+"</span>"},e.prototype.MessageTemplateMenu=function(){var t=this.app.config.reactions;return this.Comments.config.readonly?"":(t?"<span class='webix_icon chi-emoticon-outline webix_chat_reaction'></span>":"")+"<span class='webix_icon wxi-dots webix_comments_menu'></span>"},e.prototype.MessageTemplateDate=function(t){return t.date?"<span class='webix_comments_date'>"+this.Helpers.dateChatFormat(t.date)+"</span>":""},e.prototype.FormConfig=function(t){var e=this,i=t.rows[1].elements,n=i[0],a=webix.skin.$active;n.view="chat-comments-text",t.rows[1].minHeight=n.height=n.inactiveHeight=a.inputHeight;var o=i[1].cols[1];o.autowidth=!0;var r=[{}];this.app.config.files&&r.push({view:"icon",icon:"chi-paperclip",click:function(){e.Uploader.fileDialog()}}),this.app.config.emojis&&r.push({view:"icon",icon:"chi-emoticon-outline",localId:"emojiIcon"}),t.rows[1].rows=[{view:"list",css:"webix_chat_ulist",localId:"fileList",autoheight:!0,borderless:!0,template:function(t){return e.ListUploadTemplate(t)},type:{height:a.listItemHeight>30?30:a.listItemHeight},onClick:{webix_icon:function(t,i){return e.StopUpload(i),!1}}},{cols:[{padding:{right:5},rows:r},n,{padding:{left:webix.skin.$active.layoutMargin.form},view:"chat-comments-layout",rows:[{},o]}]}],delete t.rows[1].elements},e.prototype.ListUploadTemplate=function(t){var e="<div class='webix_chat_ulist_item'>";e+="<div class='webix_chat_upload_name'>"+t.name+"</div>";var i=t.status;return"exsize"==i||"error"==i?e+="<div class='webix_chat_upload_error' >"+this._("exsize"==i?"File size exceeds the limit":"File upload error")+"</div>":(e+="<div class='webix_chat_upload_progress'>",e+="<div class='webix_chat_upload_progress_bar "+t.status+"'>&nbsp;</div>",e+="</div>"),e+="<div class='webix_icon wxi-close'></div>",e+=this.UploadIconTemplate(t),e+="</div>"},e.prototype.InitUploader=function(){var t=this,e=this.Upload.getUploader(this.State.chatId,"file");e.addDropZone(this.getRoot().$view,""),this.on(e.files.data,"onStoreUpdated",(function(e,i,n){"update"==n&&"transfer"==i.status&&t.$$("fileList").getItem(e)&&(i.percent||i.xhr.addEventListener("error",(function(){i.status="error",delete i.xhr,t.$$("fileList").updateItem(e,i)}),!1),t.$$("fileList").getItemNode(e).querySelector(".webix_chat_upload_progress_bar").style.width=i.percent+"%")})),this.on(this.app,"onSizeExceed",(function(e){return t.$$("fileList").add(n(n({},e),{status:"exsize"}))})),this.on(e,"onAfterFileAdd",(function(e){t.$$("fileList").add(n(n({},e),{status:"transfer"}))})),this.on(e,"onFileUpload",(function(e,i){return t.UploadHandler(e,i)})),this.on(e,"onFileUploadError",(function(e,i){return t.UploadHandler(e,i)}))},e.prototype.UploadHandler=function(t,e){var i=this;webix.delay((function(){var n=t.id,a=e.status;i.$$("fileList").getItem(n)&&("server"==a?i.$$("fileList").remove(n):i.$$("fileList").updateItem(n,{status:e.status}))}),null,[],this.UploadDelay)},e.prototype.StopUpload=function(t){this.$$("fileList").remove(t),this.Uploader.files.getItem(t)&&this.Uploader.stopUpload(t)},e.prototype.FormatBytes=function(t){var e=this,i=["B","KB","MB","GB"].map((function(t){return e._(t)}));if(0==t)return"0 "+i[0];var n=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,n)).toFixed(2))+" "+i[n]},e.prototype.UploadIconTemplate=function(t){return"<span class='webix_icon "+("transfer"!=t.status?"chi-alert-circle-outline webix_chat_upl_error_icon":"")+"'></span>"},e.prototype.ShowMenuHandler=function(t){var e=t.getContext().id;return 800==this.Comments.getItem(e).type?t.disableItem("edit"):t.enableItem("edit"),!0},e.prototype.destroy=function(){this._emojiEvent&&webix.eventRemove(this._emojiEvent)},e.prototype.ShowEmojis=function(t,e,i){var n=this;this.EmojiPopup||(this.EmojiPopup=this.ui(ht),this.on(this.EmojiPopup.getRoot(),"onHide",(function(){n.ReactionsMode&&n.List.removeCss(n.ReactionsActiveId,"webix_active")}))),this.ReactionsMode=i,this.ReactionsActiveId=e,this.EmojiPopup.Show(t)},e.prototype.InitEmojis=function(){var t=this;this.Emojis=this.app.getService("emojis"),this._emojiEvent=webix.event(this.$$("emojiIcon").$view,"click",(function(e){webix.html.preventEvent(e),t.ShowEmojis(e)})),this.textarea=this.Comments.queryView({name:"text"}),this.on(this.app,"pasteEmoji",(function(e,i){if(t.ReactionsMode){var n=t.EmojiNameTemplate(i);t.AddReaction(t.ReactionsActiveId,n),t.EmojiPopup.Hide()}else t.PasteEmoji(i)})),this.EmojiSuggest=this.ui(new ut(this.app,this.Comments)),this.EmojiSuggest.LinkInput()},e.prototype.PasteEmoji=function(t){var e=this,i=this.textarea.getInputNode().selectionEnd,n=this.textarea.getValue(),a=n.substring(0,i),o=n.substring(i),r=this.EmojiNameTemplate(t),s=r.length;this.textarea.setValue(a+r+o),this.EmojiPopup.Hide(),webix.delay((function(){e.Comments.focus(),e.textarea.getInputNode().setSelectionRange(i+s,i+s)}))},e.prototype.AddReaction=function(t,e){var i=this,n=this.Comments.getItem(t),a=this.app.config.user;n.user_id==a||n.reactions&&n.reactions[e]==a||this.Ops.addReaction(t,e).then((function(e){e&&i.Comments.updateItem(t,e)}))},e.prototype.EmojiNameTemplate=function(t){return":"+t.name+": "},e.prototype.ReactionsTemplate=function(t,e){var i=this.GetReactionsList(t);return i?e+'<div class="webix_chat_message_reactions">'+i+(this.IsUsersMessage(t)?"":"<div class='webix_chat_reaction_add'><span class='webix_icon chi-emoticon-outline'></span> <span class='webix_chat_reaction_plus'>+</span></div>")+"</div>":e},e.prototype.reactedTooltipTemplate=function(t){var e=this;return t.reduce((function(t,i){var n=e.Users.getItem(i).name;return i==e.app.config.user&&(n+=" (you)"),t?t+", "+n:n}),"")},e.prototype.GetReactionsList=function(t){var e=t.reactions||[],i="";for(var n in e){var a=this.Emojis.replaceEmoji(n);if(a){var o=e[n],r=this.reactedTooltipTemplate(o);i+='<div class="'+("webix_chat_reaction_block"+(o.includes(this.app.config.user)?" webix_chat_user_reaction":""))+'" webix_tooltip="'+r+'" data-name="'+n+'">'+a+'<span class="webix_chat_reaction_count">'+o.length+"</span></div>"}}return i},e.prototype.ListConfig=function(t){var e=this,i=t.rows[0];i.tooltip={template:"",css:"webix_chat_reaction_tooltip"},i.onClick||(i.onClick={});var n=i.onClick;n.webix_chat_reaction=function(t,i){return e.ShowReactionsPopup(t,i)},n.webix_chat_reaction_add=function(t,i){return e.ShowReactionsPopup(t,i)},n.webix_chat_reaction_block=function(t,i,n){return e.ReactionClickHandler(i,n)}},e.prototype.ReactionClickHandler=function(t,e){var i=this,n=e.getAttribute("data-name");this.IsUsersReaction(t,n)?this.Ops.removeReaction(parseInt(t),n).then((function(e){e&&i.Comments.updateItem(t,e)})):this.AddReaction(parseInt(t),n)},e.prototype.ShowReactionsPopup=function(t,e){this.List.addCss(e,"webix_active");var i=1*e;isNaN(i)||(e=i),this.ShowEmojis(t,e,"reactions")},e}(h),ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){R||(R=!0,webix.protoUI({name:"r-layout",sizeTrigger:function(t,e,i){this._compactValue=i,this._compactHandler=e,this._app=t;var n=t.config;this._forceCompact=n.params.forceCompact,this._compactWidth=n.compactWidth,this._forceCompact||this._checkTrigger(this.$view.width,i)},_checkTrigger:function(t,e){return!this._compactWidth||!(t<=this._compactWidth&&!e||t>this._compactWidth&&e)||(this._compactWidth=null,this._compactHandler(!e),!1)},$setSize:function(t,e){(this._forceCompact||this._checkTrigger(t,this._compactValue))&&webix.ui.layout.prototype.$setSize.call(this,t,e),this._app&&this._app.callEvent("view:resize",[])}},webix.ui.layout));var t="single"===this.app.config.mode,e=this.getParam("forceCompact");return(!webix.isUndefined(e)||t)&&this.setParam("compact",e||t),this.Compact=this.getParam("compact"),{view:"r-layout",id:"main",css:"webix_chat_main_layout",rows:[{cols:this.Compact?[{$subview:!0,name:"center"}]:[ct,{$subview:!0,name:"center"},{$subview:"_hidden",name:"panel"}],margin:0},{$subview:!0,name:"top",popup:!0}]}},e.prototype.init=function(){var t=this,e=this.app.getService("local"),i=this.getRoot();i.sizeTrigger&&i.sizeTrigger(this.app,(function(e){return t.SetCompactMode(e)}),!!this.Compact),this.ShowDefaultChat(),this.on(this.app,"showSidebar",(function(){return t.ShowSidebar()})),this.on(this.app,"showChat",(function(i,n){var a=null;if("user"===i){a=n;var o=e.chats().find((function(t){return t.direct_id==n}),!0);n=o?o.id:null}else{(o=e.chats().getItem(n)).direct_id&&(i="user",a=o.direct_id)}t.ShowChat(i,n,a)})),this.on(this.app,"leaveChat",(function(e){t.LeaveChat(e)})),this.on(this.app,"removeChatMember",(function(e){t.LeaveChat(e,!0)})),this.on(this.app,"newChat",(function(){t.ShowChatWindow()})),this.on(this.app,"chatInfo",(function(e){t.ShowChatInfo(e)})),this.on(this.app,"newMembers",(function(e){t.ShowNewMembersWindow(e)})),this.on(this.app,"startCall",(function(e,i){t.StartCall(e,i)}));var n=this.getParam("state");this.on(n.$changes,"callId",(function(e){e?t.Compact?t.show("./call.panel",{target:"center"}):(t.show("./call.panel",{target:"panel"}),t.show("./messages",{target:"center"})):(t.show("./messages",{target:"center"}),t.Compact||t.show("_hidden",{target:"panel"}))}));var a=this.app.getService("backend"),o=a.pubsub(),r=a.callStatuses;this.on(o,"signal",(function(e){if("active"===e.type)n.timer||a.callInfo().then((function(e){var i=new Date(e.start),a=Math.max(new Date,i);n.time=Math.floor((a-i)/1e3),t.CallTimer()}));else if("connect"===e.type){var i=JSON.parse(e.msg);if(i.devices)return void(-1==i.devices.indexOf(t.app.config.device)&&t.EndCall());if(n.callId&&i.id!=n.callId)return void(i.status<900&&a.updateCall(i.id,r.reject));i.start&&!n.timer&&t.CallTimer(),i.status==r.init&&(n.callChatId=n.chatId);var o=i.users,s=i.id,c=i.status;i.status==r.end||i.status==r.reject||i.status==r.ignore||i.status==r.lost?t.EndCall():n.$batch({callId:s,callStatus:c,callUsers:o})}}))},e.prototype.EndCall=function(){var t=this.getParam("state");t.timer&&clearInterval(t.timer),t.$batch({callId:0,callStatus:"",callUsers:[],callChatId:null,timer:null,time:null})},e.prototype.ShowDefaultChat=function(){var t=this,e=this.getParam("state"),i=this.app.getService("local").chats();i.waitData.then((function(){e.chatId||(i.count()?e.chatId=i.getFirstId():t.Compact&&t.ShowSidebar())}))},e.prototype.ShowChat=function(t,e,i){this.getParam("state").$batch({chatId:e,chatType:t,userId:i}),this.show("_hidden",{target:"top"})},e.prototype.ShowChatWindow=function(){this.show("chat.new",{target:"top"})},e.prototype.ShowChatInfo=function(t){this.show("chat.info",{target:"top",params:{id:t}})},e.prototype.ShowNewMembersWindow=function(t){this.show("chat.members",{target:"top",params:{id:t}})},e.prototype.LeaveChat=function(t,e){var i=this.app.getService("locale")._,n=this.getParam("state");t===n.chatId&&(e&&webix.alert(i("You have been removed from the group")),n.$batch({chatId:0,chatType:"",userId:0}))},e.prototype.SetCompactMode=function(t){var e=this;webix.delay((function(){e.setParam("compact",t),e.refresh()}))},e.prototype.ShowSidebar=function(){this.SideMenu&&this.SideMenu.getRoot()||(this.SideMenu=this.ui(lt)),this.SideMenu.Show()},e.prototype.StartCall=function(t,e){var i=this.app.getService("locale")._;this.app.getService("backend").startCall(t,e).catch((function(){webix.alert(i("Can't start the call"))}))},e.prototype.CallTimer=function(){var t=this,e=this.getParam("state");e.time||(e.time=0),e.timer=setInterval((function(){t.app.callEvent("updateCallTime",[++e.time])}),1e3)},e}(h),_t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.init=function(){var t=this.app.getService("local").users();this.InitSelf(t)},e.prototype.SyncHandler=function(){var t=this;this.$$("list").data.filter((function(e){return e.id!=t.app.config.user})),this.$$("list").data.silent((function(){this.sort("name","asc")}))},e.prototype.ShowChat=function(t){this.app.callEvent("showChat",["user",1*t])},e.prototype.ListTemplate=function(t){var e=this.app.getService("helpers");return e.listAvatar(t)+e.addTextMark(t.name,this.EscapedSearchText)},e}(rt),mt={JetView:h};mt["call/panel"]=J,mt["chat/common/form"]=K,mt["chat/common/people"]=Y,mt["chat/common/toolbar"]=Z,mt["chat/common/window"]=Q,mt["chat/info/form"]=X,mt["chat/info"]=tt,mt["chat/info/info"]=et,mt["chat/info/people"]=it,mt["chat/members"]=nt,mt["chat/new/form"]=at,mt["chat/new"]=ot,mt.chats=st,mt["compact/sidemenu"]=lt,mt.list=rt,mt["messages/emojis"]=ht,mt["messages/emojisuggest"]=ut,mt.messages=dt,mt["messages/toolbar"]=pt,mt.sidebar=ct,mt.top=ft,mt.users=_t;var vt=function(){function t(t){this.app=t,this._messages={},this._subs=[]}return t.prototype.users=function(){var t=this;if(!this._users){var e=this.app.getService("backend");this._users=new webix.DataCollection({}),e.users().then((function(e){return t._users.parse(e)})),this._subs.push(e.pubsub().attachEvent("users",(function(e){var i,n=e.op,a=e.user_id,o=e.data;switch(n){case"online":(i=t._users.getItem(a))&&i.status!=o&&t._users.updateItem(a,{status:o});var r=t._chats.find((function(t){return t.direct_id==a}),!0);r&&t._chats.updateItem(r.id,{status:o?2:1})}})))}return this._users},t.prototype.chats=function(){var t=this,e=this.app.getState();if(!this._chats){this._chats=new webix.DataCollection({scheme:{$change:function(e){if(e.date&&"string"==typeof e.date&&(e.date=new Date(e.date)),e.direct_id){var i=t.users().getItem(e.direct_id);e.name||(e.name="PM: "+i.name),e.avatar||(e.avatar=i.avatar),e.status=i.status}},$sort:{by:"date",dir:"desc",as:"date"}}});var i=this.app.getService("backend");Promise.all([i.chats(),this.users().waitData]).then((function(e){t._chats.parse(e[0])})),this._subs.push(i.pubsub().attachEvent("chats",(function(e){var i,n=e.op,a=e.chat_id,o=e.data;switch(n){case"add":case"update":if(-1==o.users.indexOf(t.app.config.user))return void(t._chats.exists(a)&&(t.app.callEvent("removeChatMember",[a]),t._chats.remove(a)));t._chats.exists(a)?(i={name:o.name,avatar:o.avatar,users:o.users},o.direct_id||(i.direct_id=0),t._chats.updateItem(a,i)):t._chats.add(o,0);break;case"message":t._chats.updateItem(a,{message:o.message,message_type:o.message_type,date:new Date(o.date)})}}))),this._subs.push(i.pubsub().attachEvent("messages",(function(n){var a,o=n.op,r=n.msg;switch(o){case"add":(a=t._chats.getItem(r.chat_id))&&(e.chatId!=a.id?t._chats.updateItem(a.id,{message:r.text,message_type:r.type,unread_count:a.unread_count+1,date:r.date}):(t._chats.updateItem(a.id,{message:r.text,message_type:r.type,date:r.date}),i.resetCounter(a.id)),t._chats.getIndexById(a.id)&&t._chats.moveTop(a.id))}})))}return this._chats},t.prototype.messages=function(t){var e=this.app.getService("backend");return this._messages[t]=e.messages(t)},t}(),gt=function(){function t(t){var e=t.url,i=t.token;this._url=e,this._token=i,this._mode=1,this._seed=1,this._queue=[],this.data={},this.api={},this._events={}}return t.prototype.headers=function(){return{Accept:"application/json","Content-Type":"application/json","Remote-Token":this._token}},t.prototype.fetch=function(t,e){var i={credentials:"include",headers:this.headers()};return e&&(i.method="POST",i.body=e),fetch(t,i).then((function(t){return t.json()}))},t.prototype.load=function(t){var e=this;return t&&(this._url=t),this.fetch(this._url).then((function(t){return e.parse(t)}))},t.prototype.parse=function(t){var e=t.key,i=t.websocket;for(var n in e&&(this._token=t.key),t.data)this.data[n]=t.data[n];for(var a in t.api){var o=this.api[a]={},r=t.api[a];for(var s in r)o[s]=this._wrapper(a+"."+s)}return i&&this.connect(),this},t.prototype.connect=function(){var t=this,e=this._socket;e&&(this._socket=null,e.onclose=function(){},e.close()),this._mode=2,this._socket=function(e,i,n,a){var o=i;"/"===o[0]&&(o=document.location.protocol+"//"+document.location.host+i);var r=-1!=(o=o.replace(/^http(s|):/,"ws$1:")).indexOf("?")?"&":"?";o=""+o+r+"token="+n+"&ws=1";var s=new WebSocket(o);return s.onclose=function(){return setTimeout((function(){return e.connect()}),2e3)},s.onmessage=function(i){var n=JSON.parse(i.data);switch(n.action){case"result":e.result(n.body,[]);break;case"event":e.fire(n.body.name,n.body.value);break;case"start":t._mode=3,t._send(),t._resubscribe();break;default:e.onError(n.data)}},s}(this,this._url,this._token)},t.prototype._wrapper=function(t){return function(){var e=this,i=[].slice.call(arguments),n=null,a=new Promise((function(a,o){n={data:{id:e._uid(),name:t,args:i},status:1,resolve:a,reject:o},e._queue.push(n)}));return this.onCall(n,a),3===this._mode?this._send(n):setTimeout((function(){return e._send()}),1),a}.bind(this)},t.prototype._uid=function(){return(this._seed++).toString()},t.prototype._send=function(t){var e=this;if(2!=this._mode){var i=t?[t]:this._queue.filter((function(t){return 1===t.status}));if(i.length){var n=i.map((function(t){return t.status=2,t.data}));3!==this._mode?this.fetch(this._url,JSON.stringify(n)).catch((function(t){return e.onError(t)})).then((function(t){return e.result(t,n)})):this._socket.send(JSON.stringify({action:"call",body:n}))}}else setTimeout((function(){return e._send()}),100)},t.prototype.result=function(t,e){var i={};if(t)for(var n=0;n<t.length;n++)i[t[n].id]=t[n];else for(var a=0;a<e.length;a++)i[e[a].id]={id:e[a].id,error:"Network Error",data:null};for(var o=this._queue.length-1;o>=0;o--){var r=this._queue[o],s=i[r.data.id];s&&(this.onResponse(r,s),s.error?r.reject(s.error):r.resolve(s.data),this._queue.splice(o,1))}},t.prototype.on=function(t,e){var i=this._uid(),n=this._events[t],a=!!n;return a||(n=this._events[t]=[]),n.push({id:i,handler:e}),a||3!=this._mode||this._socket.send(JSON.stringify({action:"subscribe",name:t})),{name:t,id:i}},t.prototype._resubscribe=function(){if(3==this._mode)for(var t in this._events)this._socket.send(JSON.stringify({action:"subscribe",name:t}))},t.prototype.detach=function(t){if(t){var e=t.id,i=t.name,n=this._events[i];if(n){var a=n.filter((function(t){return t.id!=e}));a.length?this._events[i]=a:(delete this._events[i],3==this._mode&&this._socket.send(JSON.stringify({action:"unsubscribe",name:i})))}}else{if(3==this._mode)for(var o in this._events)this._socket.send(JSON.stringify({action:"unsubscribe",key:o}));this._events={}}},t.prototype.fire=function(t,e){var i=this._events[t];if(i)for(var n=0;n<i.length;n++)i[n].handler(e)},t.prototype.onError=function(t){return null},t.prototype.onCall=function(t,e){},t.prototype.onResponse=function(t,e){},t}(),bt=function(){function t(t){var e=this;this.app=t;var i=new gt({url:t.config.url,token:t.config.token});this._ready=i.load().then((function(i){e._api=i.api,e._data=i.data,e._pubsub={attachEvent:function(t,e){return i.on(t,e)},detachEvent:function(t){return i.detach(t)}};var n=t.config.user=e._data.user;t.config.device=e._data.device,e._data.users.forEach((function(t){t.id===n&&(t.status=2)}))})),this.callStatuses={init:1,accept:2,active:3,drop:900,reject:901,end:902,ignore:903,lost:904},this.callMessages={900:"start",901:"reject",902:"ignore"}}return t.prototype.ready=function(){return this._ready},t.prototype.users=function(){return Promise.resolve(this._data.users)},t.prototype.chats=function(){return Promise.resolve(this._data.chats)},t.prototype.callInfo=function(){return Promise.resolve(this._data.call)},t.prototype.addChat=function(t){return this._api.chat.AddDirect(1*t)},t.prototype.messages=function(t){return this._api.message.GetAll(1*t).then((function(t){return t.forEach((function(t){return t.date=new Date(t.date)})),t}))},t.prototype.addMessage=function(t,e,i){return this._api.message.Add(e,1*t,i.toString()).then((function(t){return t.date=new Date(t.date),t}))},t.prototype.removeMessage=function(t){return this._api.message.Remove(1*t)},t.prototype.updateMessage=function(t,e){return this._api.message.Update(1*t,e)},t.prototype.resetCounter=function(t){this._api.message.ResetCounter(1*t)},t.prototype.pubsub=function(){return this._pubsub},t.prototype.addGroupChat=function(t,e,i){return this._api.chat.AddGroup(t,e,i)},t.prototype.updateChat=function(t,e,i){return this._api.chat.Update(t,e,i)},t.prototype.leave=function(t,e){return this._api.chat.Leave(t,e)},t.prototype.setUsers=function(t,e){return this._api.chat.SetUsers(t,e)},t.prototype.avatarUploadUrl=function(t){return this.app.config.url+"/chat/"+t+"/avatar"},t.prototype.fileUploadUrl=function(t){return this.app.config.url+"/chat/"+t+"/file"},t.prototype.startCall=function(t,e){return this._api.call.Start(t,e)},t.prototype.updateCall=function(t,e){return this._api.call.SetStatus(t,e)},t.prototype.signalCall=function(t,e){return this._api.call.Signal(t,e)},t.prototype.addReaction=function(t,e){return this._api.message.AddReaction(t,e).then((function(t){return t.date=new Date(t.date),t}))},t.prototype.removeReaction=function(t,e){return this._api.message.RemoveReaction(t,e).then((function(t){return t.date=new Date(t.date),t}))},t.prototype.basicEmojis=function(){return Promise.resolve(["+1","-1","smile","frowning","tada","heart"])},t}(),wt=function(){function t(t){this._app=t,this._local=this._app.getService("local"),this._back=this._app.getService("backend")}return t.prototype.addChat=function(t){var e=this;return this._back.addChat(t).then((function(t){return e._local.chats().add(t,0),t.id}))},t.prototype.addMessage=function(t,e,i){var n=this._local.chats();return n.updateItem(t,{message:this._getMessageText(i),message_type:0,date:new Date}),n.getIndexById(t)&&n.moveTop(t),this._back.addMessage(t,i,e)},t.prototype.removeMessage=function(t){return this._back.removeMessage(t)},t.prototype.updateMessage=function(t,e){return this._back.updateMessage(t,e)},t.prototype._getMessageText=function(t){var e=80;if(this._app.config.emojis){var i=t.match(this._app.getService("emojis").emojiRegExp);i&&i.forEach((function(t){e+=t.length}))}return t.substr(0,Math.min(t.length,e))},t.prototype.resetCounter=function(t){this._back.resetCounter(t);var e=this._local.chats();e.exists(t)&&e.updateItem(t,{unread_count:0})},t.prototype.addGroupChat=function(t,e,i){var n=this;return this._back.addGroupChat(t,e,i).then((function(t){return n._local.chats().add(t,0),t.id}))},t.prototype.updateChat=function(t,e,i){var n=this;return this._back.updateChat(t,e,i).then((function(e){n._local.chats().updateItem(t,e)}))},t.prototype.leaveChat=function(t){var e=this;return this._back.leave(t,this._app.config.user).then((function(){e._app.callEvent("leaveChat",[t]),e._local.chats().remove(t)}))},t.prototype.setUsers=function(t,e){var i=this;return this._back.setUsers(t,e).then((function(e){var n=i._local.chats();e.id==t?n.updateItem(t,e):(n.add(e,0),i._app.callEvent("showChat",[n,e.id]))}))},t.prototype.addReaction=function(t,e){return this._back.addReaction(t,e)},t.prototype.removeReaction=function(t,e){return this._back.removeReaction(t,e)},t}(),Ft=function(){function t(t){this.app=t,this.initUploader(),this.maxFileSize=1e7}return t.prototype.initUploader=function(){var t=this;this.uploader=webix.ui({view:"uploader",apiOnly:!0,autosend:!0,on:{onBeforeFileAdd:function(e){return t.configUpload(e)}}})},t.prototype.config=function(t){webix.extend(this.uploader.config,t,!0)},t.prototype.getUploader=function(t,e){return this._chat=t,this._mode=e,this.uploader},t.prototype.configUpload=function(t){var e=this.app.getService("backend");if(this.uploader.config.upload="file"==this._mode?e.fileUploadUrl(this._chat):e.avatarUploadUrl(this._chat),this.uploader.config.urlData={token:this.app.config.token},t.size>this.maxFileSize)return this.app.callEvent("onSizeExceed",[t]),!1},t.prototype.fileDialog=function(){this.uploader.fileDialog()},t}(),yt=function(){function t(){this.statusMap={1:"none",2:"active",3:"busy",4:"away"},this.checkedIcon="<span class='webix_icon wxi-checkbox-marked'></span>",this.notCheckedIcon="<span class='webix_icon wxi-checkbox-blank'></span>",this.dateMask="%d.%m.%Y",this.weekMask="%D",this.todayDateMask="%H:%i"}return t.prototype.status=function(t){return"<span class = 'webix_chat_status webix_chat_status_"+this.statusMap[t.status]+"'></span>"},t.prototype.listAvatar=function(t,e){var i="<div class='"+("string"==typeof e?e:"webix_chat_list_avatar")+"'>";return t.status&&(i+=this.status(t)),i+=this.avatar(t),i+="</div>"},t.prototype.initials=function(t){var e=t.match(/\b\w/g)||[];return((e.shift()||"")+(e.pop()||"")).toUpperCase()},t.prototype.avatar=function(t,e){var i="string"==typeof e?e:"webix_chat_avatar";return t.avatar?'<img alt="" class="'+i+'" src="'+t.avatar+'"/>':t.name?"<div class='"+i+"'>"+this.initials(t.name||"")+"</div>":"<div class='"+i+" webix_icon wxi-user'></div>"},t.prototype.formAvatar=function(t,e){var i="webix_chat_avatar";return t.avatar?'<img alt="" title="'+e+'" class="'+i+'" src="'+t.avatar+'"/>':"<div class='"+i+"  webix_icon chi-camera' title='"+e+"'</div>"},t.prototype.dateChatFormat=function(t){var e=this.dateMask,i=webix.Date.datePart(new Date,!0),n=webix.Date.datePart(t,!0);return webix.Date.equal(n,i)?e=this.todayDateMask:n>webix.Date.add(i,-7,"day")&&(e=this.weekMask),webix.Date.dateToStr(e)(t)},t.prototype.peopleList=function(t,e,i){var n=this,a="<ul class='webix_chat_peoplelist'>";return t.forEach((function(t){a+="<li class='webix_chat_peoplelist_item' data-id='"+t.id+"'><div class='webix_chat_peoplelist_avatar'>"+n.avatar(t)+(i&&i.indexOf(t.id)>=0?"<div class='webix_chat_group_user_marker'><span class='webix_icon wxi-check'></span></div>":"")+(e?"<div class='webix_chat_peoplelist_delete_icon'><span class='webix_icon wxi-close'></span></div>":"")+'</div><p class="webix_chat_peoplelist_item_name">'+t.name+"</p></li>"})),a+="</ul>"},t.prototype.addTextMark=function(t,e){return e?t.replace(new RegExp("("+e+")","ig"),"<span class='webix_chat_search_mark'>$1</span>"):t},t.prototype.normalizeTime=function(t){t=t||0;var e=Math.floor(t/60),i=t-60*e;return(e<10?"0"+e:e)+":"+(i<10?"0"+i:i)},t}(),xt=[[["watch"],"231A",6],[["soccer"],"26BD",3],[["heart"],"2764",7],[["green_apple"],"1F34F",5],[["dog"],"1F436",2],[["grinning"],"1F600",1],[["car","red_car"],"1F697",4],[["apple"],"1F34E",5],[["basketball"],"1F3C0",3],[["cat"],"1F431",2],[["yellow_heart"],"1F49B",7],[["iphone"],"1F4F1",6],[["smiley"],"1F603",1],[["taxi"],"1F695",4],[["pear"],"1F350",5],[["football"],"1F3C8",3],[["mouse"],"1F42D",2],[["green_heart"],"1F49A",7],[["calling"],"1F4F2",6],[["smile"],"1F604",1],[["blue_car"],"1F699",4],[["baseball"],"26BE",3],[["tangerine"],"1F34A",5],[["hamster"],"1F439",2],[["blue_heart"],"1F499",7],[["computer"],"1F4BB",6],[["grin"],"1F601",1],[["bus"],"1F68C",4],[["keyboard"],"2328",6],[["lemon"],"1F34B",5],[["tennis"],"1F3BE",3],[["rabbit"],"1F430",2],[["purple_heart"],"1F49C",7],[["laughing","satisfied"],"1F606",1],[["trolleybus"],"1F68E",4],[["banana"],"1F34C",5],[["racing_car"],"1F3CE",4],[["volleyball"],"1F3D0",3],[["black_heart"],"1F5A4",7],[["desktop_computer"],"1F5A5",6],[["sweat_smile"],"1F605",1],[["fox_face"],"1F98A",2],[["watermelon"],"1F349",5],[["rugby_football"],"1F3C9",3],[["bear"],"1F43B",2],[["broken_heart"],"1F494",7],[["printer"],"1F5A8",6],[["joy"],"1F602",1],[["police_car"],"1F693",4],[["heavy_heart_exclamation_mark_ornament"],"2763",7],[["grapes"],"1F347",5],[["8ball"],"1F3B1",3],[["panda_face"],"1F43C",2],[["three_button_mouse"],"1F5B1",6],[["ambulance"],"1F691",4],[["rolling_on_the_floor_laughing"],"1F923",1],[["relaxed"],"263A",1],[["strawberry"],"1F353",5],[["table_tennis_paddle_and_ball"],"1F3D3",3],[["koala"],"1F428",2],[["two_hearts"],"1F495",7],[["trackball"],"1F5B2",6],[["fire_engine"],"1F692",4],[["melon"],"1F348",5],[["badminton_racquet_and_shuttlecock"],"1F3F8",3],[["tiger"],"1F42F",2],[["revolving_hearts"],"1F49E",7],[["joystick"],"1F579",6],[["blush"],"1F60A",1],[["minibus"],"1F690",4],[["cherries"],"1F352",5],[["heartbeat"],"1F493",7],[["compression"],"1F5DC",6],[["innocent"],"1F607",1],[["truck"],"1F69A",4],[["goal_net"],"1F945",3],[["lion_face"],"1F981",2],[["peach"],"1F351",5],[["ice_hockey_stick_and_puck"],"1F3D2",3],[["cow"],"1F42E",2],[["heartpulse"],"1F497",7],[["minidisc"],"1F4BD",6],[["slightly_smiling_face"],"1F642",1],[["articulated_lorry"],"1F69B",4],[["pineapple"],"1F34D",5],[["field_hockey_stick_and_ball"],"1F3D1",3],[["pig"],"1F437",2],[["sparkling_heart"],"1F496",7],[["floppy_disk"],"1F4BE",6],[["upside_down_face"],"1F643",1],[["tractor"],"1F69C",4],[["cricket_bat_and_ball"],"1F3CF",3],[["pig_nose"],"1F43D",2],[["cupid"],"1F498",7],[["cd"],"1F4BF",6],[["wink"],"1F609",1],[["scooter"],"1F6F4",4],[["kiwifruit"],"1F95D",5],[["golf"],"26F3",3],[["frog"],"1F438",2],[["gift_heart"],"1F49D",7],[["dvd"],"1F4C0",6],[["relieved"],"1F60C",1],[["bike"],"1F6B2",4],[["avocado"],"1F951",5],[["tomato"],"1F345",5],[["bow_and_arrow"],"1F3F9",3],[["monkey_face"],"1F435",2],[["heart_decoration"],"1F49F",7],[["vhs"],"1F4FC",6],[["heart_eyes"],"1F60D",1],[["motor_scooter"],"1F6F5",4],[["eggplant"],"1F346",5],[["fishing_pole_and_fish"],"1F3A3",3],[["racing_motorcycle"],"1F3CD",4],[["camera"],"1F4F7",6],[["kissing_heart"],"1F618",1],[["see_no_evil"],"1F648",2],[["camera_with_flash"],"1F4F8",6],[["kissing"],"1F617",1],[["hear_no_evil"],"1F649",2],[["rotating_light"],"1F6A8",4],[["boxing_glove"],"1F94A",3],[["cucumber"],"1F952",5],[["video_camera"],"1F4F9",6],[["kissing_smiling_eyes"],"1F619",1],[["speak_no_evil"],"1F64A",2],[["oncoming_police_car"],"1F694",4],[["martial_arts_uniform"],"1F94B",3],[["carrot"],"1F955",5],[["ice_skate"],"26F8",3],[["corn"],"1F33D",5],[["movie_camera"],"1F3A5",6],[["monkey"],"1F412",2],[["kissing_closed_eyes"],"1F61A",1],[["oncoming_bus"],"1F68D",4],[["hot_pepper"],"1F336",5],[["ski"],"1F3BF",3],[["chicken"],"1F414",2],[["film_projector"],"1F4FD",6],[["yum"],"1F60B",1],[["oncoming_automobile"],"1F698",4],[["skier"],"26F7",3],[["film_frames"],"1F39E",6],[["penguin"],"1F427",2],[["stuck_out_tongue_winking_eye"],"1F61C",1],[["oncoming_taxi"],"1F696",4],[["potato"],"1F954",5],[["sweet_potato"],"1F360",5],[["snowboarder"],"1F3C2",3],[["bird"],"1F426",2],[["telephone_receiver"],"1F4DE",6],[["stuck_out_tongue_closed_eyes"],"1F61D",1],[["aerial_tramway"],"1F6A1",4],[["phone","telephone"],"260E",6],[["chestnut"],"1F330",5],[["baby_chick"],"1F424",2],[["stuck_out_tongue"],"1F61B",1],[["mountain_cableway"],"1F6A0",4],[["weight_lifter"],"1F3CB",3],[["hatching_chick"],"1F423",2],[["pager"],"1F4DF",6],[["suspension_railway"],"1F69F",4],[["money_mouth_face"],"1F911",1],[["peanuts"],"1F95C",5],[["honey_pot"],"1F36F",5],[["hatched_chick"],"1F425",2],[["fax"],"1F4E0",6],[["railway_car"],"1F683",4],[["hugging_face"],"1F917",1],[["fencer"],"1F93A",3],[["tv"],"1F4FA",6],[["train"],"1F68B",4],[["nerd_face"],"1F913",1],[["wrestlers"],"1F93C",3],[["croissant"],"1F950",5],[["duck"],"1F986",2],[["bread"],"1F35E",5],[["radio"],"1F4FB",6],[["sunglasses"],"1F60E",1],[["mountain_railway"],"1F69E",4],[["eagle"],"1F985",2],[["studio_microphone"],"1F399",6],[["monorail"],"1F69D",4],[["clown_face"],"1F921",1],[["baguette_bread"],"1F956",5],[["owl"],"1F989",2],[["level_slider"],"1F39A",6],[["bullettrain_side"],"1F684",4],[["face_with_cowboy_hat"],"1F920",1],[["person_doing_cartwheel"],"1F938",3],[["bat"],"1F987",2],[["cheese_wedge"],"1F9C0",5],[["control_knobs"],"1F39B",6],[["wolf"],"1F43A",2],[["smirk"],"1F60F",1],[["bullettrain_front"],"1F685",4],[["egg"],"1F95A",5],[["stopwatch"],"23F1",6],[["fried_egg","cooking"],"1F373",5],[["boar"],"1F417",2],[["unamused"],"1F612",1],[["light_rail"],"1F688",4],[["timer_clock"],"23F2",6],[["horse"],"1F434",2],[["disappointed"],"1F61E",1],[["steam_locomotive"],"1F682",4],[["bacon"],"1F953",5],[["alarm_clock"],"23F0",6],[["person_with_ball"],"26F9",3],[["pensive"],"1F614",1],[["train2"],"1F686",4],[["pancakes"],"1F95E",5],[["unicorn_face"],"1F984",2],[["fried_shrimp"],"1F364",5],[["bee","honeybee"],"1F41D",2],[["mantelpiece_clock"],"1F570",6],[["worried"],"1F61F",1],[["metro"],"1F687",4],[["handball"],"1F93E",3],[["hourglass"],"231B",6],[["poultry_leg"],"1F357",5],[["bug"],"1F41B",2],[["confused"],"1F615",1],[["tram"],"1F68A",4],[["hourglass_flowing_sand"],"23F3",6],[["meat_on_bone"],"1F356",5],[["slightly_frowning_face"],"1F641",1],[["station"],"1F689",4],[["butterfly"],"1F98B",2],[["white_frowning_face"],"2639",1],[["pizza"],"1F355",5],[["snail"],"1F40C",2],[["satellite_antenna"],"1F4E1",6],[["helicopter"],"1F681",4],[["hotdog"],"1F32D",5],[["golfer"],"1F3CC",3],[["shell"],"1F41A",2],[["battery"],"1F50B",6],[["persevere"],"1F623",1],[["small_airplane"],"1F6E9",4],[["airplane"],"2708",4],[["hamburger"],"1F354",5],[["beetle"],"1F41E",2],[["electric_plug"],"1F50C",6],[["confounded"],"1F616",1],[["fries"],"1F35F",5],[["surfer"],"1F3C4",3],[["ant"],"1F41C",2],[["bulb"],"1F4A1",6],[["tired_face"],"1F62B",1],[["airplane_departure"],"1F6EB",4],[["flashlight"],"1F526",6],[["spider"],"1F577",2],[["weary"],"1F629",1],[["airplane_arriving"],"1F6EC",4],[["stuffed_flatbread"],"1F959",5],[["taco"],"1F32E",5],[["swimmer"],"1F3CA",3],[["candle"],"1F56F",6],[["spider_web"],"1F578",2],[["triumph"],"1F624",1],[["rocket"],"1F680",4],[["burrito"],"1F32F",5],[["turtle"],"1F422",2],[["wastebasket"],"1F5D1",6],[["angry"],"1F620",1],[["satellite"],"1F6F0",4],[["water_polo"],"1F93D",3],[["snake"],"1F40D",2],[["seat"],"1F4BA",4],[["rage"],"1F621",1],[["oil_drum"],"1F6E2",6],[["green_salad"],"1F957",5],[["money_with_wings"],"1F4B8",6],[["no_mouth"],"1F636",1],[["canoe"],"1F6F6",4],[["shallow_pan_of_food"],"1F958",5],[["lizard"],"1F98E",2],[["boat","sailboat"],"26F5",4],[["spaghetti"],"1F35D",5],[["dollar"],"1F4B5",6],[["neutral_face"],"1F610",1],[["scorpion"],"1F982",2],[["ramen"],"1F35C",5],[["yen"],"1F4B4",6],[["expressionless"],"1F611",1],[["rowboat"],"1F6A3",3],[["motor_boat"],"1F6E5",4],[["crab"],"1F980",2],[["stew"],"1F372",5],[["horse_racing"],"1F3C7",3],[["euro"],"1F4B6",6],[["hushed"],"1F62F",1],[["speedboat"],"1F6A4",4],[["squid"],"1F991",2],[["fish_cake"],"1F365",5],[["octopus"],"1F419",2],[["pound"],"1F4B7",6],[["frowning"],"1F626",1],[["passenger_ship"],"1F6F3",4],[["ferry"],"26F4",4],[["sushi"],"1F363",5],[["moneybag"],"1F4B0",6],[["anguished"],"1F627",1],[["bicyclist"],"1F6B4",3],[["shrimp"],"1F990",2],[["bento"],"1F371",5],[["tropical_fish"],"1F420",2],[["credit_card"],"1F4B3",6],[["open_mouth"],"1F62E",1],[["ship"],"1F6A2",4],[["anchor"],"2693",4],[["curry"],"1F35B",5],[["fish"],"1F41F",2],[["gem"],"1F48E",6],[["astonished"],"1F632",1],[["mountain_bicyclist"],"1F6B5",3],[["scales"],"2696",6],[["rice"],"1F35A",5],[["running_shirt_with_sash"],"1F3BD",3],[["blowfish"],"1F421",2],[["dizzy_face"],"1F635",1],[["construction"],"1F6A7",4],[["fuelpump"],"26FD",4],[["rice_ball"],"1F359",5],[["sports_medal"],"1F3C5",3],[["dolphin","flipper"],"1F42C",2],[["wrench"],"1F527",6],[["flushed"],"1F633",1],[["rice_cracker"],"1F358",5],[["medal"],"1F396",3],[["hammer"],"1F528",6],[["scream"],"1F631",1],[["busstop"],"1F68F",4],[["shark"],"1F988",2],[["hammer_and_pick"],"2692",6],[["oden"],"1F362",5],[["whale"],"1F433",2],[["fearful"],"1F628",1],[["vertical_traffic_light"],"1F6A6",4],[["first_place_medal"],"1F947",3],[["dango"],"1F361",5],[["whale2"],"1F40B",2],[["cold_sweat"],"1F630",1],[["traffic_light"],"1F6A5",4],[["hammer_and_wrench"],"1F6E0",6],[["second_place_medal"],"1F948",3],[["pick"],"26CF",6],[["shaved_ice"],"1F367",5],[["crocodile"],"1F40A",2],[["world_map"],"1F5FA",4],[["cry"],"1F622",1],[["third_place_medal"],"1F949",3],[["ice_cream"],"1F368",5],[["trophy"],"1F3C6",3],[["leopard"],"1F406",2],[["nut_and_bolt"],"1F529",6],[["moyai"],"1F5FF",4],[["disappointed_relieved"],"1F625",1],[["gear"],"2699",6],[["icecream"],"1F366",5],[["rosette"],"1F3F5",3],[["tiger2"],"1F405",2],[["statue_of_liberty"],"1F5FD",4],[["drooling_face"],"1F924",1],[["chains"],"26D3",6],[["fountain"],"26F2",4],[["cake"],"1F370",5],[["reminder_ribbon"],"1F397",3],[["water_buffalo"],"1F403",2],[["sob"],"1F62D",1],[["birthday"],"1F382",5],[["ticket"],"1F3AB",3],[["ox"],"1F402",2],[["gun"],"1F52B",6],[["tokyo_tower"],"1F5FC",4],[["sweat"],"1F613",1],[["custard"],"1F36E",5],[["admission_tickets"],"1F39F",3],[["european_castle"],"1F3F0",4],[["cow2"],"1F404",2],[["bomb"],"1F4A3",6],[["sleepy"],"1F62A",1],[["lollipop"],"1F36D",5],[["circus_tent"],"1F3AA",3],[["japanese_castle"],"1F3EF",4],[["hocho","knife"],"1F52A",6],[["sleeping"],"1F634",1],[["deer"],"1F98C",2],[["candy"],"1F36C",5],[["stadium"],"1F3DF",4],[["dromedary_camel"],"1F42A",2],[["dagger_knife"],"1F5E1",6],[["face_with_rolling_eyes"],"1F644",1],[["juggling"],"1F939",3],[["crossed_swords"],"2694",6],[["chocolate_bar"],"1F36B",5],[["ferris_wheel"],"1F3A1",4],[["camel"],"1F42B",2],[["thinking_face"],"1F914",1],[["popcorn"],"1F37F",5],[["roller_coaster"],"1F3A2",4],[["elephant"],"1F418",2],[["shield"],"1F6E1",6],[["lying_face"],"1F925",1],[["doughnut"],"1F369",5],[["carousel_horse"],"1F3A0",4],[["performing_arts"],"1F3AD",3],[["grimacing"],"1F62C",1],[["smoking"],"1F6AC",6],[["rhinoceros"],"1F98F",2],[["coffin"],"26B0",6],[["umbrella_on_ground"],"26F1",4],[["cookie"],"1F36A",5],[["art"],"1F3A8",3],[["zipper_mouth_face"],"1F910",1],[["gorilla"],"1F98D",2],[["funeral_urn"],"26B1",6],[["clapper"],"1F3AC",3],[["beach_with_umbrella"],"1F3D6",4],[["racehorse"],"1F40E",2],[["nauseated_face"],"1F922",1],[["glass_of_milk"],"1F95B",5],[["baby_bottle"],"1F37C",5],[["microphone"],"1F3A4",3],[["desert_island"],"1F3DD",4],[["amphora"],"1F3FA",6],[["pig2"],"1F416",2],[["sneezing_face"],"1F927",1],[["coffee"],"2615",5],[["mountain"],"26F0",4],[["headphones"],"1F3A7",3],[["goat"],"1F410",2],[["crystal_ball"],"1F52E",6],[["mask"],"1F637",1],[["tea"],"1F375",5],[["musical_score"],"1F3BC",3],[["snow_capped_mountain"],"1F3D4",4],[["ram"],"1F40F",2],[["prayer_beads"],"1F4FF",6],[["face_with_thermometer"],"1F912",1],[["sake"],"1F376",5],[["musical_keyboard"],"1F3B9",3],[["sheep"],"1F411",2],[["barber"],"1F488",6],[["mount_fuji"],"1F5FB",4],[["face_with_head_bandage"],"1F915",1],[["alembic"],"2697",6],[["volcano"],"1F30B",4],[["beer"],"1F37A",5],[["dog2"],"1F415",2],[["smiling_imp"],"1F608",1],[["drum_with_drumsticks"],"1F941",3],[["beers"],"1F37B",5],[["saxophone"],"1F3B7",3],[["desert"],"1F3DC",4],[["poodle"],"1F429",2],[["imp"],"1F47F",1],[["telescope"],"1F52D",6],[["trumpet"],"1F3BA",3],[["camping"],"1F3D5",4],[["cat2"],"1F408",2],[["japanese_ogre"],"1F479",1],[["microscope"],"1F52C",6],[["clinking_glasses"],"1F942",5],[["tent"],"26FA",4],[["wine_glass"],"1F377",5],[["guitar"],"1F3B8",3],[["rooster"],"1F413",2],[["japanese_goblin"],"1F47A",1],[["hole"],"1F573",6],[["violin"],"1F3BB",3],[["pill"],"1F48A",6],[["hankey","poop","shit"],"1F4A9",1],[["railway_track"],"1F6E4",4],[["tumbler_glass"],"1F943",5],[["turkey"],"1F983",2],[["cocktail"],"1F378",5],[["game_die"],"1F3B2",3],[["ghost"],"1F47B",1],[["syringe"],"1F489",6],[["dove_of_peace"],"1F54A",2],[["motorway"],"1F6E3",4],[["thermometer"],"1F321",6],[["tropical_drink"],"1F379",5],[["dart"],"1F3AF",3],[["building_construction"],"1F3D7",4],[["rabbit2"],"1F407",2],[["skull"],"1F480",1],[["skull_and_crossbones"],"2620",1],[["champagne"],"1F37E",5],[["bowling"],"1F3B3",3],[["factory"],"1F3ED",4],[["mouse2"],"1F401",2],[["toilet"],"1F6BD",6],[["video_game"],"1F3AE",3],[["house"],"1F3E0",4],[["rat"],"1F400",2],[["alien"],"1F47D",1],[["potable_water"],"1F6B0",6],[["spoon"],"1F944",5],[["fork_and_knife"],"1F374",5],[["slot_machine"],"1F3B0",3],[["house_with_garden"],"1F3E1",4],[["chipmunk"],"1F43F",2],[["space_invader"],"1F47E",1],[["shower"],"1F6BF",6],[["knife_fork_plate"],"1F37D",5],[["house_buildings"],"1F3D8",4],[["feet","paw_prints"],"1F43E",2],[["bathtub"],"1F6C1",6],[["robot_face"],"1F916",1],[["jack_o_lantern"],"1F383",1],[["derelict_house_building"],"1F3DA",4],[["dragon"],"1F409",2],[["bath"],"1F6C0",6],[["office"],"1F3E2",4],[["dragon_face"],"1F432",2],[["smiley_cat"],"1F63A",1],[["bellhop_bell"],"1F6CE",6],[["cactus"],"1F335",2],[["department_store"],"1F3EC",4],[["key"],"1F511",6],[["smile_cat"],"1F638",1],[["christmas_tree"],"1F384",2],[["post_office"],"1F3E3",4],[["old_key"],"1F5DD",6],[["joy_cat"],"1F639",1],[["evergreen_tree"],"1F332",2],[["european_post_office"],"1F3E4",4],[["heart_eyes_cat"],"1F63B",1],[["door"],"1F6AA",6],[["deciduous_tree"],"1F333",2],[["hospital"],"1F3E5",4],[["smirk_cat"],"1F63C",1],[["couch_and_lamp"],"1F6CB",6],[["palm_tree"],"1F334",2],[["bank"],"1F3E6",4],[["kissing_cat"],"1F63D",1],[["bed"],"1F6CF",6],[["seedling"],"1F331",2],[["hotel"],"1F3E8",4],[["scream_cat"],"1F640",1],[["sleeping_accommodation"],"1F6CC",6],[["herb"],"1F33F",2],[["convenience_store"],"1F3EA",4],[["frame_with_picture"],"1F5BC",6],[["crying_cat_face"],"1F63F",1],[["shamrock"],"2618",2],[["school"],"1F3EB",4],[["pouting_cat"],"1F63E",1],[["shopping_bags"],"1F6CD",6],[["four_leaf_clover"],"1F340",2],[["love_hotel"],"1F3E9",4],[["open_hands"],"1F450",1],[["shopping_trolley"],"1F6D2",6],[["gift"],"1F381",6],[["bamboo"],"1F38D",2],[["wedding"],"1F492",4],[["raised_hands"],"1F64C",1],[["balloon"],"1F388",6],[["tanabata_tree"],"1F38B",2],[["classical_building"],"1F3DB",4],[["clap"],"1F44F",1],[["church"],"26EA",4],[["leaves"],"1F343",2],[["flags"],"1F38F",6],[["pray"],"1F64F",1],[["fallen_leaf"],"1F342",2],[["ribbon"],"1F380",6],[["mosque"],"1F54C",4],[["handshake"],"1F91D",1],[["maple_leaf"],"1F341",2],[["confetti_ball"],"1F38A",6],[["+1","thumbsup"],"1F44D",1],[["synagogue"],"1F54D",4],[["mushroom"],"1F344",2],[["tada"],"1F389",6],[["-1","thumbsdown"],"1F44E",1],[["kaaba"],"1F54B",4],[["shinto_shrine"],"26E9",4],[["ear_of_rice"],"1F33E",2],[["dolls"],"1F38E",6],[["facepunch","punch"],"1F44A",1],[["fist"],"270A",1],[["izakaya_lantern","lantern"],"1F3EE",6],[["bouquet"],"1F490",2],[["japan"],"1F5FE",4],[["tulip"],"1F337",2],[["wind_chime"],"1F390",6],[["rice_scene"],"1F391",4],[["left-facing_fist"],"1F91B",1],[["email","envelope"],"2709",6],[["rose"],"1F339",2],[["national_park"],"1F3DE",4],[["right-facing_fist"],"1F91C",1],[["sunrise"],"1F305",4],[["envelope_with_arrow"],"1F4E9",6],[["hand_with_index_and_middle_fingers_crossed"],"1F91E",1],[["wilted_flower"],"1F940",2],[["v"],"270C",1],[["sunrise_over_mountains"],"1F304",4],[["sunflower"],"1F33B",2],[["incoming_envelope"],"1F4E8",6],[["stars"],"1F320",4],[["blossom"],"1F33C",2],[["e-mail"],"1F4E7",6],[["the_horns","sign_of_the_horns"],"1F918",1],[["cherry_blossom"],"1F338",2],[["sparkler"],"1F387",4],[["ok_hand"],"1F44C",1],[["love_letter"],"1F48C",6],[["hibiscus"],"1F33A",2],[["fireworks"],"1F386",4],[["point_left"],"1F448",1],[["inbox_tray"],"1F4E5",6],[["city_sunrise"],"1F307",4],[["earth_americas"],"1F30E",2],[["point_right"],"1F449",1],[["outbox_tray"],"1F4E4",6],[["city_sunset"],"1F306",4],[["earth_africa"],"1F30D",2],[["point_up_2"],"1F446",1],[["package"],"1F4E6",6],[["earth_asia"],"1F30F",2],[["cityscape"],"1F3D9",4],[["label"],"1F3F7",6],[["point_down"],"1F447",1],[["point_up"],"261D",1],[["night_with_stars"],"1F303",4],[["full_moon"],"1F315",2],[["mailbox_closed"],"1F4EA",6],[["hand","raised_hand"],"270B",1],[["milky_way"],"1F30C",4],[["waning_gibbous_moon"],"1F316",2],[["mailbox"],"1F4EB",6],[["bridge_at_night"],"1F309",4],[["last_quarter_moon"],"1F317",2],[["mailbox_with_mail"],"1F4EC",6],[["raised_back_of_hand"],"1F91A",1],[["foggy"],"1F301",4],[["waning_crescent_moon"],"1F318",2],[["mailbox_with_no_mail"],"1F4ED",6],[["raised_hand_with_fingers_splayed"],"1F590",1],[["new_moon"],"1F311",2],[["postbox"],"1F4EE",6],[["spock-hand"],"1F596",1],[["waxing_crescent_moon"],"1F312",2],[["wave"],"1F44B",1],[["postal_horn"],"1F4EF",6],[["first_quarter_moon"],"1F313",2],[["scroll"],"1F4DC",6],[["call_me_hand"],"1F919",1],[["moon","waxing_gibbous_moon"],"1F314",2],[["muscle"],"1F4AA",1],[["page_with_curl"],"1F4C3",6],[["new_moon_with_face"],"1F31A",2],[["page_facing_up"],"1F4C4",6],[["middle_finger","reversed_hand_with_middle_finger_extended"],"1F595",1],[["writing_hand"],"270D",1],[["full_moon_with_face"],"1F31D",2],[["bookmark_tabs"],"1F4D1",6],[["sun_with_face"],"1F31E",2],[["bar_chart"],"1F4CA",6],[["selfie"],"1F933",1],[["first_quarter_moon_with_face"],"1F31B",2],[["nail_care"],"1F485",1],[["chart_with_upwards_trend"],"1F4C8",6],[["last_quarter_moon_with_face"],"1F31C",2],[["ring"],"1F48D",1],[["chart_with_downwards_trend"],"1F4C9",6],[["crescent_moon"],"1F319",2],[["lipstick"],"1F484",1],[["spiral_note_pad"],"1F5D2",6],[["kiss"],"1F48B",1],[["dizzy"],"1F4AB",2],[["spiral_calendar_pad"],"1F5D3",6],[["star"],"2B50",2],[["lips"],"1F444",1],[["calendar"],"1F4C6",6],[["star2"],"1F31F",2],[["tongue"],"1F445",1],[["date"],"1F4C5",6],[["sparkles"],"2728",2],[["ear"],"1F442",1],[["card_index"],"1F4C7",6],[["zap"],"26A1",2],[["nose"],"1F443",1],[["card_file_box"],"1F5C3",6],[["footprints"],"1F463",1],[["fire"],"1F525",2],[["ballot_box_with_ballot"],"1F5F3",6],[["eye"],"1F441",1],[["boom","collision"],"1F4A5",2],[["file_cabinet"],"1F5C4",6],[["comet"],"2604",2],[["eyes"],"1F440",1],[["clipboard"],"1F4CB",6],[["sunny"],"2600",2],[["file_folder"],"1F4C1",6],[["speaking_head_in_silhouette"],"1F5E3",1],[["mostly_sunny","sun_small_cloud"],"1F324",2],[["bust_in_silhouette"],"1F464",1],[["open_file_folder"],"1F4C2",6],[["partly_sunny"],"26C5",2],[["busts_in_silhouette"],"1F465",1],[["card_index_dividers"],"1F5C2",6],[["barely_sunny","sun_behind_cloud"],"1F325",2],[["baby"],"1F476",1],[["rolled_up_newspaper"],"1F5DE",6],[["partly_sunny_rain","sun_behind_rain_cloud"],"1F326",2],[["boy"],"1F466",1],[["newspaper"],"1F4F0",6],[["rainbow"],"1F308",2],[["girl"],"1F467",1],[["notebook"],"1F4D3",6],[["cloud"],"2601",2],[["man"],"1F468",1],[["notebook_with_decorative_cover"],"1F4D4",6],[["rain_cloud"],"1F327",2],[["woman"],"1F469",1],[["ledger"],"1F4D2",6],[["thunder_cloud_and_rain"],"26C8",2],[["closed_book"],"1F4D5",6],[["lightning","lightning_cloud"],"1F329",2],[["person_with_blond_hair"],"1F471",1],[["green_book"],"1F4D7",6],[["snow_cloud"],"1F328",2],[["older_man"],"1F474",1],[["blue_book"],"1F4D8",6],[["snowman"],"2603",2],[["older_woman"],"1F475",1],[["orange_book"],"1F4D9",6],[["snowman_without_snow"],"26C4",2],[["man_with_gua_pi_mao"],"1F472",1],[["books"],"1F4DA",6],[["snowflake"],"2744",2],[["book","open_book"],"1F4D6",6],[["wind_blowing_face"],"1F32C",2],[["man_with_turban"],"1F473",1],[["bookmark"],"1F516",6],[["dash"],"1F4A8",2],[["link"],"1F517",6],[["tornado","tornado_cloud"],"1F32A",2],[["cop"],"1F46E",1],[["paperclip"],"1F4CE",6],[["fog"],"1F32B",2],[["linked_paperclips"],"1F587",6],[["ocean"],"1F30A",2],[["construction_worker"],"1F477",1],[["triangular_ruler"],"1F4D0",6],[["droplet"],"1F4A7",2],[["straight_ruler"],"1F4CF",6],[["guardsman"],"1F482",1],[["sweat_drops"],"1F4A6",2],[["pushpin"],"1F4CC",6],[["umbrella_with_rain_drops"],"2614",2],[["round_pushpin"],"1F4CD",6],[["scissors"],"2702",6],[["sleuth_or_spy"],"1F575",1],[["lower_left_ballpoint_pen"],"1F58A",6],[["lower_left_fountain_pen"],"1F58B",6],[["black_nib"],"2712",6],[["lower_left_paintbrush"],"1F58C",6],[["lower_left_crayon"],"1F58D",6],[["memo","pencil"],"1F4DD",6],[["pencil2"],"270F",6],[["mag"],"1F50D",6],[["mag_right"],"1F50E",6],[["lock_with_ink_pen"],"1F50F",6],[["closed_lock_with_key"],"1F510",6],[["lock"],"1F512",6],[["unlock"],"1F513",6],[["mother_christmas"],"1F936",1],[["santa"],"1F385",1],[["princess"],"1F478",1],[["prince"],"1F934",1],[["bride_with_veil"],"1F470",1],[["man_in_tuxedo"],"1F935",1],[["angel"],"1F47C",1],[["pregnant_woman"],"1F930",1],[["bow"],"1F647",1],[["information_desk_person"],"1F481",1],[["no_good"],"1F645",1],[["ok_woman"],"1F646",1],[["raising_hand"],"1F64B",1],[["face_palm"],"1F926",1],[["shrug"],"1F937",1],[["person_with_pouting_face"],"1F64E",1],[["person_frowning"],"1F64D",1],[["haircut"],"1F487",1],[["massage"],"1F486",1],[["man_in_business_suit_levitating"],"1F574",1],[["dancer"],"1F483",1],[["man_dancing"],"1F57A",1],[["dancers"],"1F46F",1],[["walking"],"1F6B6",1],[["runner","running"],"1F3C3",1],[["couple","man_and_woman_holding_hands"],"1F46B",1],[["two_women_holding_hands"],"1F46D",1],[["two_men_holding_hands"],"1F46C",1],[["family","man-woman-boy"],"1F46A",1],[["hearts"],"2665",7],[["womans_clothes"],"1F45A",1],[["shirt","tshirt"],"1F455",1],[["jeans"],"1F456",1],[["necktie"],"1F454",1],[["dress"],"1F457",1],[["bikini"],"1F459",1],[["kimono"],"1F458",1],[["high_heel"],"1F460",1],[["sandal"],"1F461",1],[["boot"],"1F462",1],[["mans_shoe","shoe"],"1F45E",1],[["athletic_shoe"],"1F45F",1],[["womans_hat"],"1F452",1],[["tophat"],"1F3A9",1],[["mortar_board"],"1F393",1],[["crown"],"1F451",1],[["helmet_with_white_cross"],"26D1",1],[["school_satchel"],"1F392",1],[["pouch"],"1F45D",1],[["purse"],"1F45B",1],[["handbag"],"1F45C",1],[["briefcase"],"1F4BC",1],[["eyeglasses"],"1F453",1],[["dark_sunglasses"],"1F576",1],[["closed_umbrella"],"1F302",1],[["umbrella"],"2602",1]],St=function(){function t(t){this.app=t,this.data=xt,this.buildNameMap(),this.emojiRegExp=/:([^ :]+)/gi,this.symbol=":"}return t.prototype.emojis=function(){if(this._emojis)return this._emojis;var t=this._emojis=new webix.DataCollection({}),e=this.getEmojiData(xt);return t.parse(e),t},t.prototype.getEmojiData=function(t){return t.map((function(t){return{id:webix.uid(),name:t[0][0],unified:t[1],category:t[2],names:t[0]}}))},t.prototype.replaceEmoji=function(t){var e=this,i=t.match(this.emojiRegExp),n=this.symbol;return i&&i.forEach((function(i){i=i.replace(e.emojiRegExp,(function(t,e){return e}));var a=e.emojiNameMap[i];a&&(t=t.replace(n+i+n,"<span class='webix_chat_emoji webix_chat_emoji_"+a+"'></span>"))})),t},t.prototype.basicEmojis=function(){var t=this;if(this._basicEmojis)return this._basicEmojis;var e=this._basicEmojis=new webix.DataCollection({});return this.app.getService("backend").basicEmojis().then((function(i){var n=[];i.forEach((function(e){var i=t.findEmojiByName(e);i&&n.push(i)})),e.parse(t.getEmojiData(n))})),e},t.prototype.findEmojiByName=function(t){return xt.find((function(e){return-1!=e[0].indexOf(t)}))},t.prototype.findName=function(t,e){return e?t.names.find((function(t){return-1!=t.toLowerCase().indexOf(e)})):t.name},t.prototype.buildNameMap=function(){var t=this;this.emojiNameMap={},xt.forEach((function(e){e[0].forEach((function(i){return t.emojiNameMap[i]=e[1]}))}))},t.prototype.shortNameToTitle=function(t){return(t=t.split("_").join(" "))[0].toUpperCase()+t.substring(1).toLowerCase()},t.prototype.categories=function(){return this._categories||(this._categories=[{id:"basic",icon:"chi-star-outline",name:"Basic"},{id:1,icon:"chi-emoticon-outline",name:"Smileys & People"},{id:2,icon:"chi-cat",name:"Animals & Nature"},{id:3,icon:"chi-soccer",name:"Activity"},{id:4,icon:"chi-earth",name:"Travel & Places"},{id:5,icon:"chi-food-fork-drink",name:"Food & Drink"},{id:7,icon:"chi-heart-outline",name:"Symbols"},{id:6,icon:"chi-bullhorn-outline",name:"Objects"}]),this._categories},t}(),Ct=function(t){function e(e){var i=this,a=N({chatId:0,chatType:null,userId:null,search:"",callStatus:0,callId:0,callUsers:[]}),o={state:a};e.compat&&(o.forceCompact=e.compact),e.reactions&&(e.emojis,1)&&(e.emojis=!0);var r={router:b,version:"10.0.1",debug:!0,start:"/top",mode:"full",compactWidth:650,params:{state:a,forceCompact:e.compact},files:!1};(i=t.call(this,n(n({},r),e))||this).config.debug&&(webix.Promise=window.Promise);var s,c,l,h=function(t){return i.config.override&&i.config.override.get(t)||t};return i.setService("local",new(h(vt))(i)),i.setService("backend",new(h(bt))(i)),i.setService("operations",new(h(wt))(i)),i.setService("upload",new(h(Ft))(i)),i.setService("helpers",new(h(yt))(i)),i.setService("emojis",new(h(St))(i)),l={updateConfig:function(t){var e=s.getRoot(),i=e.$view;c?c&&!i.id&&(i.id=c):(i.id?c=i.id:i.id=c="webix_"+webix.uid(),webix.html.addStyle(".webix_win_inside *:not(.webix_modal_box):not(.webix_modal_cover){ z-index: 0; }"),webix.html.addStyle("#"+c+"{ position: relative; }"),webix.html.addStyle("#"+c+" .webix_window{ z-index:2 !important; }"),webix.html.addStyle("#"+c+" .webix_disabled{ z-index:1 !important; }")),t.container=c,t.fullscreen&&(t._fillApp=!0,delete t.fullscreen),t.on||(t.on={});var n=!0,a=t.on.onShow;return t.on.onShow=function(){var t=this;a&&a.apply(this,arguments),n&&(this.$setSize=function(i,n){U(t,e,!0),webix.ui.window.prototype.$setSize.apply(t,[i,n])},V(this,s),n=null),webix.callEvent("onClick",[]),webix.html.addCss(i,"webix_win_inside"),e.disable(),U(this,e)},t}},(s=i).setService("jet-win",l),i.use(T,i.config.locale||{lang:"en",webix:{en:"en-US"}}),i}return i(e,t),e.prototype.render=function(e){var i=this,n=this.getService("backend");n.ready().then((function(){return n.callInfo()})).then((function(n){n&&n.id&&i.config.params.state.$batch({callId:n.id,callUsers:n.users,callStatus:n.status});t.prototype.render.call(i,e)}))},e.prototype.require=function(t,e){return"jet-views"===t?mt[e]:"jet-locales"===t?Et[e]:null},e.prototype.getState=function(){return this.config.params.state},e}(g);webix.protoUI({name:"chat",app:Ct,getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},$init:function(){this.$view.className+=" webix_chat";var t=this.$app.getState();for(var e in t)O(t,this.config,e)}},webix.ui.jetapp);var kt={Local:vt,Backend:bt,Operations:wt,Upload:Ft,Helpers:yt,Emojis:St},Et={en:{"Add members":"Add members","Are you sure to leave this chat?":"Are you sure to leave this chat?",Avatar:"Avatar","Are you sure to delete this member?":"Are you sure to delete this member?",Cancel:"Cancel","Change avatar":"Change avatar","Chat info":"Chat info","Chat name":"Chat name",Chats:"Chats","Create group":"Create group",Delete:"Delete","Delete member":"Delete member","Edit chat":"Edit chat",Leave:"Leave","Leave chat":"Leave chat",member:"member",members:"members",Members:"Members","New chat":"New chat","No people to add":"No people to add",People:"People",Save:"Save",Search:"Search","Show all members":"Show all members",Users:"Users",You:"You",Ringing:"Ringing...","Active call":"Active call","Is calling you":"Is calling you...",Accept:"Accept",Reject:"Reject","Start call":"Start call","Join call":"Join call","End call":"End call","Ended call":"Ended call","Incoming call":"Incoming call","Outgoing call":"Outgoing call","Rejected call":"Rejected call","Missed call":"Missed call","Can't start the call":"Can't start the call","Could not find your":"Could not find your","Error opening your":"Error opening your",microphone:"microphone",camera:"camera",Size:"Size",B:"B",KB:"KB",MB:"MB",GB:"GB","File size exceeds the limit":"File size exceeds the limit","File upload error":"File upload error","Smileys & People":"Smileys & People","Animals & Nature":"Animals & Nature",Activity:"Activity","Travel & Places":"Travel & Places","Food & Drink":"Food & Drink",Objects:"Objects","Search results":"Search results",Symbols:"Symbols",Basic:"Basic"}};t.App=Ct,t.locales=Et,t.services=kt,t.views=mt,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=chat.min.js.map
