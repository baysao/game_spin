/*
@license
Webix <%= pkg.productName %> v.<%= pkg.version %>
This software is covered by Webix Trial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).desktop={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function i(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var n=function(){return(n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=function(){},r=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)},t.prototype.getParam=function(t,e){var i=this._data[t];if(void 0!==i||!e)return i;var n=this.getParentView();return n?n.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(i){return(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,i){var n=t.attachEvent(e,i);return this._events.push({obj:t,id:n}),n},t.prototype.contains=function(t){for(var e in this._subs){var i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var i=e.view._getDefaultSub();if(i)return i}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function s(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),i=[],n=0;n<e.length;n++){var o=e[n],r={},s=o.indexOf(":");if(-1===s&&(s=o.indexOf("?")),-1!==s)for(var a=0,p=o.substr(s+1).split(/[\:\?\&]/g);a<p.length;a++){var u=p[a].split("=");r[u[0]]=decodeURIComponent(u[1])}i[n]={page:s>-1?o.substr(0,s):o,params:r,isNew:!0}}return i}function a(t){for(var e=[],i=0,n=t;i<n.length;i++){var o=n[i];e.push("/"+o.page);var r=p(o.params);r&&e.push("?"+r)}return e.join("")}function p(t){var e=[];for(var i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}var u=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:s(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var i=new t(this.route,this.index+this._next);return i.setParams(i.route.url,e,i.index),i},t.prototype.setParams=function(t,e,i){if(e){var n=t[i].params;for(var o in e)n[o]=e[o]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=a(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var i=this.route.url;if(null===t)return i;var n=this.route.url,o=!0;if(i=n.slice(0,this.index+(e?this._next:0)),t){i=i.concat(s(t));for(var r=0;r<i.length;r++)n[r]&&(i[r].view=n[r].view),o&&n[r]&&i[r].page===n[r].page?i[r].isNew=!1:i[r].isNew&&(o=!1)}return i},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=a(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,i){var n=this,r=this._join(t.url,i);return this.setParams(r,t.params,this.index+(i?this._next:0)),new Promise((function(t,i){var s=a(r),p={url:r,redirect:s,confirm:Promise.resolve()},u=e?e.app:null;if(u&&!u.callEvent("app:guard",[p.redirect,e,p]))return void i(new o);p.confirm.catch((function(t){return i(t)})).then((function(){if(null!==p.redirect){if(p.redirect!==s)return u.show(p.redirect),void i(new o);n.route.path=s,n.route.url=r,t()}else i(new o)}))}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=a(e.url)),new t(e,0)},t.prototype.update=function(t,e,i){var n=this.route.url[this.index+(i||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?n.page=e:n.params[t]=e,this.route.path=a(this.route.url)},t}(),h=function(t){function e(e,i){var n=t.call(this,e.webix)||this;return n.app=e,n._children=[],n}return i(e,t),e.prototype.ui=function(t,e){var i=(e=e||{}).container||t.container,n=this.app.createView(t);return this._children.push(n),n.render(i,this._segment,this),"object"!=typeof t||t instanceof r?n:n.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var i in t)this.setParam(i,t[i]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var n=this.getParentView();return n?n.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var o=this.getSubViewInfo(e.target);if(o){if(o.parent!==this)return o.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,o.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,i){var n=this;return t.show(e,i,!0).then((function(){return n._init_url_data(),n._urlChange()})).then((function(){t.route.linkRouter&&(n.app.getRouter().set(t.route.path,{silent:!0}),n.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,i){var n=this;"string"==typeof e&&(e=new u(e,0)),this._segment=e,this._parent=i,this._init_url_data();var o="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==o?(this._container=o,this._render(e)):this._urlChange().then((function(){return n.getRoot()}))},e.prototype._render=function(t){var e=this,i=this.config();return i.then?i.then((function(i){return e._render_final(i,t)})):this._render_final(i,t)},e.prototype._render_final=function(t,e){var i,n=this,o=null,r=null,s=!1;if(this._container.tagName?r=this._container:(o=this._container).popup?(r=document.body,s=!0):r=this.webix.$$(o.id),!this.app||!r)return Promise.reject(null);var a=this._segment.current(),p={ui:{}};this.app.copyConfig(t,p.ui,this._subs),this.app.callEvent("app:render",[this,e,p]),p.ui.$scope=this,!o&&a.isNew&&a.view&&a.view.destructor();try{if(o&&!s){var u=r,h=u.getParentView();h&&"multiview"===h.name&&!p.ui.id&&(p.ui.id=u.config.id)}this._root=this.app.webix.ui(p.ui,r);var c=this._root;s&&c.setPosition&&!c.isVisible()&&c.show(),o&&(o.view&&o.view!==this&&o.view!==this.app&&o.view.destructor(),o.id=this._root.config.id,this.getParentView()||!this.app.app?o.view=this:o.view=this.app),a.isNew&&(a.view=this,a.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((function(){return n._urlChange().then((function(){return n._initUrl=null,n.ready(n._root,e.suburl())}))}))}catch(t){i=Promise.reject(t)}return i.catch((function(t){return n._initError(n,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var i in this._subs){var n=this._subs[i],o=this._renderFrameLock(i,n,null);o&&e.push(o)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,i){if(!e.lock){var n=this._renderFrame(t,e,i);n&&(e.lock=n.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,i){var n=this;if("default"===t){if(this._segment.next()){var o=i?i.params:null;return e.params&&(o=this.webix.extend(o||{},e.params)),this._createSubView(e,this._segment.shift(o))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((function(){return n._createSubView(e,e.route)}));if(e.branch)return}var r=e.view;if(!r&&e.url){if("string"==typeof e.url)return e.route=new u(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||r instanceof e.url||(r=new(this.app._override(e.url))(this.app,"")),r||(r=e.url)}if(r)return r.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var i=this;return this.app.createFromURL(e.current()).then((function(n){return n.render(t,e,i)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(r),c=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._ui=i.ui,n}return i(e,t),e.prototype.config=function(){return this._ui},e}(h),l=function(){function t(t,e,i){this.path="",this.app=i}return t.prototype.set=function(t,e){this.path=t;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),f=!0,d=function(t){function e(e){var i=this,n=(e||{}).webix||window.webix;return e=n.extend({name:"App",version:"1.0",start:"/home"},e,!0),(i=t.call(this,n,e)||this).config=e,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return i(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,i){if((t instanceof r||"function"==typeof t&&t.prototype instanceof r)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);var n=t instanceof Array;for(var o in e=e||(n?[]:{}),t){var s=t[o];if("function"==typeof s&&s.prototype instanceof r&&(s={$subview:s}),!s||"object"!=typeof s||s instanceof this.webix.DataCollection||s instanceof RegExp||s instanceof Map)e[o]=s;else if(s instanceof Date)e[o]=new Date(s);else{var a=this.copyConfig(s,s instanceof Array?[]:{},i);null!==a&&(n?e.push(a):e[o]=a)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var i=e.getAttribute("trigger");if(i)return this._forView(e,(function(t){return t.app.trigger(i)})),t.cancelBubble=!0,t.preventDefault();var n=e.getAttribute("route");if(n)return this._forView(e,(function(t){return t.show(n)})),t.cancelBubble=!0,t.preventDefault()}var o=e.parentNode;o&&this.clickHandler(t,o)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,i=this.config.views,n=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(n="function"==typeof i?i(t):i[t])&&(t=n,n=null),n||("_hidden"===t?n={hidden:!0}:"_blank"===t?n={}:(t=t.replace(/\./g,"/"),n=this.require("jet-views",t)))}catch(e){n=this._loadError(t,e)}return n.then||(n=Promise.resolve(n)),n=n.then((function(t){return t.__esModule?t.default:t})).catch((function(i){return e._loadError(t,i)}))},e.prototype._forView=function(t,e){var i=this.webix.$$(t);i&&e(i.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(i){return e.createView(i,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e.prototype.createView=function(t,i,n){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:i,params:n,router:l});if(t.prototype instanceof r)return new t(this,{name:i,params:n});t=t(this)}return t instanceof r?t:new c(this,{name:i,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){var n=e[i].message;0===n.indexOf("Module build failed")?(n=n.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+n+"</pre>"):(n+="<br><br>Check console for more details",this.webix.message({type:"error",text:n,expire:-1}))}},e.prototype.render=function(t,e,i){var n=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var o=null;!this.$router?(f&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return n.clickHandler(t)})),f=!1),"string"==typeof e&&(e=new u(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0):o="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString();var r=i?i.params:this.config.params||null,s=this.getSubView(),a=this._subSegment,p=a.show({url:o,params:r},s).then((function(){return n.createFromURL(a.current())})).then((function(e){return e.render(t,a)})).then((function(t){return n.$router.set(a.route.path,{silent:!0}),n.callEvent("app:route",[n.getUrl()]),t}));return this.ready=this.ready.then((function(){return p})),p},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new h(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;this._segment=t;if(this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof o))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(i,"webixappstart"),e.webix.html.addCss(i,"webixapp")}),10)}if(t){if(this.app){var n=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new u(this.config.start,0),t.current().view=n}}else{var r=this.$router.get();r||(r=this.config.start,this.$router.set(r,{silent:!0})),t=new u(r,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,i){var n=!0!==t.$subview?t.$subview:null,o=t.name||(n?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[o]={id:e.id,url:n,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(r),g=function(){function t(t,e){var i=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return t.prototype.set=function(t,e){var i=this;if(this.config.routes){var n=t.split("?",2);for(var o in this.config.routes)if(this.config.routes[o]===n[0]){t=o+(n.length>1?"?"+n[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),v=!1;function w(t){if(!v&&t){v=!0;var e=window;e.Promise||(e.Promise=t.promise);var i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){var i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});var n=t.ui.baselayout.prototype.addView,o=t.ui.baselayout.prototype.removeView,r={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var i=this.$scope,o={};t=i.app.copyConfig(t,{},o),n.apply(this,[t,e]);var r=function(t){i._renderFrame(t,o[t],null).then((function(){i._subs[t]=o[t]}))};for(var s in o)r(s);return t.id}return n.apply(this,arguments)},removeView:function(){if(o.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var i in e){var n=e[i];t.$$(n.id)||(n.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,r,!0),t.extend(t.ui.baselayout.prototype,r,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}}var y=function(t){function e(e){var i;return e.router=e.router||g,w((i=t.call(this,e)||this).webix),i}return i(e,t),e.prototype.require=function(t,e){return require(t+"/"+e)},e}(d),m=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}i(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(g),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var i=this;this.path=t,e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function _(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function b(t,e,i){for(var n in t)_(t,n)&&e.call(i||t,t[n],n,t)}function x(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var $=String.prototype.replace,S=String.prototype.split,k=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},C={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:k,chinese:function(){return 0},croatian:k,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:k,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},A={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function W(t){var e,i=(e={},b(A,(function(t,i){b(t,(function(t){e[t]=i}))})),e);return i[t]||i[S.call(t,/-/,1)[0]]||i.en}function E(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var T=/\$/g,P=/%\{(.*?)\}/g;function I(t,e,i,n){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var o=t,r=n||P,s="number"==typeof e?{smart_count:e}:e;if(null!=s.smart_count&&o){var a=S.call(o,"||||");o=(a[function(t,e){return C[W(t)](e)}(i||"en",s.smart_count)]||a[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return o=$.call(o,r,(function(t,e){return _(s,e)&&null!=s[e]?$.call(s[e],T,"$$"):t}))}function L(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?I:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||x,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(E(e)+"(.*?)"+E(i),"g")}(e.interpolation)}L.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},L.prototype.extend=function(t,e){b(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.extend(t,n):this.phrases[n]=t}),this)},L.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:b(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.unset(t,n):delete this.phrases[n]}),this)},L.prototype.clear=function(){this.phrases={}},L.prototype.replace=function(t){this.clear(),this.extend(t)},L.prototype.t=function(t,e){var i,n,o=null==e?{}:e;if("string"==typeof this.phrases[t])i=this.phrases[t];else if("string"==typeof o._)i=o._;else if(this.onMissingKey){n=(0,this.onMissingKey)(t,o,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+t+'"'),n=t;return"string"==typeof i&&(n=I(i,o,this.currentLocale,this.tokenRegex)),n},L.prototype.has=function(t){return _(this.phrases,t)},L.transformPhrase=function(t,e,i){return I(t,e,i)};var H=L;var z=window.webix;z&&w(z);var V=function(t,e,i){var n=(i=i||{}).storage,o=n?n.get("lang")||"en":i.lang||"en";function r(e,r,s){r.__esModule&&(r=r.default);var p={phrases:r};i.polyglot&&t.webix.extend(p,i.polyglot);var u=a.polyglot=new H(p);if(u.locale(e),a._=t.webix.bind(u.t,u),o=e,n&&n.put("lang",o),i.webix){var h=i.webix[e];h&&t.webix.i18n.setLocale(h)}return s?Promise.resolve():t.refresh()}function s(e,n){if(!1!==i.path){var o=(i.path?i.path+"/":"")+e;r(e,t.require("jet-locales",o),n)}}var a={getLang:function(){return o},setLang:s,setLangData:r,_:null,polyglot:null};t.setService("locale",a),s(o,!0)},M=window;M.Promise||(M.Promise=M.webix.promise);var R=1;function D(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function j(t,e){e=e||{};var i={},n={},o=function(t,e){var o=R++;return i[o]={mask:t,handler:e},e("*"===t?n:n[t],void 0,t),o},r=[],s=!1,a=function(t,e,n,o){if(s)r.push([t,e,n,o]);else for(var a=Object.keys(i),p=0;p<a.length;p++){var u=i[a[p]];u&&("*"!==u.mask&&u.mask!==t||u.handler(n,e,t,o))}};return Object.defineProperty(n,"$changes",{value:{attachEvent:o,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$observe",{value:o,enumerable:!1,configurable:!1}),Object.defineProperty(n,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)n[t]=e[t]}}for(s=!0,t(n),s=!1;r.length;){var i=r.shift();a.apply(this,i)}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$extend",{value:function(t,i){for(var o in i=i||e,t)if(t.hasOwnProperty(o)){var r=t[o];i.nested&&"object"==typeof r&&r?n[o]=j(r,i):O(n,r,o,a)}},enumerable:!1,configurable:!1}),n.$extend(t,e),n}function O(t,e,i,n){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var o=e;e=t,n(i,o,t,null)}},enumerable:!0,configurable:!1})}webix.protoUI({name:"deskview",defaults:{grid:!1,drag:!0,select:!0,align:"left,top"},on_click:{webix_deskview_item:function(t,e){var i=this.config.select;i&&("multiselect"==i||this.config.multiselect?(this.getSelectedId()&&t.shiftKey&&(e=this.getSelectedRange(e)),this.select(e,!1,t.ctrlKey||t.metaKey||t.shiftKey)):this.select(e))}},$skin:function(){},on_dblclick:{},type:{height:110,width:100,padding:8,css:"desktop_tile",classname:function(t,e,i){var n="webix_deskview_item";return e.css&&(n+=" "+e.css),t.$css&&("object"==typeof t.$css&&(t.$css=webix.createCss(t.$css)),n+=" "+t.$css),i&&i.$css&&(n+=" "+i.$css),n},aria:function(t,e,i){return"role='option'"+(i&&i.webix_selected?" aria-selected='true' tabindex='0'":" tabindex='-1'")},iconTemplate:function(t,e){var i="webix_deskview_tile_icon",n=e.imgPath||"";return t.icon?'<img alt="'+t.name+'" class="'+i+'" src="'+(n+t.icon)+'"/>':"<div class='"+i+" webix_deskview_icon_default'></div>"},template:function(t,e){if(t.name){var i="<div class='webix_deskview_item_box'>";return(i+=e.iconTemplate(t,e))+'<div class="webix_deskview_tile_name">'+t.name+"</div></div>"}return""},templateStart:function(t,e,i){var n=e.width,o=e.height,r=e.padding/2,s=t.$x,a=t.$y;return'<div webix_l_id="'+t.id+'" class="'+e.classname(t,e,i)+" "+e.aria(t,e,i)+'" style="margin:'+r+"px;width:"+n+"px;height: "+o+"px;left: "+s+"px;top: "+a+'px; overflow:hidden;">'},templateEnd:webix.template("</div>")},$init:function(){var t=this;webix.html.addCss(this.$view,"webix_deskview"),this.data.provideApi(this,!0),this.attachEvent("onBeforeRender",(function(){t.$height&&t.setCells()})),this.attachEvent("onBeforeDrop",(function(e,i){return t.dropHandler(e,i)}));var e=webix.attachEvent("onDragMode",(function(e){"start"==e&&webix.DragControl.getContext().from==t&&t.DragStartHandler()}));this.attachEvent("onDestruct",(function(){webix.detachEvent(e)}))},setCells:function(){var t=this,e=this.data.getRange(),i=this.getXCount(),n=this.getYCount(),o=this.type.width,r=this.type.height,s={},a=this.config.align,p=a.indexOf("right")>-1?-1:1,u=a.indexOf("bottom")>-1?-1:1,h="x"==this.config.layout;e.forEach((function(e){if(e.$x&&e.$x>=i*o||e.$y&&e.$y>=n*r||void 0===e.$x)for(var a=void 0,c=h?u:p,l=h?p:u,f=h?n:i,d=h?i:n,g=c>0?0:f-1;t._forCheck(g,f,c)&&!a;g+=c)for(var v=l>0?0:d-1;t._forCheck(v,d,l)&&!a;v+=l){var w=(h?v:g)*t.type.width,y=(h?g:v)*t.type.height;s[g]&&s[g][v]||t.isAreaOccupied(w,y)||(e.$x=w,e.$y=y,a=!0),s[g]||(s[g]={}),s[g][v]=1}}))},_forCheck:function(t,e,i){return i>0&&t<e||i<0&&t>=0},sortTiles:function(t){this.data.blockEvent(),this.data.sort((function(t,e){return void 0!==t.$y?t.$x<e.$x?-1:t.$x>e.$x?1:t.$y<e.$y?-1:1:0})),this.data.unblockEvent(),t||this.refresh()},isAreaOccupied:function(t,e,i){var n=this.type.width,o=this.type.height,r=t+n,s=e+o;return this.data.find((function(a){if(void 0!==a.$x){var p=a.$x,u=a.$y;return!(r<=p||t>=p+n||s<=u||e>=u+o||i&&a.id==i)}}),!0)},getXCount:function(){return Math.floor(this.$width/this.type.width)},getYCount:function(){var t=this.getXCount(),e=Math.floor(this.$height/this.type.height),i=this.data.order;return t*e<i.length&&t&&(e=Math.ceil(i.length/t)),e},dropHandler:function(t,e){var i=this;if(t.to==this&&t.from==this){this.sortTiles(!0);var n,o,r=t.start,s=t.target;if(!r)return!1;var a=t.source;a.length>1&&(n=webix.html.offset(this.getItemNode(t.start))),a.forEach((function(a){if(r==a&&s&&s!=a)i.moveNext(a,s);else{var p=webix.html.pos(e),u=p.x,h=p.y;r!=a&&(u+=(o=webix.html.offset(i.getItemNode(a))).x-n.x,h+=o.y-n.y);var c=i.getScrollState(),l=u+t.x_offset+c.x-i.$view.offsetLeft,f=h+t.y_offset+c.y-i.$view.offsetTop;i.moveToPos(a,l,f)}}))}return!1},moveToPos:function(t,e,i){var n=this.type.width,o=this.type.height;this.config.grid&&(e=Math.round(e/n)*n,i=Math.round(i/o)*o),e=Math.max(0,Math.min(e,(this.getXCount()-1)*n)),i=Math.max(0,Math.min(i,(this.getYCount()-1)*o));var r=this.isAreaOccupied(e,i,t);r?this.moveNext(t,r.id):this.updateItem(t,{$x:Math.max(e,0),$y:Math.max(i,0)})},moveNext:function(t,e,i){var n,o,r=this.type.width,s=this.type.height,a=this.getXCount(),p=this.getYCount();i=i||1;for(var u=this.getItem(e),h=Math.round(u.$x/r),c=Math.round(u.$y/s);i>0&&h<a||i<0&&h>=0;h+=i){for(;i>0&&c<p||i<0&&c>=0;){if(n=h*this.type.width,o=c*this.type.height,!this.isAreaOccupied(n,o,t))return this.updateItem(t,{$x:n,$y:o});if(i>0&&h==a-1&&c==p-1)return this.moveNext(t,e,-1);c+=i}c=i>0?0:p-1}},$getSize:function(t,e){return webix.ui.proto.prototype.$getSize.call(this,t,e)},$setSize:function(t,e){return webix.ui.proto.prototype.$setSize.call(this,t,e),this.callEvent("onSetSize",[]),!0},getSelectedRange:function(t){var e=this,i=this.getSelectedId(!0).pop(),n=this.getItem(i),o=this.getItem(t),r=n.$x,s=n.$y,a=o.$x,p=o.$y;return this.data.find((function(t){var i=t.$x,n=t.$y;return!e.data.getMark(t.id,"webix_selected")&&(s>p?n>p&&n<s||n==p&&a<i||n==s&&r>i:s<p?n<p&&n>s||n==p&&a>i||n==s&&r<i:r<a&&i<a&&i>r||r>a&&i>a&&i<r)})).map((function(t){return t.id})).concat([t])},DragStartHandler:function(){var t=webix.DragControl.getNode();t&&(t.className+=" webix_dsk_drag_zone")}},webix.ui.list);var B=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return this.MaxCount=4,this.SetPosition(),{view:"popup",css:"webix_dsk_submenu",padding:0,point:0,body:{localId:"menu",rows:[{view:"list",localId:"list",yCount:1,width:200,template:"<div class='webix_dsk_submenu_title'>#title# </div><div class='webix_icon wxi-close'></div>",data:[],on:{onItemClick:function(e){t.app.callEvent("onWindowSelect",[t.List.getItem(e).appId,e])}},onClick:{"wxi-close":function(e,i){return t.app.callEvent("onCloseAppClick",[t.List.getItem(i).appId,i]),!1}}},this.BottomTemplate()]}}},e.prototype.init=function(){this.List=this.$$("list"),this.View=this.getRoot(),this.Apps=this.app.getService("local").apps(),this.Wins=this.app.getService("windows")},e.prototype.SetPosition=function(){var t=this.app.config.barPosition;this.Position={top:{pos:"bottom",x:-20},bottom:{pos:"top",x:-20,y:2},left:{pos:"right"},right:{pos:"left"}}[t]},e.prototype.GetData=function(t){var e=this.Wins.getWindows(t);if(!e)return null;var i=this.Apps.getItem(t),n=i.tooltip||function(){return i.name};return e.map((function(e){return{id:e.config.id,title:n(e.$desktopOptions),appId:t}}))},e.prototype.Update=function(t){this.List.clearAll();var e=this.GetData(t),i=e?e.length:0;this.List.config.yCount=Math.min(i,this.MaxCount);var n=i>1?"multi":"one";return this.View.getBody().showBatch(n),i&&this.List.parse(e),this.List.resize(),i},e.prototype.ShowData=function(t,e){this.Id=e,this.Update(e)?this.Show(t):this.View.hide()},e.prototype.Show=function(t){this.View.show(t,this.Position)},e.prototype.BottomTemplate=function(){var t=this,e=this.app.getService("locale")._;return{height:webix.skin.$active.listItemHeight,batch:"multi",css:"webix_dsk_close_all",template:"<span class='webix_dsk_close_inner'>"+e("Close all")+"</span>",onClick:{webix_dsk_close_inner:function(){return t.CloseAll()}}}},e.prototype.CloseAll=function(){this.Wins.closeApp(this.Id)},e}(h),U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.GetSize(),i={view:"layout",margin:0,css:"webix_dsk_toolbar"},n={view:"template",borderless:!0,width:e,height:e,css:"webix_dsk_start_button",template:"<span class='webix_icon dsi-menu'></span>",onClick:{webix_dsk_start_button:function(e,i,n){return t.app.callEvent("onMenuClick",[n])}}},o=this.app.config.barPosition,r="left"==o||"right"==o?"y":"x",s={view:"list",localId:"buttonList",borderless:!0,scroll:r,layout:r,select:!0,data:[],css:"webix_dsk_toolbar_buttons",type:{width:e,height:e,template:function(e){return t.BarTemplate(e)}},on:{onItemClick:function(e,i,n){return t.ButtonClickHandler(e,n)},onMouseMove:function(e,i,n){return t.MouseMoveHandler(e,i,n)}}};return i["left"==o||"right"==o?"rows":"cols"]=[n,s],i},e.prototype.init=function(){var t=this;this.ToolbarMenu=this.ui(B),this.Wins=this.app.getService("windows"),this.Helpers=this.app.getService("helpers"),this.Apps=this.app.getService("local").apps(),this.List=this.$$("buttonList"),this.on(this.app,"onWinShow",(function(e){return t.WinShowHandler(e)})),this.on(this.app,"onWinClose",(function(e){return t.WinCloseHandler(e)})),this.on(this.app,"onWinHide",(function(e){return t.WinHideHandler(e)})),this.on(this.app,"onCloseAppClick",(function(e){t.ShowTooltip(e,t.List.getItemNode(e))})),this.on(this.app,"onWindowActivation",(function(e){return t.List.select(e)})),this.LoadApps(),this.on(this.Apps.data,"onStoreUpdated",(function(){return t.LoadApps()}))},e.prototype.GetSize=function(){return webix.skin.$active.barHeight},e.prototype.LoadApps=function(){this.List.clearAll();var t=[];this.Apps.data.each((function(e){e.pin&&-1!=e.pin.indexOf("bar")&&t.push(n(n({},e),{pinned:!0}))})),this.List.parse(t)},e.prototype.ButtonClickHandler=function(t,e){var i=this.Wins.getWindows(t);i?i.length>1?this.ShowTooltip(t,e):this.Wins.show(t):this.app.callEvent("onDesktopAppClick",[t])},e.prototype.MouseMoveHandler=function(t,e,i){this.ShowTooltip(t,i)},e.prototype.ShowTooltip=function(t,e){this.ToolbarMenu.ShowData(e,t)},e.prototype.WinShowHandler=function(t){this.List.getItem(t)||this.List.add(this.Apps.getItem(t)),this.List.select(t),this.List.refresh(t)},e.prototype.WinCloseHandler=function(t){this.Wins.getWindows(t)||this.List.getItem(t).pinned?this.List.refresh(t):this.List.remove(t);var e=this.Wins.getTopWindowId();e?this.List.select(e):this.List.unselectAll()},e.prototype.WinHideHandler=function(){var t=this.Wins.getTopWindowId();t?this.List.select(t):this.List.unselectAll()},e.prototype.BarTemplate=function(t){var e=this.Helpers.iconTemplate(t,"webix_dsk_bar_app_icon"),i=this.Wins.getWindows(t.id),n=i?i.length:0,o=n?"<div class='webix_dsk_bar_button_border_inner'></div>":"";return n>1&&(o+="<div class='webix_dsk_bar_button_border_multiple'></div>"),"<div class='webix_dsk_bar_button' title='"+(n?"":t.name)+"'>"+e+"<div class='webix_dsk_bar_button_border'>"+o+"</div></div>"},e}(h),N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.State=this.getParam("state",!0),i={css:"webix_dsk_tiles",borderless:!0,type:"clean"},n="mini"==webix.skin.$name||"compact"==webix.skin.$name,o={view:"deskview",minWidth:200,minHeight:200,localId:"tiles",multiselect:this.app.config.multiselect,layout:e.tileLayout,align:e.tileAlign,grid:e.grid,onContext:{},type:{width:n?90:100,height:n?100:110,imgPath:this.app.config.appIconPath,iconTemplate:function(e){return t.DesktopIconTemplate(e)}}},r=this.app.config.barPosition,s="left"==r||"top"==r?0:1;return(i["left"==r||"right"==r?"cols":"rows"]=[o]).splice(s,0,U),i},e.prototype.init=function(){var t=this;this.Apps=this.app.getService("local").apps(),this.Wins=this.app.getService("windows"),this.Helpers=this.app.getService("helpers"),this.Tiles=this.$$("tiles"),this.on(this.Tiles,"onSetSize",(function(){return t.SetBox()})),this.on(this.Tiles,"onItemClick",(function(e,i){return t.ItemClickHandler(e,i)})),this.on(this.Tiles,"onEnter",(function(){return t.EnterHandler()})),this.on(this.webix,"onClick",(function(e){e&&t.ClickHandler(e)})),this.on(this.Tiles,"onBeforeDrag",(function(e){t.BeforeDrag(e)})),this.on(this.app,"onCloseAppClick",(function(e,i){t.CloseWin(e,i)})),this.on(this.State.$changes,"tileLayout",(function(e,i){i&&t.SetTilesConfig("layout",e,!0)})),this.on(this.State.$changes,"tileAlign",(function(e,i){i&&t.SetTilesConfig("align",e,!0)})),this.on(this.State.$changes,"grid",(function(e){t.SetTilesConfig("grid",e)})),this.SetBox(),webix.delay((function(){t.Tiles.$destructed||(t.LoadApps(),t.on(t.Apps.data,"onStoreUpdated",(function(){return t.LoadApps()})))}))},e.prototype.EnterHandler=function(){var t=this.Tiles.getSelectedId();t&&this.ClickHandler(t)},e.prototype.ItemClickHandler=function(t,e){var i=e&&(e.ctrlKey||e.metaKey),n=e&&e.shiftKey,o=this.Tiles.getItem(t);i||n||o.name&&this.app.callEvent("onDesktopAppClick",[t])},e.prototype.ClickHandler=function(t){this.Tiles&&t.target==this.Tiles.$view&&this.Tiles.unselect()},e.prototype.BeforeDrag=function(t){t.source&&t.source.length<2&&this.Tiles.select(t.start)},e.prototype.SetTilesConfig=function(t,e,i){this.Tiles.define(t,e),i&&this.LoadApps(!0)},e.prototype.LoadApps=function(t){this.Tiles.clearAll();var e=[];this.Apps.data.each((function(t){var i=t.pin;i&&-1!=i.indexOf("desktop")&&e.push(t)})),t&&e.forEach((function(t){delete t.$x,delete t.$y})),this.Tiles.parse(e)},e.prototype.CloseWin=function(t,e){this.Wins.closeWin(t,webix.$$(e))},e.prototype.SetBox=function(){var t=webix.html.offset(this.Tiles.$view);t.left=t.x,t.top=t.y,this.State.box=t},e.prototype.DesktopIconTemplate=function(t){return this.Helpers.iconTemplate(t,"webix_deskview_tile_icon")},e}(h);webix.protoUI({name:"menutiles",type:{maxWidth:170},$getSize:function(t,e){var i=this.data.count();if(i){var n=this.getTopParentView().$width;this.MinTileWidth||(this.MinTileWidth=this.type.width);var o=Math.min(n/7,this.type.maxWidth);this.type.width=Math.max(this.MinTileWidth,o);var r=(n-30*n/400)/this.type.width;this.config.xCount=Math.floor(Math.min(i,r))}return webix.ui.dataview.prototype.$getSize.call(this,t,e)}},webix.ui.dataview);var F=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return{view:"popup",hidden:!0,borderless:!0,css:"webix_dsk_menu",head:!1,body:{type:"clean",margin:15,padding:{top:20,bottom:10},rows:[{cols:[{},{view:"search",maxWidth:400,minWidth:200,localId:"search"},{}]},{borderless:!0,view:"scrollview",body:{cols:[{},{view:"menutiles",localId:"apps",onContext:{},xCount:4,borderless:!0,css:"webix_dsk_menu_tiles",type:{type:"tiles",width:100,height:120,template:function(e){return t.AppTemplate(e)}},scheme:{$sort:this.SchemeSort()},autoheight:!0,data:[],on:{onItemClick:function(e){return t.ClickHandler(e)}}},{}]},scroll:!0}]}}},e.prototype.init=function(){var t=this,e=this.app.getState();this.Helpers=this.app.getService("helpers"),this.Apps=this.app.getService("local").apps(),this.Tiles=this.$$("apps");var i=this.View=this.getRoot();this.on(this.Tiles,"onEnter",(function(){return t.EnterHandler()})),this.$$("search").attachEvent("onTimedKeyPress",(function(){t.FilterApps(t.$$("search").getValue())})),this.on(e.$changes,"systemParams",(function(){i.hide()})),i.attachEvent("onHide",(function(){return t.FilterApps(!1)})),i.attachEvent("onShow",(function(){return t.$$("apps").refresh()})),this.on(e.$changes,"box",(function(e){e&&t.Resize(e)})),this.LoadApps(),this.on(this.Apps.data,"onStoreUpdated",(function(){return t.LoadApps()}))},e.prototype.Resize=function(t){this.View.config.width=t.width,this.View.config.height=t.height,this.View.setPosition(t.left,t.top),this.View.resize()},e.prototype.SchemeSort=function(){return{by:"name",dir:"asc"}},e.prototype.LoadApps=function(){this.Tiles.clearAll(),this.Tiles.parse(this.Apps),this.Tiles.resize()},e.prototype.FilterApps=function(t){t?(t=t.toLowerCase(),this.Tiles.filter((function(e){return-1!=e.name.toLowerCase().indexOf(t)}))):(this.Tiles.filter(),this.$$("search").setValue("")),this.Tiles.resize()},e.prototype.AppTemplate=function(t){return this.Helpers.iconTemplate(t,"webix_dsk_menu_app_icon")+"<div class='webix_dsk_menu_app_name'>"+t.name+"</div>"},e.prototype.Show=function(){var t=this;this.View.isVisible()||this.webix.delay((function(){t.View.$destructed||t.View.show()}))},e.prototype.ClickHandler=function(t){this.View.hide(),this.app.callEvent("onDesktopAppClick",[t])},e.prototype.EnterHandler=function(){var t=this.Tiles.getSelectedId();t&&this.ClickHandler(t)},e}(h),K=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{css:"webix_dsk_signin"}},e}(h),q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{css:"webix_dsk_main",borderless:!0,cols:[{$subview:!0}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state"),this.Local=this.app.getService("local"),this.Apps=this.Local.apps(),this.app.config.apps&&this.Apps.parse(this.app.config.apps),this.Wins=this.app.getService("windows"),this.on(this.app,"onDesktopAppClick",(function(e){return t.AppClickHandler(e)})),this.on(this.app,"onWindowSelect",(function(e,i){return t.ShowWindow(e,i)})),this.on(this.app,"onMenuClick",(function(){return t.ShowMenu()})),this.on(this.State.$changes,"systemParams",(function(e){e?t.show("desk"):(t.Wins.closeAll(),t.Local.clearAppHandlers(),t.show("signout"))})),this.on(this.app,"onWinResize",(function(e,i){return t.ResizeApp(e,i)})),this.on(this.app,"onBeforeWinClose",(function(e,i){return t.CloseApp(e,i)})),this.on(this.app,"onWinHide",(function(e,i){return t.HideApp(e,i)})),this.on(this.app,"onWinShow",(function(e,i,n){return t.ShowApp(e,i,n)})),this.on(this.State.$changes,"box",(function(e){e&&(t.app.config.compact?t.Wins.resizeWins(e):t.Wins.adjustWins(e))})),this.on(this.Apps.data,"onStoreUpdated",(function(e,i,n){"delete"==n?t.Wins.closeApp(e):"update"==n&&t.Wins.rename(e,i.name,i.icon)})),this.on(this.Apps.data,"onClearAll",(function(){t.Wins.closeAll()}))},e.prototype.ShowMenu=function(){this.Menu||(this.Menu=this.ui(F)),this.Menu.Show()},e.prototype.AppClickHandler=function(t){var e=this,i=this.Apps.getItem(t);if(i.handlers)this.LaunchApp(t);else{var n=i.launch(this.State.systemParams||{});n.then?n.then((function(i){return e.LaunchApp(t,i)})):this.LaunchApp(t,n)}},e.prototype.LaunchApp=function(t,e){e&&(this.Apps.getItem(t).handlers=e);var i=this.Apps.getItem(t);if(!i.showNew&&this.Wins.getWindow(t))this.ShowWindow(t);else{var n=this.Wins.createAppWindow(t,i.name,i.icon,this.State.box);this.InitApp(t,n)}},e.prototype.ShowWindow=function(t,e){this.Wins.show(t,e)},e.prototype.GetApp=function(t){return this.Apps.getItem(t)},e.prototype.InitApp=function(t,e){var i=this,o=this.GetApp(t),r=o.handlers.init;if(r){var s=e.getBody().$view,a=e.$desktopOptions={},p=r(s,a);p&&(p.webixJet?(p.render(s),a.$view=p):a.$view=webix.ui(n(n({},p),{container:s}))),o.handlers.on&&o.handlers.on("afterinit",null,a),this.on(e,"onViewResize",(function(){return i.ResizeApp(t,e)}))}},e.prototype.ResizeApp=function(t,e){var i,n=this.GetApp(t),o=e.getBody(),r={width:o.$width,height:o.$height},s=e.$desktopOptions;s.$view&&(i=s.$view.webixJet?s.$view.getRoot():s.$view),i&&i.adjust(),n.handlers.on&&n.handlers.on("resize",r,s)},e.prototype.CloseApp=function(t,e){var i=this.GetApp(t);if(i){var n=e.$desktopOptions;i.handlers.destroy&&i.handlers.destroy(n),n.$view&&n.$view.destructor&&n.$view.destructor()}},e.prototype.HideApp=function(t,e){var i=this.GetApp(t);i.handlers.on&&i.handlers.on("deactivate",null,e.$desktopOptions)},e.prototype.ShowApp=function(t,e,i){if(!i){var n=this.GetApp(t);n.handlers.on&&n.handlers.on("activate",null,e.$desktopOptions)}},e.prototype.destroy=function(){this.Wins.destroy()},e}(h),G={JetView:h};G.desk=N,G.menu=F,G.signout=K,G.submenu=B,G.toolbar=U,G.top=q;var J=function(){function t(t){this.app=t,this._=t.getService("locale")._}return t.prototype.apps=function(){var t=this;return this._apps||(this._apps=new webix.DataCollection({scheme:{$change:function(e){var i=t.nameTemplate(e);return t._apps.find((function(t){return t.name==i&&t.id!=e.id}),!0)&&(i=t.getUniqueName(i,e)),e.name=i,e},$serialize:function(t){var e=n({},t);return delete e.handlers,delete e.launch,e}}})),this._apps},t.prototype.nameTemplate=function(t){var e=(t.name+"").trim();return e=e?e.charAt(0).toUpperCase()+e.slice(1):this._("App")+webix.uid()},t.prototype.getUniqueName=function(t){var e=new RegExp("^"+t+"\\((\\d+)\\)$"),i=1;return this._apps.data.each((function(t){var n=t.name.match(e);n&&n[1]>=i&&(i=1*n[1]+1)})),t+"("+i+")"},t.prototype.clearAppHandlers=function(){this._apps.data.each((function(t){return delete t.handlers}))},t}(),X=function(){function t(t){this.app=t}return t.prototype.iconTemplate=function(t,e){var i="";t.icon?i+="<img class='webix_dsk_app_icon "+(e||"")+"' src='"+(this.app.config.appIconPath+t.icon)+"' alt='"+t.name+"'/>":i+=this.defaultIconTemplate(t,e);return"<div class='webix_dsk_app_icon_box'>"+i+"</div>"},t.prototype.defaultIconTemplate=function(t,e){var i=t.name.match(/\b\w/g);return i&&(i=((i.shift()||"")+(i.pop()||"")).toUpperCase()),"<div class='webix_dsk_app_icon webix_dsk_app_icon_default "+e+"'>"+(i||"")+"</div>"},t}();webix.protoUI({name:"dwindow",defaults:{minWidth:100,minHeight:100},$getSize:function(t,e){return this.config.fullscreen?(webix.ui.window.prototype.$getSize.call(this,t,e),[this.config.dskWidth,this.config.dskWidth,this.config.dskHeight,this.config.dskHeight]):webix.ui.window.prototype.$getSize.call(this,t,e)},$resizeMove:function(t){this.callEvent("onWindowResize",[t])}},webix.ui.window);var Y=function(){function t(t){this._wins={},this._app=t,this._events={},this.Compact=t.config.compact,this.helpers=t.getService("helpers"),this.icons={hide:"wxi-minus",maximize:"dsi-crop-square",minimize:"dsi-dock-window",close:"wxi-close"}}return t.prototype.show=function(t,e){var i=e?webix.$$(e):this._wins[t][0];i.show(),this._app.callEvent("onWinShow",[t,i]),i._DskResize&&(this._app.callEvent("onWinResize",[t,i]),delete i._DskResize)},t.prototype.getWindows=function(t){return t?this._wins[t]:this._wins},t.prototype.getWindow=function(t,e){return this._wins[t]?this._wins[t][e||0]:null},t.prototype.createAppWindow=function(t,e,i,n){var o=this,r=webix.ui(this.getWindowConfig(t,e,i,n));return r.attachEvent("onViewMove",(function(t){return o.correctMovePosition(r,t)})),r.attachEvent("onWindowResize",(function(t){return o.correctDragSize(r,t)})),this._wins[t]||(this._wins[t]=[]),this._wins[t].push(r),this._events[r.config.id]=webix.event(r.$view,"click",(function(){o._app.callEvent("onWindowFocus",[t])})),r.show(),this._app.callEvent("onWinShow",[t,r,!0]),r},t.prototype.getWindowConfig=function(t,e,i,n){var o=this.Compact?n.height:Math.min(n.height,450),r=this.Compact?n.width:Math.min(n.width,800);return{view:"dwindow",css:"webix_dsk_window"+(this.Compact?" webix_dsk_window_compact":""),dskName:e,dskIcon:i,move:!this.Compact,resize:!this.Compact,top:n.top+(this.Compact?0:(n.height-o)/2),left:n.left+(this.Compact?0:(n.width-r)/2),toFront:!0,height:o,width:r,head:this.getToolbarConfig(t,e,i),body:{}}},t.prototype.getButtonTemplate=function(t,e){var i=this,n=null;return"minimize"==e?n="fullscreen":"maximize"==e&&(n="normal"),{view:"icon",icon:this.icons[e],width:this.Compact?webix.skin.$active.toolbarHeight:30,css:"webix_dsk_win_btn webix_dsk_win_btn_"+e,name:e,batch:n,click:function(n,o){var r=this.getTopParentView();i.buttonClickHandler(t,r,e),"hide"!=e&&"close"!=e||o.stopPropagation()}}},t.prototype.getWinTitle=function(t,e,i){return this.helpers.iconTemplate({id:t,icon:i,name:e},"webix_dsk_win_icon")+e},t.prototype.getToolbarConfig=function(t,e,i){var n=this,o=this.Compact?["hide","close"]:["hide","maximize","minimize","close"];return{view:"toolbar",height:this.Compact?webix.skin.$active.toolbarHeight:30,css:"webix_dsk_win_toolbar",visibleBatch:"normal",margin:0,padding:2,cols:[{view:"label",name:"title",label:this.getWinTitle(t,e,i)}].concat(o.map((function(e){return n.getButtonTemplate(t,e)})))}},t.prototype.rename=function(t,e,i){var n=this,o=this._wins[t];o&&o.forEach((function(o){o.config.dskName==e&&o.config.dskIcon==i||o.getHead().elements.title.setHTML(n.getWinTitle(t,e,i))}))},t.prototype.buttonClickHandler=function(t,e,i){"hide"==i?this.hide(t,e):"maximize"==i||"minimize"==i?this.toggle(t,e):"close"==i&&this.closeWin(t,e)},t.prototype.hide=function(t,e){e.hide(),this._app.callEvent("onWinHide",[t,e])},t.prototype.toggle=function(t,e){if(e.config.fullscreen=!e.config.fullscreen,e.config.fullscreen){var i=this._app.getState().box,n=i.top,o=i.left,r=i.width,s=i.height;e.config.dskWidth=r,e.config.dskHeight=s,e.config.dskTop=e.config.top,e.config.dskLeft=e.config.left,e.config.top=n,e.config.left=o,e.getHead().showBatch("fullscreen")}else{var a=e.config.dskLeft,p=e.config.dskTop;(a||p)&&(e.setPosition(a,p),this.adjustWin(t,e,this._app.getState().box)),e.getHead().showBatch("normal")}e.resize(),this._app.callEvent("onWinResize",[t,e])},t.prototype.closeApp=function(t){for(var e=this._wins[t];e&&e.length;)this.closeWin(t,e[0])},t.prototype.closeAll=function(){for(var t in this._wins)this.closeApp(t);this._wins={},this._app.callEvent("onAllWinClose",[])},t.prototype.closeWin=function(t,e){this._app.callEvent("onBeforeWinClose",[t,e]),e.close();var i=this._wins[t].findIndex((function(t){return t==e}));this._wins[t].splice(i,1),this._wins[t].length||(this._wins[t]=null),webix.eventRemove(this._events[e.config.id]),this._app.callEvent("onWinClose",[t,e])},t.prototype.getTopWindowId=function(){var t=[null,0],e=function(e){i._wins[e]&&i._wins[e].forEach((function(i){i.isVisible()&&i.$view.style.zIndex>t[1]&&(t=[e,i.$view.style.zIndex])}))},i=this;for(var n in this._wins)e(n);return t[0]},t.prototype.destroy=function(){var t=this;for(var e in this._wins)this._wins[e]&&this._wins[e].forEach((function(e){e.close(),webix.eventRemove(t._events[e.config.id])}));this._wins=null},t.prototype.setWinBox=function(t,e){t.config.width=e.width,t.config.height=e.height,t.config.fullscreen?t.resize():t.$setSize(e.width,e.height),t.setPosition(e.left,e.top),t.isVisible()||(t._DskResize=!0)},t.prototype.resizeWins=function(t){var e=this,i=function(i){n._wins[i]&&n._wins[i].forEach((function(n){e.setWinBox(n,t),e._app.callEvent("onWinResize",[i,n])}))},n=this;for(var o in this._wins)i(o)},t.prototype.adjustWins=function(t){var e=this,i=function(i){n._wins[i]&&n._wins[i].forEach((function(n){e.adjustWin(i,n,t)}))},n=this;for(var o in this._wins)i(o)},t.prototype.adjustWin=function(t,e,i){var n=e.config,o=n.width,r=n.height,s=n.left,a=n.top,p=!1;e.config.fullscreen&&(e.config.dskWidth=i.width,e.config.dskHeight=i.height,s=i.left,a=i.top,p=!0),s<i.left&&(s=i.left,p=!0),a<i.top&&(a=i.top,p=!0);var u=o+s-i.left-i.width;u>0&&((s-=u)<i.left&&(s=i.left,o=i.width),p=!0),(u=r+a-i.top-i.height)>0&&((a-=u)<i.top&&(a=i.top,r=i.height),p=!0),p&&(this.setWinBox(e,{width:o,height:r,left:s,top:a}),this._app.callEvent("onWinResize",[t,e]))},t.prototype.correctMovePosition=function(t,e){var i=e.x+webix.DragControl.left,n=e.y+webix.DragControl.top,o=this._app.getState().box,r=o.top,s=o.left,a=o.width,p=o.height;if(i<s)e.x+=s-i;else{var u=i+t.$width,h=s+a;u>h&&(e.x-=u-h)}if(n<r)e.y+=r-n;else{var c=n+t.$height,l=r+p;c>l&&(e.y-=c-l)}},t.prototype.correctDragSize=function(t,e){var i=this._app.getState().box,n=i.width,o=i.height,r=i.left,s=i.top,a=t.config,p=a.minWidth,u=a.minHeight,h=t.config.left,c=t.config.top;if(e.x<p)e.x=p;else{var l=n+r-h;e.x>l&&(e.x=l)}if(e.y<u)e.y=u;else{var f=o+s-c;e.y>f&&(e.y=f)}},t}(),Z=function(t){function e(e){var i=this,o=j({systemParams:e.systemParams||null,tileLayout:e.tileLayout||"y",tileAlign:e.tileAlign||"left,top",grid:void 0===e.grid||e.grid,box:{height:null,width:null,top:null,left:null}}),r={router:m,version:"10.0.1",debug:!0,start:"/top",appIconPath:"",multiselect:!0,params:{state:o},apps:[],appSettings:{},barPosition:"bottom"};e.apps&&e.apps.forEach((function(t){t.id||(t.id=t.name)})),(i=t.call(this,n(n({},r),e))||this).use(V,i.config.locale||{lang:"en",webix:{en:"en-US"}}),i.config.debug&&(webix.Promise=window.Promise);var s=function(t){return i.config.override&&i.config.override.get(t)||t};return i.setService("local",new(s(J))(i)),i.setService("helpers",new(s(X))(i)),i.setService("windows",new(s(Y))(i)),i}return i(e,t),e.prototype.require=function(t,e){return"jet-views"===t?G[e]:"jet-locales"===t?tt[e]:null},e.prototype.getState=function(){return this.config.params.state},e.prototype.addApp=function(t){this.getService("local").apps().add(t)},e.prototype.setStateData=function(t){var e=this.getService("local").apps();t.forEach((function(t){e.getItem(t.id)&&e.updateItem(t.id,t)}))},e.prototype.getStateData=function(){return this.getService("local").apps().serialize()},e}(y);webix.protoUI({name:"desktop",app:Z,getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},addApp:function(t){this.$app.addApp(t)},setStateData:function(t){this.$app.setStateData(t)},getStateData:function(){return this.$app.getStateData()},$init:function(){var t=this,e=this.$app.getState();for(var i in e)D(e,this.config,i);this.attachEvent("onDestruct",(function(){return t.$app.destructor()}))}},webix.ui.jetapp);var Q={Local:J,Windows:Y,Helpers:X},tt={en:{App:"App","Close all":"Close all"}};t.App=Z,t.locales=tt,t.services=Q,t.views=G,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=desktop.min.js.map
