/*
@license
Webix <%= pkg.productName %> v.<%= pkg.version %>
This software is covered by Webix Trial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).fileManager={})}(this,(function(e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,i)};function i(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var n=function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=function(){},o=function(){function e(e,t){this.webixJet=!0,this.webix=e,this._events=[],this._subs={},this._data={},t&&t.params&&e.extend(this._data,t.params)}return e.prototype.getRoot=function(){return this._root},e.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},e.prototype.setParam=function(e,t,i){if(this._data[e]!==t&&(this._data[e]=t,this._segment.update(e,t,0),i))return this.show(null)},e.prototype.getParam=function(e,t){var i=this._data[e];if(void 0!==i||!t)return i;var n=this.getParentView();return n?n.getParam(e,t):void 0},e.prototype.getUrl=function(){return this._segment.suburl()},e.prototype.getUrlString=function(){return this._segment.toString()},e.prototype.getParentView=function(){return this._parent},e.prototype.$$=function(e){if("string"==typeof e){var t=this.getRoot();return t.queryView((function(i){return(i.config.id===e||i.config.localId===e)&&i.$scope===t.$scope}),"self")}return e},e.prototype.on=function(e,t,i){var n=e.attachEvent(t,i);return this._events.push({obj:e,id:n}),n},e.prototype.contains=function(e){for(var t in this._subs){var i=this._subs[t].view;if(i===e||i.contains(e))return!0}return!1},e.prototype.getSubView=function(e){var t=this.getSubViewInfo(e);if(t)return t.subview.view},e.prototype.getSubViewInfo=function(e){var t=this._subs[e||"default"];return t?{subview:t,parent:this}:"_top"===e?(this._subs[e]={url:"",id:null,popup:!0},this.getSubViewInfo(e)):this._parent?this._parent.getSubViewInfo(e):null},e.prototype._detachEvents=function(){for(var e=this._events,t=e.length-1;t>=0;t--)e[t].obj.detachEvent(e[t].id)},e.prototype._destroySubs=function(){for(var e in this._subs){var t=this._subs[e].view;t&&t.destructor()}this._subs={}},e.prototype._init_url_data=function(){var e=this._segment.current();this._data={},this.webix.extend(this._data,e.params,!0)},e.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var e in this._subs){var t=this._subs[e];if(!t.branch&&t.view&&"_top"!==e){var i=t.view._getDefaultSub();if(i)return i}}},e.prototype._routed_view=function(){var e=this.getParentView();if(!e)return!0;var t=e._getDefaultSub();return!(!t&&t!==this)&&e._routed_view()},e}();function a(e){"/"===e[0]&&(e=e.substr(1));for(var t=e.split("/"),i=[],n=0;n<t.length;n++){var r=t[n],o={},a=r.indexOf(":");if(-1===a&&(a=r.indexOf("?")),-1!==a)for(var s=0,c=r.substr(a+1).split(/[\:\?\&]/g);s<c.length;s++){var u=c[s].split("=");o[u[0]]=decodeURIComponent(u[1])}i[n]={page:a>-1?r.substr(0,a):r,params:o,isNew:!0}}return i}function s(e){for(var t=[],i=0,n=e;i<n.length;i++){var r=n[i];t.push("/"+r.page);var o=c(r.params);o&&t.push("?"+o)}return t.join("")}function c(e){var t=[];for(var i in e)"object"!=typeof e[i]&&(t.length&&t.push("&"),t.push(i+"="+encodeURIComponent(e[i])));return t.join("")}var u=function(){function e(e,t){this._next=1,this.route="string"==typeof e?{url:a(e),path:e}:e,this.index=t}return e.prototype.current=function(){return this.route.url[this.index]},e.prototype.next=function(){return this.route.url[this.index+this._next]},e.prototype.suburl=function(){return this.route.url.slice(this.index)},e.prototype.shift=function(t){var i=new e(this.route,this.index+this._next);return i.setParams(i.route.url,t,i.index),i},e.prototype.setParams=function(e,t,i){if(t){var n=e[i].params;for(var r in t)n[r]=t[r]}},e.prototype.refresh=function(){for(var e=this.route.url,t=this.index+1;t<e.length;t++)e[t].isNew=!0},e.prototype.toString=function(){var e=s(this.suburl());return e?e.substr(1):""},e.prototype._join=function(e,t){var i=this.route.url;if(null===e)return i;var n=this.route.url,r=!0;if(i=n.slice(0,this.index+(t?this._next:0)),e){i=i.concat(a(e));for(var o=0;o<i.length;o++)n[o]&&(i[o].view=n[o].view),r&&n[o]&&i[o].page===n[o].page?i[o].isNew=!1:i[o].isNew&&(r=!1)}return i},e.prototype.append=function(e){var t=this._join(e,!0);return this.route.path=s(t),this.route.url=t,this.route.path},e.prototype.show=function(e,t,i){var n=this,o=this._join(e.url,i);return this.setParams(o,e.params,this.index+(i?this._next:0)),new Promise((function(e,i){var a=s(o),c={url:o,redirect:a,confirm:Promise.resolve()},u=t?t.app:null;if(u&&!u.callEvent("app:guard",[c.redirect,t,c]))return void i(new r);c.confirm.catch((function(e){return i(e)})).then((function(){if(null!==c.redirect){if(c.redirect!==a)return u.show(c.redirect),void i(new r);n.route.path=a,n.route.url=o,e()}else i(new r)}))}))},e.prototype.size=function(e){this._next=e},e.prototype.split=function(){var t={url:this.route.url.slice(this.index+1),path:""};return t.url.length&&(t.path=s(t.url)),new e(t,0)},e.prototype.update=function(e,t,i){var n=this.route.url[this.index+(i||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(e,t,i);""===e?n.page=t:n.params[e]=t,this.route.path=s(this.route.url)},e}(),p=function(e){function t(t,i){var n=e.call(this,t.webix)||this;return n.app=t,n._children=[],n}return i(t,e),t.prototype.ui=function(e,t){var i=(t=t||{}).container||e.container,n=this.app.createView(e);return this._children.push(n),n.render(i,this._segment,this),"object"!=typeof e||e instanceof o?n:n.getRoot()},t.prototype.show=function(e,t){if(t=t||{},"object"==typeof e){for(var i in e)this.setParam(i,e[i]);e=null}else{if("/"===e.substr(0,1))return this.app.show(e,t);if(0===e.indexOf("./")&&(e=e.substr(2)),0===e.indexOf("../")){var n=this.getParentView();return n?n.show(e.substr(3),t):this.app.show("/"+e.substr(3))}var r=this.getSubViewInfo(t.target);if(r){if(r.parent!==this)return r.parent.show(e,t);if(t.target&&"default"!==t.target)return this._renderFrameLock(t.target,r.subview,{url:e,params:t.params})}else if(e)return this.app.show("/"+e,t)}return this._show(this._segment,{url:e,params:t.params},this)},t.prototype._show=function(e,t,i){var n=this;return e.show(t,i,!0).then((function(){return n._init_url_data(),n._urlChange()})).then((function(){e.route.linkRouter&&(n.app.getRouter().set(e.route.path,{silent:!0}),n.app.callEvent("app:route",[e.route.path]))}))},t.prototype.init=function(e,t){},t.prototype.ready=function(e,t){},t.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},t.prototype.urlChange=function(e,t){},t.prototype.destroy=function(){},t.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),e.prototype.destructor.call(this))},t.prototype.use=function(e,t){e(this.app,this,t)},t.prototype.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},t.prototype.render=function(e,t,i){var n=this;"string"==typeof t&&(t=new u(t,0)),this._segment=t,this._parent=i,this._init_url_data();var r="string"==typeof(e=e||document.body)?this.webix.toNode(e):e;return this._container!==r?(this._container=r,this._render(t)):this._urlChange().then((function(){return n.getRoot()}))},t.prototype._render=function(e){var t=this,i=this.config();return i.then?i.then((function(i){return t._render_final(i,e)})):this._render_final(i,e)},t.prototype._render_final=function(e,t){var i,n=this,r=null,o=null,a=!1;if(this._container.tagName?o=this._container:(r=this._container).popup?(o=document.body,a=!0):o=this.webix.$$(r.id),!this.app||!o)return Promise.reject(null);var s=this._segment.current(),c={ui:{}};this.app.copyConfig(e,c.ui,this._subs),this.app.callEvent("app:render",[this,t,c]),c.ui.$scope=this,!r&&s.isNew&&s.view&&s.view.destructor();try{if(r&&!a){var u=o,p=u.getParentView();p&&"multiview"===p.name&&!c.ui.id&&(c.ui.id=u.config.id)}this._root=this.app.webix.ui(c.ui,o);var l=this._root;a&&l.setPosition&&!l.isVisible()&&l.show(),r&&(r.view&&r.view!==this&&r.view!==this.app&&r.view.destructor(),r.id=this._root.config.id,this.getParentView()||!this.app.app?r.view=this:r.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),i=Promise.resolve(this._init(this._root,t)).then((function(){return n._urlChange().then((function(){return n._initUrl=null,n.ready(n._root,t.suburl())}))}))}catch(e){i=Promise.reject(e)}return i.catch((function(e){return n._initError(n,e)}))},t.prototype._init=function(e,t){return this.init(e,t.suburl())},t.prototype._urlChange=function(){var e=this;this.app.callEvent("app:urlchange",[this,this._segment]);var t=[];for(var i in this._subs){var n=this._subs[i],r=this._renderFrameLock(i,n,null);r&&t.push(r)}return Promise.all(t).then((function(){return e.urlChange(e._root,e._segment.suburl())}))},t.prototype._renderFrameLock=function(e,t,i){if(!t.lock){var n=this._renderFrame(e,t,i);n&&(t.lock=n.then((function(){return t.lock=null}),(function(){return t.lock=null})))}return t.lock},t.prototype._renderFrame=function(e,t,i){var n=this;if("default"===e){if(this._segment.next()){var r=i?i.params:null;return t.params&&(r=this.webix.extend(r||{},t.params)),this._createSubView(t,this._segment.shift(r))}t.view&&t.popup&&(t.view.destructor(),t.view=null)}if(null!==i&&(t.url=i.url,t.params&&(i.params=this.webix.extend(i.params||{},t.params))),t.route){if(null!==i)return t.route.show(i,t.view).then((function(){return n._createSubView(t,t.route)}));if(t.branch)return}var o=t.view;if(!o&&t.url){if("string"==typeof t.url)return t.route=new u(t.url,0),i&&t.route.setParams(t.route.route.url,i.params,0),t.params&&t.route.setParams(t.route.route.url,t.params,0),this._createSubView(t,t.route);"function"!=typeof t.url||o instanceof t.url||(o=new(this.app._override(t.url))(this.app,"")),o||(o=t.url)}if(o)return o.render(t,t.route||this._segment,this)},t.prototype._initError=function(e,t){return this.app&&this.app.error("app:error:initview",[t,e]),!0},t.prototype._createSubView=function(e,t){var i=this;return this.app.createFromURL(t.current()).then((function(n){return n.render(e,t,i)}))},t.prototype._destroyKids=function(){for(var e=this._children,t=e.length-1;t>=0;t--)e[t]&&e[t].destructor&&e[t].destructor();this._children=[]},t}(o),l=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._ui=i.ui,n}return i(t,e),t.prototype.config=function(){return this._ui},t}(p),h=function(){function e(e,t,i){this.path="",this.app=i}return e.prototype.set=function(e,t){this.path=e;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},e.prototype.get=function(){return this.path},e}(),f=!0,d=function(e){function t(t){var i=this,n=(t||{}).webix||window.webix;return t=n.extend({name:"App",version:"1.0",start:"/home"},t,!0),(i=e.call(this,n,t)||this).config=t,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return i(t,e),t.prototype.getUrl=function(){return this._subSegment.suburl()},t.prototype.getUrlString=function(){return this._subSegment.toString()},t.prototype.getService=function(e){var t=this._services[e];return"function"==typeof t&&(t=this._services[e]=t(this)),t},t.prototype.setService=function(e,t){this._services[e]=t},t.prototype.destructor=function(){this.getSubView().destructor(),e.prototype.destructor.call(this)},t.prototype.copyConfig=function(e,t,i){if((e instanceof o||"function"==typeof e&&e.prototype instanceof o)&&(e={$subview:e}),void 0!==e.$subview)return this.addSubView(e,t,i);var n=e instanceof Array;for(var r in t=t||(n?[]:{}),e){var a=e[r];if("function"==typeof a&&a.prototype instanceof o&&(a={$subview:a}),!a||"object"!=typeof a||a instanceof this.webix.DataCollection||a instanceof RegExp||a instanceof Map)t[r]=a;else if(a instanceof Date)t[r]=new Date(a);else{var s=this.copyConfig(a,a instanceof Array?[]:{},i);null!==s&&(n?t.push(s):t[r]=s)}}return t},t.prototype.getRouter=function(){return this.$router},t.prototype.clickHandler=function(e,t){if(e&&(t=t||e.target||e.srcElement)&&t.getAttribute){var i=t.getAttribute("trigger");if(i)return this._forView(t,(function(e){return e.app.trigger(i)})),e.cancelBubble=!0,e.preventDefault();var n=t.getAttribute("route");if(n)return this._forView(t,(function(e){return e.show(n)})),e.cancelBubble=!0,e.preventDefault()}var r=t.parentNode;r&&this.clickHandler(e,r)},t.prototype.getRoot=function(){return this.getSubView().getRoot()},t.prototype.refresh=function(){var e=this;return this._subSegment?this.getSubView().refresh().then((function(t){return e.callEvent("app:route",[e.getUrl()]),t})):Promise.resolve(null)},t.prototype.loadView=function(e){var t=this,i=this.config.views,n=null;if(""===e)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(n="function"==typeof i?i(e):i[e])&&(e=n,n=null),n||("_hidden"===e?n={hidden:!0}:"_blank"===e?n={}:(e=e.replace(/\./g,"/"),n=this.require("jet-views",e)))}catch(t){n=this._loadError(e,t)}return n.then||(n=Promise.resolve(n)),n=n.then((function(e){return e.__esModule?e.default:e})).catch((function(i){return t._loadError(e,i)}))},t.prototype._forView=function(e,t){var i=this.webix.$$(e);i&&t(i.$scope)},t.prototype._loadViewDynamic=function(e){return null},t.prototype.createFromURL=function(e){var t=this;return e.isNew||!e.view?this.loadView(e.page).then((function(i){return t.createView(i,name,e.params)})):Promise.resolve(e.view)},t.prototype._override=function(e){var t=this.config.override;if(t){for(var i=void 0;e;)i=e,e=t.get(e);return i}return e},t.prototype.createView=function(e,i,n){if("function"==typeof(e=this._override(e))){if(e.prototype instanceof t)return new e({app:this,name:i,params:n,router:h});if(e.prototype instanceof o)return new e(this,{name:i,params:n});e=e(this)}return e instanceof o?e:new l(this,{name:i,ui:e})},t.prototype.show=function(e,t){return e&&this.app&&0==e.indexOf("//")?this.app.show(e.substr(1),t):this.render(this._container,e||this.config.start,t)},t.prototype.trigger=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];this.apply(e,t)},t.prototype.apply=function(e,t){this.callEvent(e,t)},t.prototype.action=function(e){return this.webix.bind((function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.apply(e,t)}),this)},t.prototype.on=function(e,t){this.attachEvent(e,t)},t.prototype.use=function(e,t){e(this,null,t)},t.prototype.error=function(e,t){if(this.callEvent(e,t),this.callEvent("app:error",t),this.config.debug)for(var i=0;i<t.length;i++)if(console.error(t[i]),t[i]instanceof Error){var n=t[i].message;0===n.indexOf("Module build failed")?(n=n.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+n+"</pre>"):(n+="<br><br>Check console for more details",this.webix.message({type:"error",text:n,expire:-1}))}},t.prototype.render=function(e,t,i){var n=this;this._container="string"==typeof e?this.webix.toNode(e):e||document.body;var r=null;!this.$router?(f&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(e){return n.clickHandler(e)})),f=!1),"string"==typeof t&&(t=new u(t,0)),this._subSegment=this._first_start(t),this._subSegment.route.linkRouter=!0):r="string"==typeof t?t:this.app?t.split().route.path||this.config.start:t.toString();var o=i?i.params:this.config.params||null,a=this.getSubView(),s=this._subSegment,c=s.show({url:r,params:o},a).then((function(){return n.createFromURL(s.current())})).then((function(t){return t.render(e,s)})).then((function(e){return n.$router.set(s.route.path,{silent:!0}),n.callEvent("app:route",[n.getUrl()]),e}));return this.ready=this.ready.then((function(){return c})),c},t.prototype.getSubView=function(){if(this._subSegment){var e=this._subSegment.current().view;if(e)return e}return new p(this,{})},t.prototype.require=function(e,t){return null},t.prototype._first_start=function(e){var t=this;this._segment=e;if(this.$router=new this.config.router((function(e){return setTimeout((function(){t.show(e).catch((function(e){if(!(e instanceof r))throw e}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){t.webix.html.removeCss(i,"webixappstart"),t.webix.html.addCss(i,"webixapp")}),10)}if(e){if(this.app){var n=e.current().view;e.current().view=this,e.next()?(e.refresh(),e=e.split()):e=new u(this.config.start,0),e.current().view=n}}else{var o=this.$router.get();o||(o=this.config.start,this.$router.set(o,{silent:!0})),e=new u(o,0)}return e},t.prototype._loadError=function(e,t){return this.error("app:error:resolve",[t,e]),{template:" "}},t.prototype.addSubView=function(e,t,i){var n=!0!==e.$subview?e.$subview:null,r=e.name||(n?this.webix.uid():"default");return t.id=e.id||"s"+this.webix.uid(),(i[r]={id:t.id,url:n,branch:e.branch,popup:e.popup,params:e.params}).popup?null:t},t}(o),v=function(){function e(e,t){var i=this;this.config=t||{},this._detectPrefix(),this.cb=e,window.onpopstate=function(){return i.cb(i.get())}}return e.prototype.set=function(e,t){var i=this;if(this.config.routes){var n=e.split("?",2);for(var r in this.config.routes)if(this.config.routes[r]===n[0]){e=r+(n.length>1?"?"+n[1]:"");break}}this.get()!==e&&window.history.pushState(null,null,this.prefix+this.sufix+e),t&&t.silent||setTimeout((function(){return i.cb(e)}),1)},e.prototype.get=function(){var e=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(e="/"!==e&&"#"!==e?e:"",this.config.routes){var t=e.split("?",2),i=this.config.routes[t[0]];i&&(e=i+(t.length>1?"?"+t[1]:""))}return e},e.prototype._detectPrefix=function(){var e=this.config.routerPrefix;this.sufix="#"+(void 0===e?"!":e),this.prefix=document.location.href.split("#",2)[0]},e.prototype._getRaw=function(){return document.location.href},e}(),g=!1;function w(e){if(!g&&e){g=!0;var t=window;t.Promise||(t.Promise=e.promise);var i=e.version.split(".");10*i[0]+1*i[1]<53&&(e.ui.freeze=function(t){var i=t();return i&&i.then?i.then((function(t){return e.ui.$freeze=!1,e.ui.resize(),t})):(e.ui.$freeze=!1,e.ui.resize()),i});var n=e.ui.baselayout.prototype.addView,r=e.ui.baselayout.prototype.removeView,o={addView:function(e,t){if(this.$scope&&this.$scope.webixJet&&!e.queryView){var i=this.$scope,r={};e=i.app.copyConfig(e,{},r),n.apply(this,[e,t]);var o=function(e){i._renderFrame(e,r[e],null).then((function(){i._subs[e]=r[e]}))};for(var a in r)o(a);return e.id}return n.apply(this,arguments)},removeView:function(){if(r.apply(this,arguments),this.$scope&&this.$scope.webixJet){var t=this.$scope._subs;for(var i in t){var n=t[i];e.$$(n.id)||(n.view.destructor(),delete t[i])}}}};e.extend(e.ui.layout.prototype,o,!0),e.extend(e.ui.baselayout.prototype,o,!0),e.protoUI({name:"jetapp",$init:function(t){this.$app=new this.app(t);var i=e.uid().toString();t.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},e.ui.proxy,e.EventSystem)}}var m=function(e){function t(t){var i;return t.router=t.router||v,w((i=e.call(this,t)||this).webix),i}return i(t,e),t.prototype.require=function(e,t){return require(e+"/"+t)},t}(d),y=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}i(t,e),t.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},t.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(v),function(){function e(e,t){this.path="",this.cb=e}return e.prototype.set=function(e,t){var i=this;this.path=e,t&&t.silent||setTimeout((function(){return i.cb(e)}),1)},e.prototype.get=function(){return this.path},e}());function b(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function _(e,t,i){for(var n in e)b(e,n)&&t.call(i||e,e[n],n,e)}function x(e){e="Warning: "+e,"undefined"!=typeof console&&console.error(e);try{throw new Error(e)}catch(e){}}var S=String.prototype.replace,k=String.prototype.split,$=function(e){var t=e%10;return 11!==e&&1===t?0:2<=t&&t<=4&&!(e>=12&&e<=14)?1:2},C={arabic:function(e){if(e<3)return e;var t=e%100;return t>=3&&t<=10?3:t>=11?4:5},bosnian_serbian:$,chinese:function(){return 0},croatian:$,french:function(e){return e>1?1:0},german:function(e){return 1!==e?1:0},russian:$,lithuanian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){if(1===e)return 0;var t=e%10;return 2<=t&&t<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0},slovenian:function(e){var t=e%100;return 1===t?0:2===t?1:3===t||4===t?2:3}},T={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function P(e){var t,i=(t={},_(T,(function(e,i){_(e,(function(e){t[e]=i}))})),t);return i[e]||i[k.call(e,/-/,1)[0]]||i.en}function I(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var E=/\$/g,A=/%\{(.*?)\}/g;function F(e,t,i,n){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return e;var r=e,o=n||A,a="number"==typeof t?{smart_count:t}:t;if(null!=a.smart_count&&r){var s=k.call(r,"||||");r=(s[function(e,t){return C[P(e)](t)}(i||"en",a.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return r=S.call(r,o,(function(e,t){return b(a,t)&&null!=a[t]?S.call(a[t],E,"$$"):e}))}function j(e){var t=e||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en";var i=t.allowMissing?F:null;this.onMissingKey="function"==typeof t.onMissingKey?t.onMissingKey:i,this.warn=t.warn||x,this.tokenRegex=function(e){var t=e&&e.prefix||"%{",i=e&&e.suffix||"}";if("||||"===t||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(I(t)+"(.*?)"+I(i),"g")}(t.interpolation)}j.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},j.prototype.extend=function(e,t){_(e,(function(e,i){var n=t?t+"."+i:i;"object"==typeof e?this.extend(e,n):this.phrases[n]=e}),this)},j.prototype.unset=function(e,t){"string"==typeof e?delete this.phrases[e]:_(e,(function(e,i){var n=t?t+"."+i:i;"object"==typeof e?this.unset(e,n):delete this.phrases[n]}),this)},j.prototype.clear=function(){this.phrases={}},j.prototype.replace=function(e){this.clear(),this.extend(e)},j.prototype.t=function(e,t){var i,n,r=null==t?{}:t;if("string"==typeof this.phrases[e])i=this.phrases[e];else if("string"==typeof r._)i=r._;else if(this.onMissingKey){n=(0,this.onMissingKey)(e,r,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+e+'"'),n=e;return"string"==typeof i&&(n=F(i,r,this.currentLocale,this.tokenRegex)),n},j.prototype.has=function(e){return b(this.phrases,e)},j.transformPhrase=function(e,t,i){return F(e,t,i)};var R=j;var D=window.webix;D&&w(D);var M=function(e,t,i){var n=(i=i||{}).storage,r=n?n.get("lang")||"en":i.lang||"en";function o(t,o,a){o.__esModule&&(o=o.default);var c={phrases:o};i.polyglot&&e.webix.extend(c,i.polyglot);var u=s.polyglot=new R(c);if(u.locale(t),s._=e.webix.bind(u.t,u),r=t,n&&n.put("lang",r),i.webix){var p=i.webix[t];p&&e.webix.i18n.setLocale(p)}return a?Promise.resolve():e.refresh()}function a(t,n){if(!1!==i.path){var r=(i.path?i.path+"/":"")+t;o(t,e.require("jet-locales",r),n)}}var s={getLang:function(){return r},setLang:a,setLangData:o,_:null,polyglot:null};e.setService("locale",s),a(r,!0)},V=window;V.Promise||(V.Promise=V.webix.promise);var O=1;function U(e,t,i){Object.defineProperty(t,i,{get:function(){return e[i]},set:function(t){return e[i]=t}})}function z(e,t){t=t||{};var i={},n={},r=function(e,t){var r=O++;return i[r]={mask:e,handler:t},t("*"===e?n:n[e],void 0,e),r},o=[],a=!1,s=function(e,t,n,r){if(a)o.push([e,t,n,r]);else for(var s=Object.keys(i),c=0;c<s.length;c++){var u=i[s[c]];u&&("*"!==u.mask&&u.mask!==e||u.handler(n,t,e,r))}};for(var c in e)if(e.hasOwnProperty(c)){var u=e[c];t.nested&&"object"==typeof u&&u?n[c]=z(u,t):L(n,u,c,s)}return Object.defineProperty(n,"$changes",{value:{attachEvent:r,detachEvent:function(e){delete i[e]}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$observe",{value:r,enumerable:!1,configurable:!1}),Object.defineProperty(n,"$batch",{value:function(e){if("function"!=typeof e){var t=e;e=function(){for(var e in t)n[e]=t[e]}}for(a=!0,e(n),a=!1;o.length;){var i=o.shift();s.apply(this,i)}},enumerable:!1,configurable:!1}),n}function L(e,t,i,n){Object.defineProperty(e,i,{get:function(){return t},set:function(e){if(null===t||null===e?t!==e:t.valueOf()!=e.valueOf()){var r=t;t=e,n(i,r,e,null)}},enumerable:!0,configurable:!1})}var W=!1;function B(e,t,i){var n=t.$width,r=t.$height;e.config._fillApp?e.define({width:n,height:r}):e.define({left:(n-e.$width)/2,top:(r-e.$height)/2}),i||e.resize()}function H(e,t){var i=t.getRoot();e.attachEvent("onHide",(function(){i.$destructed||(webix.html.removeCss(i.$view,"webix_win_inside"),i.enable())}));var n=t.attachEvent("view:resize",(function(){B(e,i)}));e.attachEvent("onDestruct",(function(){t.detachEvent(n)}))}function N(e){return{attachEvent:function(t,i){return webix.UIManager.addHotKey(t,i,e),{key:t,handler:i}},detachEvent:function(t){var i=t.key,n=t.handler;return webix.UIManager.removeHotKey(i,n,e)}}}var G="<span class='webix_icon wxi-folder'></span>",q="<span class='webix_icon wxi-dots webix_fmanager_menu_icon'></span>",K=function(e){function t(t,i){var n=e.call(this,t)||this;return n.compact=!!i.compact,n.tree=!!i.tree,n}return i(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._,i=this.getParam("state"),n=[{id:"download",value:t("Download"),icon:"wxi-download",show:32,hotkey:"Ctrl+D"},{$template:"Separator",show:32},{id:"toggle-preview",value:t("Preview"),icon:"wxi-eye",show:17},{id:"locate",value:t("Open item location"),icon:"wxi-folder",hotkey:"Ctrl+Alt+O",show:65},{id:"open",value:t("Open"),icon:"wxi-folder-open",hotkey:"Ctrl+O",show:8},{$template:"Separator",show:8},{id:"copy",value:t("Copy"),hotkey:"Ctrl+C",icon:"fmi-content-copy",show:35},{id:"cut",value:t("Cut"),hotkey:"Ctrl+X",icon:"fmi-content-cut",show:35},{id:"paste",value:t("Paste"),hotkey:"Ctrl+V",icon:"fmi-content-paste",show:161},{$template:"Separator",show:35},{id:"rename",value:t("Rename"),icon:"fmi-rename-box",hotkey:"Ctrl+R",show:1},{id:"delete",value:t("Delete"),icon:"wxi-close",hotkey:"Del / &#8592;",show:3}];return this.app.config.editor&&n.splice(5,0,{id:"edit",value:t("Edit"),icon:"wxi-pencil",hotkey:"Ctrl+E",show:6}),{view:"menu",css:"webix_fmanager_menu",layout:"y",autoheight:!0,data:n,template:function(e){return(e.icon?'<span class="webix_list_icon webix_icon '+e.icon+'"></span>':"")+e.value+(e.hotkey?'<span class="webix_fmanager_context-menu-hotkey">'+e.hotkey+"</span>":"")},on:{onMenuItemClick:function(t){"toggle-preview"===t?i.preview=!i.preview:e.app.callEvent("app:action",[t,e.Files]),e.app.callEvent("app:filemenu:click")}}}},t.prototype.FilterOptions=function(e){var t=this;this.Files=e;var i=e[0],n=e.length>1,r=["image","audio","video","code","pdf"],o=-1!=r.indexOf(i.type)||-1!=r.indexOf(i.$ext),a=this.app.getState().search,s="empty"===i.type;this.getRoot().define("width",a&&!n?270:200),this.getRoot().filter((function(e){return!(!(128&e.show)&&s||n&&!(2&e.show)||"folder"===i.type&&!(1&e.show)||4&e.show&&"code"!==i.type||8&e.show&&!o||16&e.show&&!t.compact||32&e.show&&t.tree||64&e.show&&!a)}))},t}(p),J=function(e){function t(t,i){var n=e.call(this,t)||this;return n._config=i,n}return i(t,e),t.prototype.config=function(){var e=this;return{view:"context",body:{$subview:new(this.app.dynamic(K))(this.app,n({},this._config)),name:"options"},on:{onBeforeShow:function(t){var i=e._Locate(t);if(!i)return!1;e.getSubView("options").FilterOptions(i)}}}},t.prototype.init=function(){var e=this;this.on(this.app,"app:filemenu:click",(function(){return e.getRoot().hide()}))},t.prototype.AttachTo=function(e,t){this._Locate=t,this.getRoot().attachTo(e)},t.prototype.Show=function(e){this.getRoot().show(e,{x:-e.offsetX,y:e.target.offsetHeight-e.offsetY})},t.prototype.Hide=function(){this.getRoot().hide()},t}(p),X=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.init=function(){var e=this;this.State=this.getParam("state"),this.Local=this.app.getService("local"),this._Track=!0,this.WTable.attachEvent("onAfterSelect",(function(){return e.ShiftFocus()})),this.WTable.attachEvent("onSelectChange",(function(){if(e._Track){var t=[].concat(e.WTable.getSelectedId(!0).map((function(t){return e.WTable.getItem(t)}))).filter((function(e){return".."!==e.value}));(t.length||e.State.selectedItem.length)&&(t.length||(t.$noSelect=!0),e.State.selectedItem=t)}})),this.on(this.State.$changes,"path",(function(t,i){e.State.search?i&&e.State.$batch({search:"",searchStats:null}):"files"===e.State.source&&(i?e.Local.folders().then((function(n){e.State.selectedItem=e.GetPrevLocation(n,t,i),e.LoadData(t)})):e.LoadData(t))})),this.on(this.WTable.data,"onStoreUpdated",(function(t,i,n){!n&&e.WTable.count()&&e.State.selectedItem.length&&e.SelectActive()})),this.AddHotkeys();var t=this.getParam("compact",!0);this.Menu=this.ui(new(this.app.dynamic(J))(this.app,{compact:t,state:this.State})),this.Menu.AttachTo(this.WTable.$view,(function(t){var i=e.WTable.locate(t);if(!i)return[{type:"empty"}];var n=e.WTable.getItem(i);if(".."==n.value)return!1;e.WTable.isSelected(i)||e.WTable.select(i);var r=e.WTable.getSelectedId(!0);return 1===r.length?[n]:r=r.map((function(t){return e.WTable.getItem(t)})).filter((function(e){return".."!=e.value}))})),this.on(this.WTable,"onAfterScroll",(function(){return e.Menu.Hide()})),this.on(this.WTable,"onBeforeDrag",(function(){return e.Menu.Hide()}))},t.prototype.ShiftFocus=function(){this.getParam("trackActive",!0)&&(this.State.isActive=!0)},t.prototype.Activate=function(e){if(e.length)if(1===e.length){var t=e[0];if("folder"===t.type)this.ShowSubFolder(".."===t.value?t.value:t.id);else{var i="code"===t.type&&this.app.config.editor?"edit":"open";this.app.callEvent("app:action",[i,e])}}else{i=this.app.config.editor?"edit":"open";this.app.callEvent("app:action",[i,e])}},t.prototype.ShowSubFolder=function(e){var t;if(".."==e){var i=this.State.path.split("/");t="/"+i.slice(1,i.length-1).join("/")}else t=e;this.State.path=t},t.prototype.GetPrevLocation=function(e,t,i){if("/"===i||!e.exists(i))return[];var n;for("/"===t&&(t="../files");i;)if(n=i,(i=e.getParentId(i))===t){var r=e.getItem(n);return[{id:r.id,value:r.value,type:"folder",date:new Date(r.date)}]}return[]},t.prototype.GetTargetFolder=function(e){var t=e?this.WTable.getItem(e):null;return!t||"folder"!==t.type||".."===t.value?this.State.path:t.id},t.prototype.SelectActive=function(){var e=this.WTable;if(!1!==this.State.isActive&&!e.getSelectedId()){for(var t=this.State.selectedItem,i=0;i<t.length;i++)e.exists(t[i].id)&&e.select(t[i].id,!0);if(!t.$noSelect&&!e.getSelectedId()){var n=e.getFirstId();n&&(e.select(n),t.$noSelect=!1)}webix.delay((function(){return webix.UIManager.setFocus(e)}))}},t.prototype.GetSelection=function(){var e=this;return this.WTable.getSelectedId(!0).map((function(t){return e.WTable.getItem(t)}))},t.prototype.LoadData=function(e,t){var i=this;this._Track=!1;var n=this.WTable;t?(n.clearAll(),this.app.getService("backend").search(e,t).then((function(e){if(i.app){for(var t=0;t<e.length;++t)i.Local.prepareData(e[t]);n.parse(e),i.GetSearchStats(e)}}))):n.data.url!==e&&(n.clearAll(),this.Local.files(e).then((function(e){i.app&&(i.RenderData(e),i.SelectActive())}))),this._Track=!0},t.prototype.MoveFiles=function(e,t){return this.app.getService("operations").move(e,this.GetTargetFolder(t)),!1},t.prototype.Icon=function(e){return'<img class="webix_fmanager_file-type-icon" src="'+this.app.getService("backend").icon(e)+'" />'},t.prototype.DragMarker=function(e){var t=this.WTable,i=t.find((function(e){return".."===e.value}),!0);if(i){var n=e.source.indexOf(i.id);-1!==n&&e.source.splice(n,1)}var r=e.source.length;if(!r)return!1;1===r&&t.select(e.source[0]);var o=t.getItem(e.source[0]),a="<div class='webix_fmanager_grid_drag_zone_list'>";if(a+='<div class="webix_fmanager_inner_drag_zone_list">'+("folder"===o.type?G:this.Icon(o))+o.value+"</div>",a+="</div>",r>1){a="<div class='webix_drag_main'>"+a+"</div>";var s="<div class='webix_drag_multiple'></div>";r>2&&(s="<div class='webix_drag_multiple_last'></div>"+s),a=s+(a+="<div class='webix_badge'>"+r+"</div>")}e.html=a},t.prototype.AddHotkeys=function(){var e=this,t=webix.env.isMac?"COMMAND":"CTRL",i=[{key:"DELETE",oper:"delete"},{key:"BACKSPACE",oper:"delete"},{key:t+"+C",oper:"copy"},{key:t+"+X",oper:"cut"},{key:t+"+V",oper:"paste"},{key:t+"+R",oper:"rename"},{key:t+"+O",oper:"open"},{key:t+"+D",oper:"download"},{key:t+"+Alt+O",oper:"locate"}];this.app.config.editor&&i.push({key:t+"+E",oper:"edit"});for(var n=function(t){r.on(N(r.getRoot()),i[t].key,(function(n,r){var o=[i[t].oper];e.app.callEvent("app:action",o),webix.html.preventEvent(r)}))},r=this,o=0;o<i.length;++o)n(o);this.on(N(this.getRoot()),t+"+A",(function(t,i){e.WTable.selectAll(),webix.html.preventEvent(i)}))},t.prototype.GetSearchStats=function(e){var t=e.length,i=e.filter((function(e){return"folder"===e.type}));this.State.searchStats={folders:i?i.length:0,files:t-i.length}},t.prototype.EmptyClick=function(){!1!==this.State.isActive?this.WTable.unselectAll():this.ShiftFocus()},t}(p),Y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.getParam("compact",!0),i="mini"===webix.skin.$name||"compact"===webix.skin.$name;return{view:"dataview",localId:"cards",drag:!t,select:!0,multiselect:!0,css:"webix_noselect webix_fmanager_cards",template:function(t){return e.CardTemplate(t)},type:n(n({},i?{height:149,width:181,padding:16}:{height:197,width:236,padding:20}),{type:"tiles"}),on:{onItemDblClick:function(){return e.Activate(e.GetSelection())},onEnter:function(){return e.Activate(e.GetSelection())},onBeforeDrag:function(t){return e.DragMarker(t)},onBeforeDrop:function(t){return e.MoveFiles(t.source,t.target)}},onClick:{webix_fmanager_menu_icon:function(t){e.Menu.Show(t)},webix_dataview:function(t,i){i||e.EmptyClick()}},onContext:{webix_dataview:function(t,i){i||e.EmptyClick()}}}},t.prototype.init=function(){this.WTable=this.$$("cards"),e.prototype.init.call(this)},t.prototype.RenderData=function(e){var t=this;this.WTable.sync(e,(function(){return t.WTable.filter((function(e){return".."!==e.value}))}))},t.prototype.CardTemplate=function(e){var t,i,n=this.app.getService("locale")._;if("folder"===e.type)t="<div class=\"webix_fmanager_card_preview\"><span class='webix_icon wxi-folder webix_fmanager_folder_icon'></span></div>",i='<div class="webix_fmanager_card_panel">\n\t\t<span class="webix_fmanager_card_label">'+n("Folder")+'</span>\n\t\t<span class="webix_fmanager_card_name folder">'+this.SearchTemplate(e.value)+"</span>"+q+"\n\t\t</div>";else{var r=webix.skin.$active.listItemHeight<29?[163,92]:[214,124],o=this.app.getService("backend").previewURL(e,r[0],r[1]);t='<div class="webix_fmanager_card_preview file">'+('<img height="'+r[1]+'" width="'+r[0]+'" src="'+o+'" onerror=\'this.style.display="none"\'/>')+"</div>",i='<div class="webix_fmanager_card_panel file">\n\t\t<span class="webix_fmanager_card_name">'+this.Icon(e)+'<span class="file_name_text">'+this.SearchTemplate(e.value)+"</span></span>"+q+"\n\t\t</div>"}return t+i},t.prototype.SearchTemplate=function(e){if(this.State.search){var t=new RegExp("("+this.State.search+")","gi");return e.replace(t,"<span class='webix_fmanager_search_mark'>$1</span>")}return e},t}(X);function Z(e){var t=e.value.lastIndexOf(".");t>-1?e.setSelectionRange(0,t):e.select()}function Q(e,t,i){if(!((i=i||{i:0,cancel:!1}).i>=e.length))return t(e[i.i],i.i).then((function(){if(i.i+=1,!i.cancel)return Q(e,t,i)}))}function ee(e){return e>=1e9?(e/1e9).toFixed(1)+" Gb":e>=1e6?(e/1e6).toFixed(1)+" Mb":e>=1e3?(e/1e3).toFixed(1)+" kb":e+" b"}function te(e){return e.length?e[e.length-1]:{type:"empty",value:"Nothing is selected"}}function ie(e){for(e=e.replace(/[/\\:*?"<>|]/g,"").trim();"."===e[0];)e=e.substr(1).trim();return e}function ne(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}webix.protoUI({name:"codemirror-editor",defaults:{mode:"javascript",lineNumbers:!0,matchBrackets:!0,theme:"default"},$init:function(e){this.$view.innerHTML="<textarea style='width:100%;height:100%;'></textarea>",this._textarea=this.$view.firstChild,this._waitEditor=webix.promise.defer(),this.$ready.push(this._render_cm_editor)},complex_types:{php:{mode:["xml","javascript","css","htmlmixed","clike"]},htmlembedded:{mode:["xml","javascript","css","htmlmixed"],addon:["mode/multiplex"]},htmlmixed:{mode:["xml","javascript","css"]},dockerfile:{addon:["mode/simple"]}},_render_cm_editor:function(){if(!1!==this.config.cdn){var e=this.config.cdn||"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/",t=[e+"/codemirror.css",e+"/codemirror.js"],i=this.config.mode?this.config.mode:"javascript",n=this.complex_types[i];n&&(n.mode&&n.mode.forEach((function(i){var n="/mode/"+i+"/"+i+".js";t.push(e+n)})),n.addon&&n.addon.forEach((function(i){var n="/addon/"+i+".js";t.push(e+n)}))),t.push(e+"/mode/"+i+"/"+i+".js"),this.config.theme&&"default"!==this.config.theme&&t.push(e+"/theme/"+this.config.theme+".css"),this.config.matchBrackets&&t.push(e+"/addon/edit/matchbrackets.js"),webix.require(t).then(webix.bind(this._render_when_ready,this)).catch((function(e){console.log(e)}))}else this._render_when_ready},_render_when_ready:function(){this._editor=CodeMirror.fromTextArea(this._textarea,{mode:this.config.mode,lineNumbers:this.config.lineNumbers,matchBrackets:this.config.matchBrackets,theme:this.config.theme}),this._waitEditor.resolve(this._editor),this.setValue(this.config.value),this._focus_await&&this.focus()},_set_inner_size:function(){this._editor&&this.$width&&(this._updateScrollSize(),this._editor.scrollTo(0,0))},_updateScrollSize:function(){var e=this._editor.getWrapperElement(),t=(this.$height||0)+"px";e.style.height=t,e.style.width=(this.$width||0)+"px";var i=this._editor.getScrollerElement();i.style.height!=t&&(i.style.height=t,this._editor.refresh())},$setSize:function(e,t){webix.ui.view.prototype.$setSize.call(this,e,t)&&this._set_inner_size()},setValue:function(e){e||0===e||(e=""),this.config.value=e,this._editor&&(this._editor.setValue(e),this.config.preserveUndoHistory||this._editor.clearHistory(),this._updateScrollSize())},getValue:function(){return this._editor?this._editor.getValue():this.config.value},focus:function(){this._focus_await=!0,this._editor&&this._editor.focus()},getEditor:function(e){return e?this._waitEditor:this._editor},undo:function(){this._editor.undo()},redo:function(){this._editor.redo()},undoLength:function(){return this._editor.historySize().undo}},webix.ui.view);var re={css:["css","less"],go:["go"],htmlmixed:["html","xml","svg"],javascript:["js","mjs","json","ts","coffee"],markdown:["md"],php:["php","phtml","php3","php4","php5","php7","php-s","pht","phar"],python:["py","pyc","pyd","pyo","pyw","pyz"],sql:["sql","sqlite3","sqlite","db"],yaml:["yaml","yml"],shell:["sh"]},oe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this;this._=this.app.getService("locale")._,this.Files=this.getParam("files");var t={view:"tabbar",localId:"tabbar",css:"webix_fmanager_editor_tabs",borderless:!0,tabMinWidth:170,moreTemplate:"<span class='webix_icon webix_tabbar_more fmi-format-list-bulleted'></span>",tooltip:function(e){return e.id},options:[],on:{onChange:function(t){return e.OpenDoc(t)},onBeforeTabClick:function(t,i){return e.TabAction(t,i)}},tabbarPopup:{css:"webix_gantt_editor_popup"}},i=webix.skin.$active,n={view:"toolbar",css:"webix_fmanager_editor_bar",padding:{left:4,right:4,top:0,bottom:0},height:i.toolbarHeight+!(i.toolbarHeight%2),cols:webix.env.mobile?this.GetMobileControls():[t]};return webix.env.mobile?n.cols.push(this.GetCloseAll(!0)):n.cols.push({width:12},this.GetCloseAll()),{type:"wide",rows:[n,{view:"codemirror-editor",localId:"editor",theme:"contrast"==webix.skin.$name||"dark"===webix.skin.$name?"monokai":"default"}]}},t.prototype.GetMobileControls=function(){var e=this;return[{view:"button",localId:"saveBtn",type:"icon",label:this._("Save"),icon:"wxi-check",css:"webix_primary webix_fmanager_editor_save",width:90,click:function(){return e.Save()}},{view:"label",label:" ",localId:"name",css:"webix_fmanager_editor_name"}]},t.prototype.GetCloseAll=function(e){var t=this;return{view:"icon",icon:e?"wxi-close":"fmi-exit-to-app",click:function(){return t.ConfirmAll()},tooltip:this._("Close the editor")+" (Esc)"}},t.prototype.init=function(){var e=this,t=this.$$("editor");if(webix.extend(t,webix.ProgressBar),t.showProgress({type:"top"}),webix.env.mobile){var i=this.Files[0];this.$$("name").setValue(this.GetFileLabel(i))}this._oldValue={},this._changed={},this._buffers={},t.getEditor(!0).then((function(i){Q(e.Files,(function(t){return e.app.getService("operations").read(t.id).then((function(i){return e.AddDoc(t,i)}))})).then((function(){if(!webix.env.mobile){for(var t=e.$$("tabbar"),i=0;i<e.Files.length;++i)e.AddTab(t,e.Files[i]);t.setValue(t.config.options[0].id)}e.OpenDoc(e.Files[0].id)})).finally((function(){t.hideProgress()})),e.HandleChanges(i)}));var n=webix.env.isMac?"COMMAND":"CTRL";this.on(N(),n+" + S",(function(t,i){e.Save(),webix.html.preventEvent(i)})),this.on(N(),n+" + Shift + S",(function(){return e.SaveAll()})),this.on(N(),"ESC",(function(){return e.ConfirmAll()}))},t.prototype.HandleChanges=function(e){var t=this;e.on("changes",(function(){t.TextChanged(t.GetActiveFile())}))},t.prototype.AddDoc=function(e,t){this._oldValue[e.id]=t,this._buffers[e.id]=CodeMirror.Doc(t,this.GetFileType(e))},t.prototype.GetFileLabel=function(e,t){return'<div class="filename">'+this.ClipName(t?e.value:e.id)+'</div><span class="extension">.'+e.$ext+"</span>"},t.prototype.ClipName=function(e){if(!e)return"";var t=e.split(".");return t.slice(0,t.length-1).join(".")},t.prototype.AddTab=function(e,t){var i='<span class="webix_fmanager_tab_action webix_icon wxi-close" webix_tooltip="'+this._("Close this file")+'"></span>',n='<div class="tab_content">'+this.GetFileLabel(t,!0)+i+"</div>",r=webix.html.getTextSize(t.value,"webix_item_tab").width+90;e.addOption({id:t.id,value:n,css:"webix_fmanager_editor_tab",width:r>250?250:r})},t.prototype.OpenDoc=function(e){var t=this;this.$$("editor").getEditor(!0).then((function(i){i.swapDoc(t._buffers[e]),i.focus()}))},t.prototype.Back=function(){this.show("/top",{params:{state:this.getParam("state")}})},t.prototype.ConfirmAll=function(){var e=this;this.CheckChanges()?webix.confirm({container:this.app.getRoot().$view,text:this._("Are you sure you want to exit without saving?")}).then((function(){return e.Back()})):this.Back()},t.prototype.TabAction=function(e,t){if(t){var i=t.target.className,n=-1!==i.indexOf("webix_icon")&&e==this.$$("tabbar").getValue();return n&&(-1!==i.indexOf("close")?this.CloseTab(e):-1!==i.indexOf("circle")&&this.ConfirmOne(e)),!n}return!0},t.prototype.ConfirmOne=function(e){var t=this;webix.confirm({container:this.app.getRoot().$view,text:this._("Save before closing?")}).then((function(){t.Save(e).then((function(){return t.CloseTab(e)}))})).catch((function(){t.CloseTab(e)}))},t.prototype.CheckChanges=function(){for(var e in this._changed)if(this._changed[e])return!0;return!1},t.prototype.SaveAll=function(){var e=this,t=this.Files.filter((function(t){return e._changed[t.id]}));t.length&&Q(t,(function(t){return e.WriteFileContent(t.id)})).then((function(){e.ChangeTextState(!1)}))},t.prototype.Save=function(e){var t=this;return e||(e=this.GetActiveFile()),this._changed[e]?this.WriteFileContent(e).then((function(){t.ChangeTextState(!1,e)})):webix.promise.resolve()},t.prototype.WriteFileContent=function(e){var t=this,i=this._buffers[e].getValue();return this.app.getService("operations").write(e,i).then((function(){t._oldValue[e]=i}))},t.prototype.GetActiveFile=function(){return webix.env.mobile?this.Files[0].id:this.$$("tabbar").getValue()},t.prototype.GetFileType=function(e){if("Dockerfile"===e.value)return"dockerfile";if(e.$ext)for(var t in re)if(-1!==re[t].indexOf(e.$ext))return t;return"htmlmixed"},t.prototype.TextChanged=function(e){var t=this._buffers[e]==this._oldValue[e];this.ChangeTextState(!t,e)},t.prototype.ChangeTextState=function(e,t){t&&e===!!this._changed[t]||(t?this._changed[t]=e:this._changed={},webix.env.mobile?this.ChangeButtonState(e):this.ChangeTabsState(e,t))},t.prototype.ChangeButtonState=function(e){var t=this.$$("saveBtn");t.config.icon=e?"webix_fmanager_icon fmi-circle":"wxi-check",t.refresh()},t.prototype.ChangeTabsState=function(e,t){var i=this.$$("tabbar");if(t){var n=i.getOption(t);this.ChangeTabState(n,e)}else for(var r=i.config.options,o=0;o<r.length;++o)this.ChangeTabState(r[o],e);i.refresh()},t.prototype.ChangeTabState=function(e,t){e.value=e.value.replace(t?"wxi-close":"webix_fmanager_icon fmi-circle",t?"webix_fmanager_icon fmi-circle":"wxi-close")},t.prototype.CloseTab=function(e){var t=this.$$("tabbar");if(t.removeOption(e),!t.getValue())return this.Back();delete this._buffers[e],delete this._changed[e],delete this._oldValue[e]},t}(p);function ae(e,t){var i=new webix.promise.defer;return webix.ui(t.getService("jet-win").updateConfig({view:"window",css:"webix_fmanager_prompt",head:{view:"toolbar",padding:{left:12,right:4},borderless:!0,elements:[{view:"label",label:e.text},{view:"icon",icon:"wxi-close",hotkey:"esc",click:function(){i.reject("prompt cancelled"),this.getTopParentView().close()}}]},body:{view:"form",padding:{top:0,left:12,right:12,bottom:12},rows:[{margin:10,cols:[{view:"text",name:"name",value:e.value,maxWidth:230,validate:ie,css:"webix_fmanager_prompt_input"},{view:"button",value:e.button,css:"webix_primary",width:100,hotkey:"enter",click:function(){var e=this.getTopParentView(),t=e.getBody();if(t.validate()){var n=t.getValues().name;i.resolve(n),e.close()}else webix.UIManager.setFocus(t)}}]}]},on:{onShow:function(){var t=this.getBody().elements.name.getInputNode();t.focus(),e.selectMask?e.selectMask(t):t.select()}}})).show(),i}var se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._;return{view:"popup",width:198,body:{view:"menu",autoheight:!0,layout:"y",css:"webix_fmanager_add_new_menu",data:[{id:"makefile",value:t("Add new file"),icon:"webix_fmanager_icon fmi-file-plus-outline"},{id:"makedir",value:t("Add new folder"),icon:"webix_fmanager_icon fmi-folder-plus-outline"},{$template:"Separator"},{id:"upload",value:t("Upload file"),icon:"webix_fmanager_icon fmi-file-upload-outline"},{id:"uploaddir",value:t("Upload folder"),icon:"webix_fmanager_icon fmi-folder-upload-outline"}],on:{onMenuItemClick:function(t){return e.StartAction(t)}}}}},t.prototype.Show=function(e){this.getRoot().show(e,{x:20})},t.prototype.StartAction=function(e){var t=this;if("makefile"===e||"makedir"===e){var i=this.app.getService("locale")._;ae({text:i("Enter a new name"),button:i("Add"),selectMask:Z,value:"New "+("makefile"===e?"file.txt":"folder")},this.app).then((function(i){t.app.callEvent("app:action",[e,ie(i)])}))}else this.app.callEvent("app:action",[e]);this.getRoot().hide()},t}(p),ce=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._;return{view:"proxy",body:{rows:[{view:"button",value:t("Add New"),inputWidth:210,css:"webix_primary",align:"center",click:function(){this.$scope.Menu.Show(this.$view)}},{view:"tree",localId:"tree",css:"webix_fmanager_tree",select:!0,drag:"target",type:{template:function(e,i){return""+i.icon(e)+i.folder(e)+" <span>"+(1===e.$level?t(e.value):e.value)+"</span>"},folder:function(e){return"<div class='webix_icon wxi-"+(e.icon||"folder")+"'></div>"}},borderless:!0,on:{onBeforeDrop:function(t){return e.MoveFiles(t.source,t.target)},onBeforeContextMenu:function(t){if(".."===t.substr(0,2))return!1;e.Tree.select(t)}}},{localId:"fs:stats",borderless:!0,height:68,css:"webix_fmanager_fsstats",template:function(e){return'<svg width="100%" height="20px">\n<rect y="1" rx="4" width="100%" height="8" style="fill:#DFE2E6;" />\n<rect y="1" rx="4" width="'+(Math.floor(e.used/e.total*100)||0)+'%" height="8" style="fill:'+webix.skin.$active.timelineColor+';" /></svg>'+('<div class="webix_fmanager_fsstats_label">'+ee(e.used||0)+" "+t("of")+" "+ee(e.total||0)+" "+t("used")+"</div>")}}],padding:{top:8,bottom:4}}}},t.prototype.init=function(){var e=this;this.State=this.getParam("state"),this.Tree=this.$$("tree"),this.app.getService("local").folders().then((function(t){e.Tree.sync(t),e.Subscribe(),e.GetFsStats()})),this.Menu=this.ui(se),this.ContextMenu=this.ui(new(this.app.dynamic(J))(this.app,{compact:!1,tree:!0})),this.ContextMenu.AttachTo(this.Tree,(function(t){var i=e.Tree.locate(t);return i?[e.Tree.getItem(i)]:null})),this.on(this.app,"reload:fs:stats",(function(){return e.GetFsStats(!0)}))},t.prototype.Subscribe=function(){var e=this;this.Tree.attachEvent("onAfterSelect",(function(){var t=e.Tree.getSelectedId();".."==t.substr(0,2)?e.State.$batch({source:t.slice(3),path:"/"}):e.State.$batch({source:e.GetRootId(t).slice(3),path:t}),e.TreeState=e.Tree.getState()})),this.Tree.attachEvent("onAfterOpen",(function(){e.TreeState=e.Tree.getState()})),this.on(this.State.$changes,"path",(function(t){if(e.State.path=t,e.Tree.exists(t)){e.Tree.select(t);var i=e.Tree.getParentId(t);i&&e.Tree.open(i),e.Tree.showItem(t)}else e.Tree.select("../"+e.State.source)})),this.app.getService("local").folders().then((function(t){e.on(t.data,"onStoreUpdated",(function(t){!t&&e.Tree.count()&&e.Tree.setState(e.TreeState)}))}))},t.prototype.GetFsStats=function(e){var t=this;this.app.getService("backend").getInfo(e).then((function(e){t.$$("fs:stats").setValues(e.stats)}))},t.prototype.MoveFiles=function(e,t){return"../files"===t&&(t="/"),this.app.getService("operations").move(e,t),!1},t.prototype.GetRootId=function(e){for(var t;e;)t=e,e=this.Tree.getParentId(e);return t},t}(p),ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._,i=this.getParam("compact",!0),n={view:"datatable",localId:"table",css:"webix_noselect webix_header_border webix_fmanager_filelist",select:"row",multiselect:!0,drag:!0,resizeColumn:{headerOnly:!0},sort:"multi",type:{backIcon:function(){return"<span class='webix_icon wxi-angle-double-left webix_fmanager_back_icon'></span>"},backLabel:function(){return t("back to parent folder")}},on:{onItemDblClick:function(){return e.Activate(e.GetSelection())},onEnter:function(){return e.Activate(e.GetSelection())},onBeforeDrag:function(t){return e.DragMarker(t)},onBeforeDrop:function(t){return e.MoveFiles(t.source,t.target)},"data->onStoreLoad":function(){e.WTable.markSorting()}},onClick:{webix_ss_center_scroll:function(){return e.EmptyClick()},webix_column:function(){return!1}},onContext:{webix_ss_center_scroll:function(t,i){i||e.EmptyClick()}},columns:[{id:"value",header:"",template:function(t){return e.NameTemplate(t)},sort:pe("value"),fillspace:!0},{id:"size",header:t("Size"),template:function(e){return"folder"!==e.type?ee(e.size):""},sort:pe("size")},{id:"date",header:t("Date"),sort:pe("date"),format:function(e){return e instanceof Date&&!isNaN(e)?webix.i18n.longDateFormatStr(e):""},width:150}]};return i&&n.columns.splice(1,2),n},t.prototype.init=function(){var t=this;this.WTable=this.$$("table"),e.prototype.init.call(this),this.on(this.State.$changes,"isActive",(function(e){e?(t.SelectActive(),webix.delay((function(){return webix.UIManager.setFocus(t.WTable)}))):(t.Menu.Hide(),t._Track=!1,t.WTable.unselect(),t._Track=!0)})),this.on(N(this.getRoot()),"TAB",(function(){t.getParam("trackActive",!0)&&(t.State.isActive=!1)}))},t.prototype.RenderData=function(e){this.WTable.sync(e)},t.prototype.NameTemplate=function(e){return"folder"===e.type?G+e.value:this.Icon(e)+'<span class="file-name">'+e.value+"</span>"},t}(X);function pe(e){return function(t,i){return".."===t.value||".."===i.value||"folder"===t.type&&"folder"!==i.type||"folder"===i.type&&"folder"!==t.type?0:"value"===e?t.value.localeCompare(i.value,void 0,{ignorePunctuation:!0,numeric:!0}):t[e]<i[e]?-1:t[e]>i[e]?1:0}}var le=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){return this.app.getService("jet-win").updateConfig({view:"window",borderless:!0,head:!1,fullscreen:!0,body:{$subview:!0,branch:!0,name:"preview"}})},t.prototype.IsVisible=function(){return this.getRoot().isVisible()},t.prototype.Show=function(e){this.show("preview",{target:"preview",params:{state:e.state,compact:!0}}),this.getRoot().show()},t.prototype.Hide=function(){this.show("_blank",{target:"preview"}),this.getRoot().hide()},t}(p),he=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this;return{view:"sidemenu",css:"webix_files_sidemenu",width:300,animate:!1,state:function(t){var i=webix.skin.$active.toolbarHeight+14;t.left=e.Parent.left,t.top=e.Parent.top+i,t.height=e.Parent.height-i},body:ce}},t.prototype.init=function(){var e=this;this.on(this.app,"view:resize",(function(){e.getRoot().isVisible()&&e.Show(!0)}))},t.prototype.Show=function(e){!e&&this.getRoot().isVisible()||(this.Parent=this.app.getRoot().$view.getBoundingClientRect(),this.getRoot().show())},t}(p),fe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){return{type:"wide",cols:[{$subview:!0,branch:!0,name:"left"},{view:"resizer"},{$subview:!0,branch:!0,name:"right"}]}},t.prototype.init=function(){this.State=this.getParam("state");var e=z({selectedItem:[].concat(this.State.selectedItem),path:this.State.path,source:this.GetSource("left"),mode:"list",isActive:!0});e.selectedItem.$noSelect=this.State.selectedItem.$noSelect;var t=z({selectedItem:[],path:this.State.path,source:this.GetSource("right"),mode:"list",isActive:!1});this._TrackChanges(e,t),this._TrackChanges(t,e),this.show("panel/list",{target:"left",params:{trackActive:!0,state:e}}),this.show("panel/list",{target:"right",params:{trackActive:!0,state:t}})},t.prototype._TrackChanges=function(e,t){var i=this;this.on(e.$changes,"path",(function(t){e.isActive&&(i.State.path=t)})),this.on(e.$changes,"source",(function(e){return i.State.source=e})),this.on(e.$changes,"selectedItem",(function(t){e.isActive&&(i.State.selectedItem=t)})),this.on(e.$changes,"isActive",(function(n){n&&i.State.$batch({path:e.path,source:e.source}),t.isActive=!n})),this.on(this.app,"pathChanged",(function(t,i){e.isActive||e.path!==t&&0!==e.path.indexOf(t+"/")||(e.path=e.path.replace(t,i))}))},t.prototype.GetSource=function(){return this.State.source},t}(p),de=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this;this.State=this.getParam("state");var t=this.app.getService("locale")._;return{rows:[{view:"toolbar",cols:[{view:"icon",icon:"wxi-angle-left",click:function(){e.State.$batch({search:"",searchStats:null})}},{localId:"header",type:"header",borderless:!0,css:"webix_fmanager_path",template:function(i){var n=t("Search results in"),r=e.app.getService("backend").getRootName(),o="";return i&&i.path&&"/"!==i.path&&(o=webix.template.escape(i.path)),n+" "+r+o}},{}]},{$subview:!0,params:{state:this.State}}]}},t.prototype.init=function(){this.$$("header").setValues({path:this.State.path})},t.prototype.ready=function(){var e=this;this.on(this.State.$changes,"search",(function(t){(t=t.trim())&&(e.State.selectedItem=[],e.getSubView().LoadData(e.State.path,t))}))},t}(p),ve=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this;return{rows:[{view:"toolbar",paddingX:4,cols:[{view:"icon",icon:"wxi-sync",css:"webix_fmanager_spec_icon",tooltip:"Refresh",click:function(){e.app.getService("local").refresh(e.State.path)}},{view:"template",localId:"path",borderless:!0,css:"webix_fmanager_path",template:function(t){return e.RenderPath(t)},onClick:{webix_fmanager_path_chunk:function(t){return e.ChangePath(t)}}}]},{$subview:!0,params:{state:this.getParam("state")}}]}},t.prototype.init=function(){var e=this;this.State=this.getParam("state"),this.on(this.State.$changes,"path",(function(t){return e.ProcessPath(t)}));var t=this.app.getService("upload").getUploader();t.addDropZone(this.getRoot().$view),this.on(t,"onBeforeFileDrop",(function(i,n){e.getRoot().$view.contains(n.target)&&(t.config.tempUrlData={id:e.State.path})}))},t.prototype.ProcessPath=function(e){var t=this;this.app.getService("local").folders().then((function(i){var n=["/"];if("/"!==e)for(var r=e.split("/"),o=1,a="";o<r.length;++o)a+="/"+r[o],n.push(i.getItem(a).value);t.$$("path").setValues({path:n})}))},t.prototype.RenderPath=function(e){if(e.path&&e.path.length){var t=this.app.getService("backend").getRootName(),i="";return e.path.forEach((function(n,r){i+='<span class="webix_fmanager_path_chunk" data-path="'+r+'">'+(r?n:t)+"</span>",r<e.path.length-1&&(i+="<span class='webix_icon wxi-angle-right'></span>")})),i}return""},t.prototype.ChangePath=function(e){var t=1*e.target.getAttribute("data-path"),i=this.State.path.split("/");i.splice(t+1,i.length-1);var n=i.join("/")||"/";this.State.path=n},t}(p),ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._,i=webix.Date.dateToStr("%M %j, %Y&nbsp;&nbsp;&nbsp;&nbsp;%H:%i:%s"),n={css:"webix_fmanager_preview_info",localId:"info",borderless:!0,autoheight:!0,template:function(t){if(!t.id)return"";var n=e.app.getService("locale")._;return"<div>"+("<div class='key_col'>"+("folder"===t.type?["Type","Date"]:["Type","Size","Date"]).map((function(e){return"<div class='key_value_cell''>"+n(e)+"</div>"})).join("")+"</div>")+('<div class="value_col">'+("folder"===t.type?[ne(n(t.type)),i(t.date)]:[ne(n(t.type)),ee(t.size),i(t.date)]).map((function(e){return"<div class='key_value_cell'>"+e+"</div>"})).join("")+"</div>")+"</div>"}},r={css:"webix_fmanager_preview_info extra",localId:"extra:info",hidden:!0,autoheight:!0,template:function(e){for(var t=Object.keys(e),i="<div class='key_col'>",n=0;n<t.length;++n)i+="<div class='key_value_cell key'>"+t[n]+"</div>";i+="</div>";var r="<div class='value_col'>";for(var o in e){var a=e[o].trim();r+="<div class='key_value_cell'>"+(a&&"0"!=a?a:"<span class='webix_fmanager_id3tags-unknown'>Unknown</span>")+"</div>"}return'<div><div class="webix_fmanager_info_header">\n<span class="webix_fmanager_icon fmi-information-outline"></span>\n<span class="webix_fmanager_info_title">Extra info</span>\n</div>'+i+(r+="</div>")+"</div>"}},o={localId:"search:counter",css:"webix_fmanager_preview_info",height:104,borderless:!0,template:function(e){return"<div>"+("<div class='key_col search'>"+["Folders","Files"].map((function(e){return"<div class='key_value_cell''>"+t(e)+"</div>"})).join("")+"</div>")+('<div class="value_col search">'+[e.folders,e.files].map((function(e){return"<div class='key_value_cell'>"+e+"</div>"})).join("")+"</div>")+"</div>"}};return{localId:"info:tabs",view:"tabview",css:"webix_fmanager_info_tab",cells:[{header:t("Information"),body:{padding:14,margin:14,rows:[n,r,{}]}},{header:t("Search results"),body:{padding:14,margin:14,rows:[o,{}]}}]}},t.prototype.init=function(){var e=this;this.Tabview=this.$$("info:tabs"),this.State=this.getParam("state"),this.on(this.State.$changes,"selectedItem",(function(t){e.ShowInfo(te(t))})),this.on(this.State.$changes,"searchStats",(function(t){t?e.$$("search:counter").setValues(t):e.State.selectedItem.length||e.Tabview.hide()}))},t.prototype.ShowInfo=function(e){var t=this,i=this.Tabview.getTabbar(),n=i.config.options[0].id,r=i.config.options[1].id;if("empty"!==e.type){this.SetInfo(this.$$("info"),e),this.SwitchTabs(i,r,n);var o=this.$$("extra:info"),a=this.app.getService("backend").getMeta(e);a?a.then((function(e){return t.SetExtraInfo(o,e)})).catch((function(){return o.hide()})):o.hide()}else this.State.search?this.SwitchTabs(i,n,r):this.Tabview.hide()},t.prototype.SetExtraInfo=function(e,t){!function e(t){for(var i in t){if("object"==typeof t[i])return e(t[i]);if(t[i]&&"0"!==t[i])return!1}return!0}(t)?this.SetInfo(e,t):e.hide()},t.prototype.SetInfo=function(e,t){e.setValues(t),e.show()},t.prototype.SwitchTabs=function(e,t,i){e.hideOption(t),e.setValue(i),e.showOption(i),this.Tabview.show()},t}(p);var we=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._,i=this.getParam("compact"),n=this.getParam("state");return{margin:.1,rows:[{view:"toolbar",localId:"toolbar",padding:{right:6},elements:[{view:"label",localId:"filename:label",css:"webix_fmanager_preview_name"},{view:"icon",icon:"wxi-download",css:"webix_fmanager_spec_icon",localId:"download",tooltip:t("Download file"),click:function(){e.app.callEvent("app:action",["download",[e.FileInfo]])}},{view:"icon",icon:"wxi-close",hidden:!i,click:function(){n.preview=!n.preview}}]},{view:"scrollview",borderless:!0,body:{type:"wide",margin:10,rows:[{view:"proxy",minHeight:413,borderless:!0,body:{$subview:!0,name:"preview"}},ge]}}]}},t.prototype.init=function(){var e=this;this.on(this.getParam("state").$changes,"selectedItem",(function(t){var i=te(t);e.ShowInfo(i),e.FileInfo=i;var n=e.$$("download");"folder"===i.type?n.hide():n.show()}))},t.prototype.ShowInfo=function(e){var t="preview.template";!this.app.config.player||"audio"!==e.type&&"video"!==e.type||(t="preview.media"),"empty"!==e.type?(this.$$("filename:label").setValue(e.value),this.$$("toolbar").show()):this.$$("toolbar").hide(),this.show(t,{target:"preview",params:{info:e}})},t}(p);webix.protoUI({name:"plyr-player",defaults:{config:{},source:{}},$init:function(){this.$view.innerHTML='<div class="webix_player_parent"><audio></audio></div>',this._container=this.$view.firstChild.firstChild,this.$view.style.overflow="visible",this._waitView=webix.promise.defer(),this.$ready.push(this.render)},getPlayer:function(e){return e?this._waitView:this._player},render:function(){if(!1===this.config.cdn||window.Plyr)this._initPlyr();else{var e=this.config.cdn?this.config.cdn:"https://cdn.plyr.io/3.5.10";webix.require([e+"/plyr.js",e+"/plyr.css"]).then(webix.bind(this._initPlyr,this)).catch((function(e){console.log(e)}))}},_initPlyr:function(){if(this.$view){var e=webix.extend({},this.config.config);this._player=new Plyr(this._container,e),this._player.elements.container.setAttribute("tabindex","-1"),this.attachEvent("onDestroy",(function(){this._player&&this._player.destroy()})),this._waitView.resolve(this._player),this._player.on("canplay",webix.bind((function(){this._player.media&&(this._player.media.setAttribute("tabindex","-1"),this._normalizeRatio())}),this)),this._player.on("ready",webix.bind((function(){this.$view&&(this.$view.querySelector(".plyr--full-ui").style["min-width"]="0px",this._normalizeRatio())}),this))}},$setSize:function(e,t){this.$view.firstChild.style.width=e+"px",this.$view.firstChild.style.height=t-2+"px",this._player&&this._normalizeRatio(e,t)},source_setter:function(e){this._waitView.then((function(t){e&&(t.source=e)}))},getPlyr:function(e){return e?this._waitView:this._player},_gcdRatio:function(e,t){for(e=Math.abs(e),t=Math.abs(t);t;){var i=t;t=e%t,e=i}return e},_normalizeRatio:function(e,t){if(this.$view){e=e||this.$view.clientWidth,t=t||this.$view.clientHeight;var i=this._gcdRatio(e,t),n=(e/i).toString()+":"+(t/i).toString();this._player.ratio=n}}},webix.ui.view,webix.EventSystem);var me=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){return{rows:[{localId:"albumArt",hidden:!0,css:"webix_fmanager_preview",template:'<img class="webix_fmanager_preview_icon" src="'+this.app.getService("backend").icon({type:"audio"},"big")+'" />'},{view:"plyr-player",css:"webix_fmanager_player",localId:"player",config:{controls:["play-large","play","progress","current-time","mute","volume"]}}]}},t.prototype.init=function(){var e=this,t=this.$$("albumArt").$view;webix.event(t,"dblclick",(function(){var t=e.getParam("info");e.app.callEvent("app:action",["open",[t]])}))},t.prototype.urlChange=function(){var e=this.getParam("info");this.ShowPreview(e)},t.prototype.ShowPreview=function(e){if(e){var t=this.app.getService("backend").directLink(e.id);this.SetMedia(t,e.type,e.$ext);var i=this.$$("albumArt"),n=this.$$("player");"audio"===e.type?(n.config.height=52,i.show()):(n.config.height=0,i.hide())}},t.prototype.SetMedia=function(e,t,i){this.$$("player").define({source:{type:t,sources:[{src:e,type:t+"/"+i}]}})},t}(p),ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){return{view:"template",localId:"preview",css:"webix_fmanager_preview"}},t.prototype.init=function(){var e=this,t=this.getRoot().$view;webix.event(t,"dblclick",(function(){var t=e.getParam("info");"code"===t.type&&e.app.config.editor?e.app.callEvent("app:action",["edit",[t]]):"folder"!==t.type&&"empty"!==t.type&&e.app.callEvent("app:action",["open",[t]])}))},t.prototype.urlChange=function(){var e=this.getParam("info");this.ShowPreview(e)},t.prototype.ShowPreview=function(e){var t=this.$$("preview");if("folder"===e.type)t.setHTML('<img class="webix_fmanager_preview_icon" src="'+this.app.getService("backend").icon({type:"folder"},"big")+'" />');else if("empty"===e.type)t.setHTML('<img class="webix_fmanager_preview_icon" src="'+this.app.getService("backend").icon({type:"none"},"big")+'" />');else{var i=this.app.getService("backend").previewURL(e,464,407);t.setHTML("<img style='width:100%; height:100%;' src='"+i+"' onerror='this.style.display=\"none\"'>")}},t}(p),be=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this;return this.Config=this.getParam("config"),this.app.getService("jet-win").updateConfig({view:"window",css:"webix_fmanager_progress",head:{template:this.Config.head,css:"webix_fmanager_progress_head",height:54},body:{padding:{top:0,bottom:20,left:20,right:20},margin:10,rows:[{template:function(e){return'<div class="webix_fmanager_progress_bar">\n<div class="webix_fmanager_progress_counter">'+e.done+" of "+e.total+' items</div>\n<div class="webix_fmanager_progress_name">'+e.file+"</div></div>"},localId:"counter",borderless:!0,height:59},{view:"button",value:"Stop",css:"webix_fmanager_progress_cancel",click:function(){e.State.cancel=!0,e.getRoot().disable()}}]}})},t.prototype.ready=function(){var e=this;this.WaitClose=webix.promise.defer(),this.Counter=this.$$("counter"),this.Counter.setValues({done:0,total:this.Config.files.length,file:this.Config.files[0]}),webix.extend(this.Counter,webix.ProgressBar),this.State=z({i:0,cancel:!1}),Q(this.Config.files,this.Config.code,this.State).finally((function(){return e.Close()})),this.on(this.State.$changes,"i",(function(t){return t&&e.Step(t)}))},t.prototype.Close=function(){this.Counter.showProgress({type:"bottom",position:1,delay:100}),this.show("_blank",{target:"popup"}),this.WaitClose.resolve()},t.prototype.Step=function(e){var t=this.Counter.getValues().done;this.Counter.setValues({done:e,file:this.Config.files[e-1]},!0),t=(t+1)/this.Config.files.length,this.Counter.showProgress({type:"bottom",position:Math.min(1,t),delay:100})},t}(p),_e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.getParam("compact"),i=webix.skin.$active,n=this.app.getService("locale")._,r=this.getParam("state");return{view:"toolbar",height:i.toolbarHeight+12,margin:20,paddingY:9,paddingX:12,cols:[{view:"icon",icon:"webix_fmanager_icon fmi-file-tree",click:function(){return e.app.callEvent("app:action",["toggle-folders"])},hidden:!t},{view:"label",label:n("Files"),autowidth:!0,hidden:t},{view:"search",width:t?0:300,localId:"search",placeholder:n("Search files and folders")},{hidden:t},{view:"toggle",css:"webix_fmanager_preview_toggle",type:"icon",icon:"wxi-eye",tooltip:n("Preview"),width:i.toolbarHeight<37?48:60,localId:"previewMode",on:{onChange:function(e,t,i){"user"===i&&(r.preview=!r.preview)}},hidden:t},{view:"segmented",width:124,optionWidth:40,localId:"modes",tooltip:function(e){switch(e.id){case"grid":return n("Table");case"cards":return n("Cards");case"double":return n("Total");default:return ne(e.id+"")}},options:[{value:"<span class='webix_fmanager_icon fmi-view-list webix_fmanager_mode_icon'></span>",id:"grid"},{value:"<span class='webix_fmanager_icon fmi-view-grid webix_fmanager_mode_icon'></span>",id:"cards"},{value:"<span class='webix_fmanager_icon fmi-view-array webix_fmanager_mode_icon'></span>",id:"double"}]}]}},t.prototype.init=function(){var e=this,t=this.getParam("state"),i=this.$$("modes");i.attachEvent("onChange",(function(e){e&&t.$batch({mode:e,search:""})})),this.on(t.$changes,"mode",(function(e){i.getOption(e)?i.setValue(e):i.setValue()}));var n=this.$$("search");n.attachEvent("onTimedKeyPress",(function(){t.search=n.getValue().trim()})),this.on(t.$changes,"search",(function(e){e=e.trim(),n.setValue(e)})),this.on(t.$changes,"preview",(function(t){e.$$("previewMode").setValue(1*t)})),this.on(N(),(webix.env.isMac?"COMMAND":"CTRL")+" + F",(function(e,t){n.focus(),webix.html.preventEvent(t)}))},t}(p),xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){W||(W=!0,webix.protoUI({name:"r-layout",sizeTrigger:function(e,t,i){this._compactValue=i,this._compactHandler=t,this._app=e;var n=e.config;this._forceCompact=n.params.forceCompact,this._compactWidth=n.compactWidth,this._forceCompact||this._checkTrigger(this.$view.width,i)},_checkTrigger:function(e,t){return!this._compactWidth||!(e<=this._compactWidth&&!t||e>this._compactWidth&&t)||(this._compactWidth=null,this._compactHandler(!t),!1)},$setSize:function(e,t){(this._forceCompact||this._checkTrigger(e,this._compactValue))&&webix.ui.layout.prototype.$setSize.call(this,e,t),this._app&&this._app.callEvent("view:resize",[])}},webix.ui.layout));var e=this.getParam("forceCompact");webix.isUndefined(e)||this.setParam("compact",e),this.Compact=this.getParam("compact");var t={view:"proxy",batch:"tree",width:240,minWidth:240,maxWidth:400,hidden:!0,borderless:!0,body:ce},i={type:"wide",localId:"folders",cols:[{$subview:!0,name:"center",branch:!0},{view:"proxy",borderless:!0,width:470,hidden:!0,localId:"r-side",body:{$subview:"",branch:!0,name:"r-side"}}]};return this.Compact||i.cols.unshift(t,{view:"resizer",batch:"tree"}),{view:"r-layout",type:"wide",css:"webix_files_main_layout",rows:[_e,i,{$subview:!0,popup:!0,name:"popup"}]}},t.prototype.init=function(){var e=this;this.getRoot().sizeTrigger(this.app,(function(t){return e.SetCompactMode(t)}),!!this.Compact);var t=this.getParam("state");this.State=t,this.Compact&&(this.SideTree=this.ui(he),this.PreviewPopup=this.ui(le)),this.on(this.app,"app:action",(function(t){switch(t){case"toggle-folders":e.ToggleFolders()}})),this.on(t.$changes,"mode",(function(t,i){return e.ShowMode(t,i)})),this.on(t.$changes,"search",(function(t){return e.ShowSearch(t)})),this.on(t.$changes,"preview",(function(t){return e.TogglePreview(t)})),this.app.getService("progress").handle(this.getRoot(),this.ShowProgress.bind(this))},t.prototype.ShowMode=function(e,t){var i=this.$$("folders"),n={target:"center",params:{state:this.getParam("state"),compact:this.Compact}};switch(e){case"grid":case"cards":i.showBatch("tree"),this.show("panel/"+("grid"==e?"list":e),n);break;case"double":i.showBatch(""),this.show("panel-double",n);break;case"search":this.PrevMode=this.PrevMode||t,i.showBatch(""),this.show("panel-search/cards",n)}},t.prototype.ShowProgress=function(e){var t=this;return this.show("./progress",{target:"popup",params:e}).then((function(){return t.getSubView("popup")}))},t.prototype.TogglePreview=function(e){if(this.Compact)e?this.PreviewPopup.Show({state:this.State}):this.PreviewPopup.Hide();else{var t=this.$$("r-side");e?(this.show("preview",{target:"r-side",params:{state:this.State}}),t.show()):(this.show("_blank",{target:"r-side"}),t.hide())}},t.prototype.ToggleFolders=function(){this.SideTree.Show()},t.prototype.ShowSearch=function(e){e?this.State.mode="search":("search"===this.State.mode&&(this.State.mode=this.PrevMode||"grid"),this.PrevMode="")},t.prototype.SetCompactMode=function(e){this.setParam("compact",e),this.refresh()},t}(p),Se={JetView:p};Se.cards=Y,Se.editor=oe,Se.folders=ce,Se.list=ue,Se["menus/addnewmenu"]=se,Se["menus/contextmenu"]=J,Se["menus/menubody"]=K,Se["mobile/previewpopup"]=le,Se["mobile/sidetree"]=he,Se["panel-double"]=fe,Se["panel-search"]=de,Se.panel=ve,Se.preview=we,Se["preview/info"]=ge,Se["preview/media"]=me,Se["preview/template"]=ye,Se.progress=be,Se["sections/dataview"]=X,Se.top=xe,Se.topbar=_e;var ke=function(){function e(e,t){this.app=e,this._url=t,this._features={preview:{},meta:{}}}return e.prototype.url=function(e){return this._url+e},e.prototype.search=function(e,t){return e=e||"/",this._files(this.url("files"),{id:e,search:t})},e.prototype.files=function(e){return e=e||"/",this._files(this.url("files"),{id:e})},e.prototype._files=function(e,t){var i=webix.ajax(e,t).then((function(e){return e.json()}));return this.getInfo().then((function(){return i}))},e.prototype.folders=function(e){return e=e||"/",webix.ajax(this.url("folders"),{id:e}).then((function(e){return e.json()}))},e.prototype.icon=function(e,t){var i=webix.skin.$name;return this.url("icons/"+i+"/"+(t||"small")+"/"+e.type+"/"+e.$ext+".svg")},e.prototype.upload=function(){return this.url("upload")},e.prototype.readText=function(e){return webix.ajax(this.url("text"),{id:e}).then((function(e){return e.text()}))},e.prototype.writeText=function(e,t){return webix.ajax().post(this.url("text"),{id:e,content:t}).then((function(e){return e.json()}))},e.prototype.directLink=function(e,t){return this.url("direct?id="+encodeURIComponent(e)+(t?"&download=true":""))},e.prototype.previewURL=function(e,t,i){return this._features.preview[e.type]?this.url("preview?width="+t+"&height="+i+"&id="+encodeURIComponent(e.id)):this.icon(e,"big")},e.prototype.remove=function(e){return webix.ajax().post(this.url("delete"),{id:e}).then((function(e){return e.json()}))},e.prototype.makedir=function(e,t){return webix.ajax().post(this.url("makedir"),{id:e,name:t}).then((function(e){return e.json()}))},e.prototype.makefile=function(e,t){return webix.ajax().post(this.url("makefile"),{id:e,name:t}).then((function(e){return e.json()}))},e.prototype.copy=function(e,t){return webix.ajax().post(this.url("copy"),{id:e,to:t}).then((function(e){return e.json()}))},e.prototype.move=function(e,t){return webix.ajax().post(this.url("move"),{id:e,to:t}).then((function(e){return e.json()}))},e.prototype.rename=function(e,t){return webix.ajax().post(this.url("rename"),{id:e,name:t}).then((function(e){return e.json()}))},e.prototype.getRootName=function(){return(0,this.app.getService("locale")._)("My Files")},e.prototype.getMeta=function(e){return!!this._features.meta[e.type]&&webix.ajax(this.url("meta"),{id:e.id}).then((function(e){return e.json()}))},e.prototype.getInfo=function(e){var t=this;return this._info&&!e?this._info:this._info=webix.ajax(this.url("info")).then((function(e){return e=e.json(),t._features=e.features,e}))},e}(),$e=function(){function e(e){this._store=new Map,this._limit=e,this._i=1}return e.prototype.each=function(e){this._store.forEach((function(t){return e(t.obj)}))},e.prototype.set=function(e,t){this._store.size>=this._limit&&this.prune(),this._store.set(e,{obj:t,key:e,t:this._i++})},e.prototype.get=function(e){var t=this._store.get(e);return t?(t.t=this._i++,t.obj):null},e.prototype.prune=function(){var e=[];this._store.forEach((function(t){return e.push(t)})),e=e.sort((function(e,t){return e.t>t.t?-1:1}));for(var t=Math.floor(this._limit/2);t<e.length;t++)this._store.delete(e[t].key)},e.prototype.delete=function(e){this._store.has(e)&&this._store.delete(e)},e.prototype.clear=function(){this._store.clear()},e}(),Ce=function(){function e(e,t){this.app=e,this.fscache=new $e(t),this.hierarchy=new webix.TreeCollection,this.folders_ready=null}return e.prototype.defaultDir=function(e){var t=[];return"/"!==e&&t.push({type:"folder",value:"..",$row:function(e,t){return t.backIcon()+"<span class='webix_fmanager_back'>"+t.backLabel()+"</span>"}}),t},e.prototype.files=function(e,t){var i=this.fscache.get(e);return t?i:i?Promise.resolve(i):(i=new webix.DataCollection({scheme:{$change:this.prepareData,$serialize:this.serializeData}}),this.fscache.set(e,i),this.reload(i,e))},e.prototype.serializeData=function(e){if(".."==e.value)return!1;var t={};for(var i in e)0!==i.indexOf("$")&&(t[i]=e[i]);return t},e.prototype.prepareData=function(e){"number"==typeof e.date&&(e.date=new Date(1e3*e.date)),"folder"===e.type?e.$css=e.type:e.$ext=function(e){if(!e)return"";var t=e.split(".");return t.length<2?"":t[t.length-1]}(e.value)},e.prototype.reload=function(e,t){var i=this;return this.app.getService("backend").files(t).then((function(n){return e.clearAll(),e.parse(i.defaultDir(t).concat(n)),e}))},e.prototype.refresh=function(e){var t=this.fscache.get(e);if(t)return this.reload(t,e)},e.prototype.addFile=function(e,t,i){var n=this,r=this.fscache.get(e);r&&(r.exists(t.id)||r.add(t,this.getFsPosition(r,t))),"folder"===t.type&&("/"===e&&(e="../files"),this.hierarchy.add(t,null,e),i&&this.app.getService("backend").folders(t.id).then((function(e){return e.length&&n.hierarchy.parse({parent:t.id,data:e})})))},e.prototype.getFsPosition=function(e,t){if("folder"!==t.type)return-1;var i=e.data;return i.order.findIndex((function(e){return"folder"!==i.getItem(e).type}))},e.prototype.deleteFile=function(e){var t=this.fscache,i=this.hierarchy;t.each((function(t){t&&t.exists(e)&&t.remove(e)})),t.delete(e),i.exists(e)&&i.remove(e)},e.prototype.updateFile=function(e,t,i){var n=this.hierarchy;this.fscache.each((function(n){n&&n.exists(e)&&(n.updateItem(e,t),i&&e!=i&&n.data.changeId(e,i))})),n.exists(e)&&(n.updateItem(e,t),i&&e!=i&&n.data.changeId(e,i))},e.prototype.defaultTree=function(){return[{value:"My Files",id:"../files",open:!0}]},e.prototype.folders=function(e){var t=this,i=this.hierarchy;return!e&&this.folders_ready||(this.folders_ready=this.app.getService("backend").folders().then((function(e){return i.clearAll(),i.parse(t.defaultTree()),i.parse({parent:"../files",data:e}),i}))),this.folders_ready},e}(),Te=function(){function e(e,t){this.initUploader(e),this.initEvents(e,t)}return e.prototype.initEvents=function(e,t){var i=this;e.attachEvent("app:action",(function(e,n){"upload"!=e&&"uploaddir"!=e||(n||(n=t.path||"/"),i.openDialog(e,n))}))},e.prototype.initUploader=function(e){this.uploader=this.createUploader(e),this.dirUploader=this.createUploader(e,!0)},e.prototype.createUploader=function(e,t){var i=webix.ui({view:"uploader",directory:t,apiOnly:!0,upload:e.getService("backend").upload(),on:{onAfterFileAdd:function(e){e.urlData=this.config.tempUrlData},onUploadComplete:function(){if(e.getService("progress").end(),e.callEvent("reload:fs:stats",[]),t){var i=this.config.tempUrlData.id,n=e.getService("local");n.refresh(i),n.folders(!0)}}}});return t||i.attachEvent("onFileUpload",(function(t,i){e.getService("local").addFile(t.urlData.id,i)})),i.$updateProgress=function(t,i){var n=i/100;n&&e.getService("progress").start(n)},i},e.prototype.openDialog=function(e,t){var i="upload"==e?this.uploader:this.dirUploader;i.config.tempUrlData={id:t},i.fileDialog()},e.prototype.getUploader=function(){return this.dirUploader},e}(),Pe=function(){function e(){this.view=null,this.popup=null}return e.prototype.handle=function(e,t){this.view=e,webix.extend(e,webix.ProgressBar),this.popup=t},e.prototype.start=function(e){var t=this.view;t&&!t.$destructed&&t.showProgress({type:"top",delay:3e3,hide:!0,position:e})},e.prototype.end=function(){var e=this.view;e&&!e.$destructed&&e.hideProgress()},e.prototype.files=function(e,t,i){var n=this;if(t.length)return 1==t.length?(this.start(),i(t[0],0).finally((function(){return n.end()}))):this.popup?this.popup({config:{head:e,files:t,code:i}}).then((function(e){return e.WaitClose})):void 0},e}(),Ie=function(){function e(e,t){this.app=e,this.state=t,this.initEvents()}return e.prototype.backend=function(){return this.app.getService("backend")},e.prototype.local=function(){return this.app.getService("local")},e.prototype.initEvents=function(){var e=this;this.app.attachEvent("app:action",(function(t,i){switch(t){case"open":e.open(i);break;case"download":e.download(i);break;case"edit":e.edit(i);break;case"delete":e.remove(i);break;case"makefile":e.makeFile(i);break;case"makedir":e.makeFolder(i);break;case"rename":e.rename(i);break;case"copy":case"cut":e.addToClipboard(t);break;case"paste":e.paste(i);break;case"locate":e.goUp(i)}}))},e.prototype.write=function(e,t){var i=this;return this.backend().writeText(e,t).then((function(t){return i.local().updateFile(e,{size:t.size,date:t.date})}))},e.prototype.read=function(e){return this.backend().readText(e)},e.prototype.makeFile=function(e){var t=this,i=this.state.path||"/";this.backend().makefile(i,e).then((function(e){e.invalid||t.local().addFile(i,e)}))},e.prototype.makeFolder=function(e){var t=this,i=this.state.path||"/";this.backend().makedir(i,e).then((function(e){e.invalid||t.local().addFile(i,e)}))},e.prototype.edit=function(e){var t=this.state;e||(e=t.selectedItem),(e=e.filter((function(e){return"code"===e.type}))).length&&this.app.show("/editor",{params:{files:e,state:t}})},e.prototype.open=function(e){e||(e=this.state.selectedItem);for(var t=0;t<e.length;++t)"folder"!=e[t].type&&window.open(this.backend().directLink(e[t].id),"_blank")},e.prototype.download=function(e){e||(e=this.state.selectedItem),window.open(this.backend().directLink(e[0].id,!0),"_self")},e.prototype.remove=function(e){var t=this,i=this.state,n=this.extractIds(e||i.selectedItem);if(!n.length)return webix.promise.reject();var r=this.app.getService("locale")._;return webix.confirm({title:r("Delete files"),text:this.removeConfirmMessage(e||i.selectedItem),container:this.app.getRoot().$view,css:"webix_fmanager_confirm"}).then((function(){return t.app.getService("progress").files(r("Deleting..."),n,(function(e){return t.backend().remove(e).then((function(n){n.invalid||(t.local().deleteFile(e),i.path===e&&(i.path="/"),t.app.callEvent("pathChanged",[e,"/"]),t.app.callEvent("reload:fs:stats",[]))}))}))})).then((function(){i.search&&(i.search=i.search+" ")}))},e.prototype.removeConfirmMessage=function(e){for(var t=this.app.getService("locale")._,i='<div class="question">'+t("Are you sure you want to delete")+" "+(e.length>1?t("these items:"):t("this item:"))+"</div>",n=0,r="&#9679;&nbsp;",o=e.length<6?e.length:5;n<o;++n)i+='<div class="item">'+r+e[n].value+"</div>";return n<e.length&&(i+="<div>"+r+t("and")+" "+(e.length-n)+" "+t("more file(s)")+"</div>"),i},e.prototype.rename=function(e){var t=this,i=this.state,n=e?e[0]:i.selectedItem[0];if(n){var r=this.app.getService("locale")._,o=n.id;ae({text:r("Enter a new name"),button:r("Rename"),value:n.value,selectMask:"folder"!==n.type?Z:null},this.app).then((function(e){(e=ie(e))&&e!==n.value&&t.backend().rename(o,e).then((function(e){t.local().updateFile(o,{value:e.id.split("/").pop()},e.id),"folder"===n.type&&t.reloadBranch(e.id).then((function(){i.path===o&&(i.path=e.id),t.app.callEvent("pathChanged",[o,e.id])})),i.search&&(i.search=i.search+" ")}))}))}},e.prototype.reloadBranch=function(e){var t=this.local().hierarchy;return this.app.getService("backend").folders(e).then((function(i){var n=[];t.data.eachChild(e,(function(e){return n.push(e.id)})),t.parse({parent:e,data:i}),t.remove(n)}))},e.prototype.copy=function(e,t){var i=this;if(!e.length)return webix.promise.reject();var n=this.local(),r=this.app.getService("locale")._;return this.app.getService("progress").files(r("Copying..."),e,(function(e){return i.backend().copy(e,t).then((function(e){e.invalid||n.addFile(t,e,!0)}))}))},e.prototype.move=function(e,t){var i=this;if(!e.length||!t)return webix.promise.reject();var n=this.local(),r=n.files(t,!0);if(r&&(e=e.filter((function(e){return!r.exists(e)}))),!(e=e.filter((function(e){return e!=t}))).length)return webix.promise.reject();var o=this.app.getService("locale")._;return this.app.getService("progress").files(o("Moving..."),e,(function(e){return i.backend().move(e,t).then((function(r){r.invalid||(n.deleteFile(e),n.addFile(t,r,!0),i.state.path===e&&(i.state.path=r.id),i.app.callEvent("pathChanged",[e,r.id]))}))}))},e.prototype.extractIds=function(e){if(!e.length||"string"==typeof e[0])return e;for(var t=[],i=0;i<e.length;++i)".."!==e[i].value&&t.push(e[i].id);return t},e.prototype.addToClipboard=function(e){var t=this.state.selectedItem;t.length&&(this.state.clipboard={files:t,mode:e})},e.prototype.clearClipboard=function(){this.state.clipboard=null},e.prototype.paste=function(e){var t=this.state;if(t.clipboard){var i=t.path;e&&"folder"==e[0].type&&(i=e[0].id),"copy"===t.clipboard.mode?this.copy(this.extractIds(t.clipboard.files),i):"cut"===t.clipboard.mode&&this.move(this.extractIds(t.clipboard.files),i),this.clearClipboard()}},e.prototype.goUp=function(e){var t=this.state;if(t.search){var i=e?e[0]:t.selectedItem[0];if(!i)return;var n=i.id.split("/"),r="/"+n.slice(1,n.length-1).join("/");t.$batch({search:"",searchStats:null,path:r})}},e}(),Ee=function(e){function t(t){var i,r,o,a=this,s=z({mode:t.mode||"grid",selectedItem:[],search:"",searchStats:null,path:t.path||"/",source:t.source||"files",clipboard:null,preview:!1}),c={router:y,version:"10.0.1",debug:!0,start:"/top",params:{state:s,forceCompact:t.compact},editor:!0,player:!0,compactWidth:640};return(a=e.call(this,n(n({},c),t))||this).setService("backend",new(a.dynamic(ke))(a,a.config.url)),a.setService("local",new(a.dynamic(Ce))(a,10)),a.setService("progress",new(a.dynamic(Pe))(a)),a.setService("upload",new(a.dynamic(Te))(a,s)),a.setService("operations",new(a.dynamic(Ie))(a,s)),o={updateConfig:function(e){var t=i.getRoot(),n=t.$view;r?r&&!n.id&&(n.id=r):(n.id?r=n.id:n.id=r="webix_"+webix.uid(),webix.html.addStyle(".webix_win_inside *:not(.webix_modal_box):not(.webix_modal_cover){ z-index: 0; }"),webix.html.addStyle("#"+r+"{ position: relative; }"),webix.html.addStyle("#"+r+" .webix_window{ z-index:2 !important; }"),webix.html.addStyle("#"+r+" .webix_disabled{ z-index:1 !important; }")),e.container=r,e.fullscreen&&(e._fillApp=!0,delete e.fullscreen),e.on||(e.on={});var o=!0,a=e.on.onShow;return e.on.onShow=function(){var e=this;a&&a.apply(this,arguments),o&&(this.$setSize=function(i,n){B(e,t,!0),webix.ui.window.prototype.$setSize.apply(e,[i,n])},H(this,i),o=null),webix.callEvent("onClick",[]),webix.html.addCss(n,"webix_win_inside"),t.disable(),B(this,t)},e}},(i=a).setService("jet-win",o),a.use(M,a.config.locale||{lang:"en",webix:{en:"en-US",zh:"zh-CN"}}),a}return i(t,e),t.prototype.dynamic=function(e){return this.config.override&&this.config.override.get(e)||e},t.prototype.require=function(e,t){return"jet-views"===e?Se[t]:"jet-locales"===e?Fe[t]:null},t.prototype.getState=function(){return this.config.params.state},t}(m);webix.protoUI({name:"filemanager",app:Ee,getState:function(){return this.$app.getState()},getService:function(e){return this.$app.getService(e)},$init:function(){this.$view.className+=" webix_files";var e=this.$app.getState();for(var t in e)U(e,this.config,t)}},webix.ui.jetapp);var Ae={Backend:ke,LocalData:Ce,Upload:Te,Progress:Pe,Operations:Ie},Fe={en:{Save:"Save","Save all":"Save all",Rename:"Rename",Open:"Open",Edit:"Edit",Delete:"Delete",Folder:"Folder","Add New":"Add New","My Files":"My Files",Size:"Size",Date:"Date","back to parent folder":"back to parent folder",Download:"Download",Type:"Type",Information:"Information",Files:"Files",Table:"Table",Cards:"Cards",Total:"Total","Are you sure ?":"Are you sure ?",Details:"Details","Enter a new name":"Enter a new name",Add:"Add","Select something":"Select something","Download file":"Download file",Preview:"Preview",Refresh:"Refresh","Are you sure you want to exit without saving?":"Are you sure you want to exit without saving?","Save before closing?":"Save before closing?",Copy:"Copy",Cut:"Cut",Paste:"Paste","Deleting...":"Deleting...","Copying...":"Copying...","Moving...":"Moving...",Folders:"Folders","Search results":"Search results","Search results in":"Search results in","Search files and folders":"Search files and folders","Add new file":"Add new file","Add new folder":"Add new folder","Upload file":"Upload file","Upload folder":"Upload folder",folder:"folder",file:"file",archive:"archive",audio:"audio",image:"image",video:"video",code:"code",document:"document",of:"of",used:"used","Open item location":"Open item location","Are you sure you want to delete":"Are you sure you want to delete","these items:":"these items:","this item:":"this item:","Delete files":"Delete files",and:"and","more file(s)":"more file(s)","Close the editor":"Close the editor","Close this file":"Close this file"}};e.App=Ee,e.locales=Fe,e.services=Ae,e.views=Se,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=filemanager.min.js.map
